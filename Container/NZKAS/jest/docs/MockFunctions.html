<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Mock Functions</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Mock Functions</h1>
    </header>
    <p>
      Mock functions make it easy to test the links between code by erasing the
      actual implementation of a function, capturing calls to the function (and
      the parameters passed in those calls), capturing instances of constructor
      functions when instantiated with <code>new</code>, and allowing test-time
      configuration of return values.
    </p>
    <p>
      There are two ways to mock functions: Either by creating a mock function
      to use in test code, or writing a
      <a href="ManualMocks.md"><code>manual mock</code></a> to override a module
      dependency.
    </p>
    <h2 id="using-a-mock-function">Using a mock function</h2>
    <p>
      Let’s imagine we’re testing an implementation of a function
      <code>forEach</code>, which invokes a callback for each item in a supplied
      array.
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">function</span> <span class="at">forEach</span>(items<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="cf">for</span> (<span class="kw">let</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> <span class="va">items</span>.<span class="at">length</span><span class="op">;</span> index<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="at">callback</span>(items[index])<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="op">}</span></a></code></pre>
    </div>
    <p>
      To test this function, we can use a mock function, and inspect the mock’s
      state to ensure the callback is invoked as expected.
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> mockCallback <span class="op">=</span> <span class="va">jest</span>.<span class="at">fn</span>((x) <span class="kw">=&gt;</span> <span class="dv">42</span> <span class="op">+</span> x)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="at">forEach</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> mockCallback)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">// The mock function is called twice</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="at">expect</span>(<span class="va">mockCallback</span>.<span class="va">mock</span>.<span class="va">calls</span>.<span class="at">length</span>).<span class="at">toBe</span>(<span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">// The first argument of the first call to the function was 0</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="at">expect</span>(<span class="va">mockCallback</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="dv">0</span>][<span class="dv">0</span>]).<span class="at">toBe</span>(<span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">// The first argument of the second call to the function was 1</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="at">expect</span>(<span class="va">mockCallback</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="dv">1</span>][<span class="dv">0</span>]).<span class="at">toBe</span>(<span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">// The return value of the first call to the function was 42</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="at">expect</span>(<span class="va">mockCallback</span>.<span class="va">mock</span>.<span class="at">results</span>[<span class="dv">0</span>].<span class="at">value</span>).<span class="at">toBe</span>(<span class="dv">42</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="mock-property"><code>.mock</code> property</h2>
    <p>
      All mock functions have this special <code>.mock</code> property, which is
      where data about how the function has been called and what the function
      returned is kept. The <code>.mock</code> property also tracks the value of
      <code>this</code> for each call, so it is possible to inspect this as
      well:
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> myMock <span class="op">=</span> <span class="va">jest</span>.<span class="at">fn</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">const</span> a <span class="op">=</span> <span class="kw">new</span> <span class="at">myMock</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">const</span> b <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">const</span> bound <span class="op">=</span> <span class="va">myMock</span>.<span class="at">bind</span>(b)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="at">bound</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myMock</span>.<span class="va">mock</span>.<span class="at">instances</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">// &gt; [ &lt;a&gt;, &lt;b&gt; ]</span></a></code></pre>
    </div>
    <p>
      These mock members are very useful in tests to assert how these functions
      get called, instantiated, or what they returned:
    </p>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// The function was called exactly once</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="va">calls</span>.<span class="at">length</span>).<span class="at">toBe</span>(<span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">// The first arg of the first call to the function was &#39;first arg&#39;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="dv">0</span>][<span class="dv">0</span>]).<span class="at">toBe</span>(<span class="st">&#39;first arg&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">// The second arg of the first call to the function was &#39;second arg&#39;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="dv">0</span>][<span class="dv">1</span>]).<span class="at">toBe</span>(<span class="st">&#39;second arg&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">// The return value of the first call to the function was &#39;return value&#39;</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="at">results</span>[<span class="dv">0</span>].<span class="at">value</span>).<span class="at">toBe</span>(<span class="st">&#39;return value&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12"></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">// This function was instantiated exactly twice</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="va">instances</span>.<span class="at">length</span>).<span class="at">toBe</span>(<span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">// The object returned by the first instantiation of this function</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">// had a `name` property whose value was set to &#39;test&#39;</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="at">expect</span>(<span class="va">someMockFunction</span>.<span class="va">mock</span>.<span class="at">instances</span>[<span class="dv">0</span>].<span class="at">name</span>).<span class="at">toEqual</span>(<span class="st">&#39;test&#39;</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="mock-return-values">Mock Return Values</h2>
    <p>
      Mock functions can also be used to inject test values into your code
      during a test:
    </p>
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> myMock <span class="op">=</span> <span class="va">jest</span>.<span class="at">fn</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="at">myMock</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">// &gt; undefined</span></a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="va">myMock</span>.<span class="at">mockReturnValueOnce</span>(<span class="dv">10</span>).<span class="at">mockReturnValueOnce</span>(<span class="st">&#39;x&#39;</span>).<span class="at">mockReturnValue</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="at">myMock</span>()<span class="op">,</span> <span class="at">myMock</span>()<span class="op">,</span> <span class="at">myMock</span>()<span class="op">,</span> <span class="at">myMock</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">// &gt; 10, &#39;x&#39;, true, true</span></a></code></pre>
    </div>
    <p>
      Mock functions are also very effective in code that uses a functional
      continuation-passing style. Code written in this style helps avoid the
      need for complicated stubs that recreate the behavior of the real
      component they’re standing in for, in favor of injecting values directly
      into the test right before they’re used.
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> filterTestFn <span class="op">=</span> <span class="va">jest</span>.<span class="at">fn</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">// Make the mock return `true` for the first call,</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">// and `false` for the second call</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="va">filterTestFn</span>.<span class="at">mockReturnValueOnce</span>(<span class="kw">true</span>).<span class="at">mockReturnValueOnce</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">const</span> result <span class="op">=</span> [<span class="dv">11</span><span class="op">,</span> <span class="dv">12</span>].<span class="at">filter</span>(filterTestFn)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="va">console</span>.<span class="at">log</span>(result)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">// &gt; [11]</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="va">filterTestFn</span>.<span class="va">mock</span>.<span class="at">calls</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">// &gt; [ [11], [12] ]</span></a></code></pre>
    </div>
    <p>
      Most real-world examples actually involve getting ahold of a mock function
      on a dependent component and configuring that, but the technique is the
      same. In these cases, try to avoid the temptation to implement logic
      inside of any function that’s not directly being tested.
    </p>
    <h2 id="mocking-modules">Mocking Modules</h2>
    <p>
      Suppose we have a class that fetches users from our API. The class uses
      <a href="https://github.com/axios/axios">axios</a> to call the API then
      returns the <code>data</code> attribute which contains all the users:
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// users.js</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="im">import</span> axios <span class="im">from</span> <span class="st">&#39;axios&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">class</span> Users <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="kw">static</span> <span class="at">all</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="cf">return</span> <span class="va">axios</span>.<span class="at">get</span>(<span class="st">&#39;/users.json&#39;</span>).<span class="at">then</span>((resp) <span class="kw">=&gt;</span> <span class="va">resp</span>.<span class="at">data</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="im">export</span> <span class="im">default</span> Users<span class="op">;</span></a></code></pre>
    </div>
    <p>
      Now, in order to test this method without actually hitting the API (and
      thus creating slow and fragile tests), we can use the
      <code>jest.mock(...)</code> function to automatically mock the axios
      module.
    </p>
    <p>
      Once we mock the module we can provide a
      <code>mockResolvedValue</code> for <code>.get</code> that returns the data
      we want our test to assert against. In effect, we are saying that we want
      axios.get(‘/users.json’) to return a fake response.
    </p>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// users.test.js</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="im">import</span> axios <span class="im">from</span> <span class="st">&#39;axios&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="im">import</span> Users <span class="im">from</span> <span class="st">&#39;./users&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="va">jest</span>.<span class="at">mock</span>(<span class="st">&#39;axios&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="at">test</span>(<span class="st">&#39;should fetch users&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="kw">const</span> users <span class="op">=</span> [<span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Bob&#39;</span><span class="op">}</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb8-9" title="9">  <span class="kw">const</span> resp <span class="op">=</span> <span class="op">{</span><span class="dt">data</span><span class="op">:</span> users<span class="op">};</span></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="va">axios</span>.<span class="va">get</span>.<span class="at">mockResolvedValue</span>(resp)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="co">// or you could use the following depending on your use case:</span></a>
<a class="sourceLine" id="cb8-13" title="13">  <span class="co">// axios.get.mockImplementation(() =&gt; Promise.resolve(resp))</span></a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="cf">return</span> <span class="va">Users</span>.<span class="at">all</span>().<span class="at">then</span>((resp) <span class="kw">=&gt;</span> <span class="at">expect</span>(<span class="va">resp</span>.<span class="at">data</span>).<span class="at">toEqual</span>(users))<span class="op">;</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="mock-implementations">Mock Implementations</h2>
    <p>
      Still, there are cases where it’s useful to go beyond the ability to
      specify return values and full-on replace the implementation of a mock
      function. This can be done with <code>jest.fn</code> or the
      <code>mockImplementationOnce</code> method on mock functions.
    </p>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">const</span> myMockFn <span class="op">=</span> <span class="va">jest</span>.<span class="at">fn</span>((cb) <span class="kw">=&gt;</span> <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="at">myMockFn</span>((err<span class="op">,</span> val) <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(val))<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">// &gt; true</span></a></code></pre>
    </div>
    <p>
      The <code>mockImplementation</code> method is useful when you need to
      define the default implementation of a mock function that is created from
      another module:
    </p>
    <div class="sourceCode" id="cb10">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// foo.js</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="co">// some implementation;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">// test.js</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="va">jest</span>.<span class="at">mock</span>(<span class="st">&#39;../foo&#39;</span>)<span class="op">;</span> <span class="co">// this happens automatically with automocking</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">const</span> foo <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;../foo&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">// foo is a mock function</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="va">foo</span>.<span class="at">mockImplementation</span>(() <span class="kw">=&gt;</span> <span class="dv">42</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="at">foo</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">// &gt; 42</span></a></code></pre>
    </div>
    <p>
      When you need to recreate a complex behavior of a mock function such that
      multiple function calls produce different results, use the
      <code>mockImplementationOnce</code> method:
    </p>
    <div class="sourceCode" id="cb11">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> myMockFn <span class="op">=</span> jest</a>
<a class="sourceLine" id="cb11-2" title="2">  .<span class="at">fn</span>()</a>
<a class="sourceLine" id="cb11-3" title="3">  .<span class="at">mockImplementationOnce</span>((cb) <span class="kw">=&gt;</span> <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>))</a>
<a class="sourceLine" id="cb11-4" title="4">  .<span class="at">mockImplementationOnce</span>((cb) <span class="kw">=&gt;</span> <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="at">myMockFn</span>((err<span class="op">,</span> val) <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(val))<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">// &gt; true</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="at">myMockFn</span>((err<span class="op">,</span> val) <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(val))<span class="op">;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">// &gt; false</span></a></code></pre>
    </div>
    <p>
      When the mocked function runs out of implementations defined with
      <code>mockImplementationOnce</code>, it will execute the default
      implementation set with <code>jest.fn</code> (if it is defined):
    </p>
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> myMockFn <span class="op">=</span> jest</a>
<a class="sourceLine" id="cb12-2" title="2">  .<span class="at">fn</span>(() <span class="kw">=&gt;</span> <span class="st">&#39;default&#39;</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">  .<span class="at">mockImplementationOnce</span>(() <span class="kw">=&gt;</span> <span class="st">&#39;first call&#39;</span>)</a>
<a class="sourceLine" id="cb12-4" title="4">  .<span class="at">mockImplementationOnce</span>(() <span class="kw">=&gt;</span> <span class="st">&#39;second call&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="at">myMockFn</span>()<span class="op">,</span> <span class="at">myMockFn</span>()<span class="op">,</span> <span class="at">myMockFn</span>()<span class="op">,</span> <span class="at">myMockFn</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">// &gt; &#39;first call&#39;, &#39;second call&#39;, &#39;default&#39;, &#39;default&#39;</span></a></code></pre>
    </div>
    <p>
      For cases where we have methods that are typically chained (and thus
      always need to return <code>this</code>), we have a sugary API to simplify
      this in the form of a <code>.mockReturnThis()</code> function that also
      sits on all mocks:
    </p>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">const</span> myObj <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="dt">myMethod</span><span class="op">:</span> <span class="va">jest</span>.<span class="at">fn</span>().<span class="at">mockReturnThis</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">// is the same as</span></a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="kw">const</span> otherObj <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="dt">myMethod</span><span class="op">:</span> <span class="va">jest</span>.<span class="at">fn</span>(<span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="op">};</span></a></code></pre>
    </div>
    <h2 id="mock-names">Mock Names</h2>
    <p>
      You can optionally provide a name for your mock functions, which will be
      displayed instead of “jest.fn()” in test error output. Use this if you
      want to be able to quickly identify the mock function reporting an error
      in your test output.
    </p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> myMockFn <span class="op">=</span> jest</a>
<a class="sourceLine" id="cb14-2" title="2">  .<span class="at">fn</span>()</a>
<a class="sourceLine" id="cb14-3" title="3">  .<span class="at">mockReturnValue</span>(<span class="st">&#39;default&#39;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4">  .<span class="at">mockImplementation</span>((scalar) <span class="kw">=&gt;</span> <span class="dv">42</span> <span class="op">+</span> scalar)</a>
<a class="sourceLine" id="cb14-5" title="5">  .<span class="at">mockName</span>(<span class="st">&#39;add42&#39;</span>)<span class="op">;</span></a></code></pre>
    </div>
    <h2 id="custom-matchers">Custom Matchers</h2>
    <p>
      Finally, in order to make it simpler to assert how mock functions have
      been called, we’ve added some custom matcher functions for you:
    </p>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="co">// The mock function was called at least once</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="at">expect</span>(mockFunc).<span class="at">toBeCalled</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-3" title="3"></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">// The mock function was called at least once with the specified args</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="at">expect</span>(mockFunc).<span class="at">toBeCalledWith</span>(arg1<span class="op">,</span> arg2)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-6" title="6"></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">// The last call to the mock function was called with the specified args</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="at">expect</span>(mockFunc).<span class="at">lastCalledWith</span>(arg1<span class="op">,</span> arg2)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9"></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">// All calls and the name of the mock is written as a snapshot</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="at">expect</span>(mockFunc).<span class="at">toMatchSnapshot</span>()<span class="op">;</span></a></code></pre>
    </div>
    <p>
      These matchers are really just sugar for common forms of inspecting the
      <code>.mock</code> property. You can always do this manually yourself if
      that’s more to your taste or if you need to do something more specific:
    </p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="co">// The mock function was called at least once</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="va">calls</span>.<span class="at">length</span>).<span class="at">toBeGreaterThan</span>(<span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3"></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">// The mock function was called at least once with the specified args</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="at">calls</span>).<span class="at">toContain</span>([arg1<span class="op">,</span> arg2])<span class="op">;</span></a>
<a class="sourceLine" id="cb16-6" title="6"></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="co">// The last call to the mock function was called with the specified args</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="va">calls</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>]).<span class="at">toEqual</span>([</a>
<a class="sourceLine" id="cb16-9" title="9">  arg1<span class="op">,</span></a>
<a class="sourceLine" id="cb16-10" title="10">  arg2<span class="op">,</span></a>
<a class="sourceLine" id="cb16-11" title="11">])<span class="op">;</span></a>
<a class="sourceLine" id="cb16-12" title="12"></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="co">// The first arg of the last call to the mock function was `42`</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="co">// (note that there is no sugar helper for this specific of an assertion)</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="at">calls</span>[<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="va">calls</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>][<span class="dv">0</span>]).<span class="at">toBe</span>(<span class="dv">42</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-16" title="16"></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co">// A snapshot will check that a mock was invoked the same number of times,</span></a>
<a class="sourceLine" id="cb16-18" title="18"><span class="co">// in the same order, with the same arguments. It will also assert on the name.</span></a>
<a class="sourceLine" id="cb16-19" title="19"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="va">mock</span>.<span class="at">calls</span>).<span class="at">toEqual</span>([[arg1<span class="op">,</span> arg2]])<span class="op">;</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="at">expect</span>(<span class="va">mockFunc</span>.<span class="at">getMockName</span>()).<span class="at">toBe</span>(<span class="st">&#39;a mock name&#39;</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      For a complete list of matchers, check out the
      <a href="ExpectAPI.md">reference docs</a>.
    </p>
  </body>
</html>
