<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>2019-01-25-jest-24-refreshing-polished-typescript-friendly</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <p>
      Today we are happy to announce the next major release of Jest - version
      24! It’s been 4 months since the last minor release, and 8 months since
      Jest 23, so this upgrade is a big one, with something for everyone!
      Highlights include built-in support for TypeScript by upgrading the Jest
      internals to Babel 7, fixing some long-standing issues with missing
      console output and performance issues when computing large diffs, and a
      brand new sparkling website. ✨
    </p>
    <p>
      For a full list of all changes see the
      <a href="https://github.com/facebook/jest/blob/master/CHANGELOG.md"
        >changelog</a
      >.
    </p>
    <!--truncate-->
    <h2 id="new-website">New Website</h2>
    <p>
      <span class="citation" data-cites="orta">[@orta]</span
      >(https://twitter.com/orta) has provided a beautiful redesign of Jest’s
      website, which has been implemented by community members
      <span class="citation" data-cites="montogeek">[@montogeek]</span
      >(https://twitter.com/montogeek) and
      <span class="citation" data-cites="brainkim">[@brainkim]</span
      >(https://github.com/brainkim).
    </p>
    <p>
      The aim of the redesign was to highlight more of what makes Jest awesome,
      and to decouple the idea that Jest is primarily a tool for testing React
      apps - you can use Jest with all sorts of projects and we want to make
      that obvious. You can read more about the ideas behind the redesign in
      <a href="https://github.com/facebook/jest/issues/7265">this issue</a>.
    </p>
    <h2 id="typescript-support">TypeScript support</h2>
    <p>
      We’ve upgraded to Babel 7 internally for Jest 24, which comes with support
      for TypeScript projects. That means Jest can support transpiling
      TypeScript out of the box, as long as you configure Babel to use it with
      <code>@babel/preset-typescript</code>. One caveat to the default
      TypeScript support, similar to Flow, is that Babel will only strip out the
      type annotations to make your code valid JavaScript. It will
      <em>not</em> typecheck your code.
    </p>
    <p>
      While Jest has supported Babel 7 since version 22 released in December
      2017, it required usage of a bridge module in order to fit in with Jest’s
      support of Babel 6. In Jest 24 we have migrated entirely over to Babel 7,
      with great help from community member
      <span class="citation" data-cites="milesj">[@milesj]</span
      >(https://github.com/milesj). This means that setup is now easier and we
      can take advantage of other Babel 7 features, such as config loading and
      automatic <code>modules</code> transpilation. Make sure to remove the
      <code>babel-core@^7.0.0-bridge.0</code> as it’s not needed now.
    </p>
    <p>
      If you want to run typechecks while you test, you should use
      <a href="https://github.com/kulshekhar/ts-jest"><code>ts-jest</code></a
      >. You will need to configure the transformer, as Jest by default applies
      Babel to <code>.ts</code> (and <code>.tsx</code>) files. Alternatively,
      you can run <code>tsc</code> or even use a Jest runner to simultaneously
      transpile your TypeScript whilst running your tests! See
      <a href="https://github.com/azz/jest-runner-tsc"
        ><code>jest-runner-tsc</code></a
      >
      for more information.
    </p>
    <p>
      <em
        >Note that if you for whatever reason cannot upgrade to Babel 7, you can
        still use Jest 24 with <code>babel@6</code> as long as you keep
        <code>babel-jest</code> at version 23.</em
      >
    </p>
    <h2 id="test.todo"><code>test.todo</code></h2>
    <p>
      Jest 23 had a change that made tests missing an implementation throw
      instead of being skipped. This change was made due to feedback that
      accidentally skipped tests were hard to discover and hard to track down.
      However, this change broke the workflow for quite a few developers who
      used the feature to sketch out which tests to write.
    </p>
    <p>
      In Jest 24, we are addressing this issue by adding an explicit
      <code>test.todo</code> (inspired by the excellent AVA), which will be
      printed separately in the test summary. It allows you to quickly sketch
      out which tests you want to write and in the future, an
      <a href="https://eslint.org/">ESLint</a> rule might even be able to warn
      you that you have forgotten to write out some tests.
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="va">test</span>.<span class="at">todo</span>(<span class="st">&#39;invalid input should throw&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="va">test</span>.<span class="at">todo</span>(<span class="st">&#39;missing options should be normalized&#39;</span>)<span class="op">;</span></a></code></pre>
    </div>
    <figure>
      <img src="/img/blog/24-todo.png" alt="test.todo" />
      <figcaption>test.todo</figcaption>
    </figure>
    <h2 id="improved-assertion-messages">Improved Assertion Messages</h2>
    <p>
      When tests fail, you need to make confident and correct decisions which
      changes are expected progress and which changes are unexpected
      regressions. It is especially important not to miss a few regressions
      hidden among much progress. Jest 24 makes reports when assertions fail
      more clear and concise for several matchers. Because the effort will
      continue in Jest 25, you might notice some temporary inconsistencies. If
      your tests never fail, then you won’t get to see them - for the rest of
      us, it’ll be easier to debug why something isn’t working as expected.
      Thanks for the hard work by
      <span class="citation" data-cites="ittordepam">[@ittordepam]</span
      >(https://twitter.com/ittordepam) and other contributors from the
      community.
    </p>
    <p>
      You can see these changes across all these PRs:
      <a href="https://github.com/facebook/jest/pull/7621">7621</a>,
      <a href="https://github.com/facebook/jest/pull/7557">7557</a>,
      <a href="https://github.com/facebook/jest/pull/7448">7448</a>,
      <a href="https://github.com/facebook/jest/pull/7325">7325</a>,
      <a href="https://github.com/facebook/jest/pull/7241">7241</a>,
      <a href="https://github.com/facebook/jest/pull/7152">7152</a>,
      <a href="https://github.com/facebook/jest/pull/7125">7125</a>,
      <a href="https://github.com/facebook/jest/pull/7107">7107</a>,
      <a href="https://github.com/facebook/jest/pull/6961">6961</a>.
    </p>
    <p>Examples:</p>
    <p>Failing assertion</p>
    <figure>
      <img src="/img/blog/24-assertion-error.png" alt="failing assertion" />
      <figcaption>failing assertion</figcaption>
    </figure>
    <p>Type mismatch</p>
    <figure>
      <img src="/img/blog/24-different-types.png" alt="different types" />
      <figcaption>different types</figcaption>
    </figure>
    <p>Mock function not called</p>
    <figure>
      <img src="/img/blog/24-mock-function.png" alt="mock functions" />
      <figcaption>mock functions</figcaption>
    </figure>
    <h2 id="fixing-old-pain">Fixing old pain</h2>
    <p>We’ve fixed a couple of really old issues in this release.</p>
    <p>
      The first one we’d like to highlight is
      <code>console.log</code> statements going missing. Jest intercepts and
      collects all logs in order to give you a stack trace to them, as well as
      provide them to reporters so you can handle them however you want.
      However, this has led to an issue where they have simply been missing in
      certain edge cases. Luckily for Jest 24,
      <span class="citation" data-cites="spion">[@spion]</span
      >(https://twitter.com/spion) has
      <a href="https://github.com/facebook/jest/pull/6871">stepped up</a> and
      fixed this issue. Thank you very much!
    </p>
    <p>
      The second one is an issue where Jest runs out of memory if the difference
      in serialization of expected and received value has a huge number of
      insertion changes (either unexpected because of mistake in test or defect
      in serializer or expected because of temporary failures during test-driven
      development).
      <span class="citation" data-cites="ittordepam">[@ittordepam]</span
      >(https://twitter.com/ittordepam) has
      <a href="https://github.com/facebook/jest/pull/6961">replaced</a> the
      previous diffing algorithm with <code>diff-sequences</code> package, which
      should fix this issue because it uses the theoretical minimum amount of
      memory. It opens up possibility for word-diffs in the future, similar to
      what
      <a href="https://git-scm.com/docs/git-diff#git-diff---word-diffltmodegt"
        >git provides</a
      >. Please see
      <a href="https://github.com/facebook/jest/pull/4619">this PR</a> and don’t
      hesitate to reach out if you want to help make that happen!
    </p>
    <h2 id="other-highlights">Other highlights</h2>
    <ul>
      <li>
        We have some improvements for <code>globalSetup</code> and
        <code>globalTeardown</code> as well - code transformation will be
        applied to them similar to <code>setupFiles</code> and they are now
        supported as part of <code>projects</code>.
      </li>
      <li>
        You can
        <a href="https://github.com/facebook/jest/pull/6143">configure</a>
        Jest’s snapshot location, this is mainly useful if you are building
        tools which use Jest in a larger build process.
      </li>
      <li>
        A quirk of Jest’s CLI has been that while some flags and options have
        been camel cased (such as <code>runInBand</code>), others have not been
        (such as <code>no-cache</code>). In Jest 24, both are recognized,
        meaning you can write your CLI arguments however you want.
      </li>
      <li>
        We’ve renamed <code>setupTestFrameworkScriptFile</code> to
        <code>setupFilesAfterEnv</code>, and made it into an array. We hope this
        will make it more obvious what the options is for. We have plans to
        further overhaul the configuration in the next major, see the paragraph
        in the section below.
      </li>
      <li>
        To reduce the amount of magic Jest performs to “just work™”, in this
        release we decided to drop automatic injection of
        <code>regenerator-runtime</code>, which is sometimes used in compiled
        async code. Including <code>regenerator-runtime</code> is not always
        necessary and we believe it’s the user’s responsibility to include it if
        it’s needed. If you use <code>@babel/preset-env</code> with
        <code>targets</code> set to a modern Node version (e.g. Node 6+) you
        will not need to include it. Please see our
        <a href="/docs/en/getting-started#using-babel">Using Babel docs</a> for
        more information.
      </li>
      <li>
        Node.js 10 came with an experimental module
        <a href="https://nodejs.org/api/worker_threads.html"
          >called <code>worker_threads</code></a
        >, which is similar to Worker threads in the browser.
        <code>jest-worker</code>, part of the
        <a href="/docs/en/jest-platform">Jest platform</a>, will be able to use
        <code>worker_threads</code> if available instead of
        <code>child_process</code>, which makes it even faster!
        <a href="https://github.com/facebook/jest/pull/6676">Benchmarks</a> show
        a 50% improvement. Due to its experimental nature, it’s not enabled when
        using Jest as a test runner, but you can use it in your own projects
        today! We plan to enable it by default when it’s promoted from
        experimantal status in Node.js.
      </li>
    </ul>
    <h2 id="breaking-changes">Breaking Changes</h2>
    <p>
      While all breaking changes are listed in the
      <a href="https://github.com/facebook/jest/blob/master/CHANGELOG.md"
        >changelog</a
      >, there’s a few of them that are worth highlighting:
    </p>
    <ul>
      <li>
        We’ve upgraded to Micromatch 3. While this might not affect every user,
        it is stricter in its parsing of globs than version 2, which is used in
        Jest 23. Please read through
        <a
          href="https://github.com/micromatch/micromatch/issues/133#issuecomment-404211484"
          >this</a
        >
        and linked issues for examples of invalid globs in case you have
        problems.
      </li>
      <li>
        We’ve removed code remnants that was needed for Node 4. It was
        previously technically possible to run Jest 23 on Node 4 - that is no
        longer possible without polyfilling and transpiling.
      </li>
      <li>
        Some changes to serialization of mock functions in snapshots - make sure
        to double check your updated snapshots after upgrading. Related
        <a href="https://github.com/facebook/jest/pull/6381">PR</a>.
      </li>
      <li>
        Jest no longer automatically injects <code>regenerator-runtime</code> -
        if you get errors concering it, make sure to configure Babel to properly
        transpile <code>async</code> functions, using
        e.g. <code>@babel/preset-env</code>. Related
        <a href="https://github.com/facebook/jest/pull/7595">PR</a>.
      </li>
    </ul>
    <h2 id="the-future">The future</h2>
    <p>
      We are incredibly humbled by the results in
      <a href="https://2018.stateofjs.com/awards/">State Of JS 2018</a>, where
      Jest won the “Highest Satisfaction” award. Another huge thing to happen in
      2018 was in October, when Jest passed 2 million weekly downloads for the
      first time. Thank you.
    </p>
    <p>
      We are very thankful for the trust in us shown by the community, and hope
      to build on it in the future. We will ensure Jest 24 and future releases
      will continue to build upon this incredible foundation, and continue to be
      an integral part of JavaScript developers’ toolkits.
    </p>
    <p>
      This has been the first release where we have explored the idea of using
      our Open Collective funding to create bug bounties. This worked well in
      getting non-core developers involved in the implementation of the new
      landing page, and we’re optimistic for a long running bug where Jest
      globals
      <a href="https://github.com/facebook/jest/issues/2549">are mismatched</a>
      from Node globals. We’d like to do more, if you have a pet bug that’s a
      good candidate for our bounty program, please let us know. In the
      meantime, you can find all the tickets with a bounty via
      <a href="https://github.com/facebook/jest/labels/Has%20Bounty"
        >the issue label</a
      >.
    </p>
    <p>
      We have already started to make plans for the next release of Jest 25,
      with the biggest planned feature being an overhaul of our configuration,
      which is pretty hard to grok, mainly because of overlapping option and
      mixing globs and regular expressions. Feedback on how you want Jest’s
      configuration to look is very much welcome, and can be submitted in
      <a href="https://github.com/facebook/jest/issues/7185">this issue</a>.
    </p>
    <p>
      You might also have heard that we are planning to migrate the code base
      from Flow to TypeScript. We are hopeful that this migration will enable
      even more contributors to jump in and help make 2019 even better for
      JavaScript testing. 🚀 The plan is to land this in a minor release in the
      not too distant future. Feedback on this choice can be added to
      <a href="https://github.com/facebook/jest/pull/7554">the RFC</a>.
    </p>
    <p>
      Lastly, if you’ve ever wondered about how Jest is built,
      <span class="citation" data-cites="cpojer">[@cpojer]</span
      >(https://twitter.com/cpojer) has recorded a video with an architectural
      overview of how Jest is put together under the hood. Feel free to reach
      out if you have any further questions about it. The video is available on
      our <a href="https://jestjs.io/docs/en/next/architecture">website</a>.
    </p>
    <p>Happy Jesting! 🃏</p>
  </body>
</html>
