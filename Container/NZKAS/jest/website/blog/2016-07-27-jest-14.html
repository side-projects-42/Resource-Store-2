<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>2016-07-27-jest-14</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <p>
      One of Jest’s philosophies is to provide an integrated
      “zero-configuration” experience. We want to make it as frictionless as
      possible to write good tests that are useful. We observed that when
      engineers are provided with ready-to-use tools, they end up writing more
      tests, which in turn results in stable and healthy code bases.
    </p>
    <p>
      One of the big open questions was how to write React tests efficiently.
      There are plenty of tools such as
      <a href="https://facebook.github.io/react/docs/test-utils.html"
        >ReactTestUtils</a
      >
      and <a href="http://airbnb.io/enzyme/">enzyme</a>. Both of these tools are
      great and are actively being used. However engineers frequently told us
      that they spend more time writing a test than the component itself. As a
      result many people stopped writing tests altogether which eventually led
      to instabilities. Engineers told us all they wanted was to make sure their
      components don’t change unexpectedly.
    </p>
    <!--truncate-->
    <p>
      Together with the React team we created a new test renderer for React and
      added snapshot testing to Jest. Consider this
      <a
        href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/Link.react-test.js"
        >example test</a
      >
      for a simple
      <a
        href="https://github.com/facebook/jest/blob/master/examples/snapshot/Link.react.js"
        >Link component</a
      >:
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> renderer <span class="im">from</span> <span class="st">&#39;react-test-renderer&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="at">test</span>(<span class="st">&#39;Link renders correctly&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">const</span> tree <span class="op">=</span> renderer</a>
<a class="sourceLine" id="cb1-4" title="4">    .<span class="at">create</span>(<span class="op">&lt;</span>Link page<span class="op">=</span><span class="st">&quot;http://www.facebook.com&quot;</span><span class="op">&gt;</span>Facebook&lt;/Link<span class="op">&gt;</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">    .<span class="at">toJSON</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="at">expect</span>(tree).<span class="at">toMatchSnapshot</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      The first time this test is run, Jest creates a
      <a
        href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/__snapshots__/Link.react-test.js.snap"
        >snapshot file</a
      >
      that looks like this:
    </p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1">exports[<span class="vs">`Link renders correctly 1`</span>] <span class="op">=</span> <span class="vs">`</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="vs">&lt;a</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="vs">  className=&quot;normal&quot;</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="vs">  href=&quot;http://www.facebook.com&quot;</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="vs">  onMouseEnter={[Function bound _onMouseEnter]}</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="vs">  onMouseLeave={[Function bound _onMouseLeave]}&gt;</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="vs">  Facebook</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="vs">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="vs">`</span><span class="op">;</span></a></code></pre>
    </div>
    <p>
      The snapshot artifact should be committed alongside code changes. We use
      <a href="https://github.com/thejameskyle/pretty-format">pretty-format</a>
      to make snapshots human-readable during code review. On subsequent test
      runs Jest will simply compare the rendered output with the previous
      snapshot. If they match, the test will pass. If they don’t match, either
      the implementation has changed and the snapshot needs to be updated with
      <code>jest -u</code>, or the test runner found a bug in your code that
      should be fixed.
    </p>
    <p>
      If we change the address the Link component in our example is pointing to,
      Jest will print this output:
    </p>
    <figure>
      <img src="/img/blog/snapshot.png" alt="snapshot-testing" />
      <figcaption>snapshot-testing</figcaption>
    </figure>
    <p>
      Now you know that you either need to accept the changes with
      <code>jest -u</code>, or fix the component if the changes were
      unintentional. To try out this functionality, please clone the
      <a href="https://github.com/facebook/jest/tree/master/examples/snapshot"
        >snapshot example</a
      >, modify the Link component and run Jest. We updated the
      <a href="/docs/tutorial-react.html">React Tutorial</a> with a new guide
      for snapshot testing.
    </p>
    <p>
      This feature was built by
      <a href="https://twitter.com/soprano">Ben Alpert</a> and
      <a href="https://twitter.com/kentaromiura">Cristian Carlesso</a>.
    </p>
    <h2 id="experimental-react-native-support">
      Experimental React Native support
    </h2>
    <p>
      By building a test renderer that targets no specific platform we are
      finally able to support a full, unmocked version of React Native. We are
      excited to launch experimental React Native support for Jest through the
      <code>jest-react-native</code> package.
    </p>
    <p>
      You can start using Jest with react-native by running
      <code>yarn add --dev jest-react-native</code> and by adding the preset to
      your Jest configuration:
    </p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode json"
      ><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="er">&quot;jest&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">&quot;preset&quot;</span><span class="fu">:</span> <span class="st">&quot;jest-react-native&quot;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="fu">}</span></a></code></pre>
    </div>
    <ul>
      <li>
        <a href="/docs/tutorial-react-native.html#content"
          >Tutorial and setup guide</a
        >
      </li>
      <li>
        <a
          href="https://github.com/facebook/jest/tree/master/examples/react-native"
          >Example project</a
        >
      </li>
      <li>
        <a href="https://github.com/bartonhammond/snowflake/pull/110"
          >Example pull request for <em>snowflake</em></a
        >, a popular react-native open source library.
      </li>
    </ul>
    <p>
      <em
        >Note: the preset currently only implements the minimal set of
        configuration necessary to get started with React Native testing. We are
        hoping for community contributions to improve this project. Please try
        it and file
        <a href="https://github.com/facebook/jest/issues">issues</a> or send
        pull requests!</em
      >
    </p>
    <h2 id="why-snapshot-testing">Why snapshot testing?</h2>
    <p>
      For Facebook’s native apps we use a system called “snapshot testing”: a
      snapshot test system that renders UI components, takes a screenshot and
      subsequently compares a recorded screenshot with changes made by an
      engineer. If the screenshots don’t match, there are two possibilities:
      either the change is unexpected or the screenshot can be updated to the
      new version of the UI component.
    </p>
    <p>
      While this was the solution we wanted for the web, we also found many
      problems with such end-to-end tests that snapshot integration tests solve:
    </p>
    <ul>
      <li>
        <strong>No flakiness:</strong> Because tests are run in a command line
        runner instead of a real browser or on a real phone, the test runner
        doesn’t have to wait for builds, spawn browsers, load a page and drive
        the UI to get a component into the expected state which tends to be
        flaky and the test results become noisy.
      </li>
      <li>
        <strong>Fast iteration speed:</strong> Engineers want to get results in
        less than a second rather than waiting for minutes or even hours. If
        tests don’t run quickly like in most end-to-end frameworks, engineers
        don’t run them at all or don’t bother writing them in the first place.
      </li>
      <li>
        <strong>Debugging:</strong> It’s easy to step into the code of an
        integration test in JS instead of trying to recreate the screenshot test
        scenario and debugging what happened in the visual diff.
      </li>
    </ul>
    <p>
      Because we believe snapshot testing can be useful beyond Jest we split the
      feature into a
      <a
        href="https://github.com/facebook/jest/tree/master/packages/jest-snapshot"
        >jest-snapshot</a
      >
      package. We are happy to work with the community to make it more generic
      so it can be integrated with other test runners and share concepts and
      infrastructure with each other.
    </p>
    <p>
      Finally, here is a quote of a Facebook engineer describing how snapshot
      testing changed his unit testing experience:
    </p>
    <blockquote>
      <p>
        “One of the most challenging aspects of my project was keeping the input
        and output files for each test case in sync. Each little change in
        functionality could cause all the output files to change. With snapshot
        testing I do not need the output files, the snapshots are generated for
        free by Jest! I can simply inspect how Jest updates the snapshots rather
        than making the changes manually.” –
        <a href="https://github.com/kyldvs">Kyle Davis</a> working on
        <a href="https://github.com/kyldvs/fjs">fjs</a>.
      </p>
    </blockquote>
    <h2 id="whats-next-for-jest">What’s next for Jest</h2>
    <p>
      Recently <a href="https://twitter.com/aaronabramov_">Aaron Abramov</a> has
      joined the Jest team full time to improve our unit and integration test
      infrastructure for Facebook’s ads products. For the next few months the
      Jest team is planning major improvements in these areas:
    </p>
    <ul>
      <li>
        <strong>Replace Jasmine:</strong> Jasmine is slowing us down and is not
        being very actively developed. We started replacing all the Jasmine
        matchers and are excited to add new features and drop this dependency.
      </li>
      <li>
        <strong>Code Coverage:</strong> When Jest was originally created, tools
        such as babel didn’t exist. Our code coverage support has a bunch of
        edge cases and isn’t always working properly. We are rewriting it to
        address all the current problems with coverage.
      </li>
      <li>
        <strong>Developer Experience:</strong> This ranges from improving the
        setup process, the debugging experience to CLI improvements and more
        documentation.
      </li>
      <li>
        <strong>Mocking:</strong> The mocking system, especially around manual
        mocks, is not working well and is confusing. We hope to make it more
        strict and easier to understand.
      </li>
      <li>
        <strong>Performance:</strong> Further performance improvements
        especially for really large codebases are being worked on.
      </li>
    </ul>
    <p>
      As always, if you have questions or if you are excited to help out, please
      reach out to us!
    </p>
  </body>
</html>
