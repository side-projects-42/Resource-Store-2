<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>
      2015-11-06-mitigating-unauthenticated-remote-code-execution-0-day-in-jenkins-cli
    </title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <p>
      <strong>Updated 2015-11-11 15:00 UTC:</strong> We have released Jenkins
      1.638 and 1.625.2 which contain a fix for this vulnerability.
      <a
        href="https://wiki.jenkins-ci.org/display/SECURITY/Jenkins+Security+Advisory+2015-11-11"
        >See the security advisory for more information about these releases</a
      >.
    </p>
    <hr />
    <p>
      <strong>Updated 2015-11-06 03:55 UTC:</strong> Included a updated
      mitigation script which doesn’t have a Jenkins boot race condition
    </p>
    <hr />
    <p>
      Earlier today we received numerous reports about a previously undisclosed
      “<a href="https://en.wikipedia.org/wiki/Zero-day_%28computing%29"
        >zero day</a
      >” critical remote code execution vulnerability and exploit in Jenkins
      core. Unfortunately the vulnerability was not disclosed to us ahead of its
      publication so we’re still working on more thorough fix. In the
      <em>meantime</em> however, we wanted to inform you of the issue and
      provide a workaround which will help prevent this exploit from being used
      against public Jenkins installations, for future reference this issue is
      being tracked privately as <code>SECURITY-218</code> in our
      <a href="https://issues.jenkins-ci.org">issue tracker</a>.
    </p>
    <p>
      The attack is mounted through the
      <a href="https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+CLI"
        >Jenkins CLI</a
      >
      subsystem, so the work-around is to remove/disable the CLI support inside
      of the running Jenkins server.
    </p>
    <p>
      Using the following Groovy script you can disable the attack vector in
      your Jenkins installations by navigating to “Manage Jenkins” and then to
      “Script Console”, or just go to
      <code>http://your-jenkins-installation/script</code>. This only addresses
      the current running Jenkins process, in order to make the workaround
      persist between restarts of the Jenkins server, add the script below to
      <code>$JENKINS_HOME/init.groovy.d/cli-shutdown.groovy</code> (create the
      directory if necessary, and the file).
    </p>
    <hr />
    <pre><code>import jenkins.*;
import jenkins.model.*;
import hudson.model.*;

// disabled CLI access over TCP listener (separate port)
def p = AgentProtocol.all()
p.each { x -&gt;
  if (x.name.contains(&quot;CLI&quot;)) p.remove(x)
}

// disable CLI access over /cli URL
def removal = { lst -&gt;
  lst.each { x -&gt; if (x.getClass().name.contains(&quot;CLIAction&quot;)) lst.remove(x) }
}
def j = Jenkins.instance;
removal(j.getExtensionList(RootAction.class))
removal(j.actions)</code></pre>
    <hr />
    <p>
      in order to make the workaround persist between restarts of the Jenkins
      server, add the script below to
      <code>$JENKINS_HOME/init.groovy.d/cli-shutdown.groovy</code> (create the
      directory if necessary, and the file).
    </p>
    <p>
      The latest version of this script can be found
      <a href="https://github.com/jenkinsci-cert/SECURITY-218"
        >in this GitHub repository</a
      >.
    </p>
    <p>
      As previously announced on the
      <a href="https://groups.google.com/d/forum/jenkinsci-advisories"
        >jenkinsci-advisories</a
      >
      mailing list we’re preparing a security release for this upcoming
      Wednesday which will include patches for both the latest and LTS lines of
      Jenkins core. The Jenkins Security team is working to include a fix for
      this previously undisclosed exploit in or before this planned security
      release.
    </p>
    <p>
      If you have questions about this exploit, join us in the
      <a href="http://webchat.freenode.net/?channels=%23jenkins&amp;uio=d4"
        >#jenkins channel on Freenode</a
      >
      or ask on the
      <a href="https://groups.google.com/d/forum/jenkinsci-users"
        >jenkinsci-users@ mailing list</a
      >.
    </p>
    <p>
      For security researchers and hobbyists, if you believe you have found a
      security vulnerability in Jenkins, we have some disclosure guidelines
      <a href="https://wiki.jenkins-ci.org/display/JENKINS/Security+Advisories"
        >on this wiki page</a
      >
      which will help us mitigate any discovered issues as quickly and safely as
      possible.
    </p>
    <hr />
    <p>
      Be sure to subscribe to the jenkinsci-advisories mailing list (<a
        href="https://groups.google.com/d/forum/jenkinsci-advisories"
        >jenkinsci-advisories</a
      >), it’s the fastest way to get updates by the Jenkins Security team.
    </p>
  </body>
</html>
