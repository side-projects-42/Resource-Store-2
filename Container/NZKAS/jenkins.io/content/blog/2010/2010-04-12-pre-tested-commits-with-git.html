<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>2010-04-12-pre-tested-commits-with-git</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <p>
      At the first
      <a href="http://wiki.hudson-ci.org/display/HUDSON/BayAreaMeetup"
        >Bay Area Hackathon</a
      >
      in mid-2009, the topic du jour was “<a
        href="http://wiki.hudson-ci.org/display/HUDSON/Designing+pre-tested+commit"
        >pre-tested commits</a
      >.” As potential implementations of the concept were discussed over
      burgers from
      <a id="aptureLink_gLlt1i6v1p" href="http://www.brickhousesf.com/"
        >Brickhouse</a
      >
      in downtown San Francisco, we realized as a group a few things: first,
      those burgers were <em>delicious</em>, but more importantly: pre-testing
      commits is very-SCM dependent and involves a lot of moving parts. One of
      the positive changes that came out shortly after the meet up was the
      support for “Concurrent Builds”, allowing a job to be executed
      concurrently on different slaves, a precursor to pre-tested commit
      support. Fervor for the pre-tested commit feature lowered as time went on,
      the feature being too dependent on the SCM itself was generally accepted
      as the reasoning behind the feature languishing.
    </p>
    <p>
      Chances are the feature is in fact too large for Hudson to support alone.
      It requires Hudson, the SCM and likely a third tool to work in concert
      together to perform such a feat.
    </p>
    <p>
      With Git, and the phenomenal code review tool
      <a href="http://code.google.com/p/gerrit/">Gerrit</a>, and the
      <a href="http://wiki.hudson-ci.org/display/HUDSON/Gerrit+Plugin"
        >Gerrit plugin</a
      >
      by intrepid plugin developer,
      <a href="http://twitter.com/jyrkiputtonen">Jyrki Puttonen</a>, pre-tested
      commits with Hudson, Git and Gerrit <em>are</em> possible.
    </p>
    <!--break-->
    <p>
      For Git users more familiar with the distributed Git workflows, working
      with Gerrit should seem familiar. Gerrit has
      <a id="aptureLink_MoOPmIyV3m" href="http://www.eclipse.org/jgit/">JGit</a
      >, a Java implementation of Git embedded within it, along with an
      <code>sshd</code> stack, meaning Gerrit can masquerade as a “regular” Git
      remote repository. Developers can push and pull to the repository just as
      they can with any other Git repository (provided they have permissions of
      course). I won’t delve too much into using Gerrit specifically here, but
      the pre-tested workflow with Gerrit and Hudson would look something like
      this:
    </p>
    <ul>
      <li>Dev creates a topic branch to work on a change</li>
      <li>Code is written (and hopefully tested) and committed locally</li>
      <li>Dev pushes commit(s) to Gerrit</li>
      <li>
        Hudson job (set to Poll SCM) picks up the patch, runs the job and marks
        it as “+1 Verified” or “-1 Fails”
      </li>
      <li>
        If the job fails or is unstable, the change should be reworked or
        corrected (typically with
        <a
          id="aptureLink_YL8glbfS7G"
          href="http://www.kernel.org/pub/software/scm/git/docs/git-rebase.html"
          >git-rebase(1)</a
        >)
      </li>
      <li>
        If Hudson says the change is good to go, it can be cherry-picked or
        pulled directly from Gerrit.
      </li>
    </ul>
    <p>For example:</p>
    <center>
      <a href="http://agentdero.cachefly.net/continuousblog/gerrit_patch.png"
        ><img
          src="http://agentdero.cachefly.net/continuousblog/gerrit_patch.png"
          width="520"
      /></a>
    </center>
    <p>
      To learn more about Gerrit, check out the
      <a href="http://code.google.com/p/gerrit/">project page on Google Code</a
      >; information on the Gerrit plugin can be
      <a href="http://wiki.hudson-ci.org/display/HUDSON/Gerrit+Plugin"
        >found on the wiki</a
      >.
    </p>
    <hr />
  </body>
</html>
