<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>2016-05-11-security-update</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <p>
      We just released security updates to Jenkins that fix a number of low and
      medium severity issues. For an overview of what was fixed, see the
      <a
        href="https://wiki.jenkins-ci.org/display/SECURITY/Jenkins+Security+Advisory+2016-05-11"
        >security advisory</a
      >.
    </p>
    <p>
      One of the fixes may well break some of your use cases in Jenkins, at
      least until plugins have been adapted: SECURITY-170. This change removes
      parameters that are not defined on a job from the build environment. So,
      right now, a job could even be unparameterized, and plugins were able to
      pass parameters anyway. Since build parameters are added to the
      environment variables of scripts run during a build, parameters such as
      <code>PATH</code> or <code>DYLD_LIBRARY_PATH</code> can be defined – on
      jobs which don’t even expect those as build parameters – to change the
      behavior of builds.
    </p>
    <p>
      A number of plugins define additional parameters for builds. For example,
      GitHub Pull Request Builder passes a number of additional parameters
      describing the pull request. Release Plugin also allows adding several
      additional parameters to a build that are not considered to be defined in
      the job as part of this security fix.
    </p>
    <p>
      Please see
      <a
        href="https://wiki.jenkins-ci.org/display/JENKINS/Plugins+affected+by+fix+for+SECURITY-170"
        >this wiki page</a
      >
      for a list of plugins known to be affected by this change.
    </p>
    <p>
      Until these plugins have been adapted to work with the new restriction
      (and advice on that is available further down), you can define the
      following system properties to work around this limitation, at least for a
      time:
    </p>
    <ul>
      <li>
        Set
        <code>hudson.model.ParametersAction.keepUndefinedParameters</code> to
        <code>true</code>, e.g. <code
          >java -Dhudson.model.ParametersAction.keepUndefinedParameters=true
          -jar jenkins.war</code
        >
        to revert to the old behavior of allowing any build parameters.
        Depending on your environment, this may be unsafe, as it opens you up to
        attacks as described above.
      </li>
      <li>
        Set <code>hudson.model.ParametersAction.safeParameters</code> to a
        comma-separated list of safe parameter names, e.g. <code
          >java -Dhudson.model.ParametersAction.safeParameters=FOO,BAR_baz,quX
          -jar jenkins.war</code
        >.
      </li>
    </ul>
    <p>
      I realize this change, among a few others that improve the security of
      Jenkins, may be difficult to adapt for some, but given the valuable
      secrets typically stored in Jenkins, I’m certain that this is the correct
      approach. We made sure to release this fix with the options described
      above, so that this change doesn’t block updating those that rely on this
      behavior.
    </p>
    <p>Developers have several options to adapt to this change:</p>
    <ul>
      <li>
        <code>ParametersAction</code> actually stores all parameters, but
        <code>getParameters()</code> only returns those that are defined on the
        job. The new method <code>getAllParameters()</code> returns all of them.
        This can be used, for example by
        <code>EnvironmentContributor</code> extensions, to add known safe
        parameters to build environments.
      </li>
      <li>
        Don’t pass extra arguments, but define a <code>QueueAction</code> for
        your metadata instead. Those can still be made available to the build
        environment as needed.
      </li>
    </ul>
    <p>
      Subscribe to the
      <a href="/content/mailing-lists">jenkinsci-advisories mailing list</a> to
      receive important notifications related to Jenkins security.
    </p>
  </body>
</html>
