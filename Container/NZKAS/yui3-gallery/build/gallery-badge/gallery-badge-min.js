YUI.add("gallery-badge",function(A){var C=function(B){this._lazyAddAttrs=false;B.node=B.host;C.superclass.constructor.call(this,B);};C.NAME="gallery-badge";C.NS="badge";C.ATTRS={node:{setter:function(B){return A.one(B);}},type:{value:"popular",setter:function(B){if(B!=="user"){this.set("username","");}return B;}},header:{value:"",getter:function(){var B="Popular Gallery Items";switch(this.get("type")){case"oncdn":B="Gallery Items on the CDN";break;case"featured":B="Featured Gallery Items";break;case"random":B="Random Gallery Item";break;case"user":B="My Gallery Items";break;}return B;}},username:{value:"",setter:function(B){if(B){this.set("header","My Gallery Items");this._setStateVal("type","user");}return B;}},render:{value:true},data:{value:{}}};A.extend(C,A.Base,{buildUI:function(F){this.set("data",F.data);if(F.data.error){return;}var E=F.data,B=this.get("type"),H=A.Node.create("<h2>"+this.get("header")+"</h2>"),D=A.Node.create("<ul></ul>"),G=this.get("node");if(B!="random"){if(B=="user"){H=A.Node.create('<h2><a href="http:/'+"/yuilibrary.com/gallery/user/"+E.userinfo.username+'">'+E.userinfo.fullname+"'s Gallery Items</a></h2>");}A.each(E.modules,function(I){D.append('<li><a href="'+I.url+'">'+I.title+"</a></li>");});}else{D.append('<li><a href="'+E.modules.url+'">'+E.modules.title+"</a></li>");}G.set("innerHTML","");G.append(H);G.append(D);},getSQL:function(){var B=this.get("type"),D;if(B=="user"){D="select * from yui.gallery.user where (username = '"+this.get("username")+"')";}else{D="select * from yui.gallery."+B;}return D;},updateUserUI:function(B){if(B.newVal!==""){this.updateUI();}},updateUI:function(D){var E=this.getSQL(),B;B=new A.yql(E,A.bind(function(F){if(F.query&&F.query.results&&F.query.results.json){this.fire("dataReturned",{data:F.query.results.json});}},this),{env:"http:/"+"/yuilibrary.com/yql/yui.env"});},initializer:function(){this.after("typeChange",A.bind(this.updateUI,this));this.after("usernameChange",A.bind(this.updateUserUI,this));this.publish("dataReturned",{type:"datareturned",defaultFn:this.buildUI});if(this.get("render")){this.render();}},render:function(){this.updateUI();},refresh:function(){this.updateUI();},destructor:function(){this.get("node").set("innerHTML","");}});A.namespace("Plugin");A.Plugin.Badge=C;},"gallery-2009.11.09-19",{requires:["node","event","gallery-yql","stylesheet"]});