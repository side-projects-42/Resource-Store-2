YUI.add("gallery-form",function(B){function G(){G.superclass.constructor.apply(this,arguments);}B.mix(G,{NAME:"form",ATTRS:{method:{value:"post",validator:function(K){return this._validateMethod(K);},setter:function(K){return K.toLowerCase();}},action:{value:"",validator:B.Lang.isString},fields:{writeOnce:true,validator:function(K){return this._validateFields(K);},setter:function(K){return this._setFields(K);}},inlineValidation:{value:false,validator:B.Lang.isBoolean}},HTML_PARSER:{action:function(K){return this._parseAction(K);},method:function(K){return this._parseMethod(K);},fields:function(K){return this._parseFields(K);}},FORM_TEMPLATE:"<form></form>"});B.extend(G,B.Widget,{_formNode:null,_ioIds:null,_validateMethod:function(K){if(!B.Lang.isString(K)){return false;}if(K.toLowerCase()!="get"&&K.toLowerCase()!="post"){return false;}return true;},_validateFields:function(L){if(!B.Lang.isArray(L)){return false;}var K=true;B.Array.each(L,function(O,N,M){if((!O instanceof B.FormField)||(!B.Lang.isObject(O))){K=false;}});return K;},_setFields:function(K){K=K||[];var L,M;B.Array.each(K,function(P,O,N){if(!P._classes){M=P.type;if(B.Lang.isFunction(M)){L=M;}else{if(M=="hidden"){L=B.HiddenField;}else{if(M=="checkbox"){L=B.CheckboxField;}else{if(M=="textarea"){L=B.TextareaField;}else{if(M=="select"){L=B.SelectField;}else{if(M=="choice"){L=B.ChoiceField;}else{if(M=="button"||M=="submit"||M=="reset"){L=B.Button;if(M=="submit"){P.onclick={fn:this.submit,scope:this};}else{if(M=="reset"){P.onclick={fn:this.reset,scope:this};}}}else{L=B.TextField;}}}}}}}K[O]=new L(P);}},this);return K;},_parseAction:function(K){var L=K.one("form");return L.get("action");},_parseMethod:function(K){var L=K.one("form");return L.get("method");},_parseFields:function(L){var M=L.all("*"),N=L.all("label"),K=[];M.each(function(Q,P,O){var U=Q.get("nodeName"),S=Q.get("id"),R,T=[];if(U=="INPUT"){R={type:Q.get("type"),name:Q.get("name"),value:Q.get("value")};if(R.type=="submit"||R.type=="reset"||R.type=="button"){R.label=Q.get("value");}}else{if(U=="BUTTON"){R={type:"button",name:Q.get("name"),label:Q.get("innerHTML")};}else{if(U=="SELECT"){Q.all("option").each(function(W,X,V){T.push({label:W.get("innerHTML"),value:W.get("value")});});R={type:"select",name:Q.get("name"),choices:T};}}}if(R){if(S){R.id=S;N.some(function(W,X,V){if(W.get("htmlFor")==S){R.label=W.get("innerHTML");}});}K.push(R);}Q.remove();});return K;},_renderFormNode:function(){var K=this.get("contentBox"),L=K.query("form");if(!L){L=B.Node.create(G.FORM_TEMPLATE);K.appendChild(L);}this._formNode=L;},_renderFormFields:function(){var K=this.get("fields");B.Array.each(K,function(N,M,L){N.render(this._formNode);},this);},_syncFormAttributes:function(){this._formNode.setAttrs({action:this.get("action"),method:this.get("method"),id:this.get("id")});},_runValidation:function(){var K=this.get("fields"),L=true;B.Array.each(K,function(O,N,M){O.set("error",null);if(O.validateField()===false){L=false;}});return L;},_enableInlineValidation:function(){var K=this.get("fields");B.Array.each(K,function(N,M,L){N.set("validateInline",true);});},_disableInlineValidation:function(){var K=this.get("fields");B.Array.each(K,function(N,M,L){N.set("validateInline",false);});},_handleIOSuccess:function(K,L){if(typeof this._ioIds[K]!="undefined"){this.reset();this.fire("success",{response:L});delete this._ioIds[K];}},_handleIOFailure:function(K,L){if(typeof this._ioIds[K]!="undefined"){this.fire("failure",{response:L});delete this._ioIds[K];}},reset:function(){this._formNode.reset();var K=this.get("fields");B.Array.each(K,function(N,M,L){N.clear();});},submit:function(){if(this._runValidation()){var N=this.get("action"),O=this.get("method"),K=this.get("fields"),M="",P,L;B.Array.each(K,function(S,R,Q){if(S.get("name")!==undefined){M+=encodeURIComponent(S.get("name"))+"="+(encodeURIComponent(S.get("value"))||"")+"&";}});L={method:O,data:M};P=B.io(N,L);this._ioIds[P.id]=P;}},getField:function(L){var K=this.get("fields"),M;if(B.Lang.isNumber(L)){return K[L];}else{if(B.Lang.isString(L)){B.Array.each(K,function(P,O,N){if(P.get("name")==L){M=P;}});return M;}}},initializer:function(K){this._ioIds={};this.publish("submit");this.publish("reset");this.publish("success");this.publish("failure");},destructor:function(){this._formNode=null;},renderUI:function(){this._renderFormNode();this._renderFormFields();},bindUI:function(){this._formNode.on("submit",B.bind(function(K){K.halt();},this));this.after("inlineValidationChange",B.bind(function(K){if(K.newValue===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));B.on("io:success",B.bind(this._handleIOSuccess,this));B.on("io:failure",B.bind(this._handleIOFailure,this));},syncUI:function(){this._syncFormAttributes();if(this.get("inlineValidation")===true){this._enableInlineValidation();}}});B.Form=G;function C(){C.superclass.constructor.apply(this,arguments);}B.mix(C,{NAME:"form-field",ATTRS:{id:{value:B.guid(),validator:B.Lang.isString,writeOnce:true},name:{validator:B.Lang.isString,writeOnce:true},value:{value:"",validator:B.Lang.isString},label:{value:"",validator:B.Lang.isString},validator:{value:function(K){return true;},validator:function(K){return this._validateValidator(K);},setter:function(K){return this._setValidator(K);}},error:{value:false,validator:function(K){return this._validateError(K);}},required:{value:false,validator:B.Lang.isBoolean},validateInline:{value:false,validator:B.Lang.isBoolean}},tabIndex:0,VALIDATE_EMAIL_ADDRESS:function(M,L){var K=/^([\w]+(?:\.[\w]+)*)@((?:[\w]+\.)*\w[\w]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(K.test(M)===false){L.set("error",C.INVALID_EMAIL_MESSAGE);return false;}return true;},INVALID_EMAIL_MESSAGE:"Please enter a valid email address",VALIDATE_PHONE_NUMBER:function(M,L){var K=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;if(K.test(M)===false){L.set("error",C.INVALID_PHONE_NUMBER);return false;}return true;},INVALID_PHONE_NUMBER:"Please enter a valid phone number",VALIDATE_IP_ADDRESS:function(O,N){var L=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,K,M=true;
if(L.test(O)===false){M=false;}K=O.split(".");B.Array.each(K,function(Q,R,P){var S=parseInt(Q,10);if(S<0||S>255){M=false;}});if(M===false){N.set("error",C.INVALID_IP_MESSAGE);}return M;},INVALID_IP_MESSAGE:"Please enter a valid IP address",VALIDATE_DATE:function(M,L){var K=/^([1-9]|1[0-2])(\-|\/)([0-2][0-9]|3[0-1])(\-|\/)(\d{4}|\d{2})$/;if(K.test(M)===false){L.set("error",C.INVALID_DATE_MESSAGE);return false;}return true;},INVALID_DATE_MESSAGE:"Please enter a a valid date",VALIDATE_TIME:function(M,L){var K=/^([1-9]|1[0-2]):[0-5]\d(:[0-5]\d(\.\d{1,3})?)?$/;if(K.test(M)===false){L.set("error",C.INVALID_TIME_MESSAGE);return false;}return true;},INVALID_TIME_MESSAGE:"Please enter a valid time",VALIDATE_POSTAL_CODE:function(N,M){var K,L=true;if(N.length==6||N.length==7){K=/^[a-zA-Z]\d[a-zA-Z](-|\s)?\d[a-zA-Z]\d$/;}else{if(N.length==5||N.length==10){K=/^\d{5}((-|\s)\d{4})?$/;}else{if(N.length>0){L=false;}}}if(L===false||(K&&K.test(N)===false)){M.set("error",C.INVALID_POSTAL_CODE_MESSAGE);return false;}return true;},INVALID_POSTAL_CODE_MESSAGE:"Please enter a valid postal code",VALIDATE_NO_SPECIAL_CHARS:function(M,L){var K=/^[a-zA-Z0-9]*$/;if(K.test(M)===false){L.set("error",C.INVALID_SPECIAL_CHARS);return false;}return true;},INVALID_SPECIAL_CHARS:"Please use only letters and numbers",INPUT_TEMPLATE:"<input>",TEXTAREA_TEMPLATE:"<textarea></textarea>",LABEL_TEMPLATE:"<label></label>",SELECT_TEMPLATE:"<select></select>"});B.extend(C,B.Widget,{_labelNode:null,_fieldNode:null,_errorNode:null,_nodeType:"text",_validateError:function(K){if(B.Lang.isString(K)){return true;}if(K===null||typeof K=="undefined"){return true;}return false;},_validateValidator:function(L){if(B.Lang.isString(L)){var K=/^(email|phone|ip|date|time|postal|special)$/;if(K.test(L)===true){return true;}}if(B.Lang.isFunction(L)){return true;}return false;},_setValidator:function(K){if(K=="email"){return C.VALIDATE_EMAIL_ADDRESS;}else{if(K=="phone"){return C.VALIDATE_PHONE_NUMBER;}else{if(K=="ip"){return C.VALIDATE_IP_ADDRESS;}else{if(K=="date"){return C.VALIDATE_DATE;}else{if(K=="time"){return C.VALIDATE_TIME;}else{if(K=="postal"){return C.VALIDATE_POSTAL_CODE;}else{if(K=="special"){return C.VALIDATE_NO_SPECIAL_CHARS;}}}}}}}return K;},_renderLabelNode:function(){var K=this.get("contentBox"),L=K.query("label");if(!L||L.get("for")!=this.get("id")){L=B.Node.create(C.LABEL_TEMPLATE);K.appendChild(L);}this._labelNode=L;},_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(C.INPUT_TEMPLATE);K.appendChild(L);}this._fieldNode=L;},_syncLabelNode:function(){if(this._labelNode){this._labelNode.setAttrs({innerHTML:this.get("label")});this._labelNode.setAttribute("for",this.get("id"));}},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),type:this._nodeType,id:this.get("id"),value:this.get("value")});this._fieldNode.setAttribute("tabindex",C.tabIndex);C.tabIndex++;},_syncError:function(){var K=this.get("error");if(K){this._showError(K);}},_checkRequired:function(){if(this.get("required")===true&&this.get("value").length===0){return false;}return true;},_showError:function(L){var K=this.get("contentBox"),M=B.Node.create("<span>"+L+"</span>");M.addClass("error");K.insertBefore(M,this._labelNode);this._errorNode=M;},_clearError:function(){if(this._errorNode){var K=this.get("contentBox");K.removeChild(this._errorNode);this._errorNode=null;}},_enableInlineValidation:function(){this.after("valueChange",B.bind(this.validateField,this));},_disableInlineValidation:function(){this.detach("valueChange",this.validateField,this);},validateField:function(M){var L=this.get("value"),K=this.get("validator");this.set("error",null);if(M&&M.src!="ui"){return false;}if(!this._checkRequired()){this.set("error","This field is required");return false;}return K.call(this,L,this);},clear:function(){this.set("value","");this._fieldNode.set("value","");},initializer:function(){this.publish("blur");this.publish("change");this.publish("focus");},destructor:function(K){},renderUI:function(){this._renderLabelNode();this._renderFieldNode();},bindUI:function(){this._fieldNode.on("change",B.bind(function(K){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("change",K);},this));this.on("valueChange",B.bind(function(K){if(K.src!="ui"){this._fieldNode.set("value",K.newVal);}},this));this._fieldNode.on("blur",B.bind(function(K){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("blur",K);},this));this._fieldNode.on("focus",B.bind(function(K){this.fire("focus",K);},this));this.on("errorChange",B.bind(function(K){if(K.newVal){this._showError(K.newVal);}else{this._clearError();}},this));this.on("validateInlineChange",B.bind(function(K){if(K.newVal===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));},syncUI:function(){this.get("boundingBox").removeAttribute("tabindex");this._syncLabelNode();this._syncFieldNode();this._syncError();if(this.get("validateInline")===true){this._enableInlineValidation();}}});B.FormField=C;function H(){H.superclass.constructor.apply(this,arguments);}B.mix(H,{NAME:"text-field"});B.extend(H,B.FormField,{_nodeType:"text"});B.TextField=H;function D(){D.superclass.constructor.apply(this,arguments);}B.mix(D,{NAME:"checkbox-field"});B.extend(D,B.FormField,{_nodeType:"checkbox",_getValue:function(L,K){if(this._fieldNode.get("checked")===true){return L;}else{return"";}},initializer:function(){D.superclass.initializer.apply(this,arguments);this.modifyAttr("value",{getter:function(L,K){return this._getValue(L,K);},writeOnce:true});}});B.CheckboxField=D;function J(){J.superclass.constructor.apply(this,arguments);}B.mix(J,{NAME:"hidden-field",ATTRS:{displayValue:{value:false,writeOnce:true,validator:B.Lang.isBoolean}}});B.extend(J,B.FormField,{_nodeType:"hidden",_valueDisplayNode:null,_renderValueDisplayNode:function(){if(this.get("displayValue")===true){var L=B.Node.create("<div></div>"),K=this.get("contentBox");K.appendChild(L);
this._valueDisplayNode=L;}},renderUI:function(){J.superclass.renderUI.apply(this,arguments);this._renderValueDisplayNode();},bindUI:function(){J.superclass.bindUI.apply(this,arguments);if(this.get("displayValue")===true){this.after("valueChange",B.bind(function(K,L){this._valueDisplayNode.set("innerHTML",L.newVal);},this,true));}}});B.HiddenField=J;function E(){E.superclass.constructor.apply(this,arguments);}B.mix(E,{NAME:"textarea-field",NODE_TEMPLATE:"<textarea></textarea>"});B.extend(E,B.FormField,{_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(B.substitute(E.NODE_TEMPLATE,{name:this.get("name"),type:"text",id:this.get("id"),value:this.get("value")}));K.appendChild(L);}L.setAttribute("tabindex",B.FormField.tabIndex);B.FormField.tabIndex++;this._fieldNode=L;}});B.TextareaField=E;function I(){I.superclass.constructor.apply(this,arguments);}B.mix(I,{NAME:"choice-field",ATTRS:{choices:{validator:function(K){return this._validateChoices(K);}},multiple:{validator:B.Lang.isBoolean,value:false}}});B.extend(I,B.FormField,{_validateChoices:function(L){if(!B.Lang.isArray(L)){return false;}var K=true;B.Array.each(L,function(O,N,M){if(!B.Lang.isObject(O)){K=false;return;}if(!O.label||!B.Lang.isString(O.label)||!O.value||!B.Lang.isString(O.value)){K=false;return;}});return K;},_renderLabelNode:function(){var K=this.get("contentBox"),L=B.Node.create("<span>"+this.get("label")+"</span>");K.appendChild(L);this._labelNode=L;},_renderFieldNode:function(){var K=this.get("contentBox"),N=this.get("choices"),L,M;B.Array.each(N,function(Q,P,O){L=B.Node.create(C.LABEL_TEMPLATE);K.appendChild(L);M=B.Node.create(C.INPUT_TEMPLATE);K.appendChild(M);});this._fieldNode=K.all("input");},_syncFieldNode:function(){var N=this.get("choices"),K=this.get("contentBox"),M=K.all("label"),L=(this.get("multiple")===true?"checkbox":"radio");M.each(function(P,O,Q){P.setAttrs({innerHTML:N[O].label});P.setAttribute("for",(this.get("id")+"_choice"+O));},this);this._fieldNode.each(function(Q,O,R){Q.setAttrs({value:N[O].value,id:(this.get("id")+"_choice"+O),name:this.get("name"),type:L});var P=B.Node.getDOMNode(Q);P.value=N[O].value;},this);},clear:function(){this._fieldNode.each(function(L,K,M){L.setAttribute("checked",false);},this);this.set("value","");},bindUI:function(){this._fieldNode.on("change",B.bind(function(K){this._fieldNode.each(function(M,L,N){if(M.get("checked")===true){this.set("value",M.get("value"));}},this);},this));}});B.ChoiceField=I;function A(){A.superclass.constructor.apply(this,arguments);}B.mix(A,{NAME:"select-field",NODE_TEMPLATE:"<select></select>",OPTION_TEMPLATE:"<option></option>"});B.extend(A,B.ChoiceField,{_renderFieldNode:function(){var K=this.get("contentBox"),L=K.query("#"+this.get("id"));if(!L){L=B.Node.create(A.NODE_TEMPLATE);K.appendChild(L);}this._fieldNode=L;this._renderOptionNodes();},_renderOptionNodes:function(){var L=this.get("choices"),K;B.Array.each(L,function(O,N,M){K=B.Node.create(A.OPTION_TEMPLATE);this._fieldNode.appendChild(K);},this);},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),id:this.get("id"),multiple:(this.get("multiple")===true?"multiple":"")});},_syncOptionNodes:function(){var M=this.get("choices"),K=this.get("contentBox"),L=K.all("option");L.each(function(Q,P,O){var N=(P===0?"Choose one":M[P-1].label),R=(P===0?"":M[P-1].value);Q.setAttrs({innerHTML:N,value:R});},this);},clear:function(){this._fieldNode.value="";},bindUI:function(){A.superclass.constructor.superclass.bindUI.apply(this,arguments);},syncUI:function(){A.superclass.syncUI.apply(this,arguments);this._syncOptionNodes();}});B.SelectField=A;function F(){F.superclass.constructor.apply(this,arguments);}B.mix(F,{NAME:"button",HTML_PARSER:{},ATTRS:{onclick:{validator:function(K){if(B.Lang.isObject(K)===false){return false;}if(typeof K.fn=="undefined"||B.Lang.isFunction(K.fn)===false){return false;}return true;},value:{fn:function(K){}},setter:function(K){K.scope=K.scope||this;K.argument=K.argument||{};return K;}}},NODE_TEMPLATE:"<button></button>"});B.extend(F,B.FormField,{_renderButtonNode:function(){var K=this.get("contentBox"),L;L=B.Node.create(F.NODE_TEMPLATE);K.appendChild(L);this._fieldNode=L;},_syncLabelNode:function(){},_syncFieldNode:function(){this._fieldNode.setAttrs({innerHTML:this.get("label"),id:this.get("id")});},_setClickHandler:function(){if(!this._fieldNode){return;}var K=this.get("onclick");B.Event.purgeElement(this._fieldNode,true,"click");B.on("click",B.bind(K.fn,K.scope,true),this._fieldNode);},renderUI:function(){this._renderButtonNode();},bindUI:function(){this.after("onclickChange",B.bind(this._setClickHandler,this,true));this._setClickHandler();}});B.Button=F;},"gallery-2009.11.19-20",{requires:["node","widget","io-base"]});