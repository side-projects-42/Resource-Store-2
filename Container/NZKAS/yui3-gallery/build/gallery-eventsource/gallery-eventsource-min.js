YUI.add("gallery-eventsource",function(F){var A=typeof EventSource!="undefined",B,E,D=500;function C(G){F.Event.Target.call(this);this.url=G;this.readyState=0;this._transport=null;this._init();}E={_fireErrorEvent:function(){F.later(0,this,function(){this.readyState=2;this.fire({type:"error"});});},_fireOpenEvent:function(){if(this.readyState<2){F.later(0,this,function(){this.readyState=1;this.fire({type:"open"});});}},_fireMessageEvent:function(G){F.later(0,this,function(){this.fire(G);});}};if(A){B={_init:function(){try{var I=new EventSource(this.url),H=this;I.onopen=I.onmessage=I.onerror=F.bind(function(J){switch(J.type){case"open":this._fireOpenEvent();break;case"message":this._fireMessageEvent({type:"message",data:J.data,lastEventId:J.lastEventId,origin:J.origin});break;case"error":this._fireErrorEvent();break;}},this);this._transport=I;}catch(G){this._fireErrorEvent();}},close:function(){if(this._transport!=null){this._transport.close();}this.readyState=2;},on:function(K,J,I,H,G){var L=this;if(K!="message"&&K!="error"&&K!="open"){this._transport.addEventListener(K,function(M){L._fireMessageEvent({type:M.type,data:M.data,origin:M.origin,lastEventId:M.lastEventId});},false);}F.Event.Target.prototype.on.apply(this,arguments);}};}else{B={_init:function(){this._lastIndex=0;this._lastEventId=null;this._data="";this._eventName="";var H,G=this;if(this.readyState!=2){if(typeof XMLHttpRequest!="undefined"){H=new XMLHttpRequest();}else{if(typeof ActiveXObject!="undefined"){H=new ActiveXObject("MSXML2.XMLHttp");}else{throw new Error("Server-sent events unavailable.");}}H.open("get",this.url,true);if(this._lastEventId){H.setRequestHeader("Last-Event-ID",this._lastEventId);}if(F.UA.ie){H.setRequestHeader("X-YUIEventSource-PollOnly","1");}H.onreadystatechange=function(){if(H.readyState==3&&F.UA.ie===0){if(H.getResponseHeader("Content-type")!="text/event-stream"){G.close();G._fireErrorEvent();}else{G._signalOpen();G._processIncomingData(H.responseText);}}else{if(H.readyState==4&&G.readyState<2){G._signalOpen();G._fireMessageEvent();G._validateResponse();}}};this._transport=H;H.send(null);}},_validateResponse:function(){var H=this._transport;try{if(H.status>=200&&H.status<300){this._processIncomingData(H.responseText);if(this.readyState!=2){this._transport.onreadystatechange=function(){};F.later(D,this,this._init);}}else{throw new Error();}}catch(G){this._fireErrorEvent();}H=null;},_signalOpen:function(){if(this.readyState==0){this._fireOpenEvent();}},_processDataLine:function(G,I,H){var J;switch(G){case"data":J=I+"\n";if(J.charAt(0)==" "){J=J.substring(1);}this._data+=J;break;case"event":this._eventName=I.replace(/^\s+|\s+$/g,"");break;case"":break;case"id":this._lastEventId=I;break;case"retry":break;default:if(!H){this._processDataLine(G,"",true);}}},_processIncomingData:function(L){L=L.substring(this._lastIndex);this._lastIndex+=L.length;var H=L.split("\n"),K,I=0,G=H.length,J;while(I<G){if(H[I].indexOf(":")>-1){K=H[I].split(":");this._processDataLine(K.shift(),K.join(":"));}else{if(H[I].replace(/\s/g,"")==""){this._fireMessageEvent();}}I++;}this._fireMessageEvent();},_fireMessageEvent:function(){var H="message",I,G;if(this._data!=""){if(this._data.charAt(this._data.length-1)=="\n"){this._data=this._data.substring(0,this._data.length-1);}if(this._eventName.replace(/^\s+|\s+$/g,"")!=""){H=this._eventName;}I=this._data;G=this._lastEventId;F.later(0,this,function(){this.fire({type:H,data:I,lastEventId:G});});this._data="";this._eventName="";}},close:function(){if(this.readyState!=2){this.readyState=2;if(this._transport){this._transport.abort();}}}};}F.extend(C,F.Event.Target,F.merge(E,B));F.EventSource=C;},"@VERSION@",{requires:["event-base","event-custom"]});