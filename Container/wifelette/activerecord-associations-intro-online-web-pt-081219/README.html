<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="active-record-associations-introduction-playlister">Active Record Associations Introduction: Playlister</h1>
<h2 id="objectives">Objectives</h2>
<ol type="1">
<li>Understand how and why Active Record implements associations between models.</li>
<li>Use Active Record migrations and methods to build out a domain model that associates classes via the has-many/belongs-to <em>and</em> the many-to-many (or has-many-through) relationships.</li>
</ol>
<h2 id="what-are-active-record-associations">What are Active Record Associations?</h2>
<p>We already know that we can build our classes such that they associate with one another. We also know that it takes a lot of code to do it. Active Record associations allow us to associate models <em>and their analogous database tables</em> without having to write tons of code.</p>
<p>Additionally, Active Record associations make actually working with our associated objects even quicker, neater and easier.</p>
<p>Sounds great, right? Now that we have you totally hooked, let’s take a look at how we use these AR associations.</p>
<h2 id="how-do-we-use-ar-associations">How do we use AR Associations?</h2>
<p>Active Record makes it easy to implement the following relationships between models:</p>
<ul>
<li>belongs_to</li>
<li>has_one</li>
<li>has_many</li>
<li>has_many :through</li>
<li>has_one :through</li>
<li>has_and_belongs_to_many</li>
</ul>
<p>We don’t need to worry about most of these right now. We’ll concern ourselves with relationships that should sound familiar:</p>
<ul>
<li>belongs to</li>
<li>has many</li>
<li>has many through</li>
</ul>
<p>In order to implement these relationships, we will need to do two things:</p>
<ol type="1">
<li>Write a migration that creates tables with associations. For example, if a cat belongs to an owner, the cats table should have an <code>owner_id</code> column.</li>
<li>Use Active Record macros in the models.</li>
</ol>
<p>We’ll go through both of these steps together, using our Playlister domain model.</p>
<h2 id="overview">Overview</h2>
<p>In this walk-through, we’ll be building out a domain model for our fictitious music playing app, Playlister. This app will catalog songs and their associated artists and genres.</p>
<p>We’ll have three models: Artists, Songs, and Genres. By writing a few migrations and making use of the appropriate Active Record macros (more on that later), we will be able to:</p>
<ul>
<li>ask an Artist about its songs and genres</li>
<li>ask a Song about its genre and its artist</li>
<li>ask a Genre about its songs and artists.</li>
</ul>
<p>The relationships between artists, songs and genres will be enacted as follows:</p>
<ul>
<li>Artists have many songs and a song belongs to an artist.</li>
<li>Artists have many genres through songs.</li>
<li>Songs belong to a genre.</li>
<li>A genre has many songs.</li>
<li>A genre has many artists through songs.</li>
</ul>
<p>We will build these associations through the use of Active Record migrations and macros.</p>
<h2 id="building-our-migrations">Building our Migrations</h2>
<h3 id="the-song-model">The Song model</h3>
<p>A song will belong to an artist <em>and</em> belong to a genre. Before we worry about the migration that will implement this in our songs table, let’s think about what that table will look like:</p>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
<th>artist_id</th>
<th>genre_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>Shake It Off</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>We can see that the songs table will have an <code>artist_id</code> column and a <code>genre_id</code> column. We will give a given song an <code>artist_id</code> value of the artist it belongs to. The same goes for genre. These foreign keys, in conjunction with the Active Record association macros will allow our query to get an artist’s songs or genres, a song’s artist or genre, and a genre’s songs and artists entirely through Active Record provided methods on our classes.</p>
<p>Let’s write the migration that will make this happen.</p>
<ul>
<li>Open a file, <code>db/migrate/03_create_songs.rb</code></li>
<li>Write the following migration:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> <span class="dt">CreateSongs</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Migration</span>[<span class="fl">4.2</span>]</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">def</span> change</a>
<a class="sourceLine" id="cb1-3" title="3">    create_table <span class="st">:songs</span> <span class="kw">do</span> |t|</a>
<a class="sourceLine" id="cb1-4" title="4">      t.string <span class="st">:name</span></a>
<a class="sourceLine" id="cb1-5" title="5">      t.integer <span class="st">:artist_id</span></a>
<a class="sourceLine" id="cb1-6" title="6">      t.integer <span class="st">:genre_id</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">end</span></a></code></pre></div>
<h3 id="the-artist-model">The Artist Model</h3>
<p>An artist will have many songs and it will have many genres <em>through</em> songs. These associations will be taken care of entirely through AR macros, which we’ll get to in a bit. What do we mean by <em>through</em> songs? The table songs is the <code>JOIN</code> table! Remember that from previous labs? That means that songs has both an <code>artist_id</code> and a <code>genre_id</code> to combine those two tables together in a many-to-many relationship.</p>
<p>Let’s take a look at what our <code>artists</code> table will need to look like:</p>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Taylor Swift</td>
</tr>
</tbody>
</table>
<p>Our artists table just needs a <code>name</code> column. Let’s write the migration. In <code>db/migrate/01_create_artists.rb</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span> <span class="dt">CreateArtists</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Migration</span>[<span class="fl">4.2</span>]</a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">def</span> change</a>
<a class="sourceLine" id="cb2-3" title="3">    create_table <span class="st">:artists</span> <span class="kw">do</span> |t|</a>
<a class="sourceLine" id="cb2-4" title="4">      t.string <span class="st">:name</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">end</span></a></code></pre></div>
<h3 id="the-genre-model">The Genre Model</h3>
<p>A genre will have many songs and it will have many artists through songs. These associations will be taken care of entirely through AR macros, which we’ll get to in a bit.</p>
<p>Let’s take a look at what our genres table will need to look like:</p>
<table>
<thead>
<tr class="header">
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>pop</td>
</tr>
</tbody>
</table>
<p>Let’s write our migration. In <code>db/migrate/02_create_genres.rb</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">class</span> <span class="dt">CreateGenres</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Migration</span>[<span class="fl">4.2</span>]</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">def</span> change</a>
<a class="sourceLine" id="cb3-3" title="3">    create_table <span class="st">:genres</span> <span class="kw">do</span> |t|</a>
<a class="sourceLine" id="cb3-4" title="4">      t.string <span class="st">:name</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">end</span></a></code></pre></div>
<p>Great! Now go ahead and run <code>rake db:migrate</code> in your terminal to execute our table creations.</p>
<h2 id="building-our-associations-using-ar-macros">Building our Associations using AR Macros</h2>
<h3 id="what-is-a-macro">What is a macro?</h3>
<p>A macro is a method that writes code for us (think metaprogramming). By invoking a few methods that come with Active Record, we can implement all of the associations we’ve been discussing.</p>
<p>We’ll be using the following AR macros (or methods):</p>
<ul>
<li><a href="http://guides.rubyonrails.org/association_basics.html#the-has-many-association"><code>has_many</code></a></li>
<li><a href="http://guides.rubyonrails.org/association_basics.html#the-has-many-through-association"><code>has_many through</code></a></li>
<li><a href="http://guides.rubyonrails.org/association_basics.html#the-belongs-to-association"><code>belongs_to</code></a></li>
</ul>
<p>Let’s get started.</p>
<h3 id="a-song-belongs-to-an-artist-and-a-genre">A Song Belongs to an Artist and A Genre</h3>
<p>Create a file, <code>app/models/song.rb</code>. Define your <code>Song</code> class to inherit from <code>ActiveRecord::Base</code>. This is very important! If we don’t inherit from Active Record Base, we won’t get our fancy macro methods.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">class</span> <span class="dt">Song</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">end</span></a></code></pre></div>
<p>We need to tell the <code>Song</code> class that it will produce objects that can belong to an artist. We will do it with the <code>belongs_to</code> macro:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">class</span> <span class="dt">Song</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb5-2" title="2">  belongs_to <span class="st">:artist</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">end</span></a></code></pre></div>
<p>Songs also belong to a genre, so we’ll use the same macro to implement that relationship:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">class</span> <span class="dt">Song</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb6-2" title="2">  belongs_to <span class="st">:artist</span></a>
<a class="sourceLine" id="cb6-3" title="3">  belongs_to <span class="st">:genre</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">end</span></a></code></pre></div>
<h3 id="an-artist-has-many-songs">An Artist Has Many Songs</h3>
<p>Create a file, <code>app/models/artist.rb</code>. Define your <code>Artist</code> class to inherit from <code>ActiveRecord::Base</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">class</span> <span class="dt">Artist</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">end</span></a></code></pre></div>
<p>We need to tell the <code>Artist</code> class that each artist object can have many songs. We will use the <code>has_many</code> macro to do it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">class</span> <span class="dt">Artist</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb8-2" title="2">  has_many <span class="st">:songs</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">end</span></a></code></pre></div>
<p>And that’s it! Now, because our songs table has an <code>artist_id</code> column and because our <code>Artist</code> class uses the <code>has_many</code> macro, an artist has many songs!</p>
<p>It is also true that an artist has many genres through songs. We will use the <code>has_many through</code> macro to implement this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">class</span> <span class="dt">Artist</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb9-2" title="2">  has_many <span class="st">:songs</span></a>
<a class="sourceLine" id="cb9-3" title="3">  has_many <span class="st">:genres</span>, <span class="st">through: :songs</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">end</span></a></code></pre></div>
<h3 id="genres-have-many-songs-and-have-many-artists">Genres Have Many Songs and Have Many Artists</h3>
<p>Create a file <code>app/models/genre.rb</code>. In it, define a class, <code>Genre</code>, to inherit from <code>ActiveRecord::Base</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">class</span> <span class="dt">Genre</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">end</span></a></code></pre></div>
<p>A genre can have many songs. Let’s implement that with the <code>has_many</code> macro:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">class</span> <span class="dt">Genre</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb11-2" title="2">  has_many <span class="st">:songs</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">end</span></a></code></pre></div>
<p>A genre also has many artists through its songs. Let’s implement this relationship with the <code>has_many through</code> macro:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">class</span> <span class="dt">Genre</span> &lt; <span class="dt">ActiveRecord</span>::<span class="dt">Base</span></a>
<a class="sourceLine" id="cb12-2" title="2">  has_many <span class="st">:songs</span></a>
<a class="sourceLine" id="cb12-3" title="3">  has_many <span class="st">:artists</span>, <span class="st">through: :songs</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">end</span></a></code></pre></div>
<p>And that’s it! The tests in this lesson are in place to ensure you’ve properly set up these associations. You can go ahead and run <code>learn</code> now to see if you pass them all before continuing.</p>
<h2 id="our-code-in-action-working-with-associations">Our Code in Action: Working with Associations</h2>
<p>Go ahead and run the test suite and you’ll see that we are passing all of our tests! Amazing! Our associations are all working, just because of our migrations and use of macros.</p>
<p>Let’s play around with our code.</p>
<p>In your console, run <code>rake console</code>. Now we are in a Pry console that accesses our models.</p>
<p>Let’s make a few new songs:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">[<span class="ex">1</span>]pry(main)<span class="op">&gt;</span> <span class="ex">hello</span> = Song.new(name: <span class="st">&quot;Hello&quot;</span>)</a>
<a class="sourceLine" id="cb13-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75a8de3d8 id: nil, name: &quot;Hello&quot;, artist_id: nil, genre_id: nil&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3">[<span class="ex">2</span>]pry(main)<span class="op">&gt;</span> <span class="ex">hotline_bling</span> = Song.new(name: <span class="st">&quot;Hotline Bling&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75b9f3a38 id: nil, name: &quot;Hotline Bling&quot;, artist_id: nil, genre_id: nil&gt;</span></a></code></pre></div>
<p>Okay, here we have two songs. Let’s make some artists to associate them to. In the <em>same PRY sessions as above</em>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">[<span class="ex">3</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele</span> = Artist.new(name: <span class="st">&quot;Adele&quot;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: nil, name: &quot;Adele&quot;&gt;</span></a>
<a class="sourceLine" id="cb14-3" title="3">[<span class="ex">4</span>] pry(main)<span class="op">&gt;</span> <span class="ex">drake</span> = Artist.new(name: <span class="st">&quot;Drake&quot;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b163c60 id: nil, name: &quot;Drake&quot;&gt;</span></a></code></pre></div>
<p>So, we know that an individual song has an <code>artist_id</code> attribute. We <em>could</em> associate <code>hello</code> to <code>adele</code> by setting <code>hello.artist_id=</code> equal to the <code>id</code> of the <code>adele</code> object. BUT! Active Record makes it so easy for us. The macros we implemented in our classes allow us to associate a song object directly to an artist object:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1">[<span class="ex">5</span>] pry(main)<span class="op">&gt;</span> <span class="ex">hello.artist</span> = adele</a>
<a class="sourceLine" id="cb15-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: nil, name: &quot;Adele&quot;&gt;</span></a></code></pre></div>
<p>Now, we can ask <code>hello</code> who its artist is:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1">[<span class="ex">6</span>] pry(main)<span class="op">&gt;</span> <span class="ex">hello.artist</span></a>
<a class="sourceLine" id="cb16-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: nil, name: &quot;Adele&quot;&gt;</span></a></code></pre></div>
<p>We can even chain methods to ask <code>hello</code> for the <em>name</em> of its artist:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1">[<span class="ex">7</span>] pry(main)<span class="op">&gt;</span> <span class="ex">hello.artist.name</span></a>
<a class="sourceLine" id="cb17-2" title="2">=<span class="op">&gt;</span> <span class="st">&quot;Adele&quot;</span></a></code></pre></div>
<p>Wow! This is great, but we’re not quite where we want to be. Right now, we’ve been able to assign an artist to a song, but is the reverse true?</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1">[<span class="ex">7</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs</span></a>
<a class="sourceLine" id="cb18-2" title="2">=<span class="op">&gt;</span> []</a></code></pre></div>
<p>In this case, we still need to tell the <code>adele</code> Artist instance which songs it has. We can do this by pushing the song instance into <code>adele.songs</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" title="1">[<span class="ex">7</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs.push</span>(hello)</a>
<a class="sourceLine" id="cb19-2" title="2">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Song</span>:0x007fc75a8de3d8 id: nil, name: <span class="st">&quot;Hello&quot;</span>, artist_id: nil, genre_id: nil<span class="op">&gt;</span>]</a></code></pre></div>
<p>Okay, now both sides of the relationships are updated, but so far all the work we’ve done has been with temporary instances of Artist and Song. To persist these relationships, we can use Active Record’s <code>save</code> functionality:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.save</span></a>
<a class="sourceLine" id="cb20-2" title="2">=<span class="op">&gt;</span> <span class="fu">true</span></a>
<a class="sourceLine" id="cb20-3" title="3">[<span class="ex">9</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele</span></a>
<a class="sourceLine" id="cb20-4" title="4">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: 1, name: &quot;Adele&quot;&gt;</span></a></code></pre></div>
<p>Notice that <code>adele</code> now has an <code>id</code>. What about <code>hello</code>?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1">[<span class="ex">10</span>] pry(main)<span class="op">&gt;</span> <span class="ex">hello</span></a>
<a class="sourceLine" id="cb21-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75a8de3d8 id: 1, name: &quot;Hello&quot;, artist_id: nil, genre_id: nil&gt;</span></a></code></pre></div>
<p>Whoa! We didn’t mention <code>hello</code> when we saved. However, we established an association by assigning <code>hello</code> as a song <code>adele</code> <em>has</em>. In order for <code>adele</code> to save, <code>hello</code> must also be saved. Thus, <code>hello</code> has also been given an <code>id</code>.</p>
<p>Go ahead and do the same for <code>hotline_bling</code> and <code>drake</code> to try it out on your own.</p>
<h2 id="adding-additional-associations">Adding Additional Associations</h2>
<p>Now, let’s make a second song for adele:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">someone_like_you</span> = Song.new(name: <span class="st">&quot;Someone Like You&quot;</span>)</a>
<a class="sourceLine" id="cb22-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75b5cabc8 id: nil, name: &quot;Someone Like You&quot;, artist_id: nil, genre_id: nil&gt;</span></a>
<a class="sourceLine" id="cb22-3" title="3">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">someone_like_you.artist</span> = adele</a>
<a class="sourceLine" id="cb22-4" title="4">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: 1, name: &quot;Adele&quot;&gt;</span></a></code></pre></div>
<p>We’ve only updated the song, so we should expect that <code>adele</code> is not aware of this song:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">someone_like_you.artist</span></a>
<a class="sourceLine" id="cb23-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: 1, name: &quot;Adele&quot;&gt;</span></a>
<a class="sourceLine" id="cb23-3" title="3">[<span class="ex">9</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs</span></a>
<a class="sourceLine" id="cb23-4" title="4">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Song</span>:0x007fc75b9f3a38 id: 1, name: <span class="st">&quot;Hello&quot;</span>, artist_id: 1, genre_id: nil<span class="op">&gt;</span>]</a></code></pre></div>
<p>Even if we save the song, <code>adele</code> will not be updated.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">someone_like_you.save</span></a>
<a class="sourceLine" id="cb24-2" title="2">=<span class="op">&gt;</span> <span class="fu">true</span></a>
<a class="sourceLine" id="cb24-3" title="3">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">someone_like_you</span></a>
<a class="sourceLine" id="cb24-4" title="4">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75b5cabc8 id: 2, name: &quot;Someone Like You&quot;, artist_id: 1, genre_id: nil&gt;</span></a>
<a class="sourceLine" id="cb24-5" title="5">[<span class="ex">9</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs</span></a>
<a class="sourceLine" id="cb24-6" title="6">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Song</span>:0x007fc75b9f3a38 id: 1, name: <span class="st">&quot;Hello&quot;</span>, artist_id: 1, genre_id: nil<span class="op">&gt;</span>]</a></code></pre></div>
<p>But lets see what happens when we switch some things around. Creating one more song:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">set_fire_to_the_rain</span> = Song.new(name: <span class="st">&quot;Set Fire to the Rain&quot;</span>)</a>
<a class="sourceLine" id="cb25-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75b5cabc8 id: nil, name: &quot;Set Fire to the Rain&quot;, artist_id: nil, genre_id: nil&gt;</span></a></code></pre></div>
<p>Then add the song to <code>adele</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1">[<span class="ex">9</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs.push</span>(set_fire_to_the_rain)</a>
<a class="sourceLine" id="cb26-2" title="2">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Song</span>:0x007fc75b9f3a38 id: 1, name: <span class="st">&quot;Hello&quot;</span>, artist_id: 1, genre_id: nil<span class="op">&gt;</span>, <span class="co">#&lt;Song:0x00007feac2be4f38 id: 3, name: &quot;Set Fire to the Rain&quot;, artist_id: 1, genre_id: nil&gt;]</span></a></code></pre></div>
<p>Whoa! Check it out - we did not explicitly save <code>set_fire_to_the_rain</code>, but just by pushing the instance into <code>adele.songs</code>, Active Record has gone ahead and saved the instance. Not only that, notice that the song instance <em>also has an aritst_id!</em></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1">[<span class="ex">8</span>] pry(main)<span class="op">&gt;</span> <span class="ex">set_fire_to_the_rain.artist</span></a>
<a class="sourceLine" id="cb27-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: 1, name: &quot;Adele&quot;&gt;</span></a></code></pre></div>
<p>So what is happening? Active Record is doing things for us behind the scenes, but when dealing with associations, it will behave differently depending on which side of a relationship between two models you are updating.</p>
<p><strong>Remember</strong>: In a <code>has_many</code>/<code>belongs_to</code> relationship, we can think of the model that <code>has_many</code> as the parent in the relationship. The model that <code>belongs_to</code>, then, is the child. If you tell the child that it belongs to the parent, <em>the parent won’t know about that relationship</em>. If you tell the parent that a certain child object has been added to its collection, <em>both the parent and the child will know about the association</em>.</p>
<p>Let’s see this in action again. Let’s create another new song and add it to <code>adele</code>’s songs collection:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb28-1" title="1">[<span class="ex">10</span>] pry(main)<span class="op">&gt;</span> <span class="ex">rolling_in_the_deep</span> = Song.new(name: <span class="st">&quot;Rolling in the Deep&quot;</span>)</a>
<a class="sourceLine" id="cb28-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Song:0x007fc75bb4d1e0 id: nil, name: &quot;Rolling in the Deep&quot;, artist_id: nil, genre_id: nil&gt;</span></a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb29-1" title="1">[<span class="ex">11</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.songs</span> <span class="op">&lt;&lt; rolling_in_the_deep</span></a>
<a class="sourceLine" id="cb29-2" title="2">=&gt; [ #&lt;Song:0x007fc75bb4d1e0 id: 4, name: &quot;Rolling in the Deep&quot;, artist_id: 1, genre_id: nil&gt;]</a>
<a class="sourceLine" id="cb29-3" title="3">[12] pry(main)&gt; rolling_in_the_deep.artist</a>
<a class="sourceLine" id="cb29-4" title="4">=&gt; #&lt;Artist:0x007fc75b8d9490 id: 4, name: &quot;Adele&quot;&gt;</a></code></pre></div>
<p>We added <code>rolling_in_the_deep</code> to <code>adele</code>’s collection of songs and we can see the <code>adele</code> knows it has that song in the collection <em>and</em> <code>rolling_in_the_deep</code> knows about its artist. Not only that, <code>rolling_in_the_deep</code> is not persisted to the database.</p>
<p>Notice that <code>adele.songs</code> returns an array of songs. When a model <code>has_many</code> of something, it will store those objects in an array. To add to that collection, we use the shovel operator, <code>&lt;&lt;</code>, to operate on that collection, treat <code>adele.songs</code> like any other array.</p>
<p>Let’s play around with some genres and our has many through association.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb30-1" title="1">[<span class="ex">13</span>] pry(main)<span class="op">&gt;</span> <span class="ex">pop</span> = Genre.create(name: <span class="st">&quot;pop&quot;</span>)</a>
<a class="sourceLine" id="cb30-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Genre:0x007fa34338d270 id: 1, name: &quot;pop&quot;&gt;</span></a></code></pre></div>
<p>This time, we’ll just use <code>create</code> directly, which would be the same as running <code>Genre.new</code>, then <code>Genre.save</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb31-1" title="1">[<span class="ex">14</span>] pry(main)<span class="op">&gt;</span> <span class="ex">pop.songs</span> <span class="op">&lt;&lt; rolling_in_the_deep</span></a>
<a class="sourceLine" id="cb31-2" title="2">=&gt; [#&lt;Song:0x007fc75bb4d1e0 id: 4, name: &quot;Rolling in the Deep&quot;, artist_id: 1, genre_id: 1&gt;]</a>
<a class="sourceLine" id="cb31-3" title="3">[15] pry(main)&gt; pop.songs</a>
<a class="sourceLine" id="cb31-4" title="4">=&gt; [#&lt;Song:0x007fc75bb4d1e0 id: 4, name: &quot;Rolling in the Deep&quot;, artist_id: 1, genre_id: 1&gt;]</a>
<a class="sourceLine" id="cb31-5" title="5">[16] pry(main)&gt; rolling_in_the_deep.genre</a>
<a class="sourceLine" id="cb31-6" title="6">=&gt; #&lt;Genre:0x007fa34338d270 id: 1, name: &quot;pop&quot;&gt;</a></code></pre></div>
<p>It’s working! But even cooler is that we’ve established has many <em>through</em> relationships. By creating a genre, then pushing a song into that genre’s list of songs, <em>the genre will now be able to produce its associated artists!</em></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb32-1" title="1">[<span class="ex">16</span>] pry(main)<span class="op">&gt;</span> <span class="ex">rolling_in_the_deep.artist</span></a>
<a class="sourceLine" id="cb32-2" title="2">=<span class="op">&gt;</span> <span class="co">#&lt;Artist:0x007fc75b8d9490 id: 4, name: &quot;Adele&quot;&gt;</span></a>
<a class="sourceLine" id="cb32-3" title="3">[<span class="ex">17</span>] pry(main)<span class="op">&gt;</span> <span class="ex">pop.artists</span></a>
<a class="sourceLine" id="cb32-4" title="4">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Artist</span>:0x007fc75b8d9490 id: 1, name: <span class="st">&quot;Adele&quot;</span><span class="op">&gt;</span>]</a>
<a class="sourceLine" id="cb32-5" title="5">[<span class="ex">28</span>] pry(main)<span class="op">&gt;</span> <span class="ex">adele.genres</span></a>
<a class="sourceLine" id="cb32-6" title="6">=<span class="op">&gt;</span> [#<span class="op">&lt;</span><span class="ex">Genre</span>:0x007fa34338d270 id: 1, name: <span class="st">&quot;pop&quot;</span><span class="op">&gt;</span>]</a></code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>So, order and direction of operations does matter when establishing associations between models - it is typically better to update the <code>has_many</code> side of a relationship to get the full benefit of Active Record’s power. Still, as we can see, with just migrations and Active Record macros, we can start to build and persist associations between things!</p>
<h2 id="video-reviews">Video Reviews</h2>
<ul>
<li><p><a href="https://www.youtube.com/watch?v=5dqPYRsQd10">Active Record Associations</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=l9JCzNN2Z2U">Active Record Associations II</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=WVBWlnUghOI">Aliasing Active Record Associations</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=ZfJ1rqFcNFU">Blog CLI with Active Record and Associations</a></p></li>
</ul>
<p class="util--hide">
View <a href='https://learn.co/lessons/activerecord-associations-intro'>Active Record Associations</a> on Learn.co and start learning to code for free.
</p>
</body>
</html>
