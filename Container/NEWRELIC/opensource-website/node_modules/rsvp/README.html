<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="rsvp.js-build-status-inline-docs">RSVP.js <a href="http://travis-ci.org/tildeio/rsvp.js"><img src="https://secure.travis-ci.org/tildeio/rsvp.js.svg?branch=master" alt="Build Status" /></a> <a href="http://inch-ci.org/github/tildeio/rsvp.js"><img src="http://inch-ci.org/github/tildeio/rsvp.js.svg?branch=master" alt="Inline docs" /></a></h1>
<p>RSVP.js provides simple tools for organizing asynchronous code.</p>
<p>Specifically, it is a tiny implementation of Promises/A+.</p>
<p>It works in node and the browser (IE9+, all the popular evergreen ones).</p>
<h2 id="downloads">downloads</h2>
<ul>
<li>rsvp (<a href="https://cdn.jsdelivr.net/npm/rsvp/dist/rsvp.js">latest</a> | <a href="https://cdn.jsdelivr.net/npm/rsvp@4/dist/rsvp.js">4.x</a>)</li>
<li>rsvp minified (<a href="https://cdn.jsdelivr.net/npm/rsvp/dist/rsvp.min.js">latest</a> | <a href="https://cdn.jsdelivr.net/npm/rsvp@4/dist/rsvp.min.js">4.x</a>)</li>
</ul>
<h2 id="cdn">CDN</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://cdn.jsdelivr.net/npm/rsvp@4/dist/rsvp.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<h2 id="promises">Promises</h2>
<p>Although RSVP is ES6 compliant, it does bring along some extra toys. If you would prefer a strict ES6 subset, I would suggest checking out our sibling project https://github.com/stefanpenner/es6-promise, It is RSVP but stripped down to the ES6 spec features.</p>
<h2 id="node">Node</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">yarn</span> add --save rsvp</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># or ...</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="ex">npm</span> install --save rsvp</a></code></pre></div>
<p><code>RSVP.Promise</code> is an implementation of <a href="http://promises-aplus.github.com/promises-spec/">Promises/A+</a> that passes the <a href="https://github.com/promises-aplus/promises-tests">test suite</a>.</p>
<p>It delivers all promises asynchronously, even if the value is already available, to help you write consistent code that doesn’t change if the underlying data provider changes from synchronous to asynchronous.</p>
<p>It is compatible with <a href="https://github.com/mozilla/task.js">TaskJS</a>, a library by Dave Herman of Mozilla that uses ES6 generators to allow you to write synchronous code with promises. It currently works in Firefox, and will work in any browser that adds support for ES6 generators. See the section below on TaskJS for more information.</p>
<h3 id="basic-usage">Basic Usage</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> RSVP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;rsvp&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">var</span> promise <span class="op">=</span> <span class="kw">new</span> <span class="va">RSVP</span>.<span class="at">Promise</span>(<span class="kw">function</span>(resolve<span class="op">,</span> reject) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="co">// succeed</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="at">resolve</span>(value)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="co">// or reject</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="at">reject</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">promise</span>.<span class="at">then</span>(<span class="kw">function</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="co">// success</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(error) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="co">// failure</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Once a promise has been resolved or rejected, it cannot be resolved or rejected again.</p>
<p>Here is an example of a simple XHR2 wrapper written using RSVP.js:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> getJSON <span class="op">=</span> <span class="kw">function</span>(url) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">var</span> promise <span class="op">=</span> <span class="kw">new</span> <span class="va">RSVP</span>.<span class="at">Promise</span>(<span class="kw">function</span>(resolve<span class="op">,</span> reject)<span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">var</span> client <span class="op">=</span> <span class="kw">new</span> <span class="at">XMLHttpRequest</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="va">client</span>.<span class="at">open</span>(<span class="st">&quot;GET&quot;</span><span class="op">,</span> url)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="va">client</span>.<span class="at">onreadystatechange</span> <span class="op">=</span> handler<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="va">client</span>.<span class="at">responseType</span> <span class="op">=</span> <span class="st">&quot;json&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="va">client</span>.<span class="at">setRequestHeader</span>(<span class="st">&quot;Accept&quot;</span><span class="op">,</span> <span class="st">&quot;application/json&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="va">client</span>.<span class="at">send</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="kw">function</span> <span class="at">handler</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-11" title="11">      <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">readyState</span> <span class="op">===</span> <span class="kw">this</span>.<span class="at">DONE</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-12" title="12">        <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">status</span> <span class="op">===</span> <span class="dv">200</span>) <span class="op">{</span> <span class="at">resolve</span>(<span class="kw">this</span>.<span class="at">response</span>)<span class="op">;</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="cf">else</span> <span class="op">{</span> <span class="at">reject</span>(<span class="kw">this</span>)<span class="op">;</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb4-14" title="14">      <span class="op">}</span></a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="op">};</span></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18">  <span class="cf">return</span> promise<span class="op">;</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="op">};</span></a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="at">getJSON</span>(<span class="st">&quot;/posts.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(json) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-22" title="22">  <span class="co">// continue</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(error) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-24" title="24">  <span class="co">// handle errors</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="chaining">Chaining</h3>
<p>One of the really awesome features of Promises/A+ promises are that they can be chained together. In other words, the return value of the first resolve handler will be passed to the second resolve handler.</p>
<p>If you return a regular value, it will be passed, as is, to the next handler.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="at">getJSON</span>(<span class="st">&quot;/posts.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(json) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="cf">return</span> <span class="va">json</span>.<span class="at">post</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="op">}</span>).<span class="at">then</span>(<span class="kw">function</span>(post) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="co">// proceed</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The really awesome part comes when you return a promise from the first handler:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="at">getJSON</span>(<span class="st">&quot;/post/1.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(post) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="co">// save off post</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="cf">return</span> <span class="at">getJSON</span>(<span class="va">post</span>.<span class="at">commentURL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="op">}</span>).<span class="at">then</span>(<span class="kw">function</span>(comments) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="co">// proceed with access to post and comments</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>This allows you to flatten out nested callbacks, and is the main feature of promises that prevents “rightward drift” in programs with a lot of asynchronous code.</p>
<p>Errors also propagate:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">getJSON</span>(<span class="st">&quot;/posts.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(posts) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(error) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="co">// since no rejection handler was passed to the</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="co">// first `.then`, the error propagates.</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You can use this to emulate <code>try/catch</code> logic in synchronous code. Simply chain as many resolve callbacks as you want, and add a failure handler at the end to catch errors.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="at">getJSON</span>(<span class="st">&quot;/post/1.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(post) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="cf">return</span> <span class="at">getJSON</span>(<span class="va">post</span>.<span class="at">commentURL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">}</span>).<span class="at">then</span>(<span class="kw">function</span>(comments) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="co">// proceed with access to posts and comments</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(error) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="co">// handle errors in either of the two requests</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="error-handling">Error Handling</h2>
<p>There are times when dealing with promises that it seems like any errors are being ‘swallowed’, and not properly raised. This makes it extremely difficult to track down where a given issue is coming from. Thankfully, <code>RSVP</code> has a solution for this problem built in.</p>
<p>You can register functions to be called when an uncaught error occurs within your promises. These callback functions can be anything, but a common practice is to call <code>console.assert</code> to dump the error to the console.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span>(reason) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="va">console</span>.<span class="at">assert</span>(<span class="kw">false</span><span class="op">,</span> reason)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>RSVP</code> allows Promises to be labeled: <code>Promise.resolve(value, 'I AM A LABEL')</code> If provided, this label is passed as the second argument to <code>RSVP.on('error')</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span>(reason<span class="op">,</span> label) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="cf">if</span> (label) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="va">console</span>.<span class="at">error</span>(label)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="va">console</span>.<span class="at">assert</span>(<span class="kw">false</span><span class="op">,</span> reason)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>NOTE:</strong> promises do allow for errors to be handled asynchronously, so this callback may result in false positives.</p>
<h2 id="finally">Finally</h2>
<p><code>finally</code> will be invoked regardless of the promise’s fate, just as native try/catch/finally behaves.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="at">findAuthor</span>().<span class="at">catch</span>(<span class="kw">function</span>(reason)<span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="cf">return</span> <span class="at">findOtherAuthor</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="op">}</span>).<span class="at">finally</span>(<span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="co">// author was either found, or not</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="arrays-of-promises">Arrays of promises</h2>
<p>Sometimes you might want to work with many promises at once. If you pass an array of promises to the <code>all()</code> method it will return a new promise that will be fulfilled when all of the promises in the array have been fulfilled; or rejected immediately if any promise in the array is rejected.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">var</span> promises <span class="op">=</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">13</span>].<span class="at">map</span>(<span class="kw">function</span>(id)<span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="cf">return</span> <span class="at">getJSON</span>(<span class="st">&quot;/post/&quot;</span> <span class="op">+</span> id <span class="op">+</span> <span class="st">&quot;.json&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-4" title="4"></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="va">RSVP</span>.<span class="at">all</span>(promises).<span class="at">then</span>(<span class="kw">function</span>(posts) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="co">// posts contains an array of results for the given promises</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(reason)<span class="op">{</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="co">// if any of the promises fails.</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="hash-of-promises">Hash of promises</h2>
<p>If you need to reference many promises at once (like <code>all()</code>), but would like to avoid encoding the actual promise order you can use <code>hash()</code>. If you pass an object literal (where the values are promises) to the <code>hash()</code> method it will return a new promise that will be fulfilled when all of the promises have been fulfilled; or rejected immediately if any promise is rejected.</p>
<p>The key difference to the <code>all()</code> function is that both the fulfillment value and the argument to the <code>hash()</code> function are object literals. This allows you to simply reference the results directly off the returned object without having to remember the initial order like you would with <code>all()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">var</span> promises <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="dt">posts</span><span class="op">:</span> <span class="at">getJSON</span>(<span class="st">&quot;/posts.json&quot;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dt">users</span><span class="op">:</span> <span class="at">getJSON</span>(<span class="st">&quot;/users.json&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="va">RSVP</span>.<span class="at">hash</span>(promises).<span class="at">then</span>(<span class="kw">function</span>(results) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">results</span>.<span class="at">users</span>) <span class="co">// print the users.json results</span></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">results</span>.<span class="at">posts</span>) <span class="co">// print the posts.json results</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="all-settled-and-hash-settled">All settled and hash settled</h2>
<p>Sometimes you want to work with several promises at once, but instead of rejecting immediately if any promise is rejected, as with <code>all()</code> or <code>hash()</code>, you want to be able to inspect the results of all your promises, whether they fulfill or reject. For this purpose, you can use <code>allSettled()</code> and <code>hashSettled()</code>. These work exactly like <code>all()</code> and <code>hash()</code>, except that they fulfill with an array or hash (respectively) of the constituent promises’ result states. Each state object will either indicate fulfillment or rejection, and provide the corresponding value or reason. The states will take one of the following formats:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="op">{</span> <span class="dt">state</span><span class="op">:</span> <span class="st">&#39;fulfilled&#39;</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> value <span class="op">}</span></a>
<a class="sourceLine" id="cb14-2" title="2">  or</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="op">{</span> <span class="dt">state</span><span class="op">:</span> <span class="st">&#39;rejected&#39;</span><span class="op">,</span> <span class="dt">reason</span><span class="op">:</span> reason <span class="op">}</span></a></code></pre></div>
<h2 id="deferred">Deferred</h2>
<blockquote>
<p>The <code>RSVP.Promise</code> constructor is generally a better, less error-prone choice than <code>RSVP.defer()</code>. Promises are recommended unless the specific properties of deferred are needed.</p>
</blockquote>
<p>Sometimes one needs to create a deferred object, without immediately specifying how it will be resolved. These deferred objects are essentially a wrapper around a promise, whilst providing late access to the <code>resolve()</code> and <code>reject()</code> methods.</p>
<p>A deferred object has this form: <code>{ promise, resolve(x), reject(r) }</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">var</span> deferred <span class="op">=</span> <span class="va">RSVP</span>.<span class="at">defer</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="va">deferred</span>.<span class="at">promise</span> <span class="co">// access the promise</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="va">deferred</span>.<span class="at">resolve</span>()<span class="op">;</span></a></code></pre></div>
<h2 id="taskjs">TaskJS</h2>
<p>The <a href="https://github.com/mozilla/task.js">TaskJS</a> library makes it possible to take promises-oriented code and make it synchronous using ES6 generators.</p>
<p>Let’s review an earlier example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="at">getJSON</span>(<span class="st">&quot;/post/1.json&quot;</span>).<span class="at">then</span>(<span class="kw">function</span>(post) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="cf">return</span> <span class="at">getJSON</span>(<span class="va">post</span>.<span class="at">commentURL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="op">}</span>).<span class="at">then</span>(<span class="kw">function</span>(comments) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="co">// proceed with access to posts and comments</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span>).<span class="at">catch</span>(<span class="kw">function</span>(reason) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-6" title="6">  <span class="co">// handle errors in either of the two requests</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Without any changes to the implementation of <code>getJSON</code>, you could write the following code with TaskJS:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="at">spawn</span>(<span class="kw">function</span> <span class="op">*</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-3" title="3">    <span class="kw">var</span> post <span class="op">=</span> <span class="kw">yield</span> <span class="at">getJSON</span>(<span class="st">&quot;/post/1.json&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4">    <span class="kw">var</span> comments <span class="op">=</span> <span class="kw">yield</span> <span class="at">getJSON</span>(<span class="va">post</span>.<span class="at">commentURL</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="op">}</span> <span class="cf">catch</span>(error) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-6" title="6">    <span class="co">// handle errors</span></a>
<a class="sourceLine" id="cb17-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>In the above example, <code>function *</code> is new syntax in ES6 for <a href="http://wiki.ecmascript.org/doku.php?id=harmony:generators">generators</a>. Inside a generator, <code>yield</code> pauses the generator, returning control to the function that invoked the generator. In this case, the invoker is a special function that understands the semantics of Promises/A, and will automatically resume the generator as soon as the promise is resolved.</p>
<p>The cool thing here is the same promises that work with current JavaScript using <code>.then</code> will work seamlessly with TaskJS once a browser has implemented it!</p>
<h2 id="instrumentation">Instrumentation</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">function</span> <span class="at">listener</span> (event) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="va">event</span>.<span class="at">guid</span>      <span class="co">// guid of promise. Must be globally unique, not just within the implementation</span></a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="va">event</span>.<span class="at">childGuid</span> <span class="co">// child of child promise (for chained via `then`)</span></a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="va">event</span>.<span class="at">eventName</span> <span class="co">// one of [&#39;created&#39;, &#39;chained&#39;, &#39;fulfilled&#39;, &#39;rejected&#39;]</span></a>
<a class="sourceLine" id="cb18-5" title="5">  <span class="va">event</span>.<span class="at">detail</span>    <span class="co">// fulfillment value or rejection reason, if applicable</span></a>
<a class="sourceLine" id="cb18-6" title="6">  <span class="va">event</span>.<span class="at">label</span>     <span class="co">// label passed to promise&#39;s constructor</span></a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="va">event</span>.<span class="at">timeStamp</span> <span class="co">// milliseconds elapsed since 1 January 1970 00:00:00 UTC up until now</span></a>
<a class="sourceLine" id="cb18-8" title="8">  <span class="va">event</span>.<span class="at">stack</span>     <span class="co">// stack at the time of the event. (if  &#39;instrument-with-stack&#39; is true)</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb18-10" title="10"></a>
<a class="sourceLine" id="cb18-11" title="11"><span class="va">RSVP</span>.<span class="at">configure</span>(<span class="st">&#39;instrument&#39;</span><span class="op">,</span> <span class="kw">true</span> <span class="op">|</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-12" title="12"><span class="co">// capturing the stacks is slow, so you also have to opt in</span></a>
<a class="sourceLine" id="cb18-13" title="13"><span class="va">RSVP</span>.<span class="at">configure</span>(<span class="st">&#39;instrument-with-stack&#39;</span><span class="op">,</span> <span class="kw">true</span> <span class="op">|</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-14" title="14"></a>
<a class="sourceLine" id="cb18-15" title="15"><span class="co">// events</span></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;created&#39;</span><span class="op">,</span> listener)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-17" title="17"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;chained&#39;</span><span class="op">,</span> listener)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-18" title="18"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;fulfilled&#39;</span><span class="op">,</span> listener)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-19" title="19"><span class="va">RSVP</span>.<span class="at">on</span>(<span class="st">&#39;rejected&#39;</span><span class="op">,</span> listener)<span class="op">;</span></a></code></pre></div>
<p>Events are only triggered when <code>RSVP.configure('instrument')</code> is true, although listeners can be registered at any time.</p>
<h2 id="building-testing">Building &amp; Testing</h2>
<p>Custom tasks:</p>
<ul>
<li><code>npm test</code> - build &amp; test</li>
<li><code>npm test:node</code> - build &amp; test just node</li>
<li><code>npm test:server</code> - build/watch &amp; test</li>
<li><code>npm run build</code> - Build</li>
<li><code>npm run build:production</code> - Build production (with minified output)</li>
<li><code>npm start</code> - build, watch and run interactive server at http://localhost:4200’</li>
</ul>
<h2 id="releasing">Releasing</h2>
<p>Check what release-it will do by running <code>npm run-script dry-run-release</code>. To actually release, run <code>node_modules/.bin/release-it</code>.</p>
</body>
</html>
