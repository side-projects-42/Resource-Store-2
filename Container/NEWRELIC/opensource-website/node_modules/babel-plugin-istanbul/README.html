<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="babel-plugin-istanbul">babel-plugin-istanbul</h1>
<p><a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/istanbuljs/babel-plugin-istanbul.svg" alt="Greenkeeper badge" /></a> <a href="https://travis-ci.org/istanbuljs/babel-plugin-istanbul"><img src="https://travis-ci.org/istanbuljs/babel-plugin-istanbul.svg?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/istanbuljs/babel-plugin-istanbul?branch=master"><img src="https://coveralls.io/repos/github/istanbuljs/babel-plugin-istanbul/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="https://conventionalcommits.org"><img src="https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg" alt="Conventional Commits" /></a> <a href="http://devtoolscommunity.herokuapp.com"><img src="http://devtoolscommunity.herokuapp.com/badge.svg" alt="community slack" /></a></p>
<p><em>Having problems? want to contribute? join our <a href="http://devtoolscommunity.herokuapp.com">community slack</a></em>.</p>
<p>A Babel plugin that instruments your code with Istanbul coverage. It can instantly be used with <a href="https://github.com/karma-runner/karma-coverage">karma-coverage</a> and mocha on Node.js (through <a href="https://github.com/bcoe/nyc">nyc</a>).</p>
<p><strong>Note:</strong> This plugin does not generate any report or save any data to any file; it only adds instrumenting code to your JavaScript source code. To integrate with testing tools, please see the <a href="#integrations">Integrations</a> section.</p>
<h2 id="usage">Usage</h2>
<p>Install it:</p>
<pre><code>npm install --save-dev babel-plugin-istanbul</code></pre>
<p>Add it to <code>.babelrc</code> in test mode:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="st">&quot;env&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="st">&quot;test&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">      <span class="st">&quot;plugins&quot;</span><span class="op">:</span> [ <span class="st">&quot;istanbul&quot;</span> ]</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>Optionally, use <a href="https://www.npmjs.com/package/cross-env">cross-env</a> to set <code>NODE_ENV=test</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">&quot;test&quot;</span><span class="fu">:</span> <span class="st">&quot;cross-env NODE_ENV=test nyc --reporter=lcov --reporter=text mocha test/*.js&quot;</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="fu">}</span></a></code></pre></div>
<h2 id="integrations">Integrations</h2>
<h3 id="karma">karma</h3>
<p>It <em>just works</em> with Karma. First, make sure that the code is already transpiled by Babel (either using <code>karma-babel-preprocessor</code>, <code>karma-webpack</code>, or <code>karma-browserify</code>). Then, simply set up <a href="https://github.com/karma-runner/karma-coverage">karma-coverage</a> according to the docs, but <strong>don’t add the <code>coverage</code> preprocessor.</strong> This plugin has already instrumented your code, and Karma should pick it up automatically.</p>
<p>It has been tested with <a href="https://codecov.io/github/bemusic/bemuse">bemusic/bemuse</a> project, which contains ~2400 statements.</p>
<h3 id="mocha-on-node.js-through-nyc">mocha on node.js (through nyc)</h3>
<p>Configure Mocha to transpile JavaScript code using Babel, then you can run your tests with <a href="https://github.com/bcoe/nyc"><code>nyc</code></a>, which will collect all the coverage report.</p>
<p>babel-plugin-istanbul respects the <code>include</code>/<code>exclude</code> configuration options from nyc, but you also need to <strong>configure NYC not to instrument your code</strong> by adding these settings in your <code>package.json</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">  <span class="st">&quot;nyc&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="st">&quot;sourceMap&quot;</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="st">&quot;instrument&quot;</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="op">},</span></a></code></pre></div>
<h2 id="ignoring-files">Ignoring files</h2>
<p>You don’t want to cover your test files as this will skew your coverage results. You can configure this by providing plugin options matching nyc’s <a href="https://github.com/bcoe/nyc#excluding-files"><code>exclude</code>/<code>include</code> rules</a>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">&quot;env&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="dt">&quot;test&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">      <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb5-5" title="5">        <span class="ot">[</span><span class="st">&quot;istanbul&quot;</span><span class="ot">,</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb5-6" title="6">          <span class="dt">&quot;exclude&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb5-7" title="7">            <span class="st">&quot;**/*.spec.js&quot;</span></a>
<a class="sourceLine" id="cb5-8" title="8">          <span class="ot">]</span></a>
<a class="sourceLine" id="cb5-9" title="9">        <span class="fu">}</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb5-10" title="10">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="fu">}</span></a></code></pre></div>
<p>If you don’t provide options in your Babel config, the plugin will look for <code>exclude</code>/<code>include</code> config under an <code>"nyc"</code> key in <code>package.json</code>.</p>
<p>You can also use <a href="https://github.com/gotwarlost/istanbul/blob/master/ignoring-code-for-coverage.md#ignoring-code-for-coverage-purposes">istanbul’s ignore hints</a> to specify specific lines of code to skip instrumenting.</p>
<h2 id="source-maps">Source Maps</h2>
<p>By default, this plugin will pick up inline source maps and attach them to the instrumented code such that code coverage can be remapped back to the original source, even for multi-step build processes. This can be memory intensive. Set <code>useInlineSourceMaps</code> to prevent this behavior.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">&quot;env&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">&quot;test&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">      <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="ot">[</span><span class="st">&quot;istanbul&quot;</span><span class="ot">,</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">          <span class="dt">&quot;useInlineSourceMaps&quot;</span><span class="fu">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="fu">}</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb6-8" title="8">      <span class="ot">]</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="fu">}</span></a></code></pre></div>
<p>If you’re instrumenting code programatically, you can pass a source map explicitly.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="im">import</span> babelPluginIstanbul <span class="im">from</span> <span class="st">&#39;babel-plugin-istanbul&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">function</span> <span class="at">instrument</span>(sourceCode<span class="op">,</span> sourceMap<span class="op">,</span> fileName) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="cf">return</span> <span class="va">babel</span>.<span class="at">transform</span>(sourceCode<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">    filename<span class="op">,</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="dt">plugins</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb7-7" title="7">      [babelPluginIstanbul<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">        <span class="dt">inputSourceMap</span><span class="op">:</span> sourceMap</a>
<a class="sourceLine" id="cb7-9" title="9">      <span class="op">}</span>]</a>
<a class="sourceLine" id="cb7-10" title="10">    ]</a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-12" title="12"><span class="op">}</span></a></code></pre></div>
<h2 id="credit-where-credit-is-due">Credit where credit is due</h2>
<p>The approach used in <code>babel-plugin-istanbul</code> was inspired by <a href="https://github.com/dtinth">Thai Pangsakulyanont</a>’s original library <a href="https://github.com/dtinth/babel-plugin-__coverage__"><code>babel-plugin-__coverage__</code></a>.</p>
<h2 id="babel-plugin-istanbul-for-enterprise"><code>babel-plugin-istanbul</code> for enterprise</h2>
<p>Available as part of the Tidelift Subscription.</p>
<p>The maintainers of <code>babel-plugin-istanbul</code> and thousands of other packages are working with Tidelift to deliver commercial support and maintenance for the open source dependencies you use to build your applications. Save time, reduce risk, and improve code health, while paying the maintainers of the exact dependencies you use. <a href="https://tidelift.com/subscription/pkg/npm-babel-plugin-istanbul?utm_source=npm-babel-plugin-istanbul&amp;utm_medium=referral&amp;utm_campaign=enterprise&amp;utm_term=repo">Learn more.</a></p>
</body>
</html>
