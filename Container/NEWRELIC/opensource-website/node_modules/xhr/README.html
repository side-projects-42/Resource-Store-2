<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="xhr">xhr</h1>
<p><a href="https://gitter.im/naugtur-xhr/Lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/naugtur-xhr/Lobby.svg" alt="Join the chat at https://gitter.im/naugtur-xhr/Lobby" /></a></p>
<p>A small XMLHttpRequest wrapper. Designed for use with <a href="http://browserify.org/">browserify</a>, <a href="https://webpack.github.io/">webpack</a> etc.</p>
<p>API is a subset of <a href="https://github.com/request/request">request</a> so you can write code that works in both node.js and the browser by using <code>require('request')</code> in your code and telling your browser bundler to load <code>xhr</code> instead of <code>request</code>.</p>
<p>For browserify, add a <a href="https://github.com/substack/node-browserify#browser-field">browser</a> field to your <code>package.json</code>:</p>
<pre><code>&quot;browser&quot;: {
  &quot;request&quot;: &quot;xhr&quot;
}</code></pre>
<p>For webpack, add a <a href="http://webpack.github.io/docs/configuration.html#resolve-alias">resolve.alias</a> field to your configuration:</p>
<pre><code>&quot;resolve&quot;: {
  &quot;alias&quot;: {
    &quot;request$&quot;: &quot;xhr&quot;
  }
}</code></pre>
<p>Browser support: IE8+ and everything else.</p>
<h2 id="installation">Installation</h2>
<pre><code>npm install xhr</code></pre>
<h2 id="example">Example</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> xhr <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;xhr&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="at">xhr</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;post&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">body</span><span class="op">:</span> someJSONString<span class="op">,</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">uri</span><span class="op">:</span> <span class="st">&quot;/foo&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">        <span class="st">&quot;Content-Type&quot;</span><span class="op">:</span> <span class="st">&quot;application/json&quot;</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="op">},</span> <span class="kw">function</span> (err<span class="op">,</span> resp<span class="op">,</span> body) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="co">// check resp.statusCode</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="op">}</span>)</a></code></pre></div>
<h2 id="var-req-xhroptions-callback"><code>var req = xhr(options, callback)</code></h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">type XhrOptions <span class="op">=</span> String <span class="op">|</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="dt">useXDR</span><span class="op">:</span> Boolean<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-3" title="3">    sync: Boolean<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-4" title="4">    uri: String<span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">url</span><span class="op">:</span> String<span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">method</span><span class="op">:</span> String<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-7" title="7">    timeout: Number<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-8" title="8">    headers: Object<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-9" title="9">    body: String<span class="op">?</span> <span class="op">|</span> Object<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-10" title="10">    json: Boolean<span class="op">?</span> <span class="op">|</span> Object<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-11" title="11">    username: String<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-12" title="12">    password: String<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-13" title="13">    withCredentials: Boolean<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-14" title="14">    responseType: String<span class="op">?,</span></a>
<a class="sourceLine" id="cb5-15" title="15">    beforeSend: Function<span class="op">?</span></a>
<a class="sourceLine" id="cb5-16" title="16">}</a>
<a class="sourceLine" id="cb5-17" title="17">xhr :<span class="op">=</span> (XhrOptions<span class="op">,</span> Callback<span class="op">&lt;</span>Response<span class="op">&gt;</span>) <span class="kw">=&gt;</span> Request</a></code></pre></div>
<p>the returned object is either an <a href="http://xhr.spec.whatwg.org/#interface-xmlhttprequest"><code>XMLHttpRequest</code></a> instance or an <a href="http://msdn.microsoft.com/en-us/library/ie/cc288060(v=vs.85).aspx"><code>XDomainRequest</code></a> instance (if on IE8/IE9 &amp;&amp; <code>options.useXDR</code> is set to <code>true</code>)</p>
<p>Your callback will be called once with the arguments ( <a href="http://es5.github.com/#x15.11"><code>Error</code></a>, <code>response</code> , <code>body</code> ) where the response is an object:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="dt">body</span><span class="op">:</span> Object<span class="op">||</span>String<span class="op">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">statusCode</span><span class="op">:</span> Number<span class="op">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">method</span><span class="op">:</span> String<span class="op">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="dt">headers</span><span class="op">:</span> <span class="op">{},</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="dt">url</span><span class="op">:</span> String<span class="op">,</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="dt">rawRequest</span><span class="op">:</span> xhr</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="op">}</span></a></code></pre></div>
<ul>
<li><code>body</code>: HTTP response body - <a href="http://xhr.spec.whatwg.org/#the-response-attribute"><code>XMLHttpRequest.response</code></a>, <a href="http://xhr.spec.whatwg.org/#the-responsetext-attribute"><code>XMLHttpRequest.responseText</code></a> or <a href="http://xhr.spec.whatwg.org/#the-responsexml-attribute"><code>XMLHttpRequest.responseXML</code></a> depending on the request type.</li>
<li><code>rawRequest</code>: Original <a href="http://xhr.spec.whatwg.org/#interface-xmlhttprequest"><code>XMLHttpRequest</code></a> instance or <a href="http://msdn.microsoft.com/en-us/library/ie/cc288060(v=vs.85).aspx"><code>XDomainRequest</code></a> instance (if on IE8/IE9 &amp;&amp; <code>options.useXDR</code> is set to <code>true</code>)</li>
<li><code>headers</code>: A collection of headers where keys are header names converted to lowercase</li>
</ul>
<p>Your callback will be called with an <a href="http://es5.github.com/#x15.11"><code>Error</code></a> if there is an error in the browser that prevents sending the request. A HTTP 500 response is not going to cause an error to be returned.</p>
<h2 id="other-signatures">Other signatures</h2>
<ul>
<li><p><code>var req = xhr(url, callback)</code> - a simple string instead of the options. In this case, a GET request will be made to that url.</p></li>
<li><p><code>var req = xhr(url, options, callback)</code> - the above may also be called with the standard set of options.</p></li>
</ul>
<h3 id="convience-methods">Convience methods</h3>
<ul>
<li><code>var req = xhr.{post, put, patch, del, head, get}(url, callback)</code></li>
<li><code>var req = xhr.{post, put, patch, del, head, get}(options, callback)</code></li>
<li><code>var req = xhr.{post, put, patch, del, head, get}(url, options, callback)</code></li>
</ul>
<p>The <code>xhr</code> module has convience functions attached that will make requests with the given method. Each function is named after its method, with the exception of <code>DELETE</code> which is called <code>xhr.del</code> for compatibility.</p>
<p>The method shorthands may be combined with the url-first form of <code>xhr</code> for succinct and descriptive requests. For example,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="va">xhr</span>.<span class="at">post</span>(<span class="st">&#39;/post-to-me&#39;</span><span class="op">,</span> <span class="kw">function</span>(err<span class="op">,</span> resp) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">resp</span>.<span class="at">body</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">}</span>)</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="va">xhr</span>.<span class="at">del</span>(<span class="st">&#39;/delete-me&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span> <span class="dt">my</span><span class="op">:</span> <span class="st">&#39;auth&#39;</span> <span class="op">}</span> <span class="op">},</span> <span class="kw">function</span> (err<span class="op">,</span> resp) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">resp</span>.<span class="at">statusCode</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">}</span>)</a></code></pre></div>
<h2 id="options">Options</h2>
<h3 id="options.method"><code>options.method</code></h3>
<p>Specify the method the <a href="http://xhr.spec.whatwg.org/#interface-xmlhttprequest"><code>XMLHttpRequest</code></a> should be opened with. Passed to <a href="http://xhr.spec.whatwg.org/#the-open()-method"><code>XMLHttpRequest.open</code></a>. Defaults to “GET”</p>
<h3 id="options.usexdr"><code>options.useXDR</code></h3>
<p>Specify whether this is a cross origin (CORS) request for IE&lt;10. Switches IE to use <a href="http://msdn.microsoft.com/en-us/library/ie/cc288060(v=vs.85).aspx"><code>XDomainRequest</code></a> instead of <code>XMLHttpRequest</code>. Ignored in other browsers.</p>
<p>Note that headers cannot be set on an XDomainRequest instance.</p>
<h3 id="options.sync"><code>options.sync</code></h3>
<p>Specify whether this is a synchrounous request. Note that when this is true the callback will be called synchronously. In most cases this option should not be used. Only use if you know what you are doing!</p>
<h3 id="options.body"><code>options.body</code></h3>
<p>Pass in body to be send across the <a href="http://xhr.spec.whatwg.org/#interface-xmlhttprequest"><code>XMLHttpRequest</code></a>. Generally should be a string. But anything that’s valid as a parameter to <a href="http://xhr.spec.whatwg.org/#the-send()-method"><code>XMLHttpRequest.send</code></a> should work (Buffer for file, etc.).</p>
<p>If <code>options.json</code> is <code>true</code>, then this must be a JSON-serializable object. <code>options.body</code> is passed to <code>JSON.stringify</code> and sent.</p>
<h3 id="options.uri-or-options.url"><code>options.uri</code> or <code>options.url</code></h3>
<p>The uri to send a request to. Passed to <a href="http://xhr.spec.whatwg.org/#the-open()-method"><code>XMLHttpRequest.open</code></a>. <code>options.url</code> and <code>options.uri</code> are aliases for each other.</p>
<h3 id="options.headers"><code>options.headers</code></h3>
<p>An object of headers that should be set on the request. The key, value pair is passed to <a href="http://xhr.spec.whatwg.org/#the-setrequestheader()-method"><code>XMLHttpRequest.setRequestHeader</code></a></p>
<h3 id="options.timeout"><code>options.timeout</code></h3>
<p>Number of miliseconds to wait for response. Defaults to 0 (no timeout). Ignored when <code>options.sync</code> is true.</p>
<h3 id="options.json"><code>options.json</code></h3>
<p>Set to <code>true</code> to send request as <code>application/json</code> (see <code>options.body</code>) and parse response from JSON.</p>
<p>For backwards compatibility <code>options.json</code> can also be a valid JSON-serializable value to be sent to the server. Additionally the response body is still parsed as JSON</p>
<p>For sending booleans as JSON body see FAQ</p>
<h3 id="options.withcredentials"><code>options.withCredentials</code></h3>
<p>Specify whether user credentials are to be included in a cross-origin request. Sets <a href="http://xhr.spec.whatwg.org/#the-withcredentials-attribute"><code>XMLHttpRequest.withCredentials</code></a>. Defaults to false.</p>
<p>A wildcard <code>*</code> cannot be used in the <code>Access-Control-Allow-Origin</code> header when <code>withCredentials</code> is true. The header needs to specify your origin explicitly or browser will abort the request.</p>
<h3 id="options.responsetype"><code>options.responseType</code></h3>
<p>Determines the data type of the <code>response</code>. Sets <a href="https://xhr.spec.whatwg.org/#the-responsetype-attribute"><code>XMLHttpRequest.responseType</code></a>. For example, a <code>responseType</code> of <code>document</code> will return a parsed <code>Document</code> object as the <code>response.body</code> for an XML resource.</p>
<h3 id="options.beforesend"><code>options.beforeSend</code></h3>
<p>A function being called right before the <code>send</code> method of the <code>XMLHttpRequest</code> or <code>XDomainRequest</code> instance is called. The <code>XMLHttpRequest</code> or <code>XDomainRequest</code> instance is passed as an argument.</p>
<h3 id="options.xhr"><code>options.xhr</code></h3>
<p>Pass an <code>XMLHttpRequest</code> object (or something that acts like one) to use instead of constructing a new one using the <code>XMLHttpRequest</code> or <code>XDomainRequest</code> constructors. Useful for testing.</p>
<h2 id="faq">FAQ</h2>
<ul>
<li>Why is my server’s JSON response not parsed? I returned the right content-type.
<ul>
<li>See <code>options.json</code> - you can set it to <code>true</code> on a GET request to tell <code>xhr</code> to parse the response body.</li>
<li>Without <code>options.json</code> body is returned as-is (a string or when <code>responseType</code> is set and the browser supports it - a result of parsing JSON or XML)</li>
</ul></li>
<li>How do I send an object or array as POST body?
<ul>
<li><code>options.body</code> should be a string. You need to serialize your object before passing to <code>xhr</code> for sending.</li>
<li>To serialize to JSON you can use <code>options.json:true</code> with <code>options.body</code> for convenience - then <code>xhr</code> will do the serialization and set content-type accordingly.</li>
</ul></li>
<li>Where’s stream API? <code>.pipe()</code> etc.
<ul>
<li>Not implemented. You can’t reasonably have that in the browser.</li>
</ul></li>
<li>Why can’t I send <code>"true"</code> as body by passing it as <code>options.json</code> anymore?
<ul>
<li>Accepting <code>true</code> as a value was a bug. Despite what <code>JSON.stringify</code> does, the string <code>"true"</code> is not valid JSON. If you’re sending booleans as JSON, please consider wrapping them in an object or array to save yourself from more trouble in the future. To bring back the old behavior, hardcode <code>options.json</code> to <code>true</code> and set <code>options.body</code> to your boolean value.</li>
</ul></li>
<li>How do I add an <code>onprogress</code> listener?
<ul>
<li>use <code>beforeSend</code> function for non-standard things that are browser specific. In this case:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="at">xhr</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  ...</a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="dt">beforeSend</span><span class="op">:</span> <span class="kw">function</span>(xhrObject)<span class="op">{</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="va">xhrObject</span>.<span class="at">onprogress</span> <span class="op">=</span> <span class="kw">function</span>()<span class="op">{}</span></a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="op">}</span>)</a></code></pre></div></li>
</ul>
<h2 id="mocking-requests">Mocking Requests</h2>
<p>You can override the constructor used to create new requests for testing. When you’re making a new request:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="at">xhr</span>(<span class="op">{</span> <span class="dt">xhr</span><span class="op">:</span> <span class="kw">new</span> <span class="at">MockXMLHttpRequest</span>() <span class="op">}</span>)</a></code></pre></div>
<p>or you can override the constructors used to create requests at the module level:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">xhr</span>.<span class="at">XMLHttpRequest</span> <span class="op">=</span> MockXMLHttpRequest</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="va">xhr</span>.<span class="at">XDomainRequest</span> <span class="op">=</span> MockXDomainRequest</a></code></pre></div>
<h2 id="mit-licenced">MIT Licenced</h2>
</body>
</html>
