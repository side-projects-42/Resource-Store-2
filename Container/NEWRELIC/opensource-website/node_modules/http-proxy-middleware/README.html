<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="http-proxy-middleware">http-proxy-middleware</h1>
<p><a href="https://travis-ci.org/chimurai/http-proxy-middleware"><img src="https://img.shields.io/travis/chimurai/http-proxy-middleware/master.svg?style=flat-square" alt="Build Status" /></a> <a href="https://coveralls.io/r/chimurai/http-proxy-middleware"><img src="https://img.shields.io/coveralls/chimurai/http-proxy-middleware.svg?style=flat-square" alt="Coveralls" /></a> <a href="https://david-dm.org/chimurai/http-proxy-middleware#info=dependencies"><img src="https://img.shields.io/david/chimurai/http-proxy-middleware.svg?style=flat-square" alt="dependency Status" /></a> <a href="https://snyk.io/test/npm/http-proxy-middleware"><img src="https://snyk.io/test/npm/http-proxy-middleware/badge.svg" alt="dependency Status" /></a> <a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square" alt="code style: prettier" /></a></p>
<p>Node.js proxying made simple. Configure proxy middleware with ease for <a href="https://github.com/senchalabs/connect">connect</a>, <a href="https://github.com/strongloop/express">express</a>, <a href="https://github.com/BrowserSync/browser-sync">browser-sync</a> and <a href="#compatible-servers">many more</a>.</p>
<p>Powered by the popular Nodejitsu <a href="https://github.com/nodejitsu/node-http-proxy"><code>http-proxy</code></a>. <a href="https://github.com/nodejitsu/node-http-proxy"><img src="https://img.shields.io/github/stars/nodejitsu/node-http-proxy.svg?style=social&amp;label=Star" alt="GitHub stars" /></a></p>
<h2 id="tldr">TL;DR</h2>
<p>Proxy <code>/api</code> requests to <code>http://www.example.org</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">var</span> proxy <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http-proxy-middleware&#39;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/api&#39;</span><span class="op">,</span> <span class="at">proxy</span>(<span class="op">{</span> <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://www.example.org&#39;</span><span class="op">,</span> <span class="dt">changeOrigin</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">app</span>.<span class="at">listen</span>(<span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">// http://localhost:3000/api/foo/bar -&gt; http://www.example.org/api/foo/bar</span></a></code></pre></div>
<p><em>All</em> <code>http-proxy</code> <a href="https://github.com/nodejitsu/node-http-proxy#options">options</a> can be used, along with some extra <code>http-proxy-middleware</code> <a href="#options">options</a>.</p>
<p>:bulb: <strong>Tip:</strong> Set the option <code>changeOrigin</code> to <code>true</code> for <a href="http://en.wikipedia.org/wiki/Virtual_hosting#Name-based">name-based virtual hosted sites</a>.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<!-- MarkdownTOC autolink=true bracket=round depth=2 -->
<ul>
<li><a href="#install">Install</a></li>
<li><a href="#core-concept">Core concept</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#context-matching">Context matching</a></li>
<li><a href="#options">Options</a>
<ul>
<li><a href="#http-proxy-middleware-options">http-proxy-middleware options</a></li>
<li><a href="#http-proxy-events">http-proxy events</a></li>
<li><a href="#http-proxy-options">http-proxy options</a></li>
</ul></li>
<li><a href="#shorthand">Shorthand</a>
<ul>
<li><a href="#appusepath-proxy">app.use(path, proxy)</a></li>
</ul></li>
<li><a href="#websocket">WebSocket</a>
<ul>
<li><a href="#external-websocket-upgrade">External WebSocket upgrade</a></li>
</ul></li>
<li><a href="#working-examples">Working examples</a></li>
<li><a href="#recipes">Recipes</a></li>
<li><a href="#compatible-servers">Compatible servers</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#changelog">Changelog</a></li>
<li><a href="#license">License</a></li>
</ul>
<!-- /MarkdownTOC -->
<h2 id="install">Install</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1">$ npm install <span class="op">--</span>save<span class="op">-</span>dev http<span class="op">-</span>proxy<span class="op">-</span>middleware</a></code></pre></div>
<h2 id="core-concept">Core concept</h2>
<p>Proxy middleware configuration.</p>
<h4 id="proxycontext-config">proxy([context,] config)</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> proxy <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http-proxy-middleware&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">var</span> apiProxy <span class="op">=</span> <span class="at">proxy</span>(<span class="st">&#39;/api&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://www.example.org&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">//                   \____/   \_____________________________/</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">//                     |                    |</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">//                   context             options</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">// &#39;apiProxy&#39; is now ready to be used as middleware in a server.</span></a></code></pre></div>
<ul>
<li><strong>context</strong>: Determine which requests should be proxied to the target host. (more on <a href="#context-matching">context matching</a>)</li>
<li><strong>options.target</strong>: target host to proxy to. <em>(protocol + host)</em></li>
</ul>
<p>(full list of <a href="#options"><code>http-proxy-middleware</code> configuration options</a>)</p>
<h4 id="proxyuri-config">proxy(uri [, config])</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// shorthand syntax for the example above:</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">var</span> apiProxy <span class="op">=</span> <span class="at">proxy</span>(<span class="st">&#39;http://www.example.org/api&#39;</span>)</a></code></pre></div>
<p>More about the <a href="#shorthand">shorthand configuration</a>.</p>
<h2 id="example">Example</h2>
<p>An example with <code>express</code> server.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// include dependencies</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">var</span> proxy <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http-proxy-middleware&#39;</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">// proxy middleware options</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">var</span> options <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://www.example.org&#39;</span><span class="op">,</span> <span class="co">// target host</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="dt">changeOrigin</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// needed for virtual hosted sites</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="dt">ws</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// proxy websockets</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="dt">pathRewrite</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="st">&#39;^/api/old-path&#39;</span><span class="op">:</span> <span class="st">&#39;/api/new-path&#39;</span><span class="op">,</span> <span class="co">// rewrite path</span></a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="st">&#39;^/api/remove/path&#39;</span><span class="op">:</span> <span class="st">&#39;/path&#39;</span> <span class="co">// remove base path</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="op">},</span></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="dt">router</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="co">// when request.headers.host == &#39;dev.localhost:3000&#39;,</span></a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="co">// override target &#39;http://www.example.org&#39; to &#39;http://localhost:8000&#39;</span></a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="st">&#39;dev.localhost:3000&#39;</span><span class="op">:</span> <span class="st">&#39;http://localhost:8000&#39;</span></a>
<a class="sourceLine" id="cb5-18" title="18">  <span class="op">}</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">// create the proxy (without context)</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="kw">var</span> exampleProxy <span class="op">=</span> <span class="at">proxy</span>(options)</a>
<a class="sourceLine" id="cb5-23" title="23"></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">// mount `exampleProxy` in web server</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb5-26" title="26"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/api&#39;</span><span class="op">,</span> exampleProxy)</a>
<a class="sourceLine" id="cb5-27" title="27"><span class="va">app</span>.<span class="at">listen</span>(<span class="dv">3000</span>)</a></code></pre></div>
<h2 id="context-matching">Context matching</h2>
<p>Providing an alternative way to decide which requests should be proxied; In case you are not able to use the server’s <a href="http://expressjs.com/en/4x/api.html#app.use"><code>path</code> parameter</a> to mount the proxy or when you need more flexibility.</p>
<p><a href="https://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986 <code>path</code></a> is used for context matching.</p>
<pre><code>         foo://example.com:8042/over/there?name=ferret#nose
         \_/   \______________/\_________/ \_________/ \__/
          |           |            |            |        |
       scheme     authority       path        query   fragment</code></pre>
<ul>
<li><p><strong>path matching</strong></p>
<ul>
<li><code>proxy({...})</code> - matches any path, all requests will be proxied.</li>
<li><code>proxy('/', {...})</code> - matches any path, all requests will be proxied.</li>
<li><code>proxy('/api', {...})</code> - matches paths starting with <code>/api</code></li>
</ul></li>
<li><p><strong>multiple path matching</strong></p>
<ul>
<li><code>proxy(['/api', '/ajax', '/someotherpath'], {...})</code></li>
</ul></li>
<li><p><strong>wildcard path matching</strong></p>
<p>For fine-grained control you can use wildcard matching. Glob pattern matching is done by <em>micromatch</em>. Visit <a href="https://www.npmjs.com/package/micromatch">micromatch</a> or <a href="https://www.npmjs.com/package/glob">glob</a> for more globbing examples.</p>
<ul>
<li><code>proxy('**', {...})</code> matches any path, all requests will be proxied.</li>
<li><code>proxy('**/*.html', {...})</code> matches any path which ends with <code>.html</code></li>
<li><code>proxy('/*.html', {...})</code> matches paths directly under path-absolute</li>
<li><code>proxy('/api/**/*.html', {...})</code> matches requests ending with <code>.html</code> in the path of <code>/api</code></li>
<li><code>proxy(['/api/**', '/ajax/**'], {...})</code> combine multiple patterns</li>
<li><code>proxy(['/api/**', '!**/bad.json'], {...})</code> exclusion</li>
</ul>
<p><strong>Note</strong>: In multiple path matching, you cannot use string paths and wildcard paths together.</p></li>
<li><p><strong>custom matching</strong></p>
<p>For full control you can provide a custom function to determine which requests should be proxied or not.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">/**</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"> * </span><span class="an">@return</span><span class="co"> {Boolean}</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"> */</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">var</span> filter <span class="op">=</span> <span class="kw">function</span>(pathname<span class="op">,</span> req) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="cf">return</span> <span class="va">pathname</span>.<span class="at">match</span>(<span class="st">&#39;^/api&#39;</span>) <span class="op">&amp;&amp;</span> <span class="va">req</span>.<span class="at">method</span> <span class="op">===</span> <span class="st">&#39;GET&#39;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw">var</span> apiProxy <span class="op">=</span> <span class="at">proxy</span>(filter<span class="op">,</span> <span class="op">{</span> <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://www.example.org&#39;</span> <span class="op">}</span>)</a></code></pre></div></li>
</ul>
<h2 id="options">Options</h2>
<h3 id="http-proxy-middleware-options">http-proxy-middleware options</h3>
<ul>
<li><p><strong>option.pathRewrite</strong>: object/function, rewrite target’s url path. Object-keys will be used as <em>RegExp</em> to match paths.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// rewrite path</span></a>
<a class="sourceLine" id="cb8-2" title="2">pathRewrite<span class="op">:</span> <span class="op">{</span><span class="st">&#39;^/old/api&#39;</span> <span class="op">:</span> <span class="st">&#39;/new/api&#39;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">// remove path</span></a>
<a class="sourceLine" id="cb8-5" title="5">pathRewrite<span class="op">:</span> <span class="op">{</span><span class="st">&#39;^/remove/api&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">// add base path</span></a>
<a class="sourceLine" id="cb8-8" title="8">pathRewrite<span class="op">:</span> <span class="op">{</span><span class="st">&#39;^/&#39;</span> <span class="op">:</span> <span class="st">&#39;/basepath/&#39;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">// custom rewriting</span></a>
<a class="sourceLine" id="cb8-11" title="11">pathRewrite<span class="op">:</span> <span class="kw">function</span> (path<span class="op">,</span> req) <span class="op">{</span> <span class="cf">return</span> <span class="va">path</span>.<span class="at">replace</span>(<span class="st">&#39;/api&#39;</span><span class="op">,</span> <span class="st">&#39;/base/api&#39;</span>) <span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.router</strong>: object/function, re-target <code>option.target</code> for specific requests.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">// Use `host` and/or `path` to match requests. First match will be used.</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">// The order of the configuration matters.</span></a>
<a class="sourceLine" id="cb9-3" title="3">router<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="st">&#39;integration.localhost:3000&#39;</span> <span class="op">:</span> <span class="st">&#39;http://localhost:8001&#39;</span><span class="op">,</span>  <span class="co">// host only</span></a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="st">&#39;staging.localhost:3000&#39;</span>     <span class="op">:</span> <span class="st">&#39;http://localhost:8002&#39;</span><span class="op">,</span>  <span class="co">// host only</span></a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="st">&#39;localhost:3000/api&#39;</span>         <span class="op">:</span> <span class="st">&#39;http://localhost:8003&#39;</span><span class="op">,</span>  <span class="co">// host + path</span></a>
<a class="sourceLine" id="cb9-7" title="7">    <span class="st">&#39;/rest&#39;</span>                      <span class="op">:</span> <span class="st">&#39;http://localhost:8004&#39;</span>   <span class="co">// path only</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">// Custom router function</span></a>
<a class="sourceLine" id="cb9-11" title="11">router<span class="op">:</span> <span class="kw">function</span>(req) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-12" title="12">    <span class="cf">return</span> <span class="st">&#39;http://localhost:8004&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.logLevel</strong>: string, [‘debug’, ‘info’, ‘warn’, ‘error’, ‘silent’]. Default: <code>'info'</code></p></li>
<li><p><strong>option.logProvider</strong>: function, modify or replace log provider. Default: <code>console</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// simple replace</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">function</span> <span class="at">logProvider</span>(provider) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="co">// replace the default console log provider.</span></a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="cf">return</span> <span class="at">require</span>(<span class="st">&#39;winston&#39;</span>)</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="op">}</span></a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="co">// verbose replacement</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">function</span> <span class="at">logProvider</span>(provider) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">var</span> logger <span class="op">=</span> <span class="kw">new</span> (<span class="at">require</span>(<span class="st">&#39;winston&#39;</span>)).<span class="at">Logger</span>()</a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="kw">var</span> myCustomProvider <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="dt">log</span><span class="op">:</span> <span class="va">logger</span>.<span class="at">log</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="dt">debug</span><span class="op">:</span> <span class="va">logger</span>.<span class="at">debug</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-8" title="8">    <span class="dt">info</span><span class="op">:</span> <span class="va">logger</span>.<span class="at">info</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-9" title="9">    <span class="dt">warn</span><span class="op">:</span> <span class="va">logger</span>.<span class="at">warn</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-10" title="10">    <span class="dt">error</span><span class="op">:</span> <span class="va">logger</span>.<span class="at">error</span></a>
<a class="sourceLine" id="cb11-11" title="11">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-12" title="12">  <span class="cf">return</span> myCustomProvider</a>
<a class="sourceLine" id="cb11-13" title="13"><span class="op">}</span></a></code></pre></div></li>
<li>(DEPRECATED) <strong>option.proxyHost</strong>: Use <code>option.changeOrigin = true</code> instead.</li>
<li><p>(DEPRECATED) <strong>option.proxyTable</strong>: Use <code>option.router</code> instead.</p></li>
</ul>
<h3 id="http-proxy-events">http-proxy events</h3>
<p>Subscribe to <a href="https://github.com/nodejitsu/node-http-proxy#listening-for-proxy-events">http-proxy events</a>:</p>
<ul>
<li><p><strong>option.onError</strong>: function, subscribe to http-proxy’s <code>error</code> event for custom error handling.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">function</span> <span class="at">onError</span>(err<span class="op">,</span> req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="va">res</span>.<span class="at">writeHead</span>(<span class="dv">500</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/plain&#39;</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="va">res</span>.<span class="at">end</span>(</a>
<a class="sourceLine" id="cb12-6" title="6">    <span class="st">&#39;Something went wrong. And we are reporting a custom error message.&#39;</span></a>
<a class="sourceLine" id="cb12-7" title="7">  )</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.onProxyRes</strong>: function, subscribe to http-proxy’s <code>proxyRes</code> event.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">function</span> <span class="at">onProxyRes</span>(proxyRes<span class="op">,</span> req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="va">proxyRes</span>.<span class="at">headers</span>[<span class="st">&#39;x-added&#39;</span>] <span class="op">=</span> <span class="st">&#39;foobar&#39;</span> <span class="co">// add new header to response</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw">delete</span> <span class="va">proxyRes</span>.<span class="at">headers</span>[<span class="st">&#39;x-removed&#39;</span>] <span class="co">// remove header from response</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.onProxyReq</strong>: function, subscribe to http-proxy’s <code>proxyReq</code> event.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">function</span> <span class="at">onProxyReq</span>(proxyReq<span class="op">,</span> req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="co">// add custom header to request</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="va">proxyReq</span>.<span class="at">setHeader</span>(<span class="st">&#39;x-added&#39;</span><span class="op">,</span> <span class="st">&#39;foobar&#39;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="co">// or log the req</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.onProxyReqWs</strong>: function, subscribe to http-proxy’s <code>proxyReqWs</code> event.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">function</span> <span class="at">onProxyReqWs</span>(proxyReq<span class="op">,</span> req<span class="op">,</span> socket<span class="op">,</span> options<span class="op">,</span> head) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="co">// add custom header</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="va">proxyReq</span>.<span class="at">setHeader</span>(<span class="st">&#39;X-Special-Proxy-Header&#39;</span><span class="op">,</span> <span class="st">&#39;foobar&#39;</span>)</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.onOpen</strong>: function, subscribe to http-proxy’s <code>open</code> event.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">function</span> <span class="at">onOpen</span>(proxySocket) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="co">// listen for messages coming FROM the target here</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="va">proxySocket</span>.<span class="at">on</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> hybiParseAndLogMessage)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="op">}</span></a></code></pre></div></li>
<li><p><strong>option.onClose</strong>: function, subscribe to http-proxy’s <code>close</code> event.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">function</span> <span class="at">onClose</span>(res<span class="op">,</span> socket<span class="op">,</span> head) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="co">// view disconnected websocket connections</span></a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Client disconnected&#39;</span>)</a>
<a class="sourceLine" id="cb17-4" title="4"><span class="op">}</span></a></code></pre></div></li>
</ul>
<h3 id="http-proxy-options">http-proxy options</h3>
<p>The following options are provided by the underlying <a href="https://github.com/nodejitsu/node-http-proxy#options">http-proxy</a> library.</p>
<ul>
<li><strong>option.target</strong>: url string to be parsed with the url module</li>
<li><strong>option.forward</strong>: url string to be parsed with the url module</li>
<li><strong>option.agent</strong>: object to be passed to http(s).request (see Node’s <a href="http://nodejs.org/api/https.html#https_class_https_agent">https agent</a> and <a href="http://nodejs.org/api/http.html#http_class_http_agent">http agent</a> objects)</li>
<li><strong>option.ssl</strong>: object to be passed to https.createServer()</li>
<li><strong>option.ws</strong>: true/false: if you want to proxy websockets</li>
<li><strong>option.xfwd</strong>: true/false, adds x-forward headers</li>
<li><strong>option.secure</strong>: true/false, if you want to verify the SSL Certs</li>
<li><strong>option.toProxy</strong>: true/false, passes the absolute URL as the <code>path</code> (useful for proxying to proxies)</li>
<li><strong>option.prependPath</strong>: true/false, Default: true - specify whether you want to prepend the target’s path to the proxy path</li>
<li><strong>option.ignorePath</strong>: true/false, Default: false - specify whether you want to ignore the proxy path of the incoming request (note: you will have to append / manually if required).</li>
<li><strong>option.localAddress</strong> : Local interface string to bind for outgoing connections</li>
<li><strong>option.changeOrigin</strong>: true/false, Default: false - changes the origin of the host header to the target URL</li>
<li><strong>option.preserveHeaderKeyCase</strong>: true/false, Default: false - specify whether you want to keep letter case of response header key</li>
<li><strong>option.auth</strong> : Basic authentication i.e. ‘user:password’ to compute an Authorization header.</li>
<li><strong>option.hostRewrite</strong>: rewrites the location hostname on (301/302/307/308) redirects.</li>
<li><strong>option.autoRewrite</strong>: rewrites the location host/port on (301/302/307/308) redirects based on requested host/port. Default: false.</li>
<li><strong>option.protocolRewrite</strong>: rewrites the location protocol on (301/302/307/308) redirects to ‘http’ or ‘https’. Default: null.</li>
<li><strong>option.cookieDomainRewrite</strong>: rewrites domain of <code>set-cookie</code> headers. Possible values:
<ul>
<li><code>false</code> (default): disable cookie rewriting</li>
<li>String: new domain, for example <code>cookieDomainRewrite: "new.domain"</code>. To remove the domain, use <code>cookieDomainRewrite: ""</code>.</li>
<li><p>Object: mapping of domains to new domains, use <code>"*"</code> to match all domains.<br />
For example keep one domain unchanged, rewrite one domain and remove other domains:</p>
<pre><code>cookieDomainRewrite: {
  &quot;unchanged.domain&quot;: &quot;unchanged.domain&quot;,
  &quot;old.domain&quot;: &quot;new.domain&quot;,
  &quot;*&quot;: &quot;&quot;
}</code></pre></li>
</ul></li>
<li><strong>option.cookiePathRewrite</strong>: rewrites path of <code>set-cookie</code> headers. Possible values:
<ul>
<li><code>false</code> (default): disable cookie rewriting</li>
<li>String: new path, for example <code>cookiePathRewrite: "/newPath/"</code>. To remove the path, use <code>cookiePathRewrite: ""</code>. To set path to root use <code>cookiePathRewrite: "/"</code>.</li>
<li><p>Object: mapping of paths to new paths, use <code>"*"</code> to match all paths. For example, to keep one path unchanged, rewrite one path and remove other paths:</p>
<pre><code>cookiePathRewrite: {
  &quot;/unchanged.path/&quot;: &quot;/unchanged.path/&quot;,
  &quot;/old.path/&quot;: &quot;/new.path/&quot;,
  &quot;*&quot;: &quot;&quot;
}</code></pre></li>
</ul></li>
<li><strong>option.headers</strong>: object, adds <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Request_fields">request headers</a>. (Example: <code>{host:'www.example.org'}</code>)</li>
<li><strong>option.proxyTimeout</strong>: timeout (in millis) when proxy receives no response from target</li>
<li><strong>option.timeout</strong>: timeout (in millis) for incoming requests</li>
<li><strong>option.followRedirects</strong>: true/false, Default: false - specify whether you want to follow redirects</li>
<li><strong>option.selfHandleResponse</strong> true/false, if set to true, none of the webOutgoing passes are called and it’s your responsibility to appropriately return the response by listening and acting on the <code>proxyRes</code> event</li>
<li><p><strong>option.buffer</strong>: stream of data to send as the request body. Maybe you have some middleware that consumes the request stream before proxying it on e.g. If you read the body of a request into a field called ‘req.rawbody’ you could restream this field in the buffer option:</p>
<pre><code>&#39;use strict&#39;;

const streamify = require(&#39;stream-array&#39;);
const HttpProxy = require(&#39;http-proxy&#39;);
const proxy = new HttpProxy();

module.exports = (req, res, next) =&gt; {

  proxy.web(req, res, {
    target: &#39;http://localhost:4003/&#39;,
    buffer: streamify(req.rawBody)
  }, next);

};</code></pre></li>
</ul>
<h2 id="shorthand">Shorthand</h2>
<p>Use the shorthand syntax when verbose configuration is not needed. The <code>context</code> and <code>option.target</code> will be automatically configured when shorthand is used. Options can still be used if needed.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="at">proxy</span>(<span class="st">&#39;http://www.example.org:8000/api&#39;</span>)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="co">// proxy(&#39;/api&#39;, {target: &#39;http://www.example.org:8000&#39;});</span></a>
<a class="sourceLine" id="cb21-3" title="3"></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="at">proxy</span>(<span class="st">&#39;http://www.example.org:8000/api/books/*/**.json&#39;</span>)</a>
<a class="sourceLine" id="cb21-5" title="5"><span class="co">// proxy(&#39;/api/books/*/**.json&#39;, {target: &#39;http://www.example.org:8000&#39;});</span></a>
<a class="sourceLine" id="cb21-6" title="6"></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="at">proxy</span>(<span class="st">&#39;http://www.example.org:8000/api&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">changeOrigin</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb21-8" title="8"><span class="co">// proxy(&#39;/api&#39;, {target: &#39;http://www.example.org:8000&#39;, changeOrigin: true});</span></a></code></pre></div>
<h3 id="app.usepath-proxy">app.use(path, proxy)</h3>
<p>If you want to use the server’s <code>app.use</code> <code>path</code> parameter to match requests; Create and mount the proxy without the http-proxy-middleware <code>context</code> parameter:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/api&#39;</span><span class="op">,</span> <span class="at">proxy</span>(<span class="op">{</span> <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://www.example.org&#39;</span><span class="op">,</span> <span class="dt">changeOrigin</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a></code></pre></div>
<p><code>app.use</code> documentation:</p>
<ul>
<li>express: http://expressjs.com/en/4x/api.html#app.use</li>
<li>connect: https://github.com/senchalabs/connect#mount-middleware</li>
</ul>
<h2 id="websocket">WebSocket</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1"><span class="co">// verbose api</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="at">proxy</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;http://echo.websocket.org&#39;</span><span class="op">,</span> <span class="dt">ws</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb23-3" title="3"></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="co">// shorthand</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="at">proxy</span>(<span class="st">&#39;http://echo.websocket.org&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">ws</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb23-6" title="6"></a>
<a class="sourceLine" id="cb23-7" title="7"><span class="co">// shorter shorthand</span></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="at">proxy</span>(<span class="st">&#39;ws://echo.websocket.org&#39;</span>)</a></code></pre></div>
<h3 id="external-websocket-upgrade">External WebSocket upgrade</h3>
<p>In the previous WebSocket examples, http-proxy-middleware relies on a initial http request in order to listen to the http <code>upgrade</code> event. If you need to proxy WebSockets without the initial http request, you can subscribe to the server’s http <code>upgrade</code> event manually.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">var</span> wsProxy <span class="op">=</span> <span class="at">proxy</span>(<span class="st">&#39;ws://echo.websocket.org&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">changeOrigin</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb24-2" title="2"></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb24-4" title="4"><span class="va">app</span>.<span class="at">use</span>(wsProxy)</a>
<a class="sourceLine" id="cb24-5" title="5"></a>
<a class="sourceLine" id="cb24-6" title="6"><span class="kw">var</span> server <span class="op">=</span> <span class="va">app</span>.<span class="at">listen</span>(<span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb24-7" title="7"><span class="va">server</span>.<span class="at">on</span>(<span class="st">&#39;upgrade&#39;</span><span class="op">,</span> <span class="va">wsProxy</span>.<span class="at">upgrade</span>) <span class="co">// &lt;-- subscribe to http &#39;upgrade&#39;</span></a></code></pre></div>
<h2 id="working-examples">Working examples</h2>
<p>View and play around with <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples">working examples</a>.</p>
<ul>
<li>Browser-Sync (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/browser-sync/index.js">example source</a>)</li>
<li>express (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/express/index.js">example source</a>)</li>
<li>connect (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/connect/index.js">example source</a>)</li>
<li>WebSocket (<a href="https://github.com/chimurai/http-proxy-middleware/tree/master/examples/websocket/index.js">example source</a>)</li>
</ul>
<h2 id="recipes">Recipes</h2>
<p>View the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes">recipes</a> for common use cases.</p>
<h2 id="compatible-servers">Compatible servers</h2>
<p><code>http-proxy-middleware</code> is compatible with the following servers:</p>
<ul>
<li><a href="https://www.npmjs.com/package/connect">connect</a></li>
<li><a href="https://www.npmjs.com/package/express">express</a></li>
<li><a href="https://www.npmjs.com/package/browser-sync">browser-sync</a></li>
<li><a href="https://www.npmjs.com/package/lite-server">lite-server</a></li>
<li><a href="https://www.npmjs.com/package/grunt-contrib-connect">grunt-contrib-connect</a></li>
<li><a href="https://www.npmjs.com/package/grunt-browser-sync">grunt-browser-sync</a></li>
<li><a href="https://www.npmjs.com/package/gulp-connect">gulp-connect</a></li>
<li><a href="https://www.npmjs.com/package/gulp-webserver">gulp-webserver</a></li>
</ul>
<p>Sample implementations can be found in the <a href="https://github.com/chimurai/http-proxy-middleware/tree/master/recipes/servers.md">server recipes</a>.</p>
<h2 id="tests">Tests</h2>
<p>Run the test suite:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># install dependencies</span></a>
<a class="sourceLine" id="cb25-2" title="2">$ <span class="ex">npm</span> install</a>
<a class="sourceLine" id="cb25-3" title="3"></a>
<a class="sourceLine" id="cb25-4" title="4"><span class="co"># linting</span></a>
<a class="sourceLine" id="cb25-5" title="5">$ <span class="ex">npm</span> run lint</a>
<a class="sourceLine" id="cb25-6" title="6"></a>
<a class="sourceLine" id="cb25-7" title="7"><span class="co"># unit tests</span></a>
<a class="sourceLine" id="cb25-8" title="8">$ <span class="ex">npm</span> test</a>
<a class="sourceLine" id="cb25-9" title="9"></a>
<a class="sourceLine" id="cb25-10" title="10"><span class="co"># code coverage</span></a>
<a class="sourceLine" id="cb25-11" title="11">$ <span class="ex">npm</span> run cover</a></code></pre></div>
<h2 id="changelog">Changelog</h2>
<ul>
<li><a href="https://github.com/chimurai/http-proxy-middleware/blob/master/CHANGELOG.md">View changelog</a></li>
</ul>
<h2 id="license">License</h2>
<p>The MIT License (MIT)</p>
<p>Copyright (c) 2015-2018 Steven Chim</p>
</body>
</html>
