<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="resizeobserver-polyfill">ResizeObserver Polyfill</h1>
<p><a href="https://travis-ci.org/que-etc/resize-observer-polyfill"><img src="https://travis-ci.org/que-etc/resize-observer-polyfill.svg?branch=master" alt="Build Status" /></a></p>
<p>A polyfill for the Resize Observer API.</p>
<p>Implementation is based on the MutationObserver and uses Mutation Events as a fall back if the first one is not supported, so there will be no polling unless DOM changes. Doesn’t modify observed elements. Handles CSS transitions/animations and can possibly observe changes caused by dynamic CSS pseudo-classes, e.g. by <code>:hover</code>.</p>
<p>Follows the <a href="http://rawgit.com/WICG/ResizeObserver/master/index.html">spec</a> and the native implementation. The size is <em>2.44 KiB</em> when minified and gzipped.</p>
<p><a href="http://que-etc.github.io/resize-observer-polyfill">Live demo</a> (has style problems in IE10 and lower).</p>
<h2 id="installation">Installation</h2>
<p>From NPM:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> install resize-observer-polyfill --save-dev</a></code></pre></div>
<p><del>From Bower:</del> (will be removed with the next major release)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">bower</span> install resize-observer-polyfill --save-dev</a></code></pre></div>
<h2 id="browser-support">Browser Support</h2>
<p>Polyfill has been tested in the following browsers:</p>
<p><a href="https://saucelabs.com/beta/builds/303f5344a7214ba5b62bc7079a15d376"><img src="https://saucelabs.com/browser-matrix/que-etc.svg" alt="Build Status" /></a></p>
<p><strong>NOTE:</strong> Internet Explorer 8 and its earlier versions are not supported.</p>
<h2 id="usage-example">Usage Example</h2>
<p>It’s recommended to use this library in the form of a <a href="https://github.com/sindresorhus/ponyfill">ponyfill</a>, which doesn’t inflict modifications of the global object.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> ResizeObserver <span class="im">from</span> <span class="st">&#39;resize-observer-polyfill&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">const</span> ro <span class="op">=</span> <span class="kw">new</span> <span class="at">ResizeObserver</span>((entries<span class="op">,</span> observer) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="cf">for</span> (<span class="kw">const</span> entry <span class="kw">of</span> entries) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">        <span class="kw">const</span> <span class="op">{</span>left<span class="op">,</span> top<span class="op">,</span> width<span class="op">,</span> height<span class="op">}</span> <span class="op">=</span> <span class="va">entry</span>.<span class="at">contentRect</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Element:&#39;</span><span class="op">,</span> <span class="va">entry</span>.<span class="at">target</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8">        <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Element&#39;s size: </span><span class="sc">${</span> width <span class="sc">}</span><span class="vs">px x </span><span class="sc">${</span> height <span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" title="9">        <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`Element&#39;s paddings: </span><span class="sc">${</span> top <span class="sc">}</span><span class="vs">px ; </span><span class="sc">${</span> left <span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="va">ro</span>.<span class="at">observe</span>(<span class="va">document</span>.<span class="at">body</span>)<span class="op">;</span></a></code></pre></div>
<p>Package’s main file is a ES5 <a href="https://github.com/umdjs/umd">UMD</a> bundle that will be swapped with the ES6 modules version for those bundlers that are aware of the <a href="https://github.com/rollup/rollup/wiki/pkg.module">module</a> field, e.g. for <a href="https://github.com/rollup/rollup">Rollup</a> or webpack 2+.</p>
<p><strong>Note</strong>: global version of the polyfill (<code>dist/ResizeObserver.global</code>) is deprecated and will be removed in the next major release.</p>
<h2 id="observation-strategy">Observation Strategy</h2>
<p>As mentioned above, this implementation primarily (but not solely) relies on Mutation Observer with a fallback to Mutation Events for IE 9 and IE 10.</p>
<p>Speaking of Mutation Events as a fallback approach: they might not be as ugly as they are being rendered, particularly when their calls are batched, throttled and there is no need to analyze changes. Given that, they won’t interrupt browser’s reflow/repaint cycles (same for MutationObserver) and may even outperform Internet Explorer’s implementation of MO causing little to no performance degradation. In contemporary browsers (Chrome, Firefox, etc.) Mutation Observer slows down <a href="https://jsfiddle.net/que_etc/gaqLe8rn/">the suite</a> that includes 200 iterations of adding/removing elements, changing attributes and modifying text data by less than 1%. Internet Explorer gives different results with MO slowing down the same suite by 2-3% while Mutation Events show the difference of ~0.6%.</p>
<p>As for the reasons why other approaches, namely the iframe/object and <code>scroll</code> strategies, were ruled out: * They require the observed element to be non-statically positioned. * You can’t apply them directly to quite a number of elements: <code>&lt;img&gt;</code>, <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>, <code>&lt;canvas&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;tbody&gt;</code>, <code>&lt;thead&gt;</code>, <code>&lt;table&gt;</code>, etc. For most of them you would need to keep an extra <code>&lt;div&gt;</code> wrapper and almost all instances of the SVGGraphicsElement will be out of scope. * The ResizeObserver spec requires to deliver notifications when a non-empty visible element becomes hidden, i.e. when either this element directly or one of its parent nodes receive the <code>display: none</code> state. Same goes for when it’s being removed from or added to the DOM. It’s not possible to handle these cases merely by using former approaches, so you’d still need to either subscribe for DOM mutations or to continuously check the element’s state.</p>
<p>And though every approach has its own limitations, I reckon that it’d be too much of a trade-off to have those constraints when building a polyfill.</p>
<h2 id="limitations">Limitations</h2>
<ul>
<li>Notifications are delivered ~20ms after actual changes happen.</li>
<li>Changes caused by dynamic pseudo-classes, e.g. <code>:hover</code> and <code>:focus</code>, are not tracked. As a workaround you could add a short transition which would trigger the <code>transitionend</code> event when an element receives one of the former classes (<a href="https://jsfiddle.net/que_etc/7fudzqng/">example</a>).</li>
<li>Delayed transitions will receive only one notification with the latest dimensions of an element.</li>
</ul>
<h2 id="building-and-testing">Building and Testing</h2>
<p>To build polyfill. Creates UMD bundle in the <code>dist</code> folder:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">npm</span> run build</a></code></pre></div>
<p>To run a code style test:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">npm</span> run test:lint</a></code></pre></div>
<p>Running unit tests:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">npm</span> run test:spec</a></code></pre></div>
<p>To test in a browser that is not present in karma’s config file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">npm</span> run test:spec:custom</a></code></pre></div>
<p>Testing against a native implementation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">npm</span> run test:spec:native</a></code></pre></div>
<p><strong>NOTE:</strong> after you invoke <code>spec:native</code> and <code>spec:custom</code> commands head to the <code>http://localhost:9876/debug.html</code> page.</p>
</body>
</html>
