<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>api-doc</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h2 id="introduction">Introduction</h2>
<p>LibSass wouldn’t be much good without a way to interface with it. These interface documentations describe the various functions and data structures available to implementers. They are split up over three major components, which have all their own source files (plus some common functionality).</p>
<ul>
<li><a href="api-context.md">Sass Context</a> - Trigger and handle the main Sass compilation</li>
<li><a href="api-value.md">Sass Value</a> - Exchange values and its format with LibSass</li>
<li><a href="api-function.md">Sass Function</a> - Get invoked by LibSass for function statments</li>
<li><a href="api-importer.md">Sass Importer</a> - Get invoked by LibSass for <span class="citation" data-cites="import">@import</span> statments</li>
</ul>
<h3 id="basic-usage">Basic usage</h3>
<p>First you will need to include the header file! This will automatically load all other headers too!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1"><span class="pp">#include </span><span class="im">&quot;sass/context.h&quot;</span></a></code></pre></div>
<h2 id="basic-c-example">Basic C Example</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" title="1"><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="pp">#include </span><span class="im">&quot;sass/context.h&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="dt">int</span> main() {</a>
<a class="sourceLine" id="cb2-5" title="5">  puts(libsass_version());</a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="cf">return</span> <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb2-7" title="7">}</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">gcc</span> -Wall version.c -lsass -o version <span class="kw">&amp;&amp;</span> <span class="ex">./version</span></a></code></pre></div>
<h2 id="more-c-examples">More C Examples</h2>
<ul>
<li><a href="api-context-example.md">Sample code for Sass Context</a></li>
<li><a href="api-value-example.md">Sample code for Sass Value</a></li>
<li><a href="api-function-example.md">Sample code for Sass Function</a></li>
<li><a href="api-importer-example.md">Sample code for Sass Importer</a></li>
</ul>
<h2 id="compiling-your-code">Compiling your code</h2>
<p>The most important is your sass file (or string of sass code). With this, you will want to start a LibSass compiler. Here is some pseudocode describing the process. The compiler has two different modes: direct input as a string with <code>Sass_Data_Context</code> or LibSass will do file reading for you by using <code>Sass_File_Context</code>. See the code for a list of options available <a href="https://github.com/sass/libsass/blob/36feef0/include/sass/interface.h#L18">Sass_Options</a></p>
<p><strong>Building a file compiler</strong></p>
<pre><code>context = sass_make_file_context(&quot;file.scss&quot;)
options = sass_file_context_get_options(context)
sass_option_set_precision(options, 1)
sass_option_set_source_comments(options, true)

sass_file_context_set_options(context, options)

compiler = sass_make_file_compiler(sass_context)
sass_compiler_parse(compiler)
sass_compiler_execute(compiler)

output = sass_context_get_output_string(context)
// Retrieve errors during compilation
error_status = sass_context_get_error_status(context)
json_error = sass_context_get_error_json(context)
// Release memory dedicated to the C compiler
sass_delete_compiler(compiler)</code></pre>
<p><strong>Building a data compiler</strong></p>
<pre><code>context = sass_make_data_context(&quot;div { a { color: blue; } }&quot;)
options = sass_data_context_get_options(context)
sass_option_set_precision(options, 1)
sass_option_set_source_comments(options, true)

sass_data_context_set_options(context, options)

compiler = sass_make_data_compiler(context)
sass_compiler_parse(compiler)
sass_compiler_execute(compiler)

output = sass_context_get_output_string(context)
// div a { color: blue; }
// Retrieve errors during compilation
error_status = sass_context_get_error_status(context)
json_error = sass_context_get_error_json(context)
// Release memory dedicated to the C compiler
sass_delete_compiler(compiler)</code></pre>
<h2 id="sass-context-internals">Sass Context Internals</h2>
<p>Everything is stored in structs:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">struct</span> Sass_Options;</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">struct</span> Sass_Context : Sass_Options;</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">struct</span> Sass_File_context : Sass_Context;</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">struct</span> Sass_Data_context : Sass_Context;</a></code></pre></div>
<p>This mirrors very well how <code>libsass</code> uses these structures.</p>
<ul>
<li><code>Sass_Options</code> holds everything you feed in before the compilation. It also hosts <code>input_path</code> and <code>output_path</code> options, because they are used to generate/calculate relative links in source-maps. The <code>input_path</code> is shared with <code>Sass_File_Context</code>.</li>
<li><code>Sass_Context</code> holds all the data returned by the compilation step.</li>
<li><code>Sass_File_Context</code> is a specific implementation that requires no additional fields</li>
<li><code>Sass_Data_Context</code> is a specific implementation that adds the <code>input_source</code> field</li>
</ul>
<p>Structs can be down-casted to access <code>context</code> or <code>options</code>!</p>
<h2 id="memory-handling-and-life-cycles">Memory handling and life-cycles</h2>
<p>We keep memory around for as long as the main <a href="api-context.md">context</a> object is not destroyed (<code>sass_delete_context</code>). LibSass will create copies of most inputs/options beside the main sass code. You need to allocate and fill that buffer before passing it to LibSass. You may also overtake memory management from libsass for certain return values (i.e. <code>sass_context_take_output_string</code>).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// to allocate buffer to be filled</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="dt">void</span>* sass_alloc_memory(<span class="dt">size_t</span> size);</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// to allocate a buffer from existing string</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="dt">char</span>* sass_copy_c_string(<span class="dt">const</span> <span class="dt">char</span>* str);</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">// to free overtaken memory when done</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="dt">void</span> sass_free_memory(<span class="dt">void</span>* ptr);</a></code></pre></div>
<h2 id="miscellaneous-api-functions">Miscellaneous API functions</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// Some convenient string helper function</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="dt">char</span>* sass_string_unquote (<span class="dt">const</span> <span class="dt">char</span>* str);</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="dt">char</span>* sass_string_quote (<span class="dt">const</span> <span class="dt">char</span>* str, <span class="dt">const</span> <span class="dt">char</span> quote_mark);</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">// Get compiled libsass version</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="dt">const</span> <span class="dt">char</span>* libsass_version(<span class="dt">void</span>);</a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">// Implemented sass language version</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">// Hardcoded version 3.4 for time being</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="dt">const</span> <span class="dt">char</span>* libsass_language_version(<span class="dt">void</span>);</a></code></pre></div>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<p><strong>input_path</strong></p>
<p>The <code>input_path</code> is part of <code>Sass_Options</code>, but it also is the main option for <code>Sass_File_Context</code>. It is also used to generate relative file links in source- maps. Therefore it is pretty usefull to pass this information if you have a <code>Sass_Data_Context</code> and know the original path.</p>
<p><strong>output_path</strong></p>
<p>Be aware that <code>libsass</code> does not write the output file itself. This option merely exists to give <code>libsass</code> the proper information to generate links in source-maps. The file has to be written to the disk by the binding/implementation. If the <code>output_path</code> is omitted, <code>libsass</code> tries to extrapolate one from the <code>input_path</code> by replacing (or adding) the file ending with <code>.css</code>.</p>
<h2 id="error-codes">Error Codes</h2>
<p>The <code>error_code</code> is integer value which indicates the type of error that occurred inside the LibSass process. Following is the list of error codes along with the short description:</p>
<ul>
<li>1: normal errors like parsing or <code>eval</code> errors</li>
<li>2: bad allocation error (memory error)</li>
<li>3: “untranslated” C++ exception (<code>throw std::exception</code>)</li>
<li>4: legacy string exceptions ( <code>throw const char*</code> or <code>std::string</code> )</li>
<li>5: Some other unknown exception</li>
</ul>
<p>Although for the API consumer, error codes do not offer much value except indicating whether <em>any</em> error occurred during the compilation, it helps debugging the LibSass internal code paths.</p>
<h2 id="real-world-implementations">Real-World Implementations</h2>
<p>The proof is in the pudding, so we have highlighted a few implementations that should be on par with the latest LibSass interface version. Some of them may not have all features implemented!</p>
<ol type="1">
<li><a href="https://github.com/sass/perl-libsass/blob/master/lib/CSS/Sass.xs">Perl Example</a></li>
<li><a href="https://godoc.org/github.com/wellington/go-libsass#example-Compiler--Stdin">Go Example</a></li>
<li><a href="https://github.com/sass/node-sass/blob/master/src/binding.cpp">Node Example</a></li>
</ol>
<h2 id="abi-forward-compatibility">ABI forward compatibility</h2>
<p>We use a functional API to make dynamic linking more robust and future compatible. The API is not yet 100% stable, so we do not yet guarantee <a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/abi.html">ABI</a> forward compatibility.</p>
<h2 id="plugins-experimental">Plugins (experimental)</h2>
<p>LibSass can load plugins from directories. Just define <code>plugin_path</code> on context options to load all plugins from the directories. To implement plugins, please consult the following example implementations.</p>
<ul>
<li>https://github.com/mgreter/libsass-glob</li>
<li>https://github.com/mgreter/libsass-math</li>
<li>https://github.com/mgreter/libsass-digest</li>
</ul>
<h2 id="internal-structs">Internal Structs</h2>
<ul>
<li><a href="api-context-internal.md">Sass Context Internals</a></li>
<li><a href="api-value-internal.md">Sass Value Internals</a></li>
<li><a href="api-function-internal.md">Sass Function Internals</a></li>
<li><a href="api-importer-internal.md">Sass Importer Internals</a></li>
</ul>
</body>
</html>
