<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>plugins</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p>Plugins are shared object files (.so on *nix and .dll on win) that can be loaded by LibSass on runtime. Currently we only provide a way to load internal/custom functions from plugins. In the future we probably will also add a way to provide custom importers via plugins (needs more refactoring to <a href="https://github.com/sass/libsass/issues/962">support multiple importers with some kind of priority system</a>).</p>
<h2 id="plugin.cpp">plugin.cpp</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="pp">#include </span><span class="im">&quot;sass_values.h&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">union</span> Sass_Value* ADDCALL call_fn_foo(<span class="at">const</span> <span class="kw">union</span> Sass_Value* <span class="va">s_args</span>, <span class="dt">void</span>* cookie)</a>
<a class="sourceLine" id="cb1-7" title="7">{</a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="co">// we actually abuse the void* to store an &quot;int&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="cf">return</span> sass_make_number((<span class="dt">intptr_t</span>)cookie, <span class="st">&quot;px&quot;</span>);</a>
<a class="sourceLine" id="cb1-10" title="10">}</a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="at">extern</span> <span class="st">&quot;C&quot;</span> <span class="at">const</span> <span class="dt">char</span>* ADDCALL libsass_get_version() {</a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="cf">return</span> libsass_version();</a>
<a class="sourceLine" id="cb1-14" title="14">}</a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="at">extern</span> <span class="st">&quot;C&quot;</span> Sass_C_Function_List ADDCALL libsass_load_functions()</a>
<a class="sourceLine" id="cb1-17" title="17">{</a>
<a class="sourceLine" id="cb1-18" title="18">  <span class="co">// allocate a custom function caller</span></a>
<a class="sourceLine" id="cb1-19" title="19">  Sass_C_Function_Callback fn_foo =</a>
<a class="sourceLine" id="cb1-20" title="20">    sass_make_function(<span class="st">&quot;foo()&quot;</span>, call_fn_foo, (<span class="dt">void</span>*)<span class="dv">42</span>);</a>
<a class="sourceLine" id="cb1-21" title="21">  <span class="co">// create list of all custom functions</span></a>
<a class="sourceLine" id="cb1-22" title="22">  Sass_C_Function_List fn_list = sass_make_function_list(<span class="dv">1</span>);</a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="co">// put the only function in this plugin to the list</span></a>
<a class="sourceLine" id="cb1-24" title="24">  sass_function_set_list_entry(fn_list, <span class="dv">0</span>, fn_foo);</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="co">// return the list</span></a>
<a class="sourceLine" id="cb1-26" title="26">  <span class="cf">return</span> fn_list;</a>
<a class="sourceLine" id="cb1-27" title="27">}</a></code></pre></div>
<p>To compile the plugin you need to have LibSass already built as a shared library (to link against it). The commands below expect the shared library in the <code>lib</code> sub-directory (<code>-Llib</code>). The plugin and the main LibSass process should “consume” the same shared LibSass library on runtime. It will propably also work if they use different LibSass versions. In this case we check if the major versions are compatible (i.e. 3.1.3 and 3.1.1 would be considered compatible).</p>
<h2 id="compile-with-gcc-on-linux">Compile with gcc on linux</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">g++</span> -O2 -shared plugin.cpp -o plugin.so -fPIC -Llib -lsass</a></code></pre></div>
<h2 id="compile-with-mingw-on-windows">Compile with mingw on windows</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">g++</span> -O2 -shared plugin.cpp -o plugin.dll -Llib -lsass</a></code></pre></div>
</body>
</html>
