<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<h1 id="watch-utilities-for-watching-file-trees-in-node.js">watch – Utilities for watching file trees in node.js</h1>
<h2 id="install">Install</h2>
<pre>
  npm install watch
</pre>
<h2 id="purpose">Purpose</h2>
<p>The intention of this module is provide tools that make managing the watching of file &amp; directory trees easier.</p>
<h4 id="watch.watchtreeroot-options-callback">watch.watchTree(root, [options,] callback)</h4>
<p>The first argument is the directory root you want to watch.</p>
<p>The options object is passed to fs.watchFile but can also be used to provide two additional watchTree specific options:</p>
<ul>
<li><code>'ignoreDotFiles'</code> - When true this option means that when the file tree is walked it will ignore files that being with “.”</li>
<li><code>'filter'</code> - You can use this option to provide a function that returns true or false for each file and directory to decide whether or not that file/directory is included in the watcher.</li>
<li><code>'interval'</code> - Specifies the interval duration in seconds, the time period between polling for file changes.</li>
<li><code>'ignoreUnreadableDir'</code> - When true, this options means that when a file can’t be read, this file is silently skipped.</li>
<li><code>'ignoreNotPermitted'</code> - When true, this options means that when a file can’t be read due to permission issues, this file is silently skipped.</li>
<li><code>'ignoreDirectoryPattern'</code> - When a regex pattern is set, e.g. /node_modules/, these directories are silently skipped.</li>
</ul>
<p>The callback takes 3 arguments. The first is the file that was modified. The second is the current stat object for that file and the third is the previous stat object.</p>
<p>When a file is new the previous stat object is null.</p>
<p>When watchTree is finished walking the tree and adding all the listeners it passes the file hash (keys are the file/directory names and the values are the current stat objects) as the first argument and null as both the previous and current stat object arguments.</p>
<pre>
  watch.watchTree('/home/mikeal', function (f, curr, prev) {
    if (typeof f == "object" && prev === null && curr === null) {
      // Finished walking the tree
    } else if (prev === null) {
      // f is a new file
    } else if (curr.nlink === 0) {
      // f was removed
    } else {
      // f was changed
    }
  })
</pre>
<h3 id="watch.unwatchtreeroot">watch.unwatchTree(root)</h3>
<p>Unwatch a previously watched directory root using <code>watch.watchTree</code>.</p>
<h3 id="watch.createmonitorroot-options-callback">watch.createMonitor(root, [options,] callback)</h3>
<p>This function creates an EventEmitter that gives notifications for different changes that happen to the file and directory tree under the given root argument.</p>
<p>The options object is passed to watch.watchTree.</p>
<p>The callback receives the monitor object.</p>
<p>The monitor object contains a property, <code>files</code>, which is a hash of files and directories as keys with the current stat object as the value.</p>
<p>The monitor has the following events.</p>
<ul>
<li><code>'created'</code> - New file has been created. Two arguments, the filename and the stat object.</li>
<li><code>'removed'</code> - A file has been moved or deleted. Two arguments, the filename and the stat object for the fd.</li>
<li><code>'changed'</code> - A file has been changed. Three arguments, the filename, the current stat object, and the previous stat object.</li>
</ul>
<p>The monitor can be stopped using <code>.stop</code> (calls <code>unwatchTree</code>).</p>
<pre>
  var watch = require('watch')
  watch.createMonitor('/home/mikeal', function (monitor) {
    monitor.files['/home/mikeal/.zshrc'] // Stat object for my zshrc.
    monitor.on("created", function (f, stat) {
      // Handle new files
    })
    monitor.on("changed", function (f, curr, prev) {
      // Handle file changes
    })
    monitor.on("removed", function (f, stat) {
      // Handle removed files
    })
    monitor.stop(); // Stop watching
  })
</pre>
<h3 id="cli">CLI</h3>
<p>This module includes a simple command line interface, which you can install with <code>npm install watch -g</code>.</p>
<pre><code>Usage: watch &lt;command&gt; [...directory] [OPTIONS]

OPTIONS:
    --wait=&lt;seconds&gt;
        Duration, in seconds, that watching will be disabled
        after running &lt;command&gt;. Setting this option will
        throttle calls to &lt;command&gt; for the specified duration.

    --filter=&lt;file&gt;
        Path to a require-able .js file that exports a filter
        function to be passed to watchTreeOptions.filter.
        Path is resolved relative to process.cwd().

    --interval=&lt;seconds&gt;
        Specifies the interval duration in seconds, the time period between polling for file changes.

    --ignoreDotFiles, -d
        Ignores dot or hidden files in the watch [directory].

     --ignoreUnreadable, -u
        Silently ignores files that cannot be read within the
        watch [directory].

     --ignoreDirectoryPattern=&lt;regexp&gt;, -p
        Silently skips directories that match the regular
        expression.</code></pre>
<p>It will watch the given directories (defaults to the current working directory) with <code>watchTree</code> and run the given command every time a file changes.</p>
<h3 id="examples">Examples</h3>
<p>As stated above the pattern is:</p>
<pre><code>watch &lt;command&gt; [...directory] [OPTIONS]</code></pre>
<p>To run the watch command in the terminal you have to write the following:</p>
<pre><code>watch &#39;npm run test -s&#39; directory</code></pre>
<p>As the command has to be written in quotation marks Windows users may need to use double quotes rather than single quotes</p>
<pre><code>watch &quot;npm run test -s&quot; directory</code></pre>
<p>Note: Because Windows users may need to use double quotes rather than single quotes they need to escape the them in npm scripts</p>
<pre><code>&quot;scripts&quot;: {
    &quot;watch:osx&quot;: &quot;watch &#39;npm run test -s&#39; source&quot;
    &quot;watch:windows&quot;: &quot;watch \&quot;npm run test -s\&quot; source&quot;,
}</code></pre>
<h2 id="contributing">Contributing</h2>
<h3 id="releasing">Releasing</h3>
<p>On the latest clean <code>master</code>:</p>
<pre><code>npm run release:major
npm run release:minor
npm run release:patch</code></pre>
</body>
</html>
