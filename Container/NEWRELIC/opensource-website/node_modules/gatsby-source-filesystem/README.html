<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="gatsby-source-filesystem">gatsby-source-filesystem</h1>
<p>A Gatsby source plugin for sourcing data into your Gatsby application from your local filesystem.</p>
<p>The plugin creates <code>File</code> nodes from files. The various “transformer” plugins can transform <code>File</code> nodes into various other types of data e.g. <code>gatsby-transformer-json</code> transforms JSON files into JSON data nodes and <code>gatsby-transformer-remark</code> transforms markdown files into <code>MarkdownRemark</code> nodes from which you can query an HTML representation of the markdown.</p>
<h2 id="install">Install</h2>
<p><code>npm install gatsby-source-filesystem</code></p>
<h2 id="how-to-use">How to use</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// In your gatsby-config.js</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">plugins</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="co">// You can have multiple instances of this plugin</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="co">// to read source nodes from different locations on your</span></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="co">// filesystem.</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="co">//</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="co">// The following sets up the Jekyll pattern of having a</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="co">// &quot;pages&quot; directory for Markdown files and a &quot;data&quot; directory</span></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="co">// for `.json`, `.yaml`, `.csv`.</span></a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="op">{</span></a>
<a class="sourceLine" id="cb1-12" title="12">      <span class="dt">resolve</span><span class="op">:</span> <span class="vs">`gatsby-source-filesystem`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-13" title="13">      <span class="dt">options</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-14" title="14">        <span class="dt">name</span><span class="op">:</span> <span class="vs">`pages`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-15" title="15">        <span class="dt">path</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>__dirname<span class="sc">}</span><span class="vs">/src/pages/`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-16" title="16">      <span class="op">},</span></a>
<a class="sourceLine" id="cb1-17" title="17">    <span class="op">},</span></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="op">{</span></a>
<a class="sourceLine" id="cb1-19" title="19">      <span class="dt">resolve</span><span class="op">:</span> <span class="vs">`gatsby-source-filesystem`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-20" title="20">      <span class="dt">options</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-21" title="21">        <span class="dt">name</span><span class="op">:</span> <span class="vs">`data`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-22" title="22">        <span class="dt">path</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>__dirname<span class="sc">}</span><span class="vs">/src/data/`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-23" title="23">        <span class="dt">ignore</span><span class="op">:</span> [<span class="vs">`**/</span><span class="sc">\.</span><span class="vs">*`</span>]<span class="op">,</span> <span class="co">// ignore files starting with a dot</span></a>
<a class="sourceLine" id="cb1-24" title="24">      <span class="op">},</span></a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="op">},</span></a>
<a class="sourceLine" id="cb1-26" title="26">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="op">}</span></a></code></pre></div>
<h2 id="options">Options</h2>
<p>In addition to the name and path parameters you may pass an optional <code>ignore</code> array of file globs to ignore.</p>
<p>They will be added to the following default list:</p>
<pre class="text"><code>**/*.un~
**/.DS_Store
**/.gitignore
**/.npmignore
**/.babelrc
**/yarn.lock
**/node_modules
../**/dist/**</code></pre>
<p>To prevent concurrent requests overload of <code>processRemoteNode</code>, you can adjust the <code>200</code> default concurrent downloads, with <code>GATSBY_CONCURRENT_DOWNLOAD</code> environment variable.</p>
<h2 id="how-to-query">How to query</h2>
<p>You can query file nodes like the following:</p>
<pre class="graphql"><code>{
  allFile {
    edges {
      node {
        extension
        dir
        modifiedTime
      }
    }
  }
}</code></pre>
<p>To filter by the <code>name</code> you specified in the config, use <code>sourceInstanceName</code>:</p>
<pre class="graphql"><code>{
  allFile(filter: { sourceInstanceName: { eq: &quot;data&quot; } }) {
    edges {
      node {
        extension
        dir
        modifiedTime
      }
    }
  }
}</code></pre>
<h2 id="helper-functions">Helper functions</h2>
<p><code>gatsby-source-filesystem</code> exports three helper functions:</p>
<ul>
<li><code>createFilePath</code></li>
<li><code>createRemoteFileNode</code></li>
<li><code>createFileNodeFromBuffer</code></li>
</ul>
<h3 id="createfilepath">createFilePath</h3>
<p>When building pages from files, you often want to create a URL from a file’s path on the file system. E.g. if you have a markdown file at <code>src/content/2018-01-23-an-exploration-of-the-nature-of-reality/index.md</code>, you might want to turn that into a page on your site at <code>example.com/2018-01-23-an-exploration-of-the-nature-of-reality/</code>. <code>createFilePath</code> is a helper function to make this task easier.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="at">createFilePath</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="co">// The node you&#39;d like to convert to a path</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="co">// e.g. from a markdown, JSON, YAML file, etc</span></a>
<a class="sourceLine" id="cb5-4" title="4">  node<span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="co">// Method used to get a node</span></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="co">// The parameter from `onCreateNode` should be passed in here</span></a>
<a class="sourceLine" id="cb5-7" title="7">  getNode<span class="op">,</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="co">// The base path for your files.</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="co">// It is relative to the `options.path` setting in the `gatsby-source-filesystem` entries of your `gatsby-config.js`.</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="co">// Defaults to `src/pages`. For the example above, you&#39;d use `src/content`.</span></a>
<a class="sourceLine" id="cb5-11" title="11">  basePath<span class="op">,</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="co">// Whether you want your file paths to contain a trailing `/` slash</span></a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="co">// Defaults to true</span></a>
<a class="sourceLine" id="cb5-14" title="14">  trailingSlash<span class="op">,</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="op">}</span>)</a></code></pre></div>
<h4 id="example-usage">Example usage</h4>
<p>The following is taken from <a href="https://www.gatsbyjs.org/tutorial/part-seven/">Gatsby Tutorial, Part Seven</a> and is used to create URL slugs for markdown pages.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> <span class="op">{</span> createFilePath <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="vs">`gatsby-source-filesystem`</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">exports</span>.<span class="at">onCreateNode</span> <span class="op">=</span> (<span class="op">{</span> node<span class="op">,</span> getNode<span class="op">,</span> actions <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="kw">const</span> <span class="op">{</span> createNodeField <span class="op">}</span> <span class="op">=</span> actions</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="co">// Ensures we are processing only markdown files</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="cf">if</span> (<span class="va">node</span>.<span class="va">internal</span>.<span class="at">type</span> <span class="op">===</span> <span class="st">&quot;MarkdownRemark&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="co">// Use `createFilePath` to turn markdown files in our `data/faqs` directory into `/faqs/slug`</span></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="kw">const</span> relativeFilePath <span class="op">=</span> <span class="at">createFilePath</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">      node<span class="op">,</span></a>
<a class="sourceLine" id="cb6-10" title="10">      getNode<span class="op">,</span></a>
<a class="sourceLine" id="cb6-11" title="11">      <span class="dt">basePath</span><span class="op">:</span> <span class="st">&quot;data/faqs/&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-13" title="13"></a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="co">// Creates new query&#39;able field with name of &#39;slug&#39;</span></a>
<a class="sourceLine" id="cb6-15" title="15">    <span class="at">createNodeField</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-16" title="16">      node<span class="op">,</span></a>
<a class="sourceLine" id="cb6-17" title="17">      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;slug&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-18" title="18">      <span class="dt">value</span><span class="op">:</span> <span class="vs">`/faqs</span><span class="sc">${</span>relativeFilePath<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-19" title="19">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="op">}</span></a></code></pre></div>
<h3 id="createremotefilenode">createRemoteFileNode</h3>
<p>When building source plugins for remote data sources such as headless CMSs, their data will often link to files stored remotely that are often convenient to download so you can work with them locally.</p>
<p>The <code>createRemoteFileNode</code> helper makes it easy to download remote files and add them to your site’s GraphQL schema.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">createRemoteFileNode</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="co">// The source url of the remote file</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">url</span><span class="op">:</span> <span class="vs">`https://example.com/a-file.jpg`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="co">// The id of the parent node (i.e. the node to which the new remote File node will be linked to.</span></a>
<a class="sourceLine" id="cb7-6" title="6">  parentNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="co">// Gatsby&#39;s cache which the helper uses to check if the file has been downloaded already. It&#39;s passed to all Node APIs.</span></a>
<a class="sourceLine" id="cb7-9" title="9">  getCache<span class="op">,</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="co">// The action used to create nodes</span></a>
<a class="sourceLine" id="cb7-12" title="12">  createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="co">// A helper function for creating node Ids</span></a>
<a class="sourceLine" id="cb7-15" title="15">  createNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">  <span class="co">// OPTIONAL</span></a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="co">// Adds htaccess authentication to the download request if passed in.</span></a>
<a class="sourceLine" id="cb7-19" title="19">  <span class="dt">auth</span><span class="op">:</span> <span class="op">{</span> <span class="dt">htaccess_user</span><span class="op">:</span> <span class="vs">`USER`</span><span class="op">,</span> <span class="dt">htaccess_pass</span><span class="op">:</span> <span class="vs">`PASSWORD`</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb7-20" title="20"></a>
<a class="sourceLine" id="cb7-21" title="21">  <span class="co">// OPTIONAL</span></a>
<a class="sourceLine" id="cb7-22" title="22">  <span class="co">// Adds extra http headers to download request if passed in.</span></a>
<a class="sourceLine" id="cb7-23" title="23">  <span class="dt">httpHeaders</span><span class="op">:</span> <span class="op">{</span> <span class="dt">Authorization</span><span class="op">:</span> <span class="vs">`Bearer someAccessToken`</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="co">// OPTIONAL</span></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="co">// Sets the file extension</span></a>
<a class="sourceLine" id="cb7-27" title="27">  <span class="dt">ext</span><span class="op">:</span> <span class="st">&quot;.jpg&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="op">}</span>)</a></code></pre></div>
<h4 id="example-usage-1">Example usage</h4>
<p>The following example is pulled from <a href="https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-wordpress">gatsby-source-wordpress</a>. Downloaded files are created as <code>File</code> nodes and then linked to the WordPress Media node, so it can be queried both as a regular <code>File</code> node and from the <code>localFile</code> field in the Media node.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> <span class="op">{</span> createRemoteFileNode <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="vs">`gatsby-source-filesystem`</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="va">exports</span>.<span class="at">downloadMediaFiles</span> <span class="op">=</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb8-4" title="4">  nodes<span class="op">,</span></a>
<a class="sourceLine" id="cb8-5" title="5">  getCache<span class="op">,</span></a>
<a class="sourceLine" id="cb8-6" title="6">  createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb8-7" title="7">  createNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb8-8" title="8">  _auth<span class="op">,</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="va">nodes</span>.<span class="at">map</span>(<span class="kw">async</span> node <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="kw">let</span> fileNode</a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="co">// Ensures we are only processing Media Files</span></a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="co">// `wordpress__wp_media` is the media file type name for WordPress</span></a>
<a class="sourceLine" id="cb8-14" title="14">    <span class="cf">if</span> (<span class="va">node</span>.<span class="at">__type</span> <span class="op">===</span> <span class="vs">`wordpress__wp_media`</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-15" title="15">      <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-16" title="16">        fileNode <span class="op">=</span> <span class="cf">await</span> <span class="at">createRemoteFileNode</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb8-17" title="17">          <span class="dt">url</span><span class="op">:</span> <span class="va">node</span>.<span class="at">source_url</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-18" title="18">          <span class="dt">parentNodeId</span><span class="op">:</span> <span class="va">node</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-19" title="19">          getCache<span class="op">,</span></a>
<a class="sourceLine" id="cb8-20" title="20">          createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb8-21" title="21">          createNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb8-22" title="22">          <span class="dt">auth</span><span class="op">:</span> _auth<span class="op">,</span></a>
<a class="sourceLine" id="cb8-23" title="23">        <span class="op">}</span>)</a>
<a class="sourceLine" id="cb8-24" title="24">      <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-25" title="25">        <span class="co">// Ignore</span></a>
<a class="sourceLine" id="cb8-26" title="26">      <span class="op">}</span></a>
<a class="sourceLine" id="cb8-27" title="27">    <span class="op">}</span></a>
<a class="sourceLine" id="cb8-28" title="28"></a>
<a class="sourceLine" id="cb8-29" title="29">    <span class="co">// Adds a field `localFile` to the node</span></a>
<a class="sourceLine" id="cb8-30" title="30">    <span class="co">// ___NODE appendix tells Gatsby that this field will link to another node</span></a>
<a class="sourceLine" id="cb8-31" title="31">    <span class="cf">if</span> (fileNode) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-32" title="32">      <span class="va">node</span>.<span class="at">localFile___NODE</span> <span class="op">=</span> <span class="va">fileNode</span>.<span class="at">id</span></a>
<a class="sourceLine" id="cb8-33" title="33">    <span class="op">}</span></a>
<a class="sourceLine" id="cb8-34" title="34">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb8-35" title="35"><span class="op">}</span></a></code></pre></div>
<p>The file node can then be queried using GraphQL. See an example of this in the <a href="/plugins/gatsby-source-wordpress/#image-processing">gatsby-source-wordpress README</a> where downloaded images are queried using <a href="/plugins/gatsby-transformer-sharp/">gatsby-transformer-sharp</a> to use in the component <a href="/plugins/gatsby-image/">gatsby-image</a>.</p>
<h4 id="retrieving-the-remote-file-name-and-extension">Retrieving the remote file name and extension</h4>
<p>The helper tries first to retrieve the file name and extension by parsing the url and the path provided (e.g. if the url is <code>https://example.com/image.jpg</code>, the extension will be inferred as <code>.jpg</code> and the name as <code>image</code>). If the url does not contain an extension, we use the <a href="https://www.npmjs.com/package/file-type"><code>file-type</code></a> package to infer the file type. Finally, the name and the extension <em>can</em> be explicitly passed, like so:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="at">createRemoteFileNode</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="co">// The source url of the remote file</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="dt">url</span><span class="op">:</span> <span class="vs">`https://example.com/a-file-without-an-extension`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="dt">parentNodeId</span><span class="op">:</span> <span class="va">node</span>.<span class="at">id</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-5" title="5">  getCache<span class="op">,</span></a>
<a class="sourceLine" id="cb9-6" title="6">  createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb9-7" title="7">  createNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="co">// if necessary!</span></a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="dt">ext</span><span class="op">:</span> <span class="st">&quot;.jpg&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;image&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="op">}</span>)</a></code></pre></div>
<h3 id="createfilenodefrombuffer">createFileNodeFromBuffer</h3>
<p>When working with data that isn’t already stored in a file, such as when querying binary/blob fields from a database, it’s helpful to cache that data to the filesystem in order to use it with other transformers that accept files as input.</p>
<p>The <code>createFileNodeFromBuffer</code> helper accepts a <code>Buffer</code>, caches its contents to disk, and creates a file node that points to it.</p>
<h2 id="example-usage-2">Example usage</h2>
<p>The following example is adapted from the source of <a href="https://github.com/malcolm-kee/gatsby-source-mysql"><code>gatsby-source-mysql</code></a>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// gatsby-node.js</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">const</span> createMySqlNodes <span class="op">=</span> <span class="at">require</span>(<span class="vs">`./create-nodes`</span>)</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="va">exports</span>.<span class="at">sourceNodes</span> <span class="op">=</span> <span class="kw">async</span> (<span class="op">{</span> actions<span class="op">,</span> createNodeId<span class="op">,</span> getCache <span class="op">},</span> config) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="kw">const</span> <span class="op">{</span> createNode <span class="op">}</span> <span class="op">=</span> actions</a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="kw">const</span> <span class="op">{</span> conn<span class="op">,</span> queries <span class="op">}</span> <span class="op">=</span> config</a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="kw">const</span> <span class="op">{</span> db<span class="op">,</span> results <span class="op">}</span> <span class="op">=</span> <span class="cf">await</span> <span class="at">query</span>(conn<span class="op">,</span> queries)</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-10" title="10">    queries</a>
<a class="sourceLine" id="cb10-11" title="11">      .<span class="at">map</span>((query<span class="op">,</span> i) <span class="kw">=&gt;</span> (<span class="op">{</span> ...<span class="at">query</span><span class="op">,</span> <span class="dt">___sql</span><span class="op">:</span> results[i] <span class="op">}</span>))</a>
<a class="sourceLine" id="cb10-12" title="12">      .<span class="at">forEach</span>(result <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-13" title="13">        <span class="at">createMySqlNodes</span>(result<span class="op">,</span> results<span class="op">,</span> createNode<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-14" title="14">          createNode<span class="op">,</span></a>
<a class="sourceLine" id="cb10-15" title="15">          createNodeId<span class="op">,</span></a>
<a class="sourceLine" id="cb10-16" title="16">          getCache<span class="op">,</span></a>
<a class="sourceLine" id="cb10-17" title="17">        <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-18" title="18">      )</a>
<a class="sourceLine" id="cb10-19" title="19">    <span class="va">db</span>.<span class="at">end</span>()</a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-21" title="21">    <span class="va">console</span>.<span class="at">error</span>(e)</a>
<a class="sourceLine" id="cb10-22" title="22">    <span class="va">db</span>.<span class="at">end</span>()</a>
<a class="sourceLine" id="cb10-23" title="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-25" title="25"></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">// create-nodes.js</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="kw">const</span> <span class="op">{</span> createFileNodeFromBuffer <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="vs">`gatsby-source-filesystem`</span>)</a>
<a class="sourceLine" id="cb10-28" title="28"><span class="kw">const</span> createNodeHelpers <span class="op">=</span> <span class="at">require</span>(<span class="vs">`gatsby-node-helpers`</span>).<span class="at">default</span></a>
<a class="sourceLine" id="cb10-29" title="29"></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="kw">const</span> <span class="op">{</span> createNodeFactory <span class="op">}</span> <span class="op">=</span> <span class="at">createNodeHelpers</span>(<span class="op">{</span> <span class="dt">typePrefix</span><span class="op">:</span> <span class="vs">`mysql`</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-31" title="31"></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="kw">function</span> <span class="at">attach</span>(node<span class="op">,</span> key<span class="op">,</span> value<span class="op">,</span> ctx) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-33" title="33">  <span class="cf">if</span> (<span class="va">Buffer</span>.<span class="at">isBuffer</span>(value)) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-34" title="34">    <span class="va">ctx</span>.<span class="va">linkChildren</span>.<span class="at">push</span>(parentNodeId <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-35" title="35">      <span class="at">createFileNodeFromBuffer</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb10-36" title="36">        <span class="dt">buffer</span><span class="op">:</span> value<span class="op">,</span></a>
<a class="sourceLine" id="cb10-37" title="37">        <span class="dt">getCache</span><span class="op">:</span> <span class="va">ctx</span>.<span class="at">getCache</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-38" title="38">        <span class="dt">createNode</span><span class="op">:</span> <span class="va">ctx</span>.<span class="at">createNode</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-39" title="39">        <span class="dt">createNodeId</span><span class="op">:</span> <span class="va">ctx</span>.<span class="at">createNodeId</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-40" title="40">      <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-41" title="41">    )</a>
<a class="sourceLine" id="cb10-42" title="42">    value <span class="op">=</span> <span class="vs">`Buffer`</span></a>
<a class="sourceLine" id="cb10-43" title="43">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-44" title="44"></a>
<a class="sourceLine" id="cb10-45" title="45">  node[key] <span class="op">=</span> value</a>
<a class="sourceLine" id="cb10-46" title="46"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-47" title="47"></a>
<a class="sourceLine" id="cb10-48" title="48"><span class="kw">function</span> <span class="at">createMySqlNodes</span>(<span class="op">{</span> name<span class="op">,</span> __sql<span class="op">,</span> idField<span class="op">,</span> keys <span class="op">},</span> results<span class="op">,</span> ctx) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-49" title="49">  <span class="kw">const</span> MySqlNode <span class="op">=</span> <span class="at">createNodeFactory</span>(name)</a>
<a class="sourceLine" id="cb10-50" title="50">  <span class="va">ctx</span>.<span class="at">linkChildren</span> <span class="op">=</span> []</a>
<a class="sourceLine" id="cb10-51" title="51"></a>
<a class="sourceLine" id="cb10-52" title="52">  <span class="cf">return</span> <span class="va">__sql</span>.<span class="at">forEach</span>(row <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-53" title="53">    <span class="cf">if</span> (<span class="op">!</span>keys) keys <span class="op">=</span> <span class="va">Object</span>.<span class="at">keys</span>(row)</a>
<a class="sourceLine" id="cb10-54" title="54"></a>
<a class="sourceLine" id="cb10-55" title="55">    <span class="kw">const</span> node <span class="op">=</span> <span class="op">{</span> <span class="dt">id</span><span class="op">:</span> row[idField] <span class="op">}</span></a>
<a class="sourceLine" id="cb10-56" title="56"></a>
<a class="sourceLine" id="cb10-57" title="57">    <span class="cf">for</span> (<span class="kw">const</span> key <span class="kw">of</span> keys) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-58" title="58">      <span class="at">attach</span>(node<span class="op">,</span> key<span class="op">,</span> row[key]<span class="op">,</span> ctx)</a>
<a class="sourceLine" id="cb10-59" title="59">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-60" title="60"></a>
<a class="sourceLine" id="cb10-61" title="61">    node <span class="op">=</span> <span class="va">ctx</span>.<span class="at">createNode</span>(node)</a>
<a class="sourceLine" id="cb10-62" title="62"></a>
<a class="sourceLine" id="cb10-63" title="63">    <span class="cf">for</span> (<span class="kw">const</span> link <span class="kw">of</span> <span class="va">ctx</span>.<span class="at">linkChildren</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-64" title="64">      <span class="at">link</span>(<span class="va">node</span>.<span class="at">id</span>)</a>
<a class="sourceLine" id="cb10-65" title="65">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-66" title="66">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-67" title="67"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-68" title="68"></a>
<a class="sourceLine" id="cb10-69" title="69"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> createMySqlNodes</a></code></pre></div>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>In case that due to spotty network, or slow connection, some remote files fail to download. Even after multiple retries and adjusting concurrent downloads, you can adjust timeout and retry settings with these environment variables:</p>
<ul>
<li><code>GATSBY_STALL_RETRY_LIMIT</code>, default: <code>3</code></li>
<li><code>GATSBY_STALL_TIMEOUT</code>, default: <code>30000</code></li>
<li><code>GATSBY_CONNECTION_TIMEOUT</code>, default: <code>30000</code></li>
</ul>
</body>
</html>
