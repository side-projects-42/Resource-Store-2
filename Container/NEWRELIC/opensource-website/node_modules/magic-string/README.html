<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="magic-string">magic-string</h1>
<p><a href="https://travis-ci.org/Rich-Harris/magic-string"> <img src="http://img.shields.io/travis/Rich-Harris/magic-string.svg"
       alt="build status"> </a> <a href="https://npmjs.org/package/magic-string"> <img src="https://img.shields.io/npm/v/magic-string.svg"
       alt="npm version"> </a> <a href="https://github.com/Rich-Harris/magic-string/blob/master/LICENSE.md"> <img src="https://img.shields.io/npm/l/magic-string.svg"
       alt="license"> </a></p>
<p>Suppose you have some source code. You want to make some light modifications to it - replacing a few characters here and there, wrapping it with a header and footer, etc - and ideally you’d like to generate a source map at the end of it. You’ve thought about using something like <a href="https://github.com/benjamn/recast">recast</a> (which allows you to generate an AST from some JavaScript, manipulate it, and reprint it with a sourcemap without losing your comments and formatting), but it seems like overkill for your needs (or maybe the source code isn’t JavaScript).</p>
<p>Your requirements are, frankly, rather niche. But they’re requirements that I also have, and for which I made magic-string. It’s a small, fast utility for manipulating strings and generating sourcemaps.</p>
<h2 id="installation">Installation</h2>
<p>magic-string works in both node.js and browser environments. For node, install with npm:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> i magic-string</a></code></pre></div>
<p>To use in browser, grab the <a href="https://unpkg.com/magic-string/dist/magic-string.umd.js">magic-string.umd.js</a> file and add it to your page:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&#39;magic-string.umd.js&#39;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>(It also works with various module systems, if you prefer that sort of thing - it has a dependency on <a href="https://github.com/Rich-Harris/vlq">vlq</a>.)</p>
<h2 id="usage">Usage</h2>
<p>These examples assume you’re in node.js, or something similar:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> MagicString <span class="op">=</span> <span class="at">require</span>( <span class="st">&#39;magic-string&#39;</span> )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> s <span class="op">=</span> <span class="kw">new</span> <span class="at">MagicString</span>( <span class="st">&#39;problems = 99&#39;</span> )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">s</span>.<span class="at">overwrite</span>( <span class="dv">0</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="st">&#39;answer&#39;</span> )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="va">s</span>.<span class="at">toString</span>()<span class="op">;</span> <span class="co">// &#39;answer = 99&#39;</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="va">s</span>.<span class="at">overwrite</span>( <span class="dv">11</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="st">&#39;42&#39;</span> )<span class="op">;</span> <span class="co">// character indices always refer to the original string</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="va">s</span>.<span class="at">toString</span>()<span class="op">;</span> <span class="co">// &#39;answer = 42&#39;</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">s</span>.<span class="at">prepend</span>( <span class="st">&#39;var &#39;</span> ).<span class="at">append</span>( <span class="st">&#39;;&#39;</span> )<span class="op">;</span> <span class="co">// most methods are chainable</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="va">s</span>.<span class="at">toString</span>()<span class="op">;</span> <span class="co">// &#39;var answer = 42;&#39;</span></a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="kw">var</span> map <span class="op">=</span> <span class="va">s</span>.<span class="at">generateMap</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-14" title="14">  <span class="dt">source</span><span class="op">:</span> <span class="st">&#39;source.js&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="dt">file</span><span class="op">:</span> <span class="st">&#39;converted.js.map&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="dt">includeContent</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="op">}</span>)<span class="op">;</span> <span class="co">// generates a v3 sourcemap</span></a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="at">require</span>( <span class="st">&#39;fs&#39;</span> ).<span class="at">writeFile</span>( <span class="st">&#39;converted.js&#39;</span><span class="op">,</span> <span class="va">s</span>.<span class="at">toString</span>() )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="at">require</span>( <span class="st">&#39;fs&#39;</span> ).<span class="at">writeFile</span>( <span class="st">&#39;converted.js.map&#39;</span><span class="op">,</span> <span class="va">map</span>.<span class="at">toString</span>() )<span class="op">;</span></a></code></pre></div>
<p>You can pass an options argument:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> s <span class="op">=</span> <span class="kw">new</span> <span class="at">MagicString</span>( someCode<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="co">// both these options will be used if you later</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="co">// call `bundle.addSource( s )` - see below</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">filename</span><span class="op">:</span> <span class="st">&#39;foo.js&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="dt">indentExclusionRanges</span><span class="op">:</span> [<span class="co">/*...*/</span>]</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="methods">Methods</h2>
<h3 id="s.addsourcemaplocation-index">s.addSourcemapLocation( index )</h3>
<p>Adds the specified character index (with respect to the original string) to sourcemap mappings, if <code>hires</code> is <code>false</code> (see below).</p>
<h3 id="s.append-content">s.append( content )</h3>
<p>Appends the specified content to the end of the string. Returns <code>this</code>.</p>
<h3 id="s.appendleft-index-content">s.appendLeft( index, content )</h3>
<p>Appends the specified <code>content</code> at the <code>index</code> in the original string. If a range <em>ending</em> with <code>index</code> is subsequently moved, the insert will be moved with it. Returns <code>this</code>. See also <code>s.prependLeft(...)</code>.</p>
<h3 id="s.appendright-index-content">s.appendRight( index, content )</h3>
<p>Appends the specified <code>content</code> at the <code>index</code> in the original string. If a range <em>starting</em> with <code>index</code> is subsequently moved, the insert will be moved with it. Returns <code>this</code>. See also <code>s.prependRight(...)</code>.</p>
<h3 id="s.clone">s.clone()</h3>
<p>Does what you’d expect.</p>
<h3 id="s.generatedecodedmap-options">s.generateDecodedMap( options )</h3>
<p>Generates a sourcemap object with raw mappings in array form, rather than encoded as a string. See <code>generateMap</code> documentation below for options details. Useful if you need to manipulate the sourcemap further, but most of the time you will use <code>generateMap</code> instead.</p>
<h3 id="s.generatemap-options">s.generateMap( options )</h3>
<p>Generates a <a href="https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit">version 3 sourcemap</a>. All options are, well, optional:</p>
<ul>
<li><code>file</code> - the filename where you plan to write the sourcemap</li>
<li><code>source</code> - the filename of the file containing the original source</li>
<li><code>includeContent</code> - whether to include the original content in the map’s <code>sourcesContent</code> array</li>
<li><code>hires</code> - whether the mapping should be high-resolution. Hi-res mappings map every single character, meaning (for example) your devtools will always be able to pinpoint the exact location of function calls and so on. With lo-res mappings, devtools may only be able to identify the correct line - but they’re quicker to generate and less bulky. If sourcemap locations have been specified with <code>s.addSourceMapLocation()</code>, they will be used here.</li>
</ul>
<p>The returned sourcemap has two (non-enumerable) methods attached for convenience:</p>
<ul>
<li><code>toString</code> - returns the equivalent of <code>JSON.stringify(map)</code></li>
<li><code>toUrl</code> - returns a DataURI containing the sourcemap. Useful for doing this sort of thing:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">code <span class="op">+=</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">//# sourceMappingURL=&#39;</span> <span class="op">+</span> <span class="va">map</span>.<span class="at">toUrl</span>()<span class="op">;</span></a></code></pre></div>
<h3 id="s.indent-prefix-options">s.indent( prefix[, options] )</h3>
<p>Prefixes each line of the string with <code>prefix</code>. If <code>prefix</code> is not supplied, the indentation will be guessed from the original content, falling back to a single tab character. Returns <code>this</code>.</p>
<p>The <code>options</code> argument can have an <code>exclude</code> property, which is an array of <code>[start, end]</code> character ranges. These ranges will be excluded from the indentation - useful for (e.g.) multiline strings.</p>
<h3 id="s.insertleft-index-content">s.insertLeft( index, content )</h3>
<p><strong>DEPRECATED</strong> since 0.17 – use <code>s.appendLeft(...)</code> instead</p>
<h3 id="s.insertright-index-content">s.insertRight( index, content )</h3>
<p><strong>DEPRECATED</strong> since 0.17 – use <code>s.prependRight(...)</code> instead</p>
<h3 id="s.locate-index">s.locate( index )</h3>
<p><strong>DEPRECATED</strong> since 0.10 – see <a href="https://github.com/Rich-Harris/magic-string/pull/30">#30</a></p>
<h3 id="s.locateorigin-index">s.locateOrigin( index )</h3>
<p><strong>DEPRECATED</strong> since 0.10 – see <a href="https://github.com/Rich-Harris/magic-string/pull/30">#30</a></p>
<h3 id="s.move-start-end-newindex">s.move( start, end, newIndex )</h3>
<p>Moves the characters from <code>start</code> and <code>end</code> to <code>index</code>. Returns <code>this</code>.</p>
<h3 id="s.overwrite-start-end-content-options">s.overwrite( start, end, content[, options] )</h3>
<p>Replaces the characters from <code>start</code> to <code>end</code> with <code>content</code>. The same restrictions as <code>s.remove()</code> apply. Returns <code>this</code>.</p>
<p>The fourth argument is optional. It can have a <code>storeName</code> property — if <code>true</code>, the original name will be stored for later inclusion in a sourcemap’s <code>names</code> array — and a <code>contentOnly</code> property which determines whether only the content is overwritten, or anything that was appended/prepended to the range as well.</p>
<h3 id="s.prepend-content">s.prepend( content )</h3>
<p>Prepends the string with the specified content. Returns <code>this</code>.</p>
<h3 id="s.prependleft-index-content">s.prependLeft ( index, content )</h3>
<p>Same as <code>s.appendLeft(...)</code>, except that the inserted content will go <em>before</em> any previous appends or prepends at <code>index</code></p>
<h3 id="s.prependright-index-content">s.prependRight ( index, content )</h3>
<p>Same as <code>s.appendRight(...)</code>, except that the inserted content will go <em>before</em> any previous appends or prepends at <code>index</code></p>
<h3 id="s.remove-start-end">s.remove( start, end )</h3>
<p>Removes the characters from <code>start</code> to <code>end</code> (of the original string, <strong>not</strong> the generated string). Removing the same content twice, or making removals that partially overlap, will cause an error. Returns <code>this</code>.</p>
<h3 id="s.slice-start-end">s.slice( start, end )</h3>
<p>Returns the content of the generated string that corresponds to the slice between <code>start</code> and <code>end</code> of the original string. Throws error if the indices are for characters that were already removed.</p>
<h3 id="s.snip-start-end">s.snip( start, end )</h3>
<p>Returns a clone of <code>s</code>, with all content before the <code>start</code> and <code>end</code> characters of the original string removed.</p>
<h3 id="s.tostring">s.toString()</h3>
<p>Returns the generated string.</p>
<h3 id="s.trim-chartype">s.trim([ charType ])</h3>
<p>Trims content matching <code>charType</code> (defaults to <code>\s</code>, i.e. whitespace) from the start and end. Returns <code>this</code>.</p>
<h3 id="s.trimstart-chartype">s.trimStart([ charType ])</h3>
<p>Trims content matching <code>charType</code> (defaults to <code>\s</code>, i.e. whitespace) from the start. Returns <code>this</code>.</p>
<h3 id="s.trimend-chartype">s.trimEnd([ charType ])</h3>
<p>Trims content matching <code>charType</code> (defaults to <code>\s</code>, i.e. whitespace) from the end. Returns <code>this</code>.</p>
<h3 id="s.trimlines">s.trimLines()</h3>
<p>Removes empty lines from the start and end. Returns <code>this</code>.</p>
<h3 id="s.isempty">s.isEmpty()</h3>
<p>Returns true if the resulting source is empty (disregarding white space).</p>
<h2 id="bundling">Bundling</h2>
<p>To concatenate several sources, use <code>MagicString.Bundle</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> bundle <span class="op">=</span> <span class="kw">new</span> <span class="va">MagicString</span>.<span class="at">Bundle</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">bundle</span>.<span class="at">addSource</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">filename</span><span class="op">:</span> <span class="st">&#39;foo.js&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">content</span><span class="op">:</span> <span class="kw">new</span> <span class="at">MagicString</span>( <span class="st">&#39;var answer = 42;&#39;</span> )</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="va">bundle</span>.<span class="at">addSource</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="dt">filename</span><span class="op">:</span> <span class="st">&#39;bar.js&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="dt">content</span><span class="op">:</span> <span class="kw">new</span> <span class="at">MagicString</span>( <span class="st">&#39;console.log( answer )&#39;</span> )</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">// Advanced: a source can include an `indentExclusionRanges` property</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">// alongside `filename` and `content`. This will be passed to `s.indent()`</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">// - see documentation above</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="va">bundle</span>.<span class="at">indent</span>() <span class="co">// optionally, pass an indent string, otherwise it will be guessed</span></a>
<a class="sourceLine" id="cb6-18" title="18">  .<span class="at">prepend</span>( <span class="st">&#39;(function () {</span><span class="sc">\n</span><span class="st">&#39;</span> )</a>
<a class="sourceLine" id="cb6-19" title="19">  .<span class="at">append</span>( <span class="st">&#39;}());&#39;</span> )<span class="op">;</span></a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="va">bundle</span>.<span class="at">toString</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">// (function () {</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">//   var answer = 42;</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">//   console.log( answer );</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">// }());</span></a>
<a class="sourceLine" id="cb6-26" title="26"></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">// options are as per `s.generateMap()` above</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="kw">var</span> map <span class="op">=</span> <span class="va">bundle</span>.<span class="at">generateMap</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-29" title="29">  <span class="dt">file</span><span class="op">:</span> <span class="st">&#39;bundle.js&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-30" title="30">  <span class="dt">includeContent</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-31" title="31">  <span class="dt">hires</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>As an alternative syntax, if you a) don’t have <code>filename</code> or <code>indentExclusionRanges</code> options, or b) passed those in when you used <code>new MagicString(...)</code>, you can simply pass the <code>MagicString</code> instance itself:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> bundle <span class="op">=</span> <span class="kw">new</span> <span class="va">MagicString</span>.<span class="at">Bundle</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">var</span> source <span class="op">=</span> <span class="kw">new</span> <span class="at">MagicString</span>( someCode<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">filename</span><span class="op">:</span> <span class="st">&#39;foo.js&#39;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="va">bundle</span>.<span class="at">addSource</span>( source )<span class="op">;</span></a></code></pre></div>
<h2 id="license">License</h2>
<p>MIT</p>
</body>
</html>
