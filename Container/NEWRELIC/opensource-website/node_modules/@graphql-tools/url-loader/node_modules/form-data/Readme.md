Form-Data [![NPM Module](https://img.shields.io/npm/v/form-data.svg)](https://www.npmjs.com/package/form-data) [![Join the chat at https://gitter.im/form-data/form-data](http://form-data.github.io/images/gitterbadge.svg)](https://gitter.im/form-data/form-data)
====================================================================================================================================================================================================================================================================

A library to create readable `"multipart/form-data"` streams. Can be used to submit forms and file uploads to other web applications.

The API of this library is inspired by the [XMLHttpRequest-2 FormData Interface](http://dev.w3.org/2006/webapi/XMLHttpRequest-2/Overview.html#the-formdata-interface).

[![Linux Build](https://img.shields.io/travis/form-data/form-data/v4.0.0.svg?label=linux:6.x-12.x)](https://travis-ci.org/form-data/form-data) [![MacOS Build](https://img.shields.io/travis/form-data/form-data/v4.0.0.svg?label=macos:6.x-12.x)](https://travis-ci.org/form-data/form-data) [![Windows Build](https://img.shields.io/travis/form-data/form-data/v4.0.0.svg?label=windows:6.x-12.x)](https://travis-ci.org/form-data/form-data)

[![Coverage Status](https://img.shields.io/coveralls/form-data/form-data/v4.0.0.svg?label=code+coverage)](https://coveralls.io/github/form-data/form-data?branch=master) [![Dependency Status](https://img.shields.io/david/form-data/form-data.svg)](https://david-dm.org/form-data/form-data)

Install
-------

    npm install --save form-data

Usage
-----

In this example we are constructing a form with 3 fields that contain a string, a buffer and a file stream.

    var FormData = require('form-data');
    var fs = require('fs');

    var form = new FormData();
    form.append('my_field', 'my value');
    form.append('my_buffer', new Buffer(10));
    form.append('my_file', fs.createReadStream('/foo/bar.jpg'));

Also you can use http-response stream:

    var FormData = require('form-data');
    var http = require('http');

    var form = new FormData();

    http.request('http://nodejs.org/images/logo.png', function(response) {
      form.append('my_field', 'my value');
      form.append('my_buffer', new Buffer(10));
      form.append('my_logo', response);
    });

Or <span class="citation" data-cites="mikeal">@mikeal</span>’s [request](https://github.com/request/request) stream:

    var FormData = require('form-data');
    var request = require('request');

    var form = new FormData();

    form.append('my_field', 'my value');
    form.append('my_buffer', new Buffer(10));
    form.append('my_logo', request('http://nodejs.org/images/logo.png'));

In order to submit this form to a web application, call `submit(url, [callback])` method:

    form.submit('http://example.org/', function(err, res) {
      // res – response object (http.IncomingMessage)  //
      res.resume();
    });

For more advanced request manipulations `submit()` method returns `http.ClientRequest` object, or you can choose from one of the alternative submission methods.

### Custom options

You can provide custom options, such as `maxDataSize`:

    var FormData = require('form-data');

    var form = new FormData({ maxDataSize: 20971520 });
    form.append('my_field', 'my value');
    form.append('my_buffer', /* something big */);

List of available options could be found in [combined-stream](https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15)

### Alternative submission methods

You can use node’s http client interface:

    var http = require('http');

    var request = http.request({
      method: 'post',
      host: 'example.org',
      path: '/upload',
      headers: form.getHeaders()
    });

    form.pipe(request);

    request.on('response', function(res) {
      console.log(res.statusCode);
    });

Or if you would prefer the `'Content-Length'` header to be set for you:

    form.submit('example.org/upload', function(err, res) {
      console.log(res.statusCode);
    });

To use custom headers and pre-known length in parts:

    var CRLF = '\r\n';
    var form = new FormData();

    var options = {
      header: CRLF + '--' + form.getBoundary() + CRLF + 'X-Custom-Header: 123' + CRLF + CRLF,
      knownLength: 1
    };

    form.append('my_buffer', buffer, options);

    form.submit('http://example.com/', function(err, res) {
      if (err) throw err;
      console.log('Done');
    });

Form-Data can recognize and fetch all the required information from common types of streams (`fs.readStream`, `http.response` and `mikeal's request`), for some other types of streams you’d need to provide “file”-related information manually:

    someModule.stream(function(err, stdout, stderr) {
      if (err) throw err;

      var form = new FormData();

      form.append('file', stdout, {
        filename: 'unicycle.jpg', // ... or:
        filepath: 'photos/toys/unicycle.jpg',
        contentType: 'image/jpeg',
        knownLength: 19806
      });

      form.submit('http://example.com/', function(err, res) {
        if (err) throw err;
        console.log('Done');
      });
    });

The `filepath` property overrides `filename` and may contain a relative path. This is typically used when uploading [multiple files from a directory](https://wicg.github.io/entries-api/#dom-htmlinputelement-webkitdirectory).

For edge cases, like POST request to URL with query string or to pass HTTP auth credentials, object can be passed to `form.submit()` as first parameter:

    form.submit({
      host: 'example.com',
      path: '/probably.php?extra=params',
      auth: 'username:password'
    }, function(err, res) {
      console.log(res.statusCode);
    });

In case you need to also send custom HTTP headers with the POST request, you can use the `headers` key in first parameter of `form.submit()`:

    form.submit({
      host: 'example.com',
      path: '/surelynot.php',
      headers: {'x-test-header': 'test-header-value'}
    }, function(err, res) {
      console.log(res.statusCode);
    });

### Methods

-   [*Void* append( **String** *field*, **Mixed** *value* \[, **Mixed** *options*\] )](https://github.com/form-data/form-data#void-append-string-field-mixed-value--mixed-options-).
-   [*Headers* getHeaders( \[**Headers** *userHeaders*\] )](https://github.com/form-data/form-data#array-getheaders-array-userheaders-)
-   [*String* getBoundary()](https://github.com/form-data/form-data#string-getboundary)
-   [*Void* setBoundary()](https://github.com/form-data/form-data#void-setboundary)
-   [*Buffer* getBuffer()](https://github.com/form-data/form-data#buffer-getbuffer)
-   [*Integer* getLengthSync()](https://github.com/form-data/form-data#integer-getlengthsync)
-   [*Integer* getLength( **function** *callback* )](https://github.com/form-data/form-data#integer-getlength-function-callback-)
-   [*Boolean* hasKnownLength()](https://github.com/form-data/form-data#boolean-hasknownlength)
-   [*Request* submit( *params*, **function** *callback* )](https://github.com/form-data/form-data#request-submit-params-function-callback-)
-   [*String* toString()](https://github.com/form-data/form-data#string-tostring)

#### *Void* append( **String** *field*, **Mixed** *value* \[, **Mixed** *options*\] )

Append data to the form. You can submit about any format (string, integer, boolean, buffer, etc.). However, Arrays are not supported and need to be turned into strings by the user.

    var form = new FormData();
    form.append( 'my_string', 'my value' );
    form.append( 'my_integer', 1 );
    form.append( 'my_boolean', true );
    form.append( 'my_buffer', new Buffer(10) );
    form.append( 'my_array_as_json', JSON.stringify( ['bird','cute'] ) )

You may provide a string for options, or an object.

    // Set filename by providing a string for options
    form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), 'bar.jpg' );

    // provide an object.
    form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), {filename: 'bar.jpg', contentType: 'image/jpeg', knownLength: 19806} );

#### *Headers* getHeaders( \[**Headers** *userHeaders*\] )

This method adds the correct `content-type` header to the provided array of `userHeaders`.

#### *String* getBoundary()

Return the boundary of the formData. By default, the boundary consists of 26 `-` followed by 24 numbers for example:

    --------------------------515890814546601021194782

#### *Void* setBoundary(String *boundary*)

Set the boundary string, overriding the default behavior described above.

*Note: The boundary must be unique and may not appear in the data.*

#### *Buffer* getBuffer()

Return the full formdata request package, as a Buffer. You can insert this Buffer in e.g. Axios to send multipart data.

    var form = new FormData();
    form.append( 'my_buffer', Buffer.from([0x4a,0x42,0x20,0x52,0x6f,0x63,0x6b,0x73]) );
    form.append( 'my_file', fs.readFileSync('/foo/bar.jpg') );

    axios.post( 'https://example.com/path/to/api',
                form.getBuffer(),
                form.getHeaders()
              )

**Note:** Because the output is of type Buffer, you can only append types that are accepted by Buffer: *string, Buffer, ArrayBuffer, Array, or Array-like Object*. A ReadStream for example will result in an error.

#### *Integer* getLengthSync()

Same as `getLength` but synchronous.

*Note: getLengthSync **doesn’t** calculate streams length.*

#### *Integer* getLength( **function** *callback* )

Returns the `Content-Length` async. The callback is used to handle errors and continue once the length has been calculated

    this.getLength(function(err, length) {
      if (err) {
        this._error(err);
        return;
      }

      // add content length
      request.setHeader('Content-Length', length);

      ...
    }.bind(this));

#### *Boolean* hasKnownLength()

Checks if the length of added values is known.

#### *Request* submit( *params*, **function** *callback* )

Submit the form to a web application.

    var form = new FormData();
    form.append( 'my_string', 'Hello World' );

    form.submit( 'http://example.com/', function(err, res) {
      // res – response object (http.IncomingMessage)  //
      res.resume();
    } );

#### *String* toString()

Returns the form data as a string. Don’t use this if you are sending files or buffers, use `getBuffer()` instead.

### Integration with other libraries

#### Request

Form submission using [request](https://github.com/request/request):

    var formData = {
      my_field: 'my_value',
      my_file: fs.createReadStream(__dirname + '/unicycle.jpg'),
    };

    request.post({url:'http://service.com/upload', formData: formData}, function(err, httpResponse, body) {
      if (err) {
        return console.error('upload failed:', err);
      }
      console.log('Upload successful!  Server responded with:', body);
    });

For more details see [request readme](https://github.com/request/request#multipartform-data-multipart-form-uploads).

#### node-fetch

You can also submit a form using [node-fetch](https://github.com/bitinn/node-fetch):

    var form = new FormData();

    form.append('a', 1);

    fetch('http://example.com', { method: 'POST', body: form })
        .then(function(res) {
            return res.json();
        }).then(function(json) {
            console.log(json);
        });

#### axios

In Node.js you can post a file using [axios](https://github.com/axios/axios):

    const form = new FormData();
    const stream = fs.createReadStream(PATH_TO_FILE);

    form.append('image', stream);

    // In Node.js environment you need to set boundary in the header field 'Content-Type' by calling method `getHeaders`
    const formHeaders = form.getHeaders();

    axios.post('http://example.com', form, {
      headers: {
        ...formHeaders,
      },
    })
    .then(response => response)
    .catch(error => error)

Notes
-----

-   `getLengthSync()` method DOESN’T calculate length for streams, use `knownLength` options as workaround.
-   `getLength(cb)` will send an error as first parameter of callback if stream length cannot be calculated (e.g. send in custom streams w/o using `knownLength`).
-   `submit` will not add `content-length` if form length is unknown or not calculable.
-   Starting version `2.x` FormData has dropped support for `node@0.10.x`.
-   Starting version `3.x` FormData has dropped support for `node@4.x`.

License
-------

Form-Data is released under the [MIT](License) license.
