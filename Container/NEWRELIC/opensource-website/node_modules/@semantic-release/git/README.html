<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="semantic-releasegit"><span class="citation" data-cites="semantic-release/git">@semantic-release/git</span></h1>
<p><a href="https://github.com/semantic-release/semantic-release"><strong>semantic-release</strong></a> plugin to commit release assets to the project’s <a href="https://git-scm.com/">git</a> repository.</p>
<p><a href="https://travis-ci.org/semantic-release/git"><img src="https://img.shields.io/travis/semantic-release/git.svg" alt="Travis" /></a> <a href="https://codecov.io/gh/semantic-release/git"><img src="https://img.shields.io/codecov/c/github/semantic-release/git.svg" alt="Codecov" /></a> <a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/semantic-release/git.svg" alt="Greenkeeper badge" /></a></p>
<p><a href="https://www.npmjs.com/package/@semantic-release/git"><img src="https://img.shields.io/npm/v/@semantic-release/git/latest.svg" alt="npm latest version" /></a> <a href="https://www.npmjs.com/package/@semantic-release/git"><img src="https://img.shields.io/npm/v/@semantic-release/git/next.svg" alt="npm next version" /></a> <a href="https://www.npmjs.com/package/@semantic-release/git"><img src="https://img.shields.io/npm/v/@semantic-release/git/beta.svg" alt="npm beta version" /></a></p>
<table>
<colgroup>
<col style="width: 13%" />
<col style="width: 86%" />
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>verifyConditions</code></td>
<td>Verify the access to the remote Git repository, the commit <a href="#message"><code>message</code></a> and the <a href="#assets"><code>assets</code></a> option configuration.</td>
</tr>
<tr class="even">
<td><code>prepare</code></td>
<td>Create a release commit, including configurable file assets.</td>
</tr>
</tbody>
</table>
<h2 id="install">Install</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">npm</span> install @semantic-release/git -D</a></code></pre></div>
<h2 id="usage">Usage</h2>
<p>The plugin can be configured in the <a href="https://github.com/semantic-release/semantic-release/blob/master/docs/usage/configuration.md#configuration"><strong>semantic-release</strong> configuration file</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="st">&quot;@semantic-release/commit-analyzer&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="st">&quot;@semantic-release/release-notes-generator&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="ot">[</span><span class="st">&quot;@semantic-release/git&quot;</span><span class="ot">,</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">      <span class="dt">&quot;assets&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;dist/**/*.{js,css}&quot;</span><span class="ot">,</span> <span class="st">&quot;docs&quot;</span><span class="ot">,</span> <span class="st">&quot;package.json&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">      <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;chore(release): ${nextRelease.version} [skip ci]</span><span class="ch">\n\n</span><span class="st">${nextRelease.notes}&quot;</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="fu">}</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="ot">]</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="fu">}</span></a></code></pre></div>
<p>With this example, for each release a release commit will be pushed to the remote Git repository with: - a message formatted like <code>chore(release): &lt;version&gt; [skip ci]\n\n&lt;release notes&gt;</code> - the <code>.js</code> and <code>.css</code> files in the <code>dist</code> directory, the files in the <code>docs</code> directory and the <code>package.json</code></p>
<h3 id="merging-between-semantic-release-branches">Merging between semantic-release branches</h3>
<p>This plugin will, by default, create commit messages with the keyword <code>[skip ci]</code>, so they won’t trigger a new unnecessary CI build. If you are using <strong>semantic-release</strong> with <a href="https://github.com/semantic-release/semantic-release/blob/beta/docs/usage/workflow-configuration.md">multiple branches</a>, when merging a branch with a head being a release commit, a CI job will be triggered on the target branch. Depending on the CI service that might create an unexpected behavior as the head of the target branch might be ignored by the build due to the <code>[skip ci]</code> keyword.</p>
<p>To avoid any unexpected behavior we recommend to use the <a href="https://git-scm.com/docs/git-merge#Documentation/git-merge.txt---no-ff"><code>--no-ff</code> option</a> when merging branches used by <strong>semantic-release</strong>.</p>
<p><strong>Note</strong>: This concerns only merges done between two branches configured in the <a href="https://github.com/semantic-release/semantic-release/blob/beta/docs/usage/configuration.md#branches"><code>branches</code> option</a>.</p>
<h2 id="configuration">Configuration</h2>
<h3 id="git-authentication">Git authentication</h3>
<p>The Git user associated with the <a href="https://github.com/semantic-release/semantic-release/blob/master/docs/usage/ci-configuration.md#authentication">Git credentials</a> has to be able to push commit to the <a href="https://github.com/semantic-release/semantic-release/blob/master/docs/usage/configuration.md#branch">release branch</a>.</p>
<p>When configuring branches permission on a Git hosting service (e.g. <a href="https://help.github.com/articles/about-protected-branches">GitHub protected branches</a>, <a href="https://docs.gitlab.com/ee/user/project/protected_branches.html">GitLab protected branches</a> or <a href="https://confluence.atlassian.com/bitbucket/branch-permissions-385912271.html">Bitbucket branch permissions</a>) it might be necessary to create a specific configuration in order to allow the <strong>semantic-release</strong> user to bypass global restrictions. For example on GitHub you can uncheck “Include administrators” and configure <strong>semantic-release</strong> to use an administrator user, so the plugin can push the release commit without requiring <a href="https://help.github.com/articles/about-required-status-checks">status checks</a> and <a href="https://help.github.com/articles/about-required-reviews-for-pull-requests">pull request reviews</a>.</p>
<h3 id="environment-variables">Environment variables</h3>
<table style="width:100%;">
<colgroup>
<col style="width: 9%" />
<col style="width: 73%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>GIT_AUTHOR_NAME</code></td>
<td>The author name associated with the release commit. See <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables#_committing">Git environment variables</a>.</td>
<td><span class="citation" data-cites="semantic-release-bot">@semantic-release-bot</span>.</td>
</tr>
<tr class="even">
<td><code>GIT_AUTHOR_EMAIL</code></td>
<td>The author email associated with the release commit. See <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables#_committing">Git environment variables</a>.</td>
<td><span class="citation" data-cites="semantic-release-bot">@semantic-release-bot</span> email address.</td>
</tr>
<tr class="odd">
<td><code>GIT_COMMITTER_NAME</code></td>
<td>The committer name associated with the release commit. See <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables#_committing">Git environment variables</a>.</td>
<td><span class="citation" data-cites="semantic-release-bot">@semantic-release-bot</span>.</td>
</tr>
<tr class="even">
<td><code>GIT_COMMITTER_EMAIL</code></td>
<td>The committer email associated with the release commit. See <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables#_committing">Git environment variables</a>.</td>
<td><span class="citation" data-cites="semantic-release-bot">@semantic-release-bot</span> email address.</td>
</tr>
</tbody>
</table>
<h3 id="options">Options</h3>
<table>
<colgroup>
<col style="width: 5%" />
<col style="width: 58%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="header">
<th>Options</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>message</code></td>
<td>The message for the release commit. See <a href="#message">message</a>.</td>
<td><code>chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}</code></td>
</tr>
<tr class="even">
<td><code>assets</code></td>
<td>Files to include in the release commit. Set to <code>false</code> to disable adding files to the release commit. See <a href="#assets">assets</a>.</td>
<td><code>['CHANGELOG.md', 'package.json', 'package-lock.json', 'npm-shrinkwrap.json']</code></td>
</tr>
</tbody>
</table>
<h4 id="message"><code>message</code></h4>
<p>The message for the release commit is generated with <a href="https://lodash.com/docs#template">Lodash template</a>. The following variables are available:</p>
<table>
<colgroup>
<col style="width: 13%" />
<col style="width: 86%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>branch</code></td>
<td>The branch from which the release is done.</td>
</tr>
<tr class="even">
<td><code>branch.name</code></td>
<td>The branch name.</td>
</tr>
<tr class="odd">
<td><code>branch.type</code></td>
<td>The <a href="https://github.com/semantic-release/semantic-release/blob/beta/docs/usage/workflow-configuration.md#branch-types">type of branch</a>.</td>
</tr>
<tr class="even">
<td><code>branch.channel</code></td>
<td>The distribution channel on which to publish releases from this branch.</td>
</tr>
<tr class="odd">
<td><code>branch.range</code></td>
<td>The range of <a href="https://semver.org">semantic versions</a> to support on this branch.</td>
</tr>
<tr class="even">
<td><code>branch.prerelease</code></td>
<td>The pre-release detonation to append to <a href="https://semver.org">semantic versions</a> released from this branch.</td>
</tr>
<tr class="odd">
<td><code>lastRelease</code></td>
<td><code>Object</code> with <code>version</code>, <code>gitTag</code> and <code>gitHead</code> of the last release.</td>
</tr>
<tr class="even">
<td><code>nextRelease</code></td>
<td><code>Object</code> with <code>version</code>, <code>gitTag</code>, <code>gitHead</code> and <code>notes</code> of the release being done.</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: It is recommended to include <code>[skip ci]</code> in the commit message to not trigger a new build. Some CI service support the <code>[skip ci]</code> keyword only in the subject of the message.</p>
<h5 id="message-examples"><code>message</code> examples</h5>
<p>The <code>message</code> <code>Release &lt;%= nextRelease.version %&gt; - &lt;%= new Date().toLocaleDateString('en-US', {year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' }) %&gt; [skip ci]\n\n&lt;%= nextRelease.notes %&gt;</code> will generate the commit message:</p>
<blockquote>
<p>Release v1.0.0 - Oct. 21, 2015 1:24 AM [skip ci]<br><br>## 1.0.0<br><br>### Features<br>* Generate 1.21 gigawatts of electricity<br>…</p>
</blockquote>
<h4 id="assets"><code>assets</code></h4>
<p>Can be an <code>Array</code> or a single entry. Each entry can be either: - a <a href="https://github.com/micromatch/micromatch#matching-features">glob</a> - or an <code>Object</code> with a <code>path</code> property containing a <a href="https://github.com/micromatch/micromatch#matching-features">glob</a>.</p>
<p>Each entry in the <code>assets</code> <code>Array</code> is globbed individually. A <a href="https://github.com/micromatch/micromatch#matching-features">glob</a> can be a <code>String</code> (<code>"dist/**/*.js"</code> or <code>"dist/mylib.js"</code>) or an <code>Array</code> of <code>String</code>s that will be globbed together (<code>["dist/**", "!**/*.css"]</code>).</p>
<p>If a directory is configured, all the files under this directory and its children will be included.</p>
<p><strong>Note</strong>: If a file has a match in <code>assets</code> it will be included even if it also has a match in <code>.gitignore</code>.</p>
<h5 id="assets-examples"><code>assets</code> examples</h5>
<p><code>'dist/*.js'</code>: include all <code>js</code> files in the <code>dist</code> directory, but not in its sub-directories.</p>
<p><code>'dist/**/*.js'</code>: include all <code>js</code> files in the <code>dist</code> directory and its sub-directories.</p>
<p><code>[['dist', '!**/*.css']]</code>: include all files in the <code>dist</code> directory and its sub-directories excluding the <code>css</code> files.</p>
<p><code>[['dist', '!**/*.css'], 'package.json']</code>: include <code>package.json</code> and all files in the <code>dist</code> directory and its sub-directories excluding the <code>css</code> files.</p>
<p><code>[['dist/**/*.{js,css}', '!**/*.min.*']]</code>: include all <code>js</code> and <code>css</code> files in the <code>dist</code> directory and its sub-directories excluding the minified version.</p>
<h3 id="examples">Examples</h3>
<p>When used with the <span class="citation" data-cites="semantic-release/changelog">[@semantic-release/changelog]</span>(https://github.com/semantic-release/changelog) or <span class="citation" data-cites="semantic-release/npm">[@semantic-release/npm]</span>(https://github.com/semantic-release/npm) plugins: - The <span class="citation" data-cites="semantic-release/changelog">[@semantic-release/changelog]</span>(https://github.com/semantic-release/changelog) plugin must be called first in order to update the changelog file so the <code>@semantic-release/git</code> and <span class="citation" data-cites="semantic-release/npm">[@semantic-release/npm]</span>(https://github.com/semantic-release/npm) plugins can include it in the release. - The <span class="citation" data-cites="semantic-release/npm">[@semantic-release/npm]</span>(https://github.com/semantic-release/npm) plugin must be called second in order to update the <code>package.json</code> file so the <code>@semantic-release/git</code> plugin can include it in the release commit.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="st">&quot;@semantic-release/commit-analyzer&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="st">&quot;@semantic-release/release-notes-generator&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="st">&quot;@semantic-release/changelog&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="st">&quot;@semantic-release/npm&quot;</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="st">&quot;@semantic-release/git&quot;</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="fu">}</span></a></code></pre></div>
<h3 id="gpg-signature">GPG signature</h3>
<p>Using GPG, you can <a href="https://git-scm.com/book/id/v2/Git-Tools-Signing-Your-Work">sign and verify tags and commits</a>. With GPG keys, the release tags and commits made by Semantic-release are verified and other people can trust that they were really were made by your account.</p>
<h4 id="generate-the-gpg-keys">Generate the GPG keys</h4>
<p>If you already have a GPG public and private key you can skip this step and go to the <a href="#get-the-gpg-keys-id-and-the-public-key-content">Get the GPG keys ID and the public key content</a> step.</p>
<p><a href="https://www.gnupg.org/download/#binary">Download and install the GPG command line tools</a> for your operating system.</p>
<p>Create a GPG key</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1">$ <span class="ex">gpg</span> --full-generate-key</a></code></pre></div>
<p>At the prompt select the <code>RSA and RSA</code> king of key, enter <code>4096</code> for the keysize, specify how long the key should be valid, enter yout name, the email associated with your Git hosted account and finally set a long and hard to guess passphrase.</p>
<h4 id="get-the-gpg-keys-id-and-the-public-key-content">Get the GPG keys ID and the public key content</h4>
<p>Use the <code>gpg --list-secret-keys --keyid-format LONG</code> command to list your GPG keys. From the list, copy the GPG key ID you just created.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1">$ <span class="ex">gpg</span> --list-secret-keys --keyid-format LONG</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="ex">/Users</span>/<span class="op">&lt;</span><span class="ex">user_home</span><span class="op">&gt;</span>/.gnupg/pubring.gpg</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="ex">---------------------------------------</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="ex">sec</span>   rsa4096/XXXXXXXXXXXXXXXX 2017-12-01 [SC]</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="ex">uid</span>                 <span class="op">&lt;</span>your_name<span class="op">&gt;</span> <span class="op">&lt;</span>your_email<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="ex">ssb</span>   rsa4096/YYYYYYYYYYYYYYYY 2017-12-01 [E]</a></code></pre></div>
<p>the GPG key ID if 16 character string, on the on the <code>sec</code> line, after <code>rsa4096</code>. In this example, the GPG key ID is <code>XXXXXXXXXXXXXXXX</code>.</p>
<p>Export the public key (replace XXXXXXXXXXXXXXXX with your key ID):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1">$ <span class="ex">gpg</span> --armor --export XXXXXXXXXXXXXXXX</a></code></pre></div>
<p>Copy your GPG key, beginning with —–BEGIN PGP PUBLIC KEY BLOCK—– and ending with —–END PGP PUBLIC KEY BLOCK—–</p>
<h4 id="add-the-gpg-key-to-your-git-hosted-account">Add the GPG key to your Git hosted account</h4>
<h5 id="add-the-gpg-key-to-github">Add the GPG key to GitHub</h5>
<p>In GitHub <strong>Settings</strong>, click on <strong>SSH and GPG keys</strong> in the sidebar, then on the <strong>New GPG Key</strong> button.</p>
<p>Paste the entire GPG key export previously and click the <strong>Add GPG Key</strong> button.</p>
<p>See <a href="https://help.github.com/articles/adding-a-new-gpg-key-to-your-github-account/">Adding a new GPG key to your GitHub account</a> for more details.</p>
<h3 id="use-the-gpg-key-to-sign-commit-and-tags-locally">Use the GPG key to sign commit and tags locally</h3>
<p>If you want to use this GPG to also sign the commits and tags you create on your local machine you can follow the instruction at <a href="https://git-scm.com/book/id/v2/Git-Tools-Signing-Your-Work">Git Tools - Signing Your Work</a> This step is optional and unrelated to Semantic-release.</p>
<h4 id="add-the-gpg-keys-to-your-ci-environment">Add the GPG keys to your CI environment</h4>
<p>Make the public and private GPG key available on the CI environment. Encrypt the keys, commit it to your repository and configure the CI environment to decrypt it.</p>
<h5 id="add-the-gpg-keys-to-travis-ci">Add the GPG keys to Travis CI</h5>
<p>Install the <a href="https://github.com/travis-ci/travis.rb#installation">Travis CLI</a>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">gem</span> install travis</a></code></pre></div>
<p><a href="https://github.com/travis-ci/travis.rb#login">Login</a> to Travis with the CLI:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1">$ <span class="ex">travis</span> login</a></code></pre></div>
<p>Add the following <a href="https://github.com/travis-ci/travis.rb#env">environment</a> variables to Travis: - <code>GPG_PASSPHRASE</code> to Travis with the value set during the <a href="#generate-the-gpg-keys">GPG keys generation</a> step - <code>GPG_KEY_ID</code> to Travis with the value of your GPG key ID retrieved during the <a href="#generate-the-gpg-keys">GPG keys generation</a> (replace XXXXXXXXXXXXXXXX with your key ID) - <code>GIT_EMAIL</code> with the email address you set during the <a href="#generate-the-gpg-keys">GPG keys generation</a> step - <code>GIT_USERNAME</code> with the name you set during the <a href="#generate-the-gpg-keys">GPG keys generation</a> step</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1">$ <span class="ex">travis</span> env set GPG_PASSPHRASE <span class="op">&lt;</span>gpg_passphrase<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-2" title="2">$ <span class="ex">travis</span> env set GPG_KEY_ID XXXXXXXXXXXXXXXX</a>
<a class="sourceLine" id="cb9-3" title="3">$ <span class="ex">travis</span> env set GIT_EMAIL <span class="op">&lt;</span>your_email<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-4" title="4">$ <span class="ex">travis</span> env set GIT_USERNAME <span class="op">&lt;</span>your_name<span class="op">&gt;</span></a></code></pre></div>
<p>From your repository root export your public and private GPG keys in the <code>git_gpg_keys.asc</code> (replace XXXXXXXXXXXXXXXX with your key ID):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1">$ <span class="ex">gpg</span> --export -a XXXXXXXXXXXXXXXX <span class="op">&gt;</span> git_gpg_keys.asc</a>
<a class="sourceLine" id="cb10-2" title="2">$ <span class="ex">gpg</span> --export-secret-key -a XXXXXXXXXXXXXXXX <span class="op">&gt;&gt;</span> git_gpg_keys.asc</a></code></pre></div>
<p><a href="https://github.com/travis-ci/travis.rb#encrypt">Encrypt</a> the <code>git_gpg_keys.asc</code> (public and private key) using a symmetric encryption (AES-256), and store the secret in a secure environment variable in the Travis environment:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1">$ <span class="ex">travis</span> encrypt-file git_gpg_keys.asc</a></code></pre></div>
<p>The <code>travis encrypt-file</code> will encrypt the keys into the <code>git_gpg_keys.asc.enc</code> file and output in the console the command to add to your <code>.travis.yml</code> file. It should look like <code>openssl aes-256-cbc -K $encrypted_AAAAAAAAAAAA_key -iv $encrypted_BBBBBBBBBBBB_iv -in git_gpg_keys.asc.enc -out git_gpg_keys.asc -d</code>.</p>
<p>Copy this command to your <code>.travis.yml</code> file in the <code>before_install</code> step. Change the output path to write the unencrypted key in <code>/tmp</code>: <code>-out git_gpg_keys.asc</code> =&gt; <code>/tmp/git_gpg_keys.asc</code>. This will avoid to commit / modify / delete the unencrypted keys by mistake on the CI. Then add the commands to decrypt the GPG keys and make it available to <code>git</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">before_install:</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="co"># Decrypt the git_gpg_keys.asc.enc key into /tmp/git_gpg_keys.asc</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">-</span> openssl aes-256-cbc -K $encrypted_AAAAAAAAAAAA_key -iv $encrypted_BBBBBBBBBBBB_iv -in git_gpg_keys.asc.enc -out /tmp/git_gpg_keys.asc -d</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="co"># Make sure only the current user can read the keys</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="kw">-</span> chmod 600 /tmp/git_gpg_keys.asc</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="co"># Import the gpg key</span></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="kw">-</span> gpg --batch --yes --import /tmp/git_gpg_keys.asc</a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="co"># Create a script that pass the passphrase to the gpg CLI called by git</span></a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="kw">-</span> echo <span class="st">&#39;/usr/bin/gpg2 --passphrase ${GPG_PASSPHRASE} --batch --no-tty &quot;$@&quot;&#39;</span> &gt; /tmp/gpg-with-passphrase &amp;&amp; chmod +x /tmp/gpg-with-passphrase</a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="co"># Configure git to use the script that passes the passphrase</span></a>
<a class="sourceLine" id="cb12-11" title="11">  <span class="kw">-</span> git config gpg.program <span class="st">&quot;/tmp/gpg-with-passphrase&quot;</span></a>
<a class="sourceLine" id="cb12-12" title="12">  <span class="co"># Configure git to sign the commits and tags</span></a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="kw">-</span> git config commit.gpgsign true</a>
<a class="sourceLine" id="cb12-14" title="14">  <span class="co"># Configure git to use your GPG key</span></a>
<a class="sourceLine" id="cb12-15" title="15">  <span class="kw">-</span> git config --global user.signingkey $<span class="kw">{</span>GPG_KEY_ID<span class="kw">}</span></a></code></pre></div>
<p>See <a href="https://docs.travis-ci.com/user/encrypting-files/">Encrypting Files</a> for more details.</p>
<p>Delete the local keys as it won’t be used anymore:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">$ <span class="fu">rm</span> git_gpg_keys.asc</a></code></pre></div>
<p>Commit the encrypted keys and the <code>.travis.yml</code> file to your repository:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">$ <span class="fu">git</span> add git_gpg_keys.asc.enc .travis.yml</a>
<a class="sourceLine" id="cb14-2" title="2">$ <span class="fu">git</span> commit -m <span class="st">&quot;ci(travis): Add the encrypted GPG keys&quot;</span></a>
<a class="sourceLine" id="cb14-3" title="3">$ <span class="fu">git</span> push</a></code></pre></div>
</body>
</html>
