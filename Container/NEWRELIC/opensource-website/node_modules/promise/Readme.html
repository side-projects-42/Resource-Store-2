<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Readme</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><a href="https://promisesaplus.com/"><img src="https://promisesaplus.com/assets/logo-small.png" align="right" /></a> # promise</p>
<p>This is a simple implementation of Promises. It is a super set of ES6 Promises designed to have readable, performant code and to provide just the extensions that are absolutely necessary for using promises today.</p>
<p>For detailed tutorials on its use, see www.promisejs.org</p>
<p><strong>N.B.</strong> This promise exposes internals via underscore (<code>_</code>) prefixed properties. If you use these, your code will break with each new release.</p>
<p><a href="https://travis-ci.org/then/promise"><img src="https://img.shields.io/travis/then/promise.svg?style=flat" alt="travis" /></a> <a href="https://david-dm.org/then/promise"><img src="https://img.shields.io/david/then/promise.svg?style=flat" alt="dep" /></a> <a href="https://npmjs.org/package/promise"><img src="https://img.shields.io/npm/v/promise.svg?style=flat" alt="npm" /></a> <a href="https://npmjs.org/package/promise"><img src="https://img.shields.io/npm/dm/promise.svg?style=flat" alt="downloads" /></a></p>
<h2 id="installation">Installation</h2>
<p><strong>Server:</strong></p>
<pre><code>$ npm install promise</code></pre>
<p><strong>Client:</strong></p>
<p>You can use browserify on the client, or use the pre-compiled script that acts as a polyfill.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://www.promisejs.org/polyfills/promise-6.1.0.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>Note that the <a href="https://github.com/es-shims/es5-shim">es5-shim</a> must be loaded before this library to support browsers pre IE9.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://cdnjs.cloudflare.com/ajax/libs/es5-shim/3.4.0/es5-shim.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<h2 id="usage">Usage</h2>
<p>The example below shows how you can load the promise library (in a way that works on both client and server using node or browserify). It then demonstrates creating a promise from scratch. You simply call <code>new Promise(fn)</code>. There is a complete specification for what is returned by this method in <a href="http://promises-aplus.github.com/promises-spec/">Promises/A+</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> Promise <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;promise&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">var</span> promise <span class="op">=</span> <span class="kw">new</span> <span class="at">Promise</span>(<span class="kw">function</span> (resolve<span class="op">,</span> reject) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="at">get</span>(<span class="st">&#39;http://www.google.com&#39;</span><span class="op">,</span> <span class="kw">function</span> (err<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="cf">if</span> (err) <span class="at">reject</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="cf">else</span> <span class="at">resolve</span>(res)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>If you need <a href="https://iojs.org/api/domain.html">domains</a> support, you should instead use:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> Promise <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;promise/domains&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>If you are in an environment that implements <code>setImmediate</code> and don’t want the optimisations provided by asap, you can use:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> Promise <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;promise/setimmediate&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>If you only want part of the features, e.g. just a pure ES6 polyfill:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> Promise <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;promise/lib/es6-extensions&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">// or require(&#39;promise/domains/es6-extensions&#39;);</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// or require(&#39;promise/setimmediate/es6-extensions&#39;);</span></a></code></pre></div>
<h2 id="unhandled-rejections">Unhandled Rejections</h2>
<p>By default, promises silence any unhandled rejections.</p>
<p>You can enable logging of unhandled ReferenceErrors and TypeErrors via:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="at">require</span>(<span class="st">&#39;promise/lib/rejection-tracking&#39;</span>).<span class="at">enable</span>()<span class="op">;</span></a></code></pre></div>
<p>Due to the performance cost, you should only do this during development.</p>
<p>You can enable logging of all unhandled rejections if you need to debug an exception you think is being swallowed by promises:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="at">require</span>(<span class="st">&#39;promise/lib/rejection-tracking&#39;</span>).<span class="at">enable</span>(</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="op">{</span><span class="dt">allRejections</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span></a>
<a class="sourceLine" id="cb9-3" title="3">)<span class="op">;</span></a></code></pre></div>
<p>Due to the high probability of false positives, I only recommend using this when debugging specific issues that you think may be being swallowed. For the preferred debugging method, see <code>Promise#done(onFulfilled, onRejected)</code>.</p>
<p><code>rejection-tracking.enable(options)</code> takes the following options:</p>
<ul>
<li>allRejections (<code>boolean</code>) - track all exceptions, not just reference errors and type errors. Note that this has a high probability of resulting in false positives if your code loads data optimisticly</li>
<li>whitelist (<code>Array&lt;ErrorConstructor&gt;</code>) - this defaults to <code>[ReferenceError, TypeError]</code> but you can override it with your own list of error constructors to track.</li>
<li><code>onUnhandled(id, error)</code> and <code>onHandled(id, error)</code> - you can use these to provide your own customised display for errors. Note that if possible you should indicate that the error was a false positive if <code>onHandled</code> is called. <code>onHandled</code> is only called if <code>onUnhandled</code> has already been called.</li>
</ul>
<p>To reduce the chance of false-positives there is a delay of up to 2 seconds before errors are logged. This means that if you attach an error handler within 2 seconds, it won’t be logged as a false positive. ReferenceErrors and TypeErrors are only subject to a 100ms delay due to the higher likelihood that the error is due to programmer error.</p>
<h2 id="api">API</h2>
<p>Before all examples, you will need:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">var</span> Promise <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;promise&#39;</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="new-promiseresolver">new Promise(resolver)</h3>
<p>This creates and returns a new promise. <code>resolver</code> must be a function. The <code>resolver</code> function is passed two arguments:</p>
<ol type="1">
<li><code>resolve</code> should be called with a single argument. If it is called with a non-promise value then the promise is fulfilled with that value. If it is called with a promise (A) then the returned promise takes on the state of that new promise (A).</li>
<li><code>reject</code> should be called with a single argument. The returned promise will be rejected with that argument.</li>
</ol>
<h3 id="static-functions">Static Functions</h3>
<p>These methods are invoked by calling <code>Promise.methodName</code>.</p>
<h4 id="promise.resolvevalue">Promise.resolve(value)</h4>
<p>(deprecated aliases: <code>Promise.from(value)</code>, <code>Promise.cast(value)</code>)</p>
<p>Converts values and foreign promises into Promises/A+ promises. If you pass it a value then it returns a Promise for that value. If you pass it something that is close to a promise (such as a jQuery attempt at a promise) it returns a Promise that takes on the state of <code>value</code> (rejected or fulfilled).</p>
<h4 id="promise.rejectvalue">Promise.reject(value)</h4>
<p>Returns a rejected promise with the given value.</p>
<h4 id="promise.allarray">Promise.all(array)</h4>
<p>Returns a promise for an array. If it is called with a single argument that <code>Array.isArray</code> then this returns a promise for a copy of that array with any promises replaced by their fulfilled values. e.g.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">Promise</span>.<span class="at">all</span>([<span class="va">Promise</span>.<span class="at">resolve</span>(<span class="st">&#39;a&#39;</span>)<span class="op">,</span> <span class="st">&#39;b&#39;</span><span class="op">,</span> <span class="va">Promise</span>.<span class="at">resolve</span>(<span class="st">&#39;c&#39;</span>)])</a>
<a class="sourceLine" id="cb11-2" title="2">  .<span class="at">then</span>(<span class="kw">function</span> (res) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="at">assert</span>(res[<span class="dv">0</span>] <span class="op">===</span> <span class="st">&#39;a&#39;</span>)</a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="at">assert</span>(res[<span class="dv">1</span>] <span class="op">===</span> <span class="st">&#39;b&#39;</span>)</a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="at">assert</span>(res[<span class="dv">2</span>] <span class="op">===</span> <span class="st">&#39;c&#39;</span>)</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="op">}</span>)</a></code></pre></div>
<h4 id="promise.denodeifyfn">Promise.denodeify(fn)</h4>
<p><em>Non Standard</em></p>
<p>Takes a function which accepts a node style callback and returns a new function that returns a promise instead.</p>
<p>e.g.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">var</span> read <span class="op">=</span> <span class="va">Promise</span>.<span class="at">denodeify</span>(<span class="va">fs</span>.<span class="at">readFile</span>)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">var</span> write <span class="op">=</span> <span class="va">Promise</span>.<span class="at">denodeify</span>(<span class="va">fs</span>.<span class="at">writeFile</span>)</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw">var</span> p <span class="op">=</span> <span class="at">read</span>(<span class="st">&#39;foo.json&#39;</span><span class="op">,</span> <span class="st">&#39;utf8&#39;</span>)</a>
<a class="sourceLine" id="cb12-7" title="7">  .<span class="at">then</span>(<span class="kw">function</span> (str) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="cf">return</span> <span class="at">write</span>(<span class="st">&#39;foo.json&#39;</span><span class="op">,</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="va">JSON</span>.<span class="at">parse</span>(str)<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="st">&#39;  &#39;</span>)<span class="op">,</span> <span class="st">&#39;utf8&#39;</span>)</a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="op">}</span>)</a></code></pre></div>
<h4 id="promise.nodeifyfn">Promise.nodeify(fn)</h4>
<p><em>Non Standard</em></p>
<p>The twin to <code>denodeify</code> is useful when you want to export an API that can be used by people who haven’t learnt about the brilliance of promises yet.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="va">Promise</span>.<span class="at">nodeify</span>(awesomeAPI)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">function</span> <span class="at">awesomeAPI</span>(a<span class="op">,</span> b) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="cf">return</span> <span class="at">download</span>(a<span class="op">,</span> b)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>If the last argument passed to <code>module.exports</code> is a function, then it will be treated like a node.js callback and not parsed on to the child function, otherwise the API will just return a promise.</p>
<h3 id="prototype-methods">Prototype Methods</h3>
<p>These methods are invoked on a promise instance by calling <code>myPromise.methodName</code></p>
<h3 id="promisethenonfulfilled-onrejected">Promise#then(onFulfilled, onRejected)</h3>
<p>This method follows the <a href="http://promises-aplus.github.io/promises-spec/">Promises/A+ spec</a>. It explains things very clearly so I recommend you read it.</p>
<p>Either <code>onFulfilled</code> or <code>onRejected</code> will be called and they will not be called more than once. They will be passed a single argument and will always be called asynchronously (in the next turn of the event loop).</p>
<p>If the promise is fulfilled then <code>onFulfilled</code> is called. If the promise is rejected then <code>onRejected</code> is called.</p>
<p>The call to <code>.then</code> also returns a promise. If the handler that is called returns a promise, the promise returned by <code>.then</code> takes on the state of that returned promise. If the handler that is called returns a value that is not a promise, the promise returned by <code>.then</code> will be fulfilled with that value. If the handler that is called throws an exception then the promise returned by <code>.then</code> is rejected with that exception.</p>
<h4 id="promisecatchonrejected">Promise#catch(onRejected)</h4>
<p>Sugar for <code>Promise#then(null, onRejected)</code>, to mirror <code>catch</code> in synchronous code.</p>
<h4 id="promisedoneonfulfilled-onrejected">Promise#done(onFulfilled, onRejected)</h4>
<p><em>Non Standard</em></p>
<p>The same semantics as <code>.then</code> except that it does not return a promise and any exceptions are re-thrown so that they can be logged (crashing the application in non-browser environments)</p>
<h4 id="promisenodeifycallback">Promise#nodeify(callback)</h4>
<p><em>Non Standard</em></p>
<p>If <code>callback</code> is <code>null</code> or <code>undefined</code> it just returns <code>this</code>. If <code>callback</code> is a function it is called with rejection reason as the first argument and result as the second argument (as per the node.js convention).</p>
<p>This lets you write API functions that look like:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">function</span> <span class="at">awesomeAPI</span>(foo<span class="op">,</span> bar<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="cf">return</span> <span class="at">internalAPI</span>(foo<span class="op">,</span> bar)</a>
<a class="sourceLine" id="cb14-3" title="3">    .<span class="at">then</span>(parseResult)</a>
<a class="sourceLine" id="cb14-4" title="4">    .<span class="at">then</span>(<span class="kw">null</span><span class="op">,</span> retryErrors)</a>
<a class="sourceLine" id="cb14-5" title="5">    .<span class="at">nodeify</span>(callback)</a>
<a class="sourceLine" id="cb14-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>People who use typical node.js style callbacks will be able to just pass a callback and get the expected behavior. The enlightened people can not pass a callback and will get awesome promises.</p>
<h2 id="license">License</h2>
<p>MIT</p>
</body>
</html>
