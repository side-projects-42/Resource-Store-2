<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="st">st</h1>
<p><a href="https://travis-ci.org/isaacs/st"><img src="https://api.travis-ci.org/isaacs/st.svg?branch=master" alt="Travis Status" /></a></p>
<p>A module for serving static files. Does etags, caching, etc.</p>
<h2 id="usage">USAGE</h2>
<p>Here are some very simple usage examples.</p>
<p>Just serve the files in the cwd at the root of the http server url:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> st <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;st&#39;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="va">http</span>.<span class="at">createServer</span>(</a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="at">st</span>(<span class="va">process</span>.<span class="at">cwd</span>())</a>
<a class="sourceLine" id="cb1-6" title="6">).<span class="at">listen</span>(<span class="dv">1337</span>)</a></code></pre></div>
<p>Serve the files in static under the /static url. Otherwise do a different thing:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> mount <span class="op">=</span> <span class="at">st</span>(<span class="op">{</span> <span class="dt">path</span><span class="op">:</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/static&#39;</span>)<span class="op">,</span> <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/static&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="va">http</span>.<span class="at">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">const</span> stHandled <span class="op">=</span> <span class="at">mount</span>(req<span class="op">,</span> res)</a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="cf">if</span> (stHandled)</a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="cf">return</span></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="cf">else</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;this is not a static file&#39;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10"><span class="op">}</span>).<span class="at">listen</span>(<span class="dv">1338</span>)</a></code></pre></div>
<p>The same sort of thing, but using an express middleware style:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> mount <span class="op">=</span> <span class="at">st</span>(<span class="op">{</span> <span class="dt">path</span><span class="op">:</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/static&#39;</span>)<span class="op">,</span> <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/static&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">http</span>.<span class="at">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="at">mount</span>(req<span class="op">,</span> res<span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;this is not a static file&#39;</span>))</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="op">}</span>).<span class="at">listen</span>(<span class="dv">1339</span>)</a></code></pre></div>
<p>Serve the files in static under the / url, but only if not some doing other thing:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> mount <span class="op">=</span> <span class="at">st</span>(<span class="op">{</span> <span class="dt">path</span><span class="op">:</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/static&#39;</span>)<span class="op">,</span> <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="va">http</span>.<span class="at">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="cf">if</span> (<span class="at">shouldDoThing</span>(req)) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="at">doTheThing</span>(req<span class="op">,</span> res)</a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="at">mount</span>(req<span class="op">,</span> res)</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="op">}</span>).<span class="at">listen</span>(<span class="dv">1340</span>)</a></code></pre></div>
<p>Serve the files in static under the / url, but don’t serve a 404 if the file isn’t found, so that the rest of the app can handle it:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">const</span> mount <span class="op">=</span> <span class="at">st</span>(<span class="op">{</span> <span class="dt">path</span><span class="op">:</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/static&#39;</span>)<span class="op">,</span> <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="dt">passthrough</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="va">http</span>.<span class="at">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="at">mount</span>(req<span class="op">,</span> res<span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;this is not a static file&#39;</span>))</a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">}</span>).<span class="at">listen</span>(<span class="dv">1341</span>)</a></code></pre></div>
<p>Serve the files with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">CORS</a> enabled, to serve static files to any domain:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">http</span>.<span class="at">createServer</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="at">st</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">   <span class="dt">path</span><span class="op">:</span> <span class="va">process</span>.<span class="at">cwd</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">   <span class="dt">cors</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-6" title="6">).<span class="at">listen</span>(<span class="dv">1337</span>)</a></code></pre></div>
<p>Pass some options to the <code>st</code> function, and it returns a handler function.</p>
<p>That handler function will return <code>true</code> if it handles the static request, or <code>false</code> if it doesn’t. (This is so that you can only serve static files if they’re in <code>/static</code> for example.)</p>
<p>Here are some options if you want to configure stuff. All of these are optional except <code>path</code> which tells it where to get stuff from.</p>
<p>If you pass a string instead of an object, then it’ll use the string as the path.</p>
<p>If you don’t specify a <code>url</code>, then it’ll mount on the <code>'/'</code> url, so <code>st({ path: './static/' })</code> will try to serve <code>./static/foo.html</code> when the user goes to <code>http://example.com/foo.html</code>. (Note: This behavior changed in st 0.2.0.)</p>
<p>Here are all the options described with their defaults values and a few possible settings you might choose to use:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> st <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;st&#39;</span>)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> mount <span class="op">=</span> <span class="at">st</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;resources/static/&#39;</span><span class="op">,</span> <span class="co">// resolved against the process cwd</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;static/&#39;</span><span class="op">,</span> <span class="co">// defaults to &#39;/&#39;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="dt">cache</span><span class="op">:</span> <span class="op">{</span> <span class="co">// specify cache:false to turn off caching entirely</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">fd</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">      <span class="dt">max</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// number of fd&#39;s to hang on to</span></a>
<a class="sourceLine" id="cb7-9" title="9">      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span><span class="op">,</span> <span class="co">// amount of ms before fd&#39;s expire</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="op">},</span></a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="dt">stat</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-13" title="13">      <span class="dt">max</span><span class="op">:</span> <span class="dv">5000</span><span class="op">,</span> <span class="co">// number of stat objects to hang on to</span></a>
<a class="sourceLine" id="cb7-14" title="14">      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// number of ms that stats are good for</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="op">},</span></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="dt">content</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-18" title="18">      <span class="dt">max</span><span class="op">:</span> <span class="dv">1024</span><span class="op">*</span><span class="dv">1024</span><span class="op">*</span><span class="dv">64</span><span class="op">,</span> <span class="co">// how much memory to use on caching contents</span></a>
<a class="sourceLine" id="cb7-19" title="19">      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// how long to cache contents for</span></a>
<a class="sourceLine" id="cb7-20" title="20">                              <span class="co">// if `false` does not set cache control headers</span></a>
<a class="sourceLine" id="cb7-21" title="21">      <span class="dt">cacheControl</span><span class="op">:</span> <span class="st">&#39;public, max-age=600&#39;</span> <span class="co">// to set an explicit cache-control</span></a>
<a class="sourceLine" id="cb7-22" title="22">                                          <span class="co">// header value</span></a>
<a class="sourceLine" id="cb7-23" title="23">    <span class="op">},</span></a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">    <span class="dt">index</span><span class="op">:</span> <span class="op">{</span> <span class="co">// irrelevant if not using index:true</span></a>
<a class="sourceLine" id="cb7-26" title="26">      <span class="dt">max</span><span class="op">:</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">8</span><span class="op">,</span> <span class="co">// how many bytes of autoindex html to cache</span></a>
<a class="sourceLine" id="cb7-27" title="27">      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// how long to store it for</span></a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="op">},</span></a>
<a class="sourceLine" id="cb7-29" title="29"></a>
<a class="sourceLine" id="cb7-30" title="30">    <span class="dt">readdir</span><span class="op">:</span> <span class="op">{</span> <span class="co">// irrelevant if not using index:true</span></a>
<a class="sourceLine" id="cb7-31" title="31">      <span class="dt">max</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// how many dir entries to cache</span></a>
<a class="sourceLine" id="cb7-32" title="32">      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// how long to cache them for</span></a>
<a class="sourceLine" id="cb7-33" title="33">    <span class="op">}</span></a>
<a class="sourceLine" id="cb7-34" title="34">  <span class="op">},</span></a>
<a class="sourceLine" id="cb7-35" title="35"></a>
<a class="sourceLine" id="cb7-36" title="36">  <span class="co">// indexing options</span></a>
<a class="sourceLine" id="cb7-37" title="37">  <span class="dt">index</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// auto-index, the default</span></a>
<a class="sourceLine" id="cb7-38" title="38">  <span class="dt">index</span><span class="op">:</span> <span class="st">&#39;index.html&#39;</span><span class="op">,</span> <span class="co">// use &#39;index.html&#39; file as the index</span></a>
<a class="sourceLine" id="cb7-39" title="39">  <span class="dt">index</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// return 404&#39;s for directories</span></a>
<a class="sourceLine" id="cb7-40" title="40"></a>
<a class="sourceLine" id="cb7-41" title="41">  <span class="dt">dot</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// default: return 403 for any url with a dot-file part</span></a>
<a class="sourceLine" id="cb7-42" title="42">  <span class="dt">dot</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// allow dot-files to be fetched normally</span></a>
<a class="sourceLine" id="cb7-43" title="43"></a>
<a class="sourceLine" id="cb7-44" title="44">  <span class="dt">passthrough</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// calls next/returns instead of returning a 404 error</span></a>
<a class="sourceLine" id="cb7-45" title="45">  <span class="dt">passthrough</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// returns a 404 when a file or an index is not found</span></a>
<a class="sourceLine" id="cb7-46" title="46"></a>
<a class="sourceLine" id="cb7-47" title="47">  <span class="dt">gzip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// default: compresses the response with gzip compression</span></a>
<a class="sourceLine" id="cb7-48" title="48">  <span class="dt">gzip</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// does not compress the response, even if client accepts gzip</span></a>
<a class="sourceLine" id="cb7-49" title="49"></a>
<a class="sourceLine" id="cb7-50" title="50">  <span class="dt">cors</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// default: static assets not accessible from other domains</span></a>
<a class="sourceLine" id="cb7-51" title="51">  <span class="dt">cors</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// static assets can be accessed from any domain</span></a>
<a class="sourceLine" id="cb7-52" title="52"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-53" title="53"></a>
<a class="sourceLine" id="cb7-54" title="54"><span class="co">// with bare node.js</span></a>
<a class="sourceLine" id="cb7-55" title="55"><span class="va">http</span>.<span class="at">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-56" title="56">  <span class="cf">if</span> (<span class="at">mount</span>(req<span class="op">,</span> res)) <span class="cf">return</span> <span class="co">// serving a static file</span></a>
<a class="sourceLine" id="cb7-57" title="57">  <span class="at">myCustomLogic</span>(req<span class="op">,</span> res)</a>
<a class="sourceLine" id="cb7-58" title="58"><span class="op">}</span>).<span class="at">listen</span>(PORT)</a>
<a class="sourceLine" id="cb7-59" title="59"></a>
<a class="sourceLine" id="cb7-60" title="60"><span class="co">// with express</span></a>
<a class="sourceLine" id="cb7-61" title="61"><span class="va">app</span>.<span class="at">use</span>(mount)</a>
<a class="sourceLine" id="cb7-62" title="62"><span class="co">// or</span></a>
<a class="sourceLine" id="cb7-63" title="63"><span class="va">app</span>.<span class="at">route</span>(<span class="st">&#39;/static/:fooblz&#39;</span><span class="op">,</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-64" title="64">  <span class="at">mount</span>(req<span class="op">,</span> res<span class="op">,</span> next) <span class="co">// will call next() if it doesn&#39;t do anything</span></a>
<a class="sourceLine" id="cb7-65" title="65"><span class="op">}</span>)</a></code></pre></div>
<p>On the command line:</p>
<pre><code>$ st -h
st
Static file server in node

Options:

-h --help             Show this help

-p --port PORT        Listen on PORT (default=1337)

-H --host HOST        Bind address HOST (default=*)

-l --localhost        Same as &quot;--host localhost&quot;

-d --dir DIRECTORY    Serve the contents of DIRECTORY (default=cwd)

-u --url MOUNTURL     Serve the contents at MOUNTURL mount path (default=/)

-i --index [INDEX]    Use the specified INDEX filename as the result
                      when a directory is requested.  Set to &quot;true&quot;
                      to turn autoindexing on, or &quot;false&quot; to turn it
                      off.  If no INDEX is provided, then it will turn
                      autoindexing on.  (default=true)

-ni --no-index        Same as &quot;--index false&quot;

-. --dot [DOT]        Allow .files to be served.  Set to &quot;false&quot; to
                      disable.

-n. --no-dot          Same as &quot;--dot false&quot;

-co --cors            Enable CORS to serve files to any domain.

-nc --no-cache        Turn off all caching.

-a --age AGE          Max age (in ms) of cache entries.</code></pre>
<h2 id="range-requests">Range Requests</h2>
<p>Range requests are not supported.</p>
<p>I’d love a patch to add support for them, but the spec is kind of confusing, and it’s not always a clear win if you’re not serving very large files, so it should come with some very comprehensive tests.</p>
<p>Thankfully, as far as I can tell, it’s always safe to serve the entire file to a request with a range header, so st does behave correctly, if not ideally in those situations. It’d be great to be able to do the better thing if the contents are cached, but still serve the full file if it’s not in cache (so that it can be cached for subsequent requests).</p>
<h2 id="memory-caching">Memory Caching</h2>
<p>To make things go as fast as possible, it is a good idea to set the cache limits as high as you can afford, given the amount of memory on your server. Serving buffers out of process memory will generally always be faster than hitting the file system.</p>
<h2 id="client-caching">Client Caching</h2>
<p>An etag header and last-modified will be attached to every request. If presented with an <code>if-none-match</code> or <code>if-modified-since</code>, then it’ll return a 304 in the appropriate conditions.</p>
<p>The etag is generated based on the dev, ino, and last modified date. Stat results are cached.</p>
<h2 id="compression">Compression</h2>
<p>If the request header claims to enjoy gzip encoding, and the filename does not end in ‘.gz’ or ‘.tgz’, then the response will be gzipped.</p>
<p>Gzipped bytes are not included in the calculation of cache sizes, so this utility will use a bit more memory than the cache.content.max and cache.index.max bytes would seem to allow. This will be less than double, and usually insignificant for normal web assets, but is important to consider if memory is at a premium.</p>
<p>Gzip compression can be disabled by setting <code>gzip: false</code> on the options passed into <code>st()</code>. This is useful if your application already handles gzipping responses by other means.</p>
<h2 id="filtering-output">Filtering Output</h2>
<p>If you want to do some fancy stuff to the file before sending it, you can attach a <code>res.filter = myFilterStream</code> thing to the response object before passing it to the mount function.</p>
<p>This is useful if you want to get the benefits of caching and gzipping and such, but serve stylus files as css, for example.</p>
<h2 id="security-status">Security Status</h2>
<p>Versions prior to 0.2.5 did not properly prevent folder traversal. Literal dots in a path were resolved out, but url encoded dots were not. Thus, a request like <code>/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd</code> would leak sensitive data from the server.</p>
<p>As of version 0.2.5, any <code>'/../'</code> in the request path, urlencoded or not, will be replaced with <code>'/'</code>. If your application depends on url traversal, then you are encouraged to please refactor so that you do not depend on having <code>..</code> in url paths, as this tends to expose data that you may be surprised to be exposing.</p>
<p>Consider using the <code>--localhost</code> setting if you don’t want other people on your local network to read the files served by the command line server. This may become the default in a future major version.</p>
</body>
</html>
