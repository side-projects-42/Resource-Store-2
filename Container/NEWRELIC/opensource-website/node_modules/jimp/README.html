<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<div data-align="center">
<img width="200" height="200"
    src="https://s3.amazonaws.com/pix.iemoji.com/images/emoji/apple/ios-11/256/crayon.png">
<h1>
Jimp
</h1>
<p>
JavaScript Image Manipulation Program
</p>
</div>
<p>The “JavaScript Image Manipulation Program” :-)</p>
<p>An image processing library for Node written entirely in JavaScript, with zero native dependencies.</p>
<p>The default jimp configuration.</p>
<p>Supported types:</p>
<ul>
<li><code>@jimp/jpeg</code></li>
<li><code>@jimp/png</code></li>
<li><code>@jimp/bmp</code></li>
<li><code>@jimp/tiff</code></li>
<li><code>@jimp/gif</code></li>
</ul>
<h2 id="installation">Installation</h2>
<p><code>npm install --save jimp</code></p>
<p>Example usage (Promise will never resolve if callback is passed):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> Jimp <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;jimp&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">// open a file called &quot;lenna.png&quot;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;lenna.png&#39;</span><span class="op">,</span> (err<span class="op">,</span> lenna) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="cf">if</span> (err) <span class="cf">throw</span> err<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" title="6">  lenna</a>
<a class="sourceLine" id="cb1-7" title="7">    .<span class="at">resize</span>(<span class="dv">256</span><span class="op">,</span> <span class="dv">256</span>) <span class="co">// resize</span></a>
<a class="sourceLine" id="cb1-8" title="8">    .<span class="at">quality</span>(<span class="dv">60</span>) <span class="co">// set JPEG quality</span></a>
<a class="sourceLine" id="cb1-9" title="9">    .<span class="at">greyscale</span>() <span class="co">// set greyscale</span></a>
<a class="sourceLine" id="cb1-10" title="10">    .<span class="at">write</span>(<span class="st">&#39;lena-small-bw.jpg&#39;</span>)<span class="op">;</span> <span class="co">// save</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Using promises:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;lenna.png&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">  .<span class="at">then</span>(lenna <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="cf">return</span> lenna</a>
<a class="sourceLine" id="cb2-4" title="4">      .<span class="at">resize</span>(<span class="dv">256</span><span class="op">,</span> <span class="dv">256</span>) <span class="co">// resize</span></a>
<a class="sourceLine" id="cb2-5" title="5">      .<span class="at">quality</span>(<span class="dv">60</span>) <span class="co">// set JPEG quality</span></a>
<a class="sourceLine" id="cb2-6" title="6">      .<span class="at">greyscale</span>() <span class="co">// set greyscale</span></a>
<a class="sourceLine" id="cb2-7" title="7">      .<span class="at">write</span>(<span class="st">&#39;lena-small-bw.jpg&#39;</span>)<span class="op">;</span> <span class="co">// save</span></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-9" title="9">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="va">console</span>.<span class="at">error</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="typescript-usage">TypeScript Usage</h2>
<p>If you’re using this library with TypeScript the method of importing slightly differs from JavaScript. Instead of using require, you must import it with ES6 default import scheme</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ts"><code class="sourceCode typescript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> Jimp <span class="im">from</span> <span class="st">&#39;jimp&#39;</span><span class="op">;</span></a></code></pre></div>
<p>This requires setting the <code>allowSyntheticDefaultImports</code> compiler option to <code>true</code> in your <code>tsconfig</code></p>
<p><strong>Note 1</strong>: <code>esModuleInterop</code> implicitly sets <code>allowSyntheticDefaultImports</code> to <code>true</code></p>
<p><strong>Note 2</strong>: <code>allowSyntheticDefaultImports</code> nor <code>esModuleInterop</code> change the runtime behavior of your code at all. They are just flags that tells TypeScript you need the compatibility they offer.</p>
<h2 id="module-build">Module Build</h2>
<p>If you’re using a web bundles (webpack, rollup, parcel) you can benefit from using the <code>module</code> build of jimp. Using the module build will allow your bundler to understand your code better and exclude things you aren’t using.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="im">import</span> Jimp <span class="im">from</span> <span class="st">&#39;jimp/es&#39;</span><span class="op">;</span></a></code></pre></div>
<h3 id="webpack">WebPack</h3>
<p>If you’re using webpack you can set <code>process.browser</code> to true and your build of jimp will exclude certain parts, making it load faster.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">plugins</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="kw">new</span> <span class="va">webpack</span>.<span class="at">DefinePlugin</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">      <span class="st">&#39;process.browser&#39;</span><span class="op">:</span> <span class="st">&#39;true&#39;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">    ...</a>
<a class="sourceLine" id="cb5-7" title="7">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="op">}</span></a></code></pre></div>
<h2 id="basic-usage">Basic usage</h2>
<p>The static <code>Jimp.read</code> method takes the path to a file, URL, dimensions, a Jimp instance or a buffer and returns a Promise:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;./path/to/image.jpg&#39;</span>)</a>
<a class="sourceLine" id="cb6-2" title="2">  .<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="co">// Do stuff with the image.</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-5" title="5">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="co">// Handle an exception.</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;http://www.example.com/path/to/lenna.jpg&#39;</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">  .<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">    <span class="co">// Do stuff with the image.</span></a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-13" title="13">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="co">// Handle an exception.</span></a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="va">Jimp</span>.<span class="at">read</span>(jimpInstance)</a>
<a class="sourceLine" id="cb6-18" title="18">  .<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-19" title="19">    <span class="co">// Do stuff with the image.</span></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-21" title="21">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-22" title="22">    <span class="co">// Handle an exception.</span></a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-24" title="24"></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="va">Jimp</span>.<span class="at">read</span>(buffer)</a>
<a class="sourceLine" id="cb6-26" title="26">  .<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-27" title="27">    <span class="co">// Do stuff with the image.</span></a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-29" title="29">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-30" title="30">    <span class="co">// Handle an exception.</span></a>
<a class="sourceLine" id="cb6-31" title="31">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>In some cases, you need to pass additional parameters with an image’s URL. You can pass an object to the <code>Jimp.read</code> method:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;http://www.example.com/path/to/lenna.jpg&#39;</span><span class="op">,</span> <span class="co">// Required!</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="dt">headers</span><span class="op">:</span> <span class="op">{},</span></a>
<a class="sourceLine" id="cb7-4" title="4">  ...</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-6" title="6">  .<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="co">// Do stuff with the image.</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-9" title="9">  .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="co">// Handle an exception.</span></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Jimp uses <a href="https://github.com/ethanent/phin">phin</a> as it’s HTTP client. Phin uses <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_http_request_options_callback"><code>http.request(options[, callback])</code></a> or <a href="https://nodejs.org/dist/latest-v8.x/docs/api/https.html#https_https_request_options_callback"><code>https.request(options[, callback])</code></a> methods for making HTTP requests. Phin parses a <code>url</code> with the <code>url.parse(...)</code> method and passes it with all the other parameters as an <code>options</code> to the <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_http_request_options_callback"><code>http.request(options[, callback])</code></a> or <a href="https://nodejs.org/dist/latest-v8.x/docs/api/https.html#https_https_request_options_callback"><code>https.request(options[, callback])</code></a> methods.</p>
<p>Briefly speaking, you can pass any options from <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_http_request_options_callback"><code>http.request(options[, callback])</code></a>, <a href="https://nodejs.org/dist/latest-v8.x/docs/api/https.html#https_https_request_options_callback"><code>https.request(options[, callback])</code></a> or even <a href="https://nodejs.org/dist/latest-v8.x/docs/api/tls.html#tls_tls_connect_options_callback"><code>tls.connect(options[, callback])</code></a>.</p>
<p>Phin parses a <code>url</code> and combines it with any options you want. This behavior can be very useful when you need to pass some additional <code>headers</code>. Also, you can pass <code>rejectUnauthorized: false</code> if you don’t require an SSL certificate to be valid (it helps to prevent <code>unable to verify the first certificate</code> error).</p>
<p>The convenience method <code>Jimp.create</code> also exists. It is just a wrapper around <code>Jimp.read</code>.</p>
<h3 id="custom-constructor">Custom Constructor</h3>
<p>You might want to initialize jimp in so custom way. To do this Jimp exposes the static function <code>appendConstructorOption</code>. The appended constructor options run after all the defaults.</p>
<p>To define a custom constructor provide a name for it, a function to call to determine if the arguments provided to jimp match your constructor, and a function called where you can construct the image however you want.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="va">Jimp</span>.<span class="at">appendConstructorOption</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="st">&#39;Name of Option&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">  args <span class="kw">=&gt;</span> <span class="va">arg</span>.<span class="at">hasSomeCustomThing</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="kw">function</span>(resolve<span class="op">,</span> reject<span class="op">,</span> args) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-5" title="5">    <span class="kw">this</span>.<span class="at">bitmap</span> <span class="op">=</span> <span class="at">customParser</span>(args)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="at">resolve</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb8-8" title="8">)<span class="op">;</span></a></code></pre></div>
<p>If you don’t want to handle parsing the bitmap. For example if you want to do some sort of authentication for URL request. Jimp exposes <code>parseBitmap</code> so you can fall back to jimp to do the heavy lifting.</p>
<p>Parse bitmap takes the raw image data in a Buffer, a path (optional), and a node style callback.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">Jimp</span>.<span class="at">appendConstructorOption</span>(<span class="st">&#39;Custom Url&#39;</span><span class="op">,</span> options <span class="kw">=&gt;</span> <span class="va">options</span>.<span class="at">url</span><span class="op">,</span> <span class="kw">function</span>(</a>
<a class="sourceLine" id="cb9-2" title="2">  resolve<span class="op">,</span></a>
<a class="sourceLine" id="cb9-3" title="3">  reject<span class="op">,</span></a>
<a class="sourceLine" id="cb9-4" title="4">  options</a>
<a class="sourceLine" id="cb9-5" title="5">) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="at">phin</span>(options<span class="op">,</span> (err<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-7" title="7">    <span class="cf">if</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-8" title="8">      <span class="cf">return</span> <span class="at">reject</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11">    <span class="kw">this</span>.<span class="at">parseBitmap</span>(<span class="va">res</span>.<span class="at">body</span><span class="op">,</span> <span class="va">options</span>.<span class="at">url</span><span class="op">,</span> err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-12" title="12">      <span class="cf">if</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-13" title="13">        <span class="cf">return</span> <span class="at">reject</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-14" title="14">      <span class="op">}</span></a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16">      <span class="at">resolve</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="methods">Methods</h3>
<p>Once the promise is fulfilled, the following methods can be called on the image:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">/* Resize */</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="va">image</span>.<span class="at">contain</span>( w<span class="op">,</span> h[<span class="op">,</span> alignBits <span class="op">||</span> mode<span class="op">,</span> mode] )<span class="op">;</span>    <span class="co">// scale the image to the given width and height, some parts of the image may be letter boxed</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="va">image</span>.<span class="at">cover</span>( w<span class="op">,</span> h[<span class="op">,</span> alignBits <span class="op">||</span> mode<span class="op">,</span> mode] )<span class="op">;</span>      <span class="co">// scale the image to the given width and height, some parts of the image may be clipped</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="va">image</span>.<span class="at">resize</span>( w<span class="op">,</span> h[<span class="op">,</span> mode] )<span class="op">;</span>     <span class="co">// resize the image. Jimp.AUTO can be passed as one of the values.</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="va">image</span>.<span class="at">scale</span>( f[<span class="op">,</span> mode] )<span class="op">;</span>         <span class="co">// scale the image by the factor f</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="va">image</span>.<span class="at">scaleToFit</span>( w<span class="op">,</span> h[<span class="op">,</span> mode] )<span class="op">;</span> <span class="co">// scale the image to the largest size that fits inside the given width and height</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="co">// An optional resize mode can be passed with all resize methods.</span></a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">/* Crop */</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="va">image</span>.<span class="at">autocrop</span>([tolerance<span class="op">,</span> frames])<span class="op">;</span> <span class="co">// automatically crop same-color borders from image (if any), frames must be a Boolean</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="va">image</span>.<span class="at">autocrop</span>(options)<span class="op">;</span>          <span class="co">// automatically crop same-color borders from image (if any), options may contain tolerance, cropOnlyFrames, cropSymmetric, leaveBorder</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="va">image</span>.<span class="at">crop</span>( x<span class="op">,</span> y<span class="op">,</span> w<span class="op">,</span> h )<span class="op">;</span>         <span class="co">// crop to the given region</span></a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">/* Composing */</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="va">image</span>.<span class="at">blit</span>( src<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> [srcx<span class="op">,</span> srcy<span class="op">,</span> srcw<span class="op">,</span> srch] )<span class="op">;</span></a>
<a class="sourceLine" id="cb10-17" title="17">                                  <span class="co">// blit the image with another Jimp image at x, y, optionally cropped.</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="va">image</span>.<span class="at">composite</span>( src<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> [<span class="op">{</span> mode<span class="op">,</span> opacitySource<span class="op">,</span> opacityDest <span class="op">}</span>] )<span class="op">;</span>     <span class="co">// composites another Jimp image over this image at x, y</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="va">image</span>.<span class="at">mask</span>( src<span class="op">,</span> x<span class="op">,</span> y )<span class="op">;</span>          <span class="co">// masks the image with another Jimp image at x, y using average pixel value</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="va">image</span>.<span class="at">convolute</span>( kernel )<span class="op">;</span>        <span class="co">// applies a convolution kernel matrix to the image or a region</span></a>
<a class="sourceLine" id="cb10-21" title="21"></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">/* Flip and rotate */</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="va">image</span>.<span class="at">flip</span>( horz<span class="op">,</span> vert )<span class="op">;</span>         <span class="co">// flip the image horizontally or vertically</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="va">image</span>.<span class="at">mirror</span>( horz<span class="op">,</span> vert )<span class="op">;</span>       <span class="co">// an alias for flip</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="va">image</span>.<span class="at">rotate</span>( deg[<span class="op">,</span> mode] )<span class="op">;</span>      <span class="co">// rotate the image clockwise by a number of degrees. Optionally, a resize mode can be passed. If `false` is passed as the second parameter, the image width and height will not be resized.</span></a>
<a class="sourceLine" id="cb10-26" title="26"></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">/* Colour */</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="va">image</span>.<span class="at">brightness</span>( val )<span class="op">;</span>          <span class="co">// adjust the brighness by a value -1 to +1</span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="va">image</span>.<span class="at">contrast</span>( val )<span class="op">;</span>            <span class="co">// adjust the contrast by a value -1 to +1</span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="va">image</span>.<span class="at">dither565</span>()<span class="op">;</span>                <span class="co">// ordered dithering of the image and reduce color space to 16-bits (RGB565)</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="va">image</span>.<span class="at">greyscale</span>()<span class="op">;</span>                <span class="co">// remove colour from the image</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="va">image</span>.<span class="at">invert</span>()<span class="op">;</span>                   <span class="co">// invert the image colours</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="va">image</span>.<span class="at">normalize</span>()<span class="op">;</span>                <span class="co">// normalize the channels in an image</span></a>
<a class="sourceLine" id="cb10-34" title="34"></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="co">/* Alpha channel */</span></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="va">image</span>.<span class="at">hasAlpha</span>()<span class="op">;</span>                     <span class="co">// determines if an image contains opaque pixels</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="va">image</span>.<span class="at">fade</span>( f )<span class="op">;</span>                  <span class="co">// an alternative to opacity, fades the image by a factor 0 - 1. 0 will haven no effect. 1 will turn the image</span></a>
<a class="sourceLine" id="cb10-38" title="38"><span class="va">image</span>.<span class="at">opacity</span>( f )<span class="op">;</span>               <span class="co">// multiply the alpha channel by each pixel by the factor f, 0 - 1</span></a>
<a class="sourceLine" id="cb10-39" title="39"><span class="va">image</span>.<span class="at">opaque</span>()<span class="op">;</span>                   <span class="co">// set the alpha channel on every pixel to fully opaque</span></a>
<a class="sourceLine" id="cb10-40" title="40"><span class="va">image</span>.<span class="at">background</span>( hex )<span class="op">;</span>          <span class="co">// set the default new pixel colour (e.g. 0xFFFFFFFF or 0x00000000) for by some operations (e.g. image.contain and</span></a>
<a class="sourceLine" id="cb10-41" title="41"></a>
<a class="sourceLine" id="cb10-42" title="42"><span class="co">/* Blurs */</span></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="va">image</span>.<span class="at">gaussian</span>( r )<span class="op">;</span>              <span class="co">// Gaussian blur the image by r pixels (VERY slow)</span></a>
<a class="sourceLine" id="cb10-44" title="44"><span class="va">image</span>.<span class="at">blur</span>( r )<span class="op">;</span>                  <span class="co">// fast blur the image by r pixels</span></a>
<a class="sourceLine" id="cb10-45" title="45"></a>
<a class="sourceLine" id="cb10-46" title="46"><span class="co">/* Effects */</span></a>
<a class="sourceLine" id="cb10-47" title="47"><span class="va">image</span>.<span class="at">posterize</span>( n )<span class="op">;</span>             <span class="co">// apply a posterization effect with n level</span></a>
<a class="sourceLine" id="cb10-48" title="48"><span class="va">image</span>.<span class="at">sepia</span>()<span class="op">;</span>                    <span class="co">// apply a sepia wash to the image</span></a>
<a class="sourceLine" id="cb10-49" title="49"><span class="va">image</span>.<span class="at">pixelate</span>( size[<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> w<span class="op">,</span> h ])<span class="op">;</span>  <span class="co">// apply a pixelation effect to the image or a region</span></a>
<a class="sourceLine" id="cb10-50" title="50"></a>
<a class="sourceLine" id="cb10-51" title="51"><span class="co">/* 3D */</span></a>
<a class="sourceLine" id="cb10-52" title="52"><span class="va">image</span>.<span class="at">displace</span>( map<span class="op">,</span> offset )<span class="op">;</span>    <span class="co">// displaces the image pixels based on the provided displacement map. Useful for making stereoscopic 3D images.</span></a></code></pre></div>
<p>Some of these methods are irreversible, so it can be useful to perform them on a clone of the original image:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">image</span>.<span class="at">clone</span>()<span class="op">;</span> <span class="co">// returns a clone of the image</span></a></code></pre></div>
<p>(Contributions of more methods are welcome!)</p>
<h3 id="resize-modes">Resize modes</h3>
<p>The default resizing algorithm uses a bilinear method as follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="va">image</span>.<span class="at">resize</span>(<span class="dv">250</span><span class="op">,</span> <span class="dv">250</span>)<span class="op">;</span> <span class="co">// resize the image to 250 x 250</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="va">image</span>.<span class="at">resize</span>(<span class="va">Jimp</span>.<span class="at">AUTO</span><span class="op">,</span> <span class="dv">250</span>)<span class="op">;</span> <span class="co">// resize the height to 250 and scale the width accordingly</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="va">image</span>.<span class="at">resize</span>(<span class="dv">250</span><span class="op">,</span> <span class="va">Jimp</span>.<span class="at">AUTO</span>)<span class="op">;</span> <span class="co">// resize the width to 250 and scale the height accordingly</span></a></code></pre></div>
<p>Optionally, the following constants can be passed to choose a particular resizing algorithm:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="va">Jimp</span>.<span class="at">RESIZE_NEAREST_NEIGHBOR</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="va">Jimp</span>.<span class="at">RESIZE_BILINEAR</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="va">Jimp</span>.<span class="at">RESIZE_BICUBIC</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="va">Jimp</span>.<span class="at">RESIZE_HERMITE</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="va">Jimp</span>.<span class="at">RESIZE_BEZIER</span><span class="op">;</span></a></code></pre></div>
<p>For example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="va">image</span>.<span class="at">resize</span>(<span class="dv">250</span><span class="op">,</span> <span class="dv">250</span><span class="op">,</span> <span class="va">Jimp</span>.<span class="at">RESIZE_BEZIER</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="align-modes">Align modes</h3>
<p>The following constants can be passed to the <code>image.cover</code>, <code>image.contain</code> and <code>image.print</code> methods:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_LEFT</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_CENTER</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_RIGHT</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_TOP</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_MIDDLE</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_BOTTOM</span><span class="op">;</span></a></code></pre></div>
<p>Where the align mode changes the position of the associated axis as described in the table below.</p>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="header">
<th>Align Mode</th>
<th>Axis Point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Jimp.HORIZONTAL_ALIGN_LEFT</code></td>
<td>Positions the x-axis at the left of the image</td>
</tr>
<tr class="even">
<td><code>Jimp.HORIZONTAL_ALIGN_CENTER</code></td>
<td>Positions the x-axis at the center of the image</td>
</tr>
<tr class="odd">
<td><code>Jimp.HORIZONTAL_ALIGN_RIGHT</code></td>
<td>Positions the x-axis at the right of the image</td>
</tr>
<tr class="even">
<td><code>Jimp.VERTICAL_ALIGN_TOP</code></td>
<td>Positions the y-axis at the top of the image</td>
</tr>
<tr class="odd">
<td><code>Jimp.VERTICAL_ALIGN_MIDDLE</code></td>
<td>Positions the y-axis at the center of the image</td>
</tr>
<tr class="even">
<td><code>Jimp.VERTICAL_ALIGN_BOTTOM</code></td>
<td>Positions the y-axis at the bottom of the image</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">image</span>.<span class="at">contain</span>(<span class="dv">250</span><span class="op">,</span> <span class="dv">250</span><span class="op">,</span> <span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_LEFT</span> <span class="op">|</span> <span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_TOP</span>)<span class="op">;</span></a></code></pre></div>
<p>Default align modes for <code>image.cover</code> and <code>image.contain</code> are:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_CENTER</span> <span class="op">|</span> <span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_MIDDLE</span><span class="op">;</span></a></code></pre></div>
<p>Default align modes for <code>image.print</code> are:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">    <span class="dt">alignmentX</span><span class="op">:</span> <span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_LEFT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-3" title="3">    <span class="dt">alignmentY</span><span class="op">:</span> <span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_TOP</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="op">}</span></a></code></pre></div>
<h3 id="compositing-and-blend-modes">Compositing and blend modes</h3>
<p>The following modes can be used for compositing two images together. mode defaults to Jimp.BLEND_SOURCE_OVER.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="va">Jimp</span>.<span class="at">BLEND_SOURCE_OVER</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="va">Jimp</span>.<span class="at">BLEND_DESTINATION_OVER</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="va">Jimp</span>.<span class="at">BLEND_MULTIPLY</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="va">Jimp</span>.<span class="at">BLEND_ADD</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="va">Jimp</span>.<span class="at">BLEND_SCREEN</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="va">Jimp</span>.<span class="at">BLEND_OVERLAY</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="va">Jimp</span>.<span class="at">BLEND_DARKEN</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="va">Jimp</span>.<span class="at">BLEND_LIGHTEN</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="va">Jimp</span>.<span class="at">BLEND_HARDLIGHT</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="va">Jimp</span>.<span class="at">BLEND_DIFFERENCE</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="va">Jimp</span>.<span class="at">BLEND_EXCLUSION</span><span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="va">image</span>.<span class="at">composite</span>(srcImage<span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="dt">mode</span><span class="op">:</span> <span class="va">Jimp</span>.<span class="at">BLEND_MULTIPLY</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="dt">opacitySource</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="dt">opacityDest</span><span class="op">:</span> <span class="fl">0.9</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="writing-text">Writing text</h3>
<p>Jimp supports basic typography using BMFont format (.fnt) even ones in different languages! Just find a bitmap font that is suitable <a href="https://en.wikipedia.org/wiki/Bitmap_fonts">bitmap fonts</a>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1"><span class="va">Jimp</span>.<span class="at">loadFont</span>(pathOrURL).<span class="at">then</span>(font <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="co">// load font from .fnt file</span></a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="va">image</span>.<span class="at">print</span>(font<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> message)<span class="op">;</span> <span class="co">// print a message on an image. message can be a any type</span></a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="va">image</span>.<span class="at">print</span>(font<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> message<span class="op">,</span> maxWidth)<span class="op">;</span> <span class="co">// print a message on an image with text wrapped at maxWidth</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Alignment modes are supported by replacing the <code>str</code> argument with an object containing <code>text</code>, <code>alignmentX</code> and <code>alignmentY</code>. <code>alignmentX</code> defaults to <code>Jimp.HORIZONTAL_ALIGN_LEFT</code> and <code>alignmentY</code> defaults to <code>Jimp.VERTICAL_ALIGN_TOP</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1"><span class="va">Jimp</span>.<span class="at">loadFont</span>(pathOrURL).<span class="at">then</span>(font <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">  <span class="va">image</span>.<span class="at">print</span>(</a>
<a class="sourceLine" id="cb22-3" title="3">    font<span class="op">,</span></a>
<a class="sourceLine" id="cb22-4" title="4">    x<span class="op">,</span></a>
<a class="sourceLine" id="cb22-5" title="5">    y<span class="op">,</span></a>
<a class="sourceLine" id="cb22-6" title="6">    <span class="op">{</span></a>
<a class="sourceLine" id="cb22-7" title="7">      <span class="dt">text</span><span class="op">:</span> <span class="st">&#39;Hello world!&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-8" title="8">      <span class="dt">alignmentX</span><span class="op">:</span> <span class="va">Jimp</span>.<span class="at">HORIZONTAL_ALIGN_CENTER</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-9" title="9">      <span class="dt">alignmentY</span><span class="op">:</span> <span class="va">Jimp</span>.<span class="at">VERTICAL_ALIGN_MIDDLE</span></a>
<a class="sourceLine" id="cb22-10" title="10">    <span class="op">},</span></a>
<a class="sourceLine" id="cb22-11" title="11">    maxWidth<span class="op">,</span></a>
<a class="sourceLine" id="cb22-12" title="12">    maxHeight</a>
<a class="sourceLine" id="cb22-13" title="13">  )<span class="op">;</span> <span class="co">// prints &#39;Hello world!&#39; on an image, middle and center-aligned, when x = 0 and y = 0</span></a>
<a class="sourceLine" id="cb22-14" title="14"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1"><span class="va">Jimp</span>.<span class="at">loadFont</span>(path<span class="op">,</span> cb)<span class="op">;</span> <span class="co">// using a callback pattern</span></a></code></pre></div>
<p>BMFont fonts are raster based and fixed in size and colour. Jimp comes with a set of fonts that can be used on images:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="va">Jimp</span>.<span class="at">FONT_SANS_8_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 8px, black</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="va">Jimp</span>.<span class="at">FONT_SANS_10_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 10px, black</span></a>
<a class="sourceLine" id="cb24-3" title="3"><span class="va">Jimp</span>.<span class="at">FONT_SANS_12_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 12px, black</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="va">Jimp</span>.<span class="at">FONT_SANS_14_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 14px, black</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="va">Jimp</span>.<span class="at">FONT_SANS_16_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 16px, black</span></a>
<a class="sourceLine" id="cb24-6" title="6"><span class="va">Jimp</span>.<span class="at">FONT_SANS_32_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 32px, black</span></a>
<a class="sourceLine" id="cb24-7" title="7"><span class="va">Jimp</span>.<span class="at">FONT_SANS_64_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 64px, black</span></a>
<a class="sourceLine" id="cb24-8" title="8"><span class="va">Jimp</span>.<span class="at">FONT_SANS_128_BLACK</span><span class="op">;</span> <span class="co">// Open Sans, 128px, black</span></a>
<a class="sourceLine" id="cb24-9" title="9"></a>
<a class="sourceLine" id="cb24-10" title="10"><span class="va">Jimp</span>.<span class="at">FONT_SANS_8_WHITE</span><span class="op">;</span> <span class="co">// Open Sans, 8px, white</span></a>
<a class="sourceLine" id="cb24-11" title="11"><span class="va">Jimp</span>.<span class="at">FONT_SANS_16_WHITE</span><span class="op">;</span> <span class="co">// Open Sans, 16px, white</span></a>
<a class="sourceLine" id="cb24-12" title="12"><span class="va">Jimp</span>.<span class="at">FONT_SANS_32_WHITE</span><span class="op">;</span> <span class="co">// Open Sans, 32px, white</span></a>
<a class="sourceLine" id="cb24-13" title="13"><span class="va">Jimp</span>.<span class="at">FONT_SANS_64_WHITE</span><span class="op">;</span> <span class="co">// Open Sans, 64px, white</span></a>
<a class="sourceLine" id="cb24-14" title="14"><span class="va">Jimp</span>.<span class="at">FONT_SANS_128_WHITE</span><span class="op">;</span> <span class="co">// Open Sans, 128px, white</span></a></code></pre></div>
<p>These can be used as follows:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="va">Jimp</span>.<span class="at">loadFont</span>(<span class="va">Jimp</span>.<span class="at">FONT_SANS_32_BLACK</span>).<span class="at">then</span>(font <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">  <span class="va">image</span>.<span class="at">print</span>(font<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">&#39;Hello world!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb25-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h4 id="measuring-text">Measuring text</h4>
<p>If you need to do calculations on where to place your text jimp provides two methods that measure how wide and how tall a piece of text will be. You can use these methods to lay out multiple pieces of text in relation to each other</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="va">Jimp</span>.<span class="at">measureText</span>(<span class="va">Jimp</span>.<span class="at">FONT_SANS_32_BLACK</span><span class="op">,</span> <span class="st">&#39;Some string&#39;</span>)<span class="op">;</span> <span class="co">// width of text</span></a>
<a class="sourceLine" id="cb26-2" title="2"><span class="va">Jimp</span>.<span class="at">measureTextHeight</span>(<span class="va">Jimp</span>.<span class="at">FONT_SANS_32_BLACK</span><span class="op">,</span> <span class="st">&#39;Some string&#39;</span><span class="op">,</span> <span class="dv">100</span>)<span class="op">;</span> <span class="co">// height of text</span></a></code></pre></div>
<h4 id="staggering-text">Staggering Text</h4>
<p>If you need to stagger text position along the x or y-axis the print method also returns the final coordinates as an argument to the callback.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1"><span class="va">Jimp</span>.<span class="at">loadFont</span>(<span class="va">Jimp</span>.<span class="at">FONT_SANS_32_BLACK</span>).<span class="at">then</span>(font <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb27-2" title="2">  <span class="va">image</span>.<span class="at">print</span>(</a>
<a class="sourceLine" id="cb27-3" title="3">    font<span class="op">,</span></a>
<a class="sourceLine" id="cb27-4" title="4">    <span class="dv">10</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-5" title="5">    <span class="dv">10</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-6" title="6">    <span class="st">&#39;Hello world that wraps!&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-7" title="7">    <span class="dv">50</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-8" title="8">    (err<span class="op">,</span> image<span class="op">,</span> <span class="op">{</span> x<span class="op">,</span> y <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb27-9" title="9">      <span class="va">image</span>.<span class="at">print</span>(font<span class="op">,</span> x<span class="op">,</span> y <span class="op">+</span> <span class="dv">20</span><span class="op">,</span> <span class="st">&#39;More text on another line&#39;</span><span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb27-11" title="11">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Online tools are also available to convert TTF fonts to BMFont format. They can be used to create color font or sprite packs.</p>
<p>:star: <a href="http://kvazars.com/littera/">Littera</a></p>
<p>:star: <a href="https://github.com/libgdx/libgdx/wiki/Hiero">Hiero</a></p>
<h2 id="writing-to-files-and-buffers">Writing to files and buffers</h2>
<h3 id="writing-to-files">Writing to files</h3>
<p>The image can be written to disk in PNG, JPEG or BMP format (based on the save path extension or if no extension is provided the original image’s MIME type which, if not available, defaults to PNG) using:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1"><span class="va">image</span>.<span class="at">write</span>(path<span class="op">,</span> cb)<span class="op">;</span> <span class="co">// Node-style callback will be fired when write is successful</span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="va">image</span>.<span class="at">writeAsync</span>(path)<span class="op">;</span> <span class="co">// Returns Promise</span></a></code></pre></div>
<p>The original extension for an image (or “png”) can accessed as using <code>image.getExtension()</code>. The following will save an image using its original format:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">var</span> file <span class="op">=</span> <span class="st">&#39;new_name.&#39;</span> <span class="op">+</span> <span class="va">image</span>.<span class="at">getExtension</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="co">//or</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="kw">var</span> file <span class="op">=</span> <span class="st">&#39;new_name&#39;</span><span class="op">;</span> <span class="co">// with no extension</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="va">image</span>.<span class="at">write</span>(file)<span class="op">;</span></a></code></pre></div>
<h3 id="writing-to-buffers">Writing to Buffers</h3>
<p>A PNG, JPEG or BMP binary Buffer of an image (e.g. for storage in a database) can be generated using:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1"><span class="va">image</span>.<span class="at">getBuffer</span>(mime<span class="op">,</span> cb)<span class="op">;</span> <span class="co">// Node-style callback will be fired with result</span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="va">image</span>.<span class="at">getBufferAsync</span>(mime)<span class="op">;</span> <span class="co">// Returns Promise</span></a></code></pre></div>
<p>For convenience, supported MIME types are available as static properties:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1"><span class="va">Jimp</span>.<span class="at">MIME_PNG</span><span class="op">;</span> <span class="co">// &quot;image/png&quot;</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="va">Jimp</span>.<span class="at">MIME_JPEG</span><span class="op">;</span> <span class="co">// &quot;image/jpeg&quot;</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="va">Jimp</span>.<span class="at">MIME_BMP</span><span class="op">;</span> <span class="co">// &quot;image/bmp&quot;</span></a></code></pre></div>
<p>If <code>Jimp.AUTO</code> is passed as the MIME type then the original MIME type for the image (or “image/png”) will be used. Alternatively, <code>image.getMIME()</code> will return the original MIME type of the image (or “image/png”).</p>
<h3 id="data-uri">Data URI</h3>
<p>A Base64 data URI can be generated in the same way as a Buffer, using:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" title="1"><span class="va">image</span>.<span class="at">getBase64</span>(mime<span class="op">,</span> cb)<span class="op">;</span> <span class="co">// Node-style callback will be fired with result</span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="va">image</span>.<span class="at">getBase64Async</span>(mime)<span class="op">;</span> <span class="co">// Returns Promise</span></a></code></pre></div>
<h3 id="png-and-jpeg-quality">PNG and JPEG quality</h3>
<p>The quality of JPEGs can be set with:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1"><span class="va">image</span>.<span class="at">quality</span>(n)<span class="op">;</span> <span class="co">// set the quality of saved JPEG, 0 - 100</span></a></code></pre></div>
<p>The format of PNGs can be set with:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb34-1" title="1"><span class="va">image</span>.<span class="at">rgba</span>(bool)<span class="op">;</span> <span class="co">// set whether PNGs are saved as RGBA (true, default) or RGB (false)</span></a>
<a class="sourceLine" id="cb34-2" title="2"><span class="va">image</span>.<span class="at">filterType</span>(number)<span class="op">;</span> <span class="co">// set the filter type for the saved PNG</span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="va">image</span>.<span class="at">deflateLevel</span>(number)<span class="op">;</span> <span class="co">// set the deflate level for the saved PNG</span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="va">Jimp</span>.<span class="at">deflateStrategy</span>(number)<span class="op">;</span> <span class="co">// set the deflate for the saved PNG (0-3)</span></a></code></pre></div>
<p>For convenience, supported filter types are available as static properties:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb35-1" title="1"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_AUTO</span><span class="op">;</span> <span class="co">// -1</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_NONE</span><span class="op">;</span> <span class="co">//  0</span></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_SUB</span><span class="op">;</span> <span class="co">//  1</span></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_UP</span><span class="op">;</span> <span class="co">//  2</span></a>
<a class="sourceLine" id="cb35-5" title="5"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_AVERAGE</span><span class="op">;</span> <span class="co">//  3</span></a>
<a class="sourceLine" id="cb35-6" title="6"><span class="va">Jimp</span>.<span class="at">PNG_FILTER_PATH</span><span class="op">;</span> <span class="co">//  4</span></a></code></pre></div>
<h2 id="advanced-usage">Advanced usage</h2>
<h3 id="colour-manipulation">Colour manipulation</h3>
<p>Jimp supports advanced colour manipulation using a single method as follows:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb36-1" title="1"><span class="va">image</span>.<span class="at">color</span>([</a>
<a class="sourceLine" id="cb36-2" title="2">  <span class="op">{</span> <span class="dt">apply</span><span class="op">:</span> <span class="st">&#39;hue&#39;</span><span class="op">,</span> <span class="dt">params</span><span class="op">:</span> [<span class="op">-</span><span class="dv">90</span>] <span class="op">},</span></a>
<a class="sourceLine" id="cb36-3" title="3">  <span class="op">{</span> <span class="dt">apply</span><span class="op">:</span> <span class="st">&#39;lighten&#39;</span><span class="op">,</span> <span class="dt">params</span><span class="op">:</span> [<span class="dv">50</span>] <span class="op">},</span></a>
<a class="sourceLine" id="cb36-4" title="4">  <span class="op">{</span> <span class="dt">apply</span><span class="op">:</span> <span class="st">&#39;xor&#39;</span><span class="op">,</span> <span class="dt">params</span><span class="op">:</span> [<span class="st">&#39;#06D&#39;</span>] <span class="op">}</span></a>
<a class="sourceLine" id="cb36-5" title="5">])<span class="op">;</span></a></code></pre></div>
<p>The method supports the following modifiers:</p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th>Modifier</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>lighten</strong> {amount}</td>
<td>Lighten the color a given amount, from 0 to 100. Providing 100 will always return white (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="even">
<td><strong>brighten</strong> {amount}</td>
<td>Brighten the color a given amount, from 0 to 100 (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="odd">
<td><strong>darken</strong> {amount}</td>
<td>Darken the color a given amount, from 0 to 100. Providing 100 will always return black (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="even">
<td><strong>desaturate</strong> {amount}</td>
<td>Desaturate the color a given amount, from 0 to 100. Providing 100 will is the same as calling greyscale (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="odd">
<td><strong>saturate</strong> {amount}</td>
<td>Saturate the color a given amount, from 0 to 100 (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="even">
<td><strong>greyscale</strong> {amount}</td>
<td>Completely desaturates a color into greyscale (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="odd">
<td><strong>spin</strong> {degree}</td>
<td>Spin the hue a given amount, from -360 to 360. Calling with 0, 360, or -360 will do nothing - since it sets the hue back to what it was before. (works through <a href="https://github.com/bgrins/TinyColor">TinyColor</a>)</td>
</tr>
<tr class="even">
<td><strong>hue</strong> {degree}</td>
<td>Alias for <strong>spin</strong></td>
</tr>
<tr class="odd">
<td><strong>mix</strong> {color, amount}</td>
<td>Mixes colors by their RGB component values. Amount is opacity of overlaying color</td>
</tr>
<tr class="even">
<td><strong>tint</strong> {amount}</td>
<td>Same as applying <strong>mix</strong> with white color</td>
</tr>
<tr class="odd">
<td><strong>shade</strong> {amount}</td>
<td>Same as applying <strong>mix</strong> with black color</td>
</tr>
<tr class="even">
<td><strong>xor</strong> {color}</td>
<td>Treats the two colors as bitfields and applies an XOR operation to the red, green, and blue components</td>
</tr>
<tr class="odd">
<td><strong>red</strong> {amount}</td>
<td>Modify Red component by a given amount</td>
</tr>
<tr class="even">
<td><strong>green</strong> {amount}</td>
<td>Modify Green component by a given amount</td>
</tr>
<tr class="odd">
<td><strong>blue</strong> {amount}</td>
<td>Modify Blue component by a given amount</td>
</tr>
</tbody>
</table>
<h3 id="convolution-matrix">Convolution matrix</h3>
<p>Sum neighbor pixels weighted by the kernel matrix. You can find a nice explanation with examples at <a href="https://docs.gimp.org/2.6/en/plug-in-convmatrix.html">GIMP’s Convolution Matrix plugin</a></p>
<p>Implement emboss effect:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" title="1"><span class="va">image</span>.<span class="at">convolute</span>([[<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">-1</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>]])<span class="op">;</span></a></code></pre></div>
<h3 id="low-level-manipulation">Low-level manipulation</h3>
<p>Jimp enables low-level manipulation of images in memory through the bitmap property of each Jimp object:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb38-1" title="1"><span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">data</span><span class="op">;</span> <span class="co">// a Buffer of the raw bitmap data</span></a>
<a class="sourceLine" id="cb38-2" title="2"><span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">width</span><span class="op">;</span> <span class="co">// the width of the image</span></a>
<a class="sourceLine" id="cb38-3" title="3"><span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">height</span><span class="op">;</span> <span class="co">// the height of the image</span></a></code></pre></div>
<p>This data can be manipulated directly, but remember: garbage in, garbage out.</p>
<p>A helper method is available to scan a region of the bitmap:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb39-1" title="1"><span class="va">image</span>.<span class="at">scan</span>(x<span class="op">,</span> y<span class="op">,</span> w<span class="op">,</span> h<span class="op">,</span> f)<span class="op">;</span> <span class="co">// scan a given region of the bitmap and call the function f on every pixel</span></a></code></pre></div>
<p>Example usage:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb40-1" title="1"><span class="va">image</span>.<span class="at">scan</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">width</span><span class="op">,</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">height</span><span class="op">,</span> <span class="kw">function</span>(x<span class="op">,</span> y<span class="op">,</span> idx) <span class="op">{</span></a>
<a class="sourceLine" id="cb40-2" title="2">  <span class="co">// x, y is the position of this pixel on the image</span></a>
<a class="sourceLine" id="cb40-3" title="3">  <span class="co">// idx is the position start position of this rgba tuple in the bitmap Buffer</span></a>
<a class="sourceLine" id="cb40-4" title="4">  <span class="co">// this is the image</span></a>
<a class="sourceLine" id="cb40-5" title="5"></a>
<a class="sourceLine" id="cb40-6" title="6">  <span class="kw">var</span> red <span class="op">=</span> <span class="kw">this</span>.<span class="va">bitmap</span>.<span class="at">data</span>[idx <span class="op">+</span> <span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb40-7" title="7">  <span class="kw">var</span> green <span class="op">=</span> <span class="kw">this</span>.<span class="va">bitmap</span>.<span class="at">data</span>[idx <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb40-8" title="8">  <span class="kw">var</span> blue <span class="op">=</span> <span class="kw">this</span>.<span class="va">bitmap</span>.<span class="at">data</span>[idx <span class="op">+</span> <span class="dv">2</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb40-9" title="9">  <span class="kw">var</span> alpha <span class="op">=</span> <span class="kw">this</span>.<span class="va">bitmap</span>.<span class="at">data</span>[idx <span class="op">+</span> <span class="dv">3</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb40-10" title="10"></a>
<a class="sourceLine" id="cb40-11" title="11">  <span class="co">// rgba values run from 0 - 255</span></a>
<a class="sourceLine" id="cb40-12" title="12">  <span class="co">// e.g. this.bitmap.data[idx] = 0; // removes red from this pixel</span></a>
<a class="sourceLine" id="cb40-13" title="13"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>If you need to do something with the image at the end of the scan:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb41-1" title="1"><span class="va">image</span>.<span class="at">scan</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">width</span><span class="op">,</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">height</span><span class="op">,</span> <span class="kw">function</span>(x<span class="op">,</span> y<span class="op">,</span> idx) <span class="op">{</span></a>
<a class="sourceLine" id="cb41-2" title="2">  <span class="co">// do your stuff..</span></a>
<a class="sourceLine" id="cb41-3" title="3"></a>
<a class="sourceLine" id="cb41-4" title="4">  <span class="cf">if</span> (x <span class="op">==</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">width</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> y <span class="op">==</span> <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">height</span> <span class="op">-</span> <span class="dv">1</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb41-5" title="5">    <span class="co">// image scan finished, do your stuff</span></a>
<a class="sourceLine" id="cb41-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>It’s possible to make an iterator scan with a <code>for ... of</code>, if you want to <code>break</code> the scan before it reaches the end, but note, that this iterator has a huge performance implication:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb42-1" title="1"><span class="cf">for</span> (<span class="kw">const</span> <span class="op">{</span> x<span class="op">,</span> y<span class="op">,</span> idx<span class="op">,</span> image <span class="op">}</span> <span class="kw">of</span> <span class="va">image</span>.<span class="at">scanIterator</span>(</a>
<a class="sourceLine" id="cb42-2" title="2">  <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb42-3" title="3">  <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb42-4" title="4">  <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">width</span><span class="op">,</span></a>
<a class="sourceLine" id="cb42-5" title="5">  <span class="va">image</span>.<span class="va">bitmap</span>.<span class="at">height</span></a>
<a class="sourceLine" id="cb42-6" title="6">)) <span class="op">{</span></a>
<a class="sourceLine" id="cb42-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>A helper to locate a particular pixel within the raw bitmap buffer:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb43-1" title="1"><span class="va">image</span>.<span class="at">getPixelIndex</span>(x<span class="op">,</span> y)<span class="op">;</span> <span class="co">// returns the index within image.bitmap.data</span></a></code></pre></div>
<p>One of the following may be optionally passed as a third parameter to indicate a strategy for x, y positions that are outside of boundaries of the image:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb44-1" title="1"><span class="va">Jimp</span>.<span class="at">EDGE_EXTEND</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb44-2" title="2"><span class="va">Jimp</span>.<span class="at">EDGE_WRAP</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb44-3" title="3"><span class="va">Jimp</span>.<span class="at">EDGE_CROP</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></a></code></pre></div>
<p>Alternatively, you can manipulate individual pixels using the following these functions:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb45-1" title="1"><span class="va">image</span>.<span class="at">getPixelColor</span>(x<span class="op">,</span> y)<span class="op">;</span> <span class="co">// returns the colour of that pixel e.g. 0xFFFFFFFF</span></a>
<a class="sourceLine" id="cb45-2" title="2"><span class="va">image</span>.<span class="at">setPixelColor</span>(hex<span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span> <span class="co">// sets the colour of that pixel</span></a></code></pre></div>
<p>Two static helper functions exist to convert RGBA values into single integer (hex) values:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb46-1" title="1"><span class="va">Jimp</span>.<span class="at">rgbaToInt</span>(r<span class="op">,</span> g<span class="op">,</span> b<span class="op">,</span> a)<span class="op">;</span> <span class="co">// e.g. converts 255, 255, 255, 255 to 0xFFFFFFFF</span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="va">Jimp</span>.<span class="at">intToRGBA</span>(hex)<span class="op">;</span> <span class="co">// e.g. converts 0xFFFFFFFF to {r: 255, g: 255, b: 255, a:255}</span></a></code></pre></div>
<p>You can convert a css color (Hex, RGB, RGBA, HSL, HSLA, HSV, HSVA, Named) to its hexadecimal equivalent:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb47-1" title="1"><span class="va">Jimp</span>.<span class="at">cssColorToHex</span>(cssColor)<span class="op">;</span> <span class="co">// e.g. converts #FF00FF to 0xFF00FFFF</span></a></code></pre></div>
<h3 id="creating-new-images">Creating new images</h3>
<p>If you want to begin with an empty Jimp image, you can call the Jimp constructor passing the width and height of the image to create and a Node-style callback:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">new</span> <span class="at">Jimp</span>(<span class="dv">256</span><span class="op">,</span> <span class="dv">256</span><span class="op">,</span> (err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb48-2" title="2">  <span class="co">// this image is 256 x 256, every pixel is set to 0x00000000</span></a>
<a class="sourceLine" id="cb48-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You can optionally set the pixel colour as follows:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">new</span> <span class="at">Jimp</span>(<span class="dv">256</span><span class="op">,</span> <span class="dv">256</span><span class="op">,</span> <span class="bn">0xff0000ff</span><span class="op">,</span> (err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb49-2" title="2">  <span class="co">// this image is 256 x 256, every pixel is set to 0xFF0000FF</span></a>
<a class="sourceLine" id="cb49-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Or you can use a css color format:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">new</span> <span class="at">Jimp</span>(<span class="dv">256</span><span class="op">,</span> <span class="dv">256</span><span class="op">,</span> <span class="st">&#39;#FF00FF&#39;</span><span class="op">,</span> (err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb50-2" title="2">  <span class="co">// this image is 256 x 256, every pixel is set to #FF00FF</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You can also initialize a new Jimp image with a raw image buffer:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">new</span> <span class="at">Jimp</span>(<span class="op">{</span> <span class="dt">data</span><span class="op">:</span> buffer<span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1280</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">768</span> <span class="op">},</span> (err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb51-2" title="2">  <span class="co">// this image is 1280 x 768, pixels are loaded from the given buffer.</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>This can be useful for interoperating with other image processing libraries. <code>buffer</code> is expected to be four-channel (rgba) image data.</p>
<h2 id="comparing-images">Comparing images</h2>
<p>To generate a <a href="https://en.wikipedia.org/wiki/Perceptual_hashing">perceptual hash</a> of a Jimp image, based on the <a href="http://phash.org/">pHash</a> algorithm, use:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb52-1" title="1"><span class="va">image</span>.<span class="at">hash</span>()<span class="op">;</span> <span class="co">// aHgG4GgoFjA</span></a></code></pre></div>
<p>By default the hash is returned as base 64. The hash can be returned at another base by passing a number from 2 to 64 to the method:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb53-1" title="1"><span class="va">image</span>.<span class="at">hash</span>(<span class="dv">2</span>)<span class="op">;</span> <span class="co">// 1010101011010000101010000100101010010000011001001001010011100100</span></a></code></pre></div>
<p>There are 18,446,744,073,709,551,615 unique hashes. The hamming distance between the binary representation of these hashes can be used to find similar-looking images.</p>
<p>To calculate the hamming distance between two Jimp images based on their perceptual hash use:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb54-1" title="1"><span class="va">Jimp</span>.<span class="at">distance</span>(image1<span class="op">,</span> image2)<span class="op">;</span> <span class="co">// returns a number 0-1, where 0 means the two images are perceived to be identical</span></a></code></pre></div>
<p>Jimp also allows the diffing of two Jimp images using <a href="https://github.com/mapbox/pixelmatch">PixelMatch</a> as follows:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">var</span> diff <span class="op">=</span> <span class="va">Jimp</span>.<span class="at">diff</span>(image1<span class="op">,</span> image2<span class="op">,</span> threshold)<span class="op">;</span> <span class="co">// threshold ranges 0-1 (default: 0.1)</span></a>
<a class="sourceLine" id="cb55-2" title="2"><span class="va">diff</span>.<span class="at">image</span><span class="op">;</span> <span class="co">// a Jimp image showing differences</span></a>
<a class="sourceLine" id="cb55-3" title="3"><span class="va">diff</span>.<span class="at">percent</span><span class="op">;</span> <span class="co">// the proportion of different pixels (0-1), where 0 means the images are pixel identical</span></a></code></pre></div>
<p>Using a mix of hamming distance and pixel diffing to compare images, the following code has a 99% success rate of detecting the same image from a random sample (with 1% false positives). The test this figure is drawn from attempts to match each image from a sample of 120 PNGs against 120 corresponding JPEGs saved at a quality setting of 60.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">var</span> distance <span class="op">=</span> <span class="va">Jimp</span>.<span class="at">distance</span>(png<span class="op">,</span> jpeg)<span class="op">;</span> <span class="co">// perceived distance</span></a>
<a class="sourceLine" id="cb56-2" title="2"><span class="kw">var</span> diff <span class="op">=</span> <span class="va">Jimp</span>.<span class="at">diff</span>(png<span class="op">,</span> jpeg)<span class="op">;</span> <span class="co">// pixel difference</span></a>
<a class="sourceLine" id="cb56-3" title="3"></a>
<a class="sourceLine" id="cb56-4" title="4"><span class="cf">if</span> (distance <span class="op">&lt;</span> <span class="fl">0.15</span> <span class="op">||</span> <span class="va">diff</span>.<span class="at">percent</span> <span class="op">&lt;</span> <span class="fl">0.15</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb56-5" title="5">  <span class="co">// images match</span></a>
<a class="sourceLine" id="cb56-6" title="6"><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb56-7" title="7">  <span class="co">// not a match</span></a>
<a class="sourceLine" id="cb56-8" title="8"><span class="op">}</span></a></code></pre></div>
<p>You can also calculate the raw pHash (no padding or custom base). You can then use this in <code>distanceFromHash</code> to calculate the hash distance from a loaded image.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">const</span> hash1 <span class="op">=</span> <span class="va">image1</span>.<span class="at">pHash</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb57-2" title="2"><span class="kw">const</span> hash2 <span class="op">=</span> <span class="va">image2</span>.<span class="at">pHash</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb57-3" title="3"></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="va">image2</span>.<span class="at">distanceFromHash</span>(hash1)<span class="op">;</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="va">Jimp</span>.<span class="at">compareHashes</span>(hash1<span class="op">,</span> hash2)<span class="op">;</span> <span class="co">// same result as above</span></a></code></pre></div>
<h2 id="chaining-or-callbacks">Chaining or callbacks</h2>
<p>Most instance methods can be chained together, for example as follows:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb58-1" title="1"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;lenna.png&#39;</span>).<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb58-2" title="2">  image</a>
<a class="sourceLine" id="cb58-3" title="3">    .<span class="at">greyscale</span>()</a>
<a class="sourceLine" id="cb58-4" title="4">    .<span class="at">scale</span>(<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb58-5" title="5">    .<span class="at">write</span>(<span class="st">&#39;lena-half-bw.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb58-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Alternatively, methods can be passed Node-style callbacks:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb59-1" title="1"><span class="va">Jimp</span>.<span class="at">read</span>(<span class="st">&#39;lenna.png&#39;</span>).<span class="at">then</span>(image <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb59-2" title="2">  <span class="va">image</span>.<span class="at">greyscale</span>((err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb59-3" title="3">    <span class="va">image</span>.<span class="at">scale</span>(<span class="fl">0.5</span><span class="op">,</span> (err<span class="op">,</span> image) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb59-4" title="4">      <span class="va">image</span>.<span class="at">write</span>(<span class="st">&#39;lena-half-bw.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb59-5" title="5">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb59-6" title="6">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb59-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The Node-style callback pattern allows Jimp to be used with frameworks that expect or build on the Node-style callback pattern.</p>
</body>
</html>
