<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><a href="https://travis-ci.org/opentracing/opentracing-javascript"><img src="https://travis-ci.org/opentracing/opentracing-javascript.svg?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/opentracing/opentracing-javascript?branch=master"><img src="https://coveralls.io/repos/github/opentracing/opentracing-javascript/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="https://www.npmjs.com/package/opentracing"><img src="https://badge.fury.io/js/opentracing.svg" alt="NPM Published Version" /></a> <img src="http://img.shields.io/node/v/opentracing.svg" alt="Node Version" /> <a href="https://gitter.im/opentracing/opentracing-javascript?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/opentracing/opentracing-javascript.svg" alt="Join the chat at https://gitter.im/opentracing/opentracing-javascript" /></a></p>
<h1 id="opentracing-api-for-javascript">OpenTracing API for JavaScript</h1>
<p>This library is a JavaScript implementation of Open Tracing API. It is intended for use both on the server and in the browser.</p>
<h2 id="required-reading">Required Reading</h2>
<p>To fully understand this platform API, it’s helpful to be familiar with the <a href="http://opentracing.io">OpenTracing project</a> and <a href="http://opentracing.io/documentation/pages/spec.html">terminology</a> more specifically.</p>
<h2 id="quick-start">Quick Start</h2>
<p>Install the package using <code>npm</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> install --save opentracing</a></code></pre></div>
<h3 id="example">Example</h3>
<p>The package contains an example using a naive <code>MockTracer</code> implementation. To run the example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">npm</span> run example</a></code></pre></div>
<p>The output should look something like:</p>
<pre><code>Spans:
    parent_span - 1521ms
        tag &#39;custom&#39;:&#39;tag value&#39;
        tag &#39;alpha&#39;:&#39;1000&#39;
    child_span - 503ms
        tag &#39;alpha&#39;:&#39;200&#39;
        tag &#39;beta&#39;:&#39;50&#39;</code></pre>
<h3 id="code-snippet">Code snippet</h3>
<p>In your JavaScript code, add instrumentation to the operations to be tracked. This is composed primarily of using “spans” around operations of interest and adding log statements to capture useful data relevant to those operations.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> opentracing <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;opentracing&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">// </span><span class="al">NOTE</span><span class="co">: the default OpenTracing tracer does not record any tracing information.</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">// Replace this line with the tracer implementation of your choice.</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">const</span> tracer <span class="op">=</span> <span class="kw">new</span> <span class="va">opentracing</span>.<span class="at">Tracer</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="kw">const</span> span <span class="op">=</span> <span class="va">tracer</span>.<span class="at">startSpan</span>(<span class="st">&#39;http_request&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">const</span> opts <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">host </span><span class="op">:</span> <span class="st">&#39;example.com&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="dt">port </span><span class="op">:</span> <span class="st">&#39;80&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="va">http</span>.<span class="at">request</span>(opts<span class="op">,</span> res <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="va">res</span>.<span class="at">setEncoding</span>(<span class="st">&#39;utf8&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-17" title="17">    <span class="va">res</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-18" title="18">        <span class="co">// assuming no retries, mark the span as failed</span></a>
<a class="sourceLine" id="cb4-19" title="19">        <span class="va">span</span>.<span class="at">setTag</span>(<span class="va">opentracing</span>.<span class="va">Tags</span>.<span class="at">ERROR</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-20" title="20">        <span class="va">span</span>.<span class="at">log</span>(<span class="op">{</span><span class="st">&#39;event&#39;</span><span class="op">:</span> <span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="st">&#39;error.object&#39;</span><span class="op">:</span> err<span class="op">,</span> <span class="st">&#39;message&#39;</span><span class="op">:</span> <span class="va">err</span>.<span class="at">message</span><span class="op">,</span> <span class="st">&#39;stack&#39;</span><span class="op">:</span> <span class="va">err</span>.<span class="at">stack</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-21" title="21">        <span class="va">span</span>.<span class="at">finish</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-22" title="22">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="va">res</span>.<span class="at">on</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> chunk <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-24" title="24">        <span class="va">span</span>.<span class="at">log</span>(<span class="op">{</span><span class="st">&#39;event&#39;</span><span class="op">:</span> <span class="st">&#39;data_received&#39;</span><span class="op">,</span> <span class="st">&#39;chunk_length&#39;</span><span class="op">:</span> <span class="va">chunk</span>.<span class="at">length</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-25" title="25">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-26" title="26">    <span class="va">res</span>.<span class="at">on</span>(<span class="st">&#39;end&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-27" title="27">        <span class="va">span</span>.<span class="at">log</span>(<span class="op">{</span><span class="st">&#39;event&#39;</span><span class="op">:</span> <span class="st">&#39;request_end&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-28" title="28">        <span class="va">span</span>.<span class="at">finish</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-29" title="29">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="op">}</span>).<span class="at">end</span>()<span class="op">;</span></a></code></pre></div>
<p>As noted in the source snippet, the default behavior of the <code>opentracing</code> package is to act as a “no op” implementation. To capture and make the tracing data actionable, the <code>tracer</code> object should be initialized with the OpenTracing implementation of your choice as in the pseudo-code below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> CustomTracer <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;tracing-implementation-of-your-choice&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">const</span> tracer <span class="op">=</span> <span class="kw">new</span> <span class="at">CustomTracer</span>()<span class="op">;</span></a></code></pre></div>
<h3 id="usage-in-the-browser">Usage in the browser</h3>
<p>The package contains two bundles built with webpack that can be included using a standard <code>&lt;script&gt;</code> tag. The library will be exposed under the global <code>opentracing</code> namespace:</p>
<ul>
<li><code>dist/opentracing-browser.min.js</code> - minified, no runtime checks</li>
<li><code>dist/opentracing-browser.js</code> - debug version with runtime checks</li>
</ul>
<h3 id="usage-with-typescript">Usage with TypeScript</h3>
<p>Since the source is written in TypeScript, if you are using TypeScript, you can just <code>npm install</code> the package and it will work out of the box. This is especially useful for implementors who want to type check their implementation with the base interface.</p>
<h3 id="global-tracer">Global tracer</h3>
<p>The library also provides a global singleton tracer for convenience. This can be set and accessed via the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="va">opentracing</span>.<span class="at">initGlobalTracer</span>(<span class="kw">new</span> <span class="at">CustomTracer</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">const</span> tracer <span class="op">=</span> <span class="va">opentracing</span>.<span class="at">globalTracer</span>()<span class="op">;</span></a></code></pre></div>
<p>Note: <code>globalTracer()</code> returns a wrapper on the actual tracer object. This is done for the convenience of use as it ensures that the function will always return a non-null object. This can be helpful in cases where it is difficult or impossible to know precisely when <code>initGlobalTracer</code> is called (for example, when writing a utility library that does not control the initialization process). For more precise control, individual <code>Tracer</code> objects can be used instead of the global tracer.</p>
<h2 id="api-documentation">API Documentation</h2>
<p>There is a hosted copy of the current generated <a href="https://opentracing-javascript.surge.sh">ESDoc API Documentation here</a>.</p>
<h2 id="contributing-developer-information">Contributing &amp; developer information</h2>
<p>See the <a href="http://opentracing.io">OpenTracing website</a> for general information on contributing to OpenTracing.</p>
<p>The project is written in TypeScript and built using a npm scripts. Run:</p>
<ul>
<li><code>npm run build</code> creates the compiled, distributable JavaScript code in <code>./lib</code></li>
<li><code>npm run watch</code> incrementally compiles on file changes</li>
<li><code>npm run webpack</code> creates the bundles for the browser in <code>./dist</code></li>
<li><code>npm test</code> runs the tests</li>
<li><code>npm run typedoc</code> generates the documentation in <code>./typedoc</code></li>
</ul>
<p><strong>Note:</strong> The minimum supported Node version for development is <code>&gt;=6</code>. Tests can however be run on any version that this project supports (<code>&gt;=0.10</code>).</p>
<h2 id="opentracing-tracer-implementations">OpenTracing tracer implementations</h2>
<p><em>This section is intended for developers wishing to</em> <strong><em>implement their own tracers</em></strong>. <em>Developers who simply wish to</em> <strong><em>use OpenTracing</em></strong> <em>can safely ignore this information.</em></p>
<h3 id="custom-tracer-implementation">Custom tracer implementation</h3>
<p>Implementations can subclass <code>opentracing.Tracer</code>, <code>opentracing.Span</code>, and the other API classes to build an OpenTracing tracer and implement the underscore prefixed methods such as <code>_addTag</code> to pick up a bit of common code implemented in the base classes.</p>
<h3 id="api-compatibility-testing">API compatibility testing</h3>
<p>If <code>mocha</code> is being used for unit testing, <code>test/api_compatibility</code> can be used to test the custom tracer. The file exports a single function that expects as an argument a function that will return a new instance of the tracer.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> apiCompatibilityChecks <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;opentracing/lib/test/api_compatibility.js&#39;</span>).<span class="at">default</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="at">apiCompatibilityChecks</span>(() <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="at">CustomTracer</span>())<span class="op">;</span></a></code></pre></div>
<h2 id="license">LICENSE</h2>
<p>Apache License 2.0</p>
<h3 id="mocktracer">MockTracer</h3>
<p>A minimal example tracer is provided in the <code>src/mock_tracer</code> directory of the source code.</p>
</body>
</html>
