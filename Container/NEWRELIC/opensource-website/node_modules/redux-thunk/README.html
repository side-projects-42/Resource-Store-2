<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="redux-thunk">Redux Thunk</h1>
<p>Thunk <a href="https://redux.js.org/advanced/middleware">middleware</a> for Redux.</p>
<p><a href="https://travis-ci.org/reduxjs/redux-thunk"><img src="https://img.shields.io/travis/reduxjs/redux-thunk/master.svg?style=flat-square" alt="build status" /></a> <a href="https://www.npmjs.com/package/redux-thunk"><img src="https://img.shields.io/npm/v/redux-thunk.svg?style=flat-square" alt="npm version" /></a> <a href="https://www.npmjs.com/package/redux-thunk"><img src="https://img.shields.io/npm/dm/redux-thunk.svg?style=flat-square" alt="npm downloads" /></a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1">npm install <span class="op">--</span>save redux<span class="op">-</span>thunk</a></code></pre></div>
<h2 id="note-on-2.x-update">Note on 2.x Update</h2>
<p>Most tutorials today assume Redux Thunk 1.x so you might run into an issue when running their code with 2.x.<br />
<strong>If you use Redux Thunk 2.x in CommonJS environment, <a href="https://github.com/reduxjs/redux-thunk/releases/tag/v2.0.0">don’t forget to add <code>.default</code> to your import</a>:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode diff"><code class="sourceCode diff"><a class="sourceLine" id="cb2-1" title="1"><span class="st">- var ReduxThunk = require(&#39;redux-thunk&#39;)</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="va">+ var ReduxThunk = require(&#39;redux-thunk&#39;).default</span></a></code></pre></div>
<p>If you used ES modules, you’re already all good:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> ReduxThunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span> <span class="co">// no changes here 😀</span></a></code></pre></div>
<p>Additionally, since 2.x, we also support a <a href="https://unpkg.com/redux-thunk/dist/redux-thunk.min.js">UMD build</a>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> ReduxThunk <span class="op">=</span> <span class="va">window</span>.<span class="va">ReduxThunk</span>.<span class="at">default</span></a></code></pre></div>
<p>As you can see, it also requires <code>.default</code> at the end.</p>
<h2 id="why-do-i-need-this">Why Do I Need This?</h2>
<p>If you’re not sure whether you need it, you probably don’t.</p>
<p><strong><a href="http://stackoverflow.com/questions/35411423/how-to-dispatch-a-redux-action-with-a-timeout/35415559#35415559">Read this for an in-depth introduction to thunks in Redux.</a></strong></p>
<h2 id="motivation">Motivation</h2>
<p>Redux Thunk <a href="https://github.com/reactjs/redux/blob/master/docs/advanced/Middleware.md">middleware</a> allows you to write action creators that return a function instead of an action. The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. The inner function receives the store methods <code>dispatch</code> and <code>getState</code> as parameters.</p>
<p>An action creator that returns a function to perform asynchronous dispatch:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> INCREMENT_COUNTER <span class="op">=</span> <span class="st">&#39;INCREMENT_COUNTER&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">function</span> <span class="at">increment</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">type</span><span class="op">:</span> INCREMENT_COUNTER</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="op">};</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="kw">function</span> <span class="at">incrementAsync</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="cf">return</span> dispatch <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="at">setTimeout</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-12" title="12">      <span class="co">// Yay! Can invoke sync or async actions with `dispatch`</span></a>
<a class="sourceLine" id="cb5-13" title="13">      <span class="at">dispatch</span>(<span class="at">increment</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="op">};</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="op">}</span></a></code></pre></div>
<p>An action creator that returns a function to perform conditional dispatch:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> <span class="at">incrementIfOdd</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="cf">return</span> (dispatch<span class="op">,</span> getState) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="kw">const</span> <span class="op">{</span> counter <span class="op">}</span> <span class="op">=</span> <span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="cf">if</span> (counter <span class="op">%</span> <span class="dv">2</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="at">dispatch</span>(<span class="at">increment</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">};</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="op">}</span></a></code></pre></div>
<h2 id="whats-a-thunk">What’s a thunk?!</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Thunk">thunk</a> is a function that wraps an expression to delay its evaluation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// calculation of 1 + 2 is immediate</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">// x === 3</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">let</span> x <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">// calculation of 1 + 2 is delayed</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">// foo can be called later to perform the calculation</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">// foo is a thunk!</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw">let</span> foo <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></a></code></pre></div>
<p>The term <a href="https://en.wikipedia.org/wiki/Thunk#cite_note-1">originated</a> as a humorous past-tense version of “think”.</p>
<h2 id="installation">Installation</h2>
<pre><code>npm install --save redux-thunk</code></pre>
<p>Then, to enable Redux Thunk, use <a href="https://redux.js.org/api-reference/applymiddleware"><code>applyMiddleware()</code></a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers/index&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">// Note: this API requires redux@&gt;=3.1.0</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb9-7" title="7">  rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="at">applyMiddleware</span>(thunk)</a>
<a class="sourceLine" id="cb9-9" title="9">)<span class="op">;</span></a></code></pre></div>
<h2 id="composition">Composition</h2>
<p>Any return value from the inner function will be available as the return value of <code>dispatch</code> itself. This is convenient for orchestrating an asynchronous control flow with thunk action creators dispatching each other and returning Promises to wait for each other’s completion:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">&#39;redux-thunk&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="im">import</span> rootReducer <span class="im">from</span> <span class="st">&#39;./reducers&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">// Note: this API requires redux@&gt;=3.1.0</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb10-7" title="7">  rootReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb10-8" title="8">  <span class="at">applyMiddleware</span>(thunk)</a>
<a class="sourceLine" id="cb10-9" title="9">)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">function</span> <span class="at">fetchSecretSauce</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-12" title="12">  <span class="cf">return</span> <span class="at">fetch</span>(<span class="st">&#39;https://www.google.com/search?q=secret+sauce&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">// These are the normal action creators you have seen so far.</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">// The actions they return can be dispatched without any middleware.</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">// However, they only express “facts” and not the “async flow”.</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">function</span> <span class="at">makeASandwich</span>(forPerson<span class="op">,</span> secretSauce) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-21" title="21">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;MAKE_SANDWICH&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-22" title="22">    forPerson<span class="op">,</span></a>
<a class="sourceLine" id="cb10-23" title="23">    secretSauce</a>
<a class="sourceLine" id="cb10-24" title="24">  <span class="op">};</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-26" title="26"></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="kw">function</span> <span class="at">apologize</span>(fromPerson<span class="op">,</span> toPerson<span class="op">,</span> error) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-28" title="28">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-29" title="29">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;APOLOGIZE&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-30" title="30">    fromPerson<span class="op">,</span></a>
<a class="sourceLine" id="cb10-31" title="31">    toPerson<span class="op">,</span></a>
<a class="sourceLine" id="cb10-32" title="32">    error</a>
<a class="sourceLine" id="cb10-33" title="33">  <span class="op">};</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-35" title="35"></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="kw">function</span> <span class="at">withdrawMoney</span>(amount) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-37" title="37">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-38" title="38">    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;WITHDRAW&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-39" title="39">    amount</a>
<a class="sourceLine" id="cb10-40" title="40">  <span class="op">};</span></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-42" title="42"></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="co">// Even without middleware, you can dispatch an action:</span></a>
<a class="sourceLine" id="cb10-44" title="44"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">withdrawMoney</span>(<span class="dv">100</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb10-45" title="45"></a>
<a class="sourceLine" id="cb10-46" title="46"><span class="co">// But what do you do when you need to start an asynchronous action,</span></a>
<a class="sourceLine" id="cb10-47" title="47"><span class="co">// such as an API call, or a router transition?</span></a>
<a class="sourceLine" id="cb10-48" title="48"></a>
<a class="sourceLine" id="cb10-49" title="49"><span class="co">// Meet thunks.</span></a>
<a class="sourceLine" id="cb10-50" title="50"><span class="co">// A thunk is a function that returns a function.</span></a>
<a class="sourceLine" id="cb10-51" title="51"><span class="co">// This is a thunk.</span></a>
<a class="sourceLine" id="cb10-52" title="52"></a>
<a class="sourceLine" id="cb10-53" title="53"><span class="kw">function</span> <span class="at">makeASandwichWithSecretSauce</span>(forPerson) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-54" title="54"></a>
<a class="sourceLine" id="cb10-55" title="55">  <span class="co">// Invert control!</span></a>
<a class="sourceLine" id="cb10-56" title="56">  <span class="co">// Return a function that accepts `dispatch` so we can dispatch later.</span></a>
<a class="sourceLine" id="cb10-57" title="57">  <span class="co">// Thunk middleware knows how to turn thunk async actions into actions.</span></a>
<a class="sourceLine" id="cb10-58" title="58"></a>
<a class="sourceLine" id="cb10-59" title="59">  <span class="cf">return</span> <span class="kw">function</span> (dispatch) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-60" title="60">    <span class="cf">return</span> <span class="at">fetchSecretSauce</span>().<span class="at">then</span>(</a>
<a class="sourceLine" id="cb10-61" title="61">      sauce <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">makeASandwich</span>(forPerson<span class="op">,</span> sauce))<span class="op">,</span></a>
<a class="sourceLine" id="cb10-62" title="62">      error <span class="kw">=&gt;</span> <span class="at">dispatch</span>(<span class="at">apologize</span>(<span class="st">&#39;The Sandwich Shop&#39;</span><span class="op">,</span> forPerson<span class="op">,</span> error))</a>
<a class="sourceLine" id="cb10-63" title="63">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb10-64" title="64">  <span class="op">};</span></a>
<a class="sourceLine" id="cb10-65" title="65"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-66" title="66"></a>
<a class="sourceLine" id="cb10-67" title="67"><span class="co">// Thunk middleware lets me dispatch thunk async actions</span></a>
<a class="sourceLine" id="cb10-68" title="68"><span class="co">// as if they were actions!</span></a>
<a class="sourceLine" id="cb10-69" title="69"></a>
<a class="sourceLine" id="cb10-70" title="70"><span class="va">store</span>.<span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-71" title="71">  <span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;Me&#39;</span>)</a>
<a class="sourceLine" id="cb10-72" title="72">)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-73" title="73"></a>
<a class="sourceLine" id="cb10-74" title="74"><span class="co">// It even takes care to return the thunk’s return value</span></a>
<a class="sourceLine" id="cb10-75" title="75"><span class="co">// from the dispatch, so I can chain Promises as long as I return them.</span></a>
<a class="sourceLine" id="cb10-76" title="76"></a>
<a class="sourceLine" id="cb10-77" title="77"><span class="va">store</span>.<span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-78" title="78">  <span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;My wife&#39;</span>)</a>
<a class="sourceLine" id="cb10-79" title="79">).<span class="at">then</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-80" title="80">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Done!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-81" title="81"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-82" title="82"></a>
<a class="sourceLine" id="cb10-83" title="83"><span class="co">// In fact I can write action creators that dispatch</span></a>
<a class="sourceLine" id="cb10-84" title="84"><span class="co">// actions and async actions from other action creators,</span></a>
<a class="sourceLine" id="cb10-85" title="85"><span class="co">// and I can build my control flow with Promises.</span></a>
<a class="sourceLine" id="cb10-86" title="86"></a>
<a class="sourceLine" id="cb10-87" title="87"><span class="kw">function</span> <span class="at">makeSandwichesForEverybody</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-88" title="88">  <span class="cf">return</span> <span class="kw">function</span> (dispatch<span class="op">,</span> getState) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-89" title="89">    <span class="cf">if</span> (<span class="op">!</span><span class="at">getState</span>().<span class="va">sandwiches</span>.<span class="at">isShopOpen</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-90" title="90"></a>
<a class="sourceLine" id="cb10-91" title="91">      <span class="co">// You don’t have to return Promises, but it’s a handy convention</span></a>
<a class="sourceLine" id="cb10-92" title="92">      <span class="co">// so the caller can always call .then() on async dispatch result.</span></a>
<a class="sourceLine" id="cb10-93" title="93"></a>
<a class="sourceLine" id="cb10-94" title="94">      <span class="cf">return</span> <span class="va">Promise</span>.<span class="at">resolve</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb10-95" title="95">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-96" title="96"></a>
<a class="sourceLine" id="cb10-97" title="97">    <span class="co">// We can dispatch both plain object actions and other thunks,</span></a>
<a class="sourceLine" id="cb10-98" title="98">    <span class="co">// which lets us compose the asynchronous actions in a single flow.</span></a>
<a class="sourceLine" id="cb10-99" title="99"></a>
<a class="sourceLine" id="cb10-100" title="100">    <span class="cf">return</span> <span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-101" title="101">      <span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;My Grandma&#39;</span>)</a>
<a class="sourceLine" id="cb10-102" title="102">    ).<span class="at">then</span>(() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-103" title="103">      <span class="va">Promise</span>.<span class="at">all</span>([</a>
<a class="sourceLine" id="cb10-104" title="104">        <span class="at">dispatch</span>(<span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;Me&#39;</span>))<span class="op">,</span></a>
<a class="sourceLine" id="cb10-105" title="105">        <span class="at">dispatch</span>(<span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;My wife&#39;</span>))</a>
<a class="sourceLine" id="cb10-106" title="106">      ])</a>
<a class="sourceLine" id="cb10-107" title="107">    ).<span class="at">then</span>(() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-108" title="108">      <span class="at">dispatch</span>(<span class="at">makeASandwichWithSecretSauce</span>(<span class="st">&#39;Our kids&#39;</span>))</a>
<a class="sourceLine" id="cb10-109" title="109">    ).<span class="at">then</span>(() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-110" title="110">      <span class="at">dispatch</span>(<span class="at">getState</span>().<span class="at">myMoney</span> <span class="op">&gt;</span> <span class="dv">42</span> <span class="op">?</span></a>
<a class="sourceLine" id="cb10-111" title="111">        <span class="at">withdrawMoney</span>(<span class="dv">42</span>) :</a>
<a class="sourceLine" id="cb10-112" title="112">        <span class="at">apologize</span>(<span class="st">&#39;Me&#39;</span><span class="op">,</span> <span class="st">&#39;The Sandwich Shop&#39;</span>)</a>
<a class="sourceLine" id="cb10-113" title="113">      )</a>
<a class="sourceLine" id="cb10-114" title="114">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb10-115" title="115">  <span class="op">};</span></a>
<a class="sourceLine" id="cb10-116" title="116"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-117" title="117"></a>
<a class="sourceLine" id="cb10-118" title="118"><span class="co">// This is very useful for server side rendering, because I can wait</span></a>
<a class="sourceLine" id="cb10-119" title="119"><span class="co">// until data is available, then synchronously render the app.</span></a>
<a class="sourceLine" id="cb10-120" title="120"></a>
<a class="sourceLine" id="cb10-121" title="121"><span class="va">store</span>.<span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-122" title="122">  <span class="at">makeSandwichesForEverybody</span>()</a>
<a class="sourceLine" id="cb10-123" title="123">).<span class="at">then</span>(() <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb10-124" title="124">  <span class="va">response</span>.<span class="at">send</span>(<span class="va">ReactDOMServer</span>.<span class="at">renderToString</span>(<span class="op">&lt;</span>MyApp store<span class="op">={</span>store<span class="op">}</span> /&gt;))</a>
<a class="sourceLine" id="cb10-125" title="125">)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-126" title="126"></a>
<a class="sourceLine" id="cb10-127" title="127"><span class="co">// I can also dispatch a thunk async action from a component</span></a>
<a class="sourceLine" id="cb10-128" title="128"><span class="co">// any time its props change to load the missing data.</span></a>
<a class="sourceLine" id="cb10-129" title="129"></a>
<a class="sourceLine" id="cb10-130" title="130"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-131" title="131"><span class="im">import</span> <span class="op">{</span> Component <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-132" title="132"></a>
<a class="sourceLine" id="cb10-133" title="133"><span class="kw">class</span> SandwichShop <span class="kw">extends</span> Component <span class="op">{</span></a>
<a class="sourceLine" id="cb10-134" title="134">  <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-135" title="135">    <span class="kw">this</span>.<span class="va">props</span>.<span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-136" title="136">      <span class="at">makeASandwichWithSecretSauce</span>(<span class="kw">this</span>.<span class="va">props</span>.<span class="at">forPerson</span>)</a>
<a class="sourceLine" id="cb10-137" title="137">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb10-138" title="138">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-139" title="139"></a>
<a class="sourceLine" id="cb10-140" title="140">  <span class="at">componentDidUpdate</span>(prevProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-141" title="141">    <span class="cf">if</span> (<span class="va">prevProps</span>.<span class="at">forPerson</span> <span class="op">!==</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="at">forPerson</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-142" title="142">      <span class="kw">this</span>.<span class="va">props</span>.<span class="at">dispatch</span>(</a>
<a class="sourceLine" id="cb10-143" title="143">        <span class="at">makeASandwichWithSecretSauce</span>(<span class="kw">this</span>.<span class="va">props</span>.<span class="at">forPerson</span>)</a>
<a class="sourceLine" id="cb10-144" title="144">      )<span class="op">;</span></a>
<a class="sourceLine" id="cb10-145" title="145">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-146" title="146">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-147" title="147"></a>
<a class="sourceLine" id="cb10-148" title="148">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-149" title="149">    <span class="cf">return</span> <span class="op">&lt;</span>p<span class="op">&gt;{</span><span class="kw">this</span>.<span class="va">props</span>.<span class="va">sandwiches</span>.<span class="at">join</span>(<span class="st">&#39;mustard&#39;</span>)<span class="op">}</span>&lt;/p<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-150" title="150">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-151" title="151"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-152" title="152"></a>
<a class="sourceLine" id="cb10-153" title="153"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb10-154" title="154">  state <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb10-155" title="155">    <span class="dt">sandwiches</span><span class="op">:</span> <span class="va">state</span>.<span class="at">sandwiches</span></a>
<a class="sourceLine" id="cb10-156" title="156">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-157" title="157">)(SandwichShop)<span class="op">;</span></a></code></pre></div>
<h2 id="injecting-a-custom-argument">Injecting a Custom Argument</h2>
<p>Since 2.1.0, Redux Thunk supports injecting a custom argument using the <code>withExtraArgument</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  reducer<span class="op">,</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="at">applyMiddleware</span>(<span class="va">thunk</span>.<span class="at">withExtraArgument</span>(api))</a>
<a class="sourceLine" id="cb11-4" title="4">)</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">// later</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="kw">function</span> <span class="at">fetchUser</span>(id) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="cf">return</span> (dispatch<span class="op">,</span> getState<span class="op">,</span> api) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-9" title="9">    <span class="co">// you can use api here</span></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="op">}</span></a></code></pre></div>
<p>To pass multiple things, just wrap them in a single object and use destructuring:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  reducer<span class="op">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="at">applyMiddleware</span>(<span class="va">thunk</span>.<span class="at">withExtraArgument</span>(<span class="op">{</span> api<span class="op">,</span> whatever <span class="op">}</span>))</a>
<a class="sourceLine" id="cb12-4" title="4">)</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">// later</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">function</span> <span class="at">fetchUser</span>(id) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="cf">return</span> (dispatch<span class="op">,</span> getState<span class="op">,</span> <span class="op">{</span> api<span class="op">,</span> whatever <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="co">// you can use api and something else here</span></a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="op">}</span></a></code></pre></div>
<h2 id="license">License</h2>
<p>MIT</p>
</body>
</html>
