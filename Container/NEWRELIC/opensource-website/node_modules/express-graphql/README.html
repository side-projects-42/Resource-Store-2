<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="graphql-http-server-middleware">GraphQL HTTP Server Middleware</h1>
<p><a href="https://travis-ci.org/graphql/express-graphql"><img src="https://travis-ci.org/graphql/express-graphql.svg?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/graphql/express-graphql?branch=master"><img src="https://coveralls.io/repos/graphql/express-graphql/badge.svg?branch=master&amp;service=github" alt="Coverage Status" /></a></p>
<p>Create a GraphQL HTTP server with any HTTP web framework that supports connect styled middleware, including <a href="https://github.com/senchalabs/connect">Connect</a> itself, <a href="https://expressjs.com">Express</a> and <a href="http://restify.com/">Restify</a>.</p>
<h2 id="installation">Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> install --save express-graphql</a></code></pre></div>
<h3 id="typescript">TypeScript</h3>
<p>This module includes a <a href="https://www.typescriptlang.org/">TypeScript</a> declaration file to enable auto complete in compatible editors and type information for TypeScript projects. This module depends on ‘graphql’ and the Node.js types, so install <code>@types/graphql</code> and <code>@types/node</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1">$ <span class="ex">npm</span> install --save --dev @types/graphql @types/node</a></code></pre></div>
<h2 id="simple-setup">Simple Setup</h2>
<p>Just mount <code>express-graphql</code> as a route handler:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> graphqlHTTP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-graphql&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">const</span> app <span class="op">=</span> <span class="at">express</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="va">app</span>.<span class="at">use</span>(</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="at">graphqlHTTP</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="dt">schema</span><span class="op">:</span> MyGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb3-12" title="12">)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="va">app</span>.<span class="at">listen</span>(<span class="dv">4000</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="setup-with-restify">Setup with Restify</h2>
<p>Use <code>.get</code> or <code>.post</code> (or both) rather than <code>.use</code> to configure your route handler. If you want to show GraphiQL in the browser, set <code>graphiql: true</code> on your <code>.get</code> handler.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> restify <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;restify&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> graphqlHTTP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-graphql&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">const</span> app <span class="op">=</span> <span class="va">restify</span>.<span class="at">createServer</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="va">app</span>.<span class="at">post</span>(</a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="at">graphqlHTTP</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">schema</span><span class="op">:</span> MyGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb4-12" title="12">)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="va">app</span>.<span class="at">get</span>(</a>
<a class="sourceLine" id="cb4-15" title="15">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="at">graphqlHTTP</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-17" title="17">    <span class="dt">schema</span><span class="op">:</span> MyGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb4-18" title="18">    <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-19" title="19">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb4-20" title="20">)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-21" title="21"></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="va">app</span>.<span class="at">listen</span>(<span class="dv">4000</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="options">Options</h2>
<p>The <code>graphqlHTTP</code> function accepts the following options:</p>
<ul>
<li><p><strong><code>schema</code></strong>: A <code>GraphQLSchema</code> instance from <a href="https://github.com/graphql/graphql-js"><code>GraphQL.js</code></a>. A <code>schema</code> <em>must</em> be provided.</p></li>
<li><p><strong><code>graphiql</code></strong>: If <code>true</code>, presents <a href="https://github.com/graphql/graphiql">GraphiQL</a> when the GraphQL endpoint is loaded in a browser. We recommend that you set <code>graphiql</code> to <code>true</code> when your app is in development, because it’s quite useful. You may or may not want it in production. Alternatively, instead of <code>true</code> you can pass in an options object:</p>
<ul>
<li><strong><code>defaultQuery</code></strong>: An optional GraphQL string to use when no query is provided and no stored query exists from a previous session. If undefined is provided, GraphiQL will use its own default query.</li>
</ul></li>
<li><p><strong><code>rootValue</code></strong>: A value to pass as the <code>rootValue</code> to the <code>graphql()</code> function from <a href="https://github.com/graphql/graphql-js/blob/master/src/execution/execute.js#L119"><code>GraphQL.js/src/execute.js</code></a>.</p></li>
<li><p><strong><code>context</code></strong>: A value to pass as the <code>context</code> to the <code>graphql()</code> function from <a href="https://github.com/graphql/graphql-js/blob/master/src/execution/execute.js#L120"><code>GraphQL.js/src/execute.js</code></a>. If <code>context</code> is not provided, the <code>request</code> object is passed as the context.</p></li>
<li><p><strong><code>pretty</code></strong>: If <code>true</code>, any JSON response will be pretty-printed.</p></li>
<li><p><strong><code>extensions</code></strong>: An optional function for adding additional metadata to the GraphQL response as a key-value object. The result will be added to <code>"extensions"</code> field in the resulting JSON. This is often a useful place to add development time metadata such as the runtime of a query or the amount of resources consumed. This may be an async function. The function is given one object as an argument: <code>{ document, variables, operationName, result, context }</code>.</p></li>
<li><p><strong><code>validationRules</code></strong>: Optional additional validation rules queries must satisfy in addition to those defined by the GraphQL spec.</p></li>
<li><p><strong><code>customValidateFn</code></strong>: An optional function which will be used to validate instead of default <code>validate</code> from <code>graphql-js</code>.</p></li>
<li><p><strong><code>customExecuteFn</code></strong>: An optional function which will be used to execute instead of default <code>execute</code> from <code>graphql-js</code>.</p></li>
<li><p><strong><code>customFormatErrorFn</code></strong>: An optional function which will be used to format any errors produced by fulfilling a GraphQL operation. If no function is provided, GraphQL’s default spec-compliant <a href="https://github.com/graphql/graphql-js/blob/master/src/error/formatError.js"><code>formatError</code></a> function will be used.</p></li>
<li><p><strong><code>customParseFn</code></strong>: An optional function which will be used to create a document instead of the default <code>parse</code> from <code>graphql-js</code>.</p></li>
<li><p><strong><code>formatError</code></strong>: is deprecated and replaced by <code>customFormatErrorFn</code>. It will be removed in version 1.0.0.</p></li>
</ul>
<p>In addition to an object defining each option, options can also be provided as a function (or async function) which returns this options object. This function is provided the arguments <code>(request, response, graphQLParams)</code> and is called after the request has been parsed.</p>
<p>The <code>graphQLParams</code> is provided as the object <code>{ query, variables, operationName, raw }</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">app</span>.<span class="at">use</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="at">graphqlHTTP</span>(<span class="kw">async</span> (request<span class="op">,</span> response<span class="op">,</span> graphQLParams) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">schema</span><span class="op">:</span> MyGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">rootValue</span><span class="op">:</span> <span class="cf">await</span> <span class="at">someFunctionToGetRootValue</span>(request)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="op">}</span>))<span class="op">,</span></a>
<a class="sourceLine" id="cb5-8" title="8">)<span class="op">;</span></a></code></pre></div>
<h2 id="http-usage">HTTP Usage</h2>
<p>Once installed at a path, <code>express-graphql</code> will accept requests with the parameters:</p>
<ul>
<li><p><strong><code>query</code></strong>: A string GraphQL document to be executed.</p></li>
<li><p><strong><code>variables</code></strong>: The runtime values to use for any GraphQL query variables as a JSON object.</p></li>
<li><p><strong><code>operationName</code></strong>: If the provided <code>query</code> contains multiple named operations, this specifies which operation should be executed. If not provided, a 400 error will be returned if the <code>query</code> contains multiple named operations.</p></li>
<li><p><strong><code>raw</code></strong>: If the <code>graphiql</code> option is enabled and the <code>raw</code> parameter is provided raw JSON will always be returned instead of GraphiQL even when loaded from a browser.</p></li>
</ul>
<p>GraphQL will first look for each parameter in the URL’s query-string:</p>
<pre><code>/graphql?query=query+getUser($id:ID){user(id:$id){name}}&amp;variables={&quot;id&quot;:&quot;4&quot;}</code></pre>
<p>If not found in the query-string, it will look in the POST request body.</p>
<p>If a previous middleware has already parsed the POST body, the <code>request.body</code> value will be used. Use <a href="https://github.com/expressjs/multer"><code>multer</code></a> or a similar middleware to add support for <code>multipart/form-data</code> content, which may be useful for GraphQL mutations involving uploading files. See an <a href="https://github.com/graphql/express-graphql/blob/304b24b993c8f16fffff8d23b0fa4088e690874b/src/__tests__/http-test.js#L674-L741">example using multer</a>.</p>
<p>If the POST body has not yet been parsed, express-graphql will interpret it depending on the provided <em>Content-Type</em> header.</p>
<ul>
<li><p><strong><code>application/json</code></strong>: the POST body will be parsed as a JSON object of parameters.</p></li>
<li><p><strong><code>application/x-www-form-urlencoded</code></strong>: this POST body will be parsed as a url-encoded string of key-value pairs.</p></li>
<li><p><strong><code>application/graphql</code></strong>: The POST body will be parsed as GraphQL query string, which provides the <code>query</code> parameter.</p></li>
</ul>
<h2 id="combining-with-other-express-middleware">Combining with Other Express Middleware</h2>
<p>By default, the express request is passed as the GraphQL <code>context</code>. Since most express middleware operates by adding extra data to the request object, this means you can use most express middleware just by inserting it before <code>graphqlHTTP</code> is mounted. This covers scenarios such as authenticating the user, handling file uploads, or mounting GraphQL on a dynamic endpoint.</p>
<p>This example uses <a href="https://github.com/expressjs/session"><code>express-session</code></a> to provide GraphQL with the currently logged-in session.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> session <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-session&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> graphqlHTTP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-graphql&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">const</span> app <span class="op">=</span> <span class="at">express</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="va">app</span>.<span class="at">use</span>(<span class="at">session</span>(<span class="op">{</span> <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;keyboard cat&#39;</span><span class="op">,</span> <span class="dt">cookie</span><span class="op">:</span> <span class="op">{</span> <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">60000</span> <span class="op">}</span> <span class="op">}</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="va">app</span>.<span class="at">use</span>(</a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="at">graphqlHTTP</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="dt">schema</span><span class="op">:</span> MySessionAwareGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb7-14" title="14">)<span class="op">;</span></a></code></pre></div>
<p>Then in your type definitions, you can access the request via the third “context” argument in your <code>resolve</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">new</span> <span class="at">GraphQLObjectType</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;MyType&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">fields</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="dt">myField</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-5" title="5">      <span class="dt">type</span><span class="op">:</span> GraphQLString<span class="op">,</span></a>
<a class="sourceLine" id="cb8-6" title="6">      <span class="at">resolve</span>(parentValue<span class="op">,</span> args<span class="op">,</span> request) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-7" title="7">        <span class="co">// use `request.session` here</span></a>
<a class="sourceLine" id="cb8-8" title="8">      <span class="op">},</span></a>
<a class="sourceLine" id="cb8-9" title="9">    <span class="op">},</span></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="op">},</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="providing-extensions">Providing Extensions</h2>
<p>The GraphQL response allows for adding additional information in a response to a GraphQL query via a field in the response called <code>"extensions"</code>. This is added by providing an <code>extensions</code> function when using <code>graphqlHTTP</code>. The function must return a JSON-serializable Object.</p>
<p>When called, this is provided an argument which you can use to get information about the GraphQL request:</p>
<p><code>{ document, variables, operationName, result, context }</code></p>
<p>This example illustrates adding the amount of time consumed by running the provided query, which could perhaps be used by your development tools.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">const</span> graphqlHTTP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-graphql&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">const</span> app <span class="op">=</span> <span class="at">express</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="va">app</span>.<span class="at">use</span>(<span class="at">session</span>(<span class="op">{</span> <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;keyboard cat&#39;</span><span class="op">,</span> <span class="dt">cookie</span><span class="op">:</span> <span class="op">{</span> <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">60000</span> <span class="op">}</span> <span class="op">}</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">const</span> extensions <span class="op">=</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb9-8" title="8">  document<span class="op">,</span></a>
<a class="sourceLine" id="cb9-9" title="9">  variables<span class="op">,</span></a>
<a class="sourceLine" id="cb9-10" title="10">  operationName<span class="op">,</span></a>
<a class="sourceLine" id="cb9-11" title="11">  result<span class="op">,</span></a>
<a class="sourceLine" id="cb9-12" title="12">  context<span class="op">,</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-14" title="14">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-15" title="15">    <span class="dt">runTime</span><span class="op">:</span> <span class="va">Date</span>.<span class="at">now</span>() <span class="op">-</span> <span class="va">context</span>.<span class="at">startTime</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-16" title="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="op">};</span></a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="va">app</span>.<span class="at">use</span>(</a>
<a class="sourceLine" id="cb9-20" title="20">  <span class="st">&#39;/graphql&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-21" title="21">  <span class="at">graphqlHTTP</span>(request <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-22" title="22">    <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-23" title="23">      <span class="dt">schema</span><span class="op">:</span> MyGraphQLSchema<span class="op">,</span></a>
<a class="sourceLine" id="cb9-24" title="24">      <span class="dt">context</span><span class="op">:</span> <span class="op">{</span> <span class="dt">startTime</span><span class="op">:</span> <span class="va">Date</span>.<span class="at">now</span>() <span class="op">},</span></a>
<a class="sourceLine" id="cb9-25" title="25">      <span class="dt">graphiql</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-26" title="26">      extensions<span class="op">,</span></a>
<a class="sourceLine" id="cb9-27" title="27">    <span class="op">};</span></a>
<a class="sourceLine" id="cb9-28" title="28">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb9-29" title="29">)<span class="op">;</span></a></code></pre></div>
<p>When querying this endpoint, it would include this information in the result, for example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="st">&quot;data&quot;</span><span class="op">:</span> <span class="op">{</span> ... <span class="op">}</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="st">&quot;extensions&quot;</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="st">&quot;runTime&quot;</span><span class="op">:</span> <span class="dv">135</span></a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="op">}</span></a></code></pre></div>
<h2 id="additional-validation-rules">Additional Validation Rules</h2>
<p>GraphQL’s <a href="https://graphql.github.io/graphql-spec/#sec-Validation">validation phase</a> checks the query to ensure that it can be successfully executed against the schema. The <code>validationRules</code> option allows for additional rules to be run during this phase. Rules are applied to each node in an AST representing the query using the Visitor pattern.</p>
<p>A validation rule is a function which returns a visitor for one or more node Types. Below is an example of a validation preventing the specific fieldname <code>metadata</code> from being queried. For more examples see the <a href="https://github.com/graphql/graphql-js/tree/master/src/validation/rules"><code>specifiedRules</code></a> in the <a href="https://github.com/graphql/graphql-js">graphql-js</a> package.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="im">import</span> <span class="op">{</span> GraphQLError <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;graphql&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="im">export</span> <span class="kw">function</span> <span class="at">DisallowMetadataQueries</span>(context) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="at">Field</span>(node) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-6" title="6">      <span class="kw">const</span> fieldName <span class="op">=</span> <span class="va">node</span>.<span class="va">name</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">      <span class="cf">if</span> (fieldName <span class="op">===</span> <span class="st">&#39;metadata&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-9" title="9">        <span class="va">context</span>.<span class="at">reportError</span>(</a>
<a class="sourceLine" id="cb11-10" title="10">          <span class="kw">new</span> <span class="at">GraphQLError</span>(</a>
<a class="sourceLine" id="cb11-11" title="11">            <span class="vs">`Validation: Requesting the field </span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> is not allowed`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-12" title="12">          )<span class="op">,</span></a>
<a class="sourceLine" id="cb11-13" title="13">        )<span class="op">;</span></a>
<a class="sourceLine" id="cb11-14" title="14">      <span class="op">}</span></a>
<a class="sourceLine" id="cb11-15" title="15">    <span class="op">},</span></a>
<a class="sourceLine" id="cb11-16" title="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="op">}</span></a></code></pre></div>
<h2 id="other-exports">Other Exports</h2>
<p><strong><code>getGraphQLParams(request: Request): Promise&lt;GraphQLParams&gt;</code></strong></p>
<p>Given an HTTP Request, this returns a Promise for the parameters relevant to running a GraphQL request. This function is used internally to handle the incoming request, you may use it directly for building other similar services.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> graphqlHTTP <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-graphql&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="va">graphqlHTTP</span>.<span class="at">getGraphQLParams</span>(request).<span class="at">then</span>(params <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="co">// do something...</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="debugging-tips">Debugging Tips</h2>
<p>During development, it’s useful to get more information from errors, such as stack traces. Providing a function to <code>customFormatErrorFn</code> enables this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1">customFormatErrorFn<span class="op">:</span> error <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="dt">message</span><span class="op">:</span> <span class="va">error</span>.<span class="at">message</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dt">locations</span><span class="op">:</span> <span class="va">error</span>.<span class="at">locations</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">stack</span><span class="op">:</span> <span class="va">error</span>.<span class="at">stack</span> <span class="op">?</span> <span class="va">error</span>.<span class="va">stack</span>.<span class="at">split</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>) : []<span class="op">,</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="dt">path</span><span class="op">:</span> <span class="va">error</span>.<span class="at">path</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</body>
</html>
