<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="raw-body">raw-body</h1>
<p><a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/v/raw-body.svg" alt="NPM Version" /></a> <a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/dm/raw-body.svg" alt="NPM Downloads" /></a> <a href="https://nodejs.org/en/download/"><img src="https://img.shields.io/node/v/raw-body.svg" alt="Node.js Version" /></a> <a href="https://travis-ci.org/stream-utils/raw-body"><img src="https://img.shields.io/travis/stream-utils/raw-body/master.svg" alt="Build status" /></a> <a href="https://coveralls.io/r/stream-utils/raw-body?branch=master"><img src="https://img.shields.io/coveralls/stream-utils/raw-body/master.svg" alt="Test coverage" /></a></p>
<p>Gets the entire buffer of a stream either as a <code>Buffer</code> or a string. Validates the streamâ€™s length against an expected length and maximum limit. Ideal for parsing request bodies.</p>
<h2 id="install">Install</h2>
<p>This is a <a href="https://nodejs.org/en/">Node.js</a> module available through the <a href="https://www.npmjs.com/">npm registry</a>. Installation is done using the <a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"><code>npm install</code> command</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">npm</span> install raw-body</a></code></pre></div>
<h3 id="typescript">TypeScript</h3>
<p>This module includes a <a href="https://www.typescriptlang.org/">TypeScript</a> declaration file to enable auto complete in compatible editors and type information for TypeScript projects. This module depends on the Node.js types, so install <code>@types/node</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1">$ <span class="ex">npm</span> install @types/node</a></code></pre></div>
<h2 id="api">API</h2>
<!-- eslint-disable no-unused-vars -->
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> getRawBody <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;raw-body&#39;</span>)</a></code></pre></div>
<h3 id="getrawbodystream-options-callback">getRawBody(stream, [options], [callback])</h3>
<p><strong>Returns a promise if no callback specified and global <code>Promise</code> exists.</strong></p>
<p>Options:</p>
<ul>
<li><code>length</code> - The length of the stream. If the contents of the stream do not add up to this length, an <code>400</code> error code is returned.</li>
<li><code>limit</code> - The byte limit of the body. This is the number of bytes or any string format supported by <a href="https://www.npmjs.com/package/bytes">bytes</a>, for example <code>1000</code>, <code>'500kb'</code> or <code>'3mb'</code>. If the body ends up being larger than this limit, a <code>413</code> error code is returned.</li>
<li><code>encoding</code> - The encoding to use to decode the body into a string. By default, a <code>Buffer</code> instance will be returned when no encoding is specified. Most likely, you want <code>utf-8</code>, so setting <code>encoding</code> to <code>true</code> will decode as <code>utf-8</code>. You can use any type of encoding supported by <a href="https://www.npmjs.org/package/iconv-lite#readme">iconv-lite</a>.</li>
</ul>
<p>You can also pass a string in place of options to just specify the encoding.</p>
<p>If an error occurs, the stream will be paused, everything unpiped, and you are responsible for correctly disposing the stream. For HTTP requests, no handling is required if you send a response. For streams that use file descriptors, you should <code>stream.destroy()</code> or <code>stream.close()</code> to prevent leaks.</p>
<h2 id="errors">Errors</h2>
<p>This module creates errors depending on the error condition during reading. The error may be an error from the underlying Node.js implementation, but is otherwise an error created by this module, which has the following attributes:</p>
<ul>
<li><code>limit</code> - the limit in bytes</li>
<li><code>length</code> and <code>expected</code> - the expected length of the stream</li>
<li><code>received</code> - the received bytes</li>
<li><code>encoding</code> - the invalid encoding</li>
<li><code>status</code> and <code>statusCode</code> - the corresponding status code for the error</li>
<li><code>type</code> - the error type</li>
</ul>
<h3 id="types">Types</h3>
<p>The errors from this module have a <code>type</code> property which allows for the progamatic determination of the type of error returned.</p>
<h4 id="encoding.unsupported">encoding.unsupported</h4>
<p>This error will occur when the <code>encoding</code> option is specified, but the value does not map to an encoding supported by the <a href="https://www.npmjs.org/package/iconv-lite#readme">iconv-lite</a> module.</p>
<h4 id="entity.too.large">entity.too.large</h4>
<p>This error will occur when the <code>limit</code> option is specified, but the stream has an entity that is larger.</p>
<h4 id="request.aborted">request.aborted</h4>
<p>This error will occur when the request stream is aborted by the client before reading the body has finished.</p>
<h4 id="request.size.invalid">request.size.invalid</h4>
<p>This error will occur when the <code>length</code> option is specified, but the stream has emitted more bytes.</p>
<h4 id="stream.encoding.set">stream.encoding.set</h4>
<p>This error will occur when the given stream has an encoding set on it, making it a decoded stream. The stream should not have an encoding set and is expected to emit <code>Buffer</code> objects.</p>
<h2 id="examples">Examples</h2>
<h3 id="simple-express-example">Simple Express example</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> contentType <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;content-type&#39;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">var</span> getRawBody <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;raw-body&#39;</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="va">app</span>.<span class="at">use</span>(<span class="kw">function</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="at">getRawBody</span>(req<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">length</span><span class="op">:</span> <span class="va">req</span>.<span class="at">headers</span>[<span class="st">&#39;content-length&#39;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">limit</span><span class="op">:</span> <span class="st">&#39;1mb&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">encoding</span><span class="op">:</span> <span class="va">contentType</span>.<span class="at">parse</span>(req).<span class="va">parameters</span>.<span class="at">charset</span></a>
<a class="sourceLine" id="cb4-12" title="12">  <span class="op">},</span> <span class="kw">function</span> (err<span class="op">,</span> string) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="cf">if</span> (err) <span class="cf">return</span> <span class="at">next</span>(err)</a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="va">req</span>.<span class="at">text</span> <span class="op">=</span> string</a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="at">next</span>()</a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-17" title="17"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">// now access req.text</span></a></code></pre></div>
<h3 id="simple-koa-example">Simple Koa example</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> contentType <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;content-type&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> getRawBody <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;raw-body&#39;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">var</span> koa <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;koa&#39;</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">var</span> app <span class="op">=</span> <span class="at">koa</span>()</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="va">app</span>.<span class="at">use</span>(<span class="kw">function</span> <span class="op">*</span> (next) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="kw">this</span>.<span class="at">text</span> <span class="op">=</span> <span class="kw">yield</span> <span class="at">getRawBody</span>(<span class="kw">this</span>.<span class="at">req</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="dt">length</span><span class="op">:</span> <span class="kw">this</span>.<span class="va">req</span>.<span class="at">headers</span>[<span class="st">&#39;content-length&#39;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="dt">limit</span><span class="op">:</span> <span class="st">&#39;1mb&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="dt">encoding</span><span class="op">:</span> <span class="va">contentType</span>.<span class="at">parse</span>(<span class="kw">this</span>.<span class="at">req</span>).<span class="va">parameters</span>.<span class="at">charset</span></a>
<a class="sourceLine" id="cb5-12" title="12">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-13" title="13">  <span class="kw">yield</span> next</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">// now access this.text</span></a></code></pre></div>
<h3 id="using-as-a-promise">Using as a promise</h3>
<p>To use this library as a promise, simply omit the <code>callback</code> and a promise is returned, provided that a global <code>Promise</code> is defined.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> getRawBody <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;raw-body&#39;</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">var</span> server <span class="op">=</span> <span class="va">http</span>.<span class="at">createServer</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="at">getRawBody</span>(req)</a>
<a class="sourceLine" id="cb6-6" title="6">    .<span class="at">then</span>(<span class="kw">function</span> (buf) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">      <span class="va">res</span>.<span class="at">statusCode</span> <span class="op">=</span> <span class="dv">200</span></a>
<a class="sourceLine" id="cb6-8" title="8">      <span class="va">res</span>.<span class="at">end</span>(<span class="va">buf</span>.<span class="at">length</span> <span class="op">+</span> <span class="st">&#39; bytes submitted&#39;</span>)</a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">    .<span class="at">catch</span>(<span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">      <span class="va">res</span>.<span class="at">statusCode</span> <span class="op">=</span> <span class="dv">500</span></a>
<a class="sourceLine" id="cb6-12" title="12">      <span class="va">res</span>.<span class="at">end</span>(<span class="va">err</span>.<span class="at">message</span>)</a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-14" title="14"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="va">server</span>.<span class="at">listen</span>(<span class="dv">3000</span>)</a></code></pre></div>
<h3 id="using-with-typescript">Using with TypeScript</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode ts"><code class="sourceCode typescript"><a class="sourceLine" id="cb7-1" title="1"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> getRawBody <span class="im">from</span> <span class="st">&#39;raw-body&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> http <span class="im">from</span> <span class="st">&#39;http&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">const</span> server <span class="op">=</span> <span class="va">http</span><span class="op">.</span><span class="fu">createServer</span>((req<span class="op">,</span> res) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="fu">getRawBody</span>(req)</a>
<a class="sourceLine" id="cb7-6" title="6">  .<span class="fu">then</span>((buf) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="va">res</span><span class="op">.</span><span class="at">statusCode</span> <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="va">res</span><span class="op">.</span><span class="fu">end</span>(<span class="va">buf</span><span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="st">&#39; bytes submitted&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-10" title="10">  .<span class="fu">catch</span>((err) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="va">res</span><span class="op">.</span><span class="at">statusCode</span> <span class="op">=</span> <span class="va">err</span><span class="op">.</span><span class="at">statusCode</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-12" title="12">    <span class="va">res</span><span class="op">.</span><span class="fu">end</span>(<span class="va">err</span><span class="op">.</span><span class="at">message</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="va">server</span><span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="license">License</h2>
<p><a href="LICENSE">MIT</a></p>
</body>
</html>
