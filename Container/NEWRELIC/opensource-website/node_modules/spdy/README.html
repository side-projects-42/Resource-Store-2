<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="spdy-server-for-node.js">SPDY Server for node.js</h1>
<p><a href="http://travis-ci.org/spdy-http2/node-spdy"><img src="https://travis-ci.org/spdy-http2/node-spdy.svg?branch=master" alt="Build Status" /></a> <a href="http://badge.fury.io/js/spdy"><img src="https://badge.fury.io/js/spdy.svg" alt="NPM version" /></a> <a href="https://david-dm.org/spdy-http2/node-spdy"><img src="https://david-dm.org/spdy-http2/node-spdy/status.svg?style=flat-square" alt="dependencies Status" /></a> <a href="http://standardjs.com/"><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg?style=flat-square" alt="Standard - JavaScript Style Guide" /></a> <a href="https://waffle.io/spdy-http2/node-spdy"><img src="https://img.shields.io/badge/track-waffle-blue.svg?style=flat-square" alt="Waffle" /></a></p>
<p>With this module you can create <a href="https://http2.github.io/">HTTP2</a> / <a href="http://www.chromium.org/spdy">SPDY</a> servers in node.js with natural http module interface and fallback to regular https (for browsers that don’t support neither HTTP2, nor SPDY yet).</p>
<p>This module named <code>spdy</code> but it <a href="https://github.com/indutny/node-spdy/issues/269#issuecomment-239014184">provides</a> support for both http/2 (h2) and spdy (2,3,3.1). Also, <code>spdy</code> is compatible with Express.</p>
<h2 id="usage">Usage</h2>
<h3 id="examples">Examples</h3>
<p>Server:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> spdy <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;spdy&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb1-2" title="2">    fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">var</span> options <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="co">// Private key</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">key</span><span class="op">:</span> <span class="va">fs</span>.<span class="at">readFileSync</span>(__dirname <span class="op">+</span> <span class="st">&#39;/keys/spdy-key.pem&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="co">// Fullchain file or cert file (prefer the former)</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="dt">cert</span><span class="op">:</span> <span class="va">fs</span>.<span class="at">readFileSync</span>(__dirname <span class="op">+</span> <span class="st">&#39;/keys/spdy-fullchain.pem&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11">  <span class="co">// **optional** SPDY-specific options</span></a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="dt">spdy</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="dt">protocols</span><span class="op">:</span> [ <span class="st">&#39;h2&#39;</span><span class="op">,</span> <span class="st">&#39;spdy/3.1&#39;</span><span class="op">,</span> ...<span class="op">,</span> <span class="st">&#39;http/1.1&#39;</span> ]<span class="op">,</span></a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">plain</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16">    <span class="co">// **optional**</span></a>
<a class="sourceLine" id="cb1-17" title="17">    <span class="co">// Parse first incoming X_FORWARDED_FOR frame and put it to the</span></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="co">// headers of every request.</span></a>
<a class="sourceLine" id="cb1-19" title="19">    <span class="co">// </span><span class="al">NOTE</span><span class="co">: Use with care! This should not be used without some proxy that</span></a>
<a class="sourceLine" id="cb1-20" title="20">    <span class="co">// will *always* send X_FORWARDED_FOR</span></a>
<a class="sourceLine" id="cb1-21" title="21">    <span class="st">&#39;x-forwarded-for&#39;</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23">    <span class="dt">connection</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-24" title="24">      <span class="dt">windowSize</span><span class="op">:</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">,</span> <span class="co">// Server&#39;s window size</span></a>
<a class="sourceLine" id="cb1-25" title="25"></a>
<a class="sourceLine" id="cb1-26" title="26">      <span class="co">// **optional** if true - server will send 3.1 frames on 3.0 *plain* spdy</span></a>
<a class="sourceLine" id="cb1-27" title="27">      <span class="dt">autoSpdy31</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-29" title="29">  <span class="op">}</span></a>
<a class="sourceLine" id="cb1-30" title="30"><span class="op">};</span></a>
<a class="sourceLine" id="cb1-31" title="31"></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="kw">var</span> server <span class="op">=</span> <span class="va">spdy</span>.<span class="at">createServer</span>(options<span class="op">,</span> <span class="kw">function</span>(req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-33" title="33">  <span class="va">res</span>.<span class="at">writeHead</span>(<span class="dv">200</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-34" title="34">  <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;hello world!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-36" title="36"></a>
<a class="sourceLine" id="cb1-37" title="37"><span class="va">server</span>.<span class="at">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></a></code></pre></div>
<p>Client:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> spdy <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;spdy&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">var</span> https <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;https&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">var</span> agent <span class="op">=</span> <span class="va">spdy</span>.<span class="at">createAgent</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">host</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="dt">port</span><span class="op">:</span> <span class="dv">443</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="co">// Optional SPDY options</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="dt">spdy</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="dt">plain</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="dt">ssl</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="co">// **optional** send X_FORWARDED_FOR</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="st">&#39;x-forwarded-for&#39;</span><span class="op">:</span> <span class="st">&#39;127.0.0.1&#39;</span></a>
<a class="sourceLine" id="cb2-15" title="15">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="va">https</span>.<span class="at">get</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-19" title="19">  <span class="dt">host</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="dt">agent</span><span class="op">:</span> agent</a>
<a class="sourceLine" id="cb2-21" title="21"><span class="op">},</span> <span class="kw">function</span>(response) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-22" title="22">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;yikes&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-23" title="23">  <span class="co">// Here it goes like with any other node.js HTTP request</span></a>
<a class="sourceLine" id="cb2-24" title="24">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb2-25" title="25">  <span class="co">// And once we&#39;re done - we may close TCP connection to server</span></a>
<a class="sourceLine" id="cb2-26" title="26">  <span class="co">// </span><span class="al">NOTE</span><span class="co">: All non-closed requests will die!</span></a>
<a class="sourceLine" id="cb2-27" title="27">  <span class="va">agent</span>.<span class="at">close</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="op">}</span>).<span class="at">end</span>()<span class="op">;</span></a></code></pre></div>
<p>Please note that if you use a custom agent, by default all connection-level errors will result in an uncaught exception. To handle these errors subscribe to the <code>error</code> event and re-emit the captured error:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> agent <span class="op">=</span> <span class="va">spdy</span>.<span class="at">createAgent</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">host</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">port</span><span class="op">:</span> <span class="dv">443</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="op">}</span>).<span class="at">once</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">this</span>.<span class="at">emit</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h4 id="push-streams">Push streams</h4>
<p>It is possible to initiate <a href="https://httpwg.github.io/specs/rfc7540.html#PUSH_PROMISE">PUSH_PROMISE</a> to send content to clients <em>before</em> the client requests it.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="va">spdy</span>.<span class="at">createServer</span>(options<span class="op">,</span> <span class="kw">function</span>(req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">var</span> stream <span class="op">=</span> <span class="va">res</span>.<span class="at">push</span>(<span class="st">&#39;/main.js&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">status</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="co">// optional</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span> <span class="co">// optional</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">request</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-6" title="6">      <span class="dt">accept</span><span class="op">:</span> <span class="st">&#39;*/*&#39;</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="op">},</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">response</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-9" title="9">      <span class="st">&#39;content-type&#39;</span><span class="op">:</span> <span class="st">&#39;application/javascript&#39;</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" title="12">  <span class="va">stream</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-13" title="13">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-14" title="14">  <span class="va">stream</span>.<span class="at">end</span>(<span class="st">&#39;alert(&quot;hello from push stream!&quot;);&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;&lt;script src=&quot;/main.js&quot;&gt;&lt;/script&gt;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="op">}</span>).<span class="at">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></a></code></pre></div>
<p><a href="https://httpwg.github.io/specs/rfc7540.html#PUSH_PROMISE">PUSH_PROMISE</a> may be sent using the <code>push()</code> method on the current response object. The signature of the <code>push()</code> method is:</p>
<p><code>.push('/some/relative/url', { request: {...}, response: {...} }, callback)</code></p>
<p>Second argument contains headers for both PUSH_PROMISE and emulated response. <code>callback</code> will receive two arguments: <code>err</code> (if any error is happened) and a <a href="https://iojs.org/api/stream.html#stream_class_stream_duplex">Duplex</a> stream as the second argument.</p>
<p>Client usage:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> agent <span class="op">=</span> <span class="va">spdy</span>.<span class="at">createAgent</span>(<span class="op">{</span> <span class="co">/* ... */</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> req <span class="op">=</span> <span class="va">http</span>.<span class="at">get</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">host</span><span class="op">:</span> <span class="st">&#39;www.google.com&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">agent</span><span class="op">:</span> agent</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="op">},</span> <span class="kw">function</span>(response) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="va">req</span>.<span class="at">on</span>(<span class="st">&#39;push&#39;</span><span class="op">,</span> <span class="kw">function</span>(stream) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="va">stream</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span>(err) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="co">// Handle error</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="co">// Read data from stream</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>NOTE: You’re responsible for the <code>stream</code> object once given it in <code>.push()</code> callback or <code>push</code> event. Hence ignoring <code>error</code> event on it will result in uncaught exception and crash your program.</p>
<h4 id="trailing-headers">Trailing headers</h4>
<p>Server usage:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="co">// Send trailing headers to client</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="va">res</span>.<span class="at">addTrailers</span>(<span class="op">{</span> <span class="dt">header1</span><span class="op">:</span> <span class="st">&#39;value1&#39;</span><span class="op">,</span> <span class="dt">header2</span><span class="op">:</span> <span class="st">&#39;value2&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="co">// On client&#39;s trailing headers</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="va">req</span>.<span class="at">on</span>(<span class="st">&#39;trailers&#39;</span><span class="op">,</span> <span class="kw">function</span>(headers) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="co">// ...</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>Client usage:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> req <span class="op">=</span> <span class="va">http</span>.<span class="at">request</span>(<span class="op">{</span> <span class="dt">agent</span><span class="op">:</span> spdyAgent<span class="op">,</span> <span class="co">/* ... */</span> <span class="op">}</span>).<span class="at">function</span> (res) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="co">// On server&#39;s trailing headers</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="va">res</span>.<span class="at">on</span>(<span class="st">&#39;trailers&#39;</span><span class="op">,</span> <span class="kw">function</span>(headers) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="co">// ...</span></a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="va">req</span>.<span class="at">write</span>(<span class="st">&#39;stuff&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="va">req</span>.<span class="at">addTrailers</span>(<span class="op">{</span> <span class="co">/* ... */</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="va">req</span>.<span class="at">end</span>()<span class="op">;</span></a></code></pre></div>
<h4 id="options">Options</h4>
<p>All options supported by <a href="http://nodejs.org/docs/latest/api/tls.html#tls.createServer">tls</a> work with node-spdy.</p>
<p>Additional options may be passed via <code>spdy</code> sub-object:</p>
<ul>
<li><code>plain</code> - if defined, server will ignore NPN and ALPN data and choose whether to use spdy or plain http by looking at first data packet.</li>
<li><code>ssl</code> - if <code>false</code> and <code>options.plain</code> is <code>true</code>, <code>http.Server</code> will be used as a <code>base</code> class for created server.</li>
<li><code>maxChunk</code> - if set and non-falsy, limits number of bytes sent in one DATA chunk. Setting it to non-zero value is recommended if you care about interleaving of outgoing data from multiple different streams. (defaults to 8192)</li>
<li><code>protocols</code> - list of NPN/ALPN protocols to use (default is: <code>['h2','spdy/3.1', 'spdy/3', 'spdy/2','http/1.1', 'http/1.0']</code>)</li>
<li><code>protocol</code> - use specific protocol if no NPN/ALPN ex In addition,</li>
<li><code>maxStreams</code> - set “<a href="https://httpwg.github.io/specs/rfc7540.html#SETTINGS_MAX_CONCURRENT_STREAMS">maximum concurrent streams</a>” protocol option</li>
</ul>
<h3 id="api">API</h3>
<p>API is compatible with <code>http</code> and <code>https</code> module, but you can use another function as base class for SPDYServer.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="va">spdy</span>.<span class="at">createServer</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  [base <span class="kw">class</span> constructor<span class="op">,</span> <span class="va">i</span>.<span class="va">e</span>. <span class="va">https</span>.<span class="at">Server</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="op">{</span> <span class="co">/* keys and options */</span> <span class="op">},</span> <span class="co">// &lt;- the only one required argument</span></a>
<a class="sourceLine" id="cb8-4" title="4">  [request listener]</a>
<a class="sourceLine" id="cb8-5" title="5">).<span class="at">listen</span>([port]<span class="op">,</span> [host]<span class="op">,</span> [callback])<span class="op">;</span></a></code></pre></div>
<p>Request listener will receive two arguments: <code>request</code> and <code>response</code>. They’re both instances of <code>http</code>’s <code>IncomingMessage</code> and <code>OutgoingMessage</code>. But three custom properties are added to both of them: <code>isSpdy</code>, <code>spdyVersion</code>. <code>isSpdy</code> is <code>true</code> when the request was processed using HTTP2/SPDY protocols, it is <code>false</code> in case of HTTP/1.1 fallback. <code>spdyVersion</code> is either of: <code>2</code>, <code>3</code>, <code>3.1</code>, or <code>4</code> (for HTTP2).</p>
<h4 id="contributors">Contributors</h4>
<ul>
<li><a href="https://github.com/indutny">Fedor Indutny</a></li>
<li><a href="https://github.com/eee-c">Chris Strom</a></li>
<li><a href="https://github.com/francois2metz">François de Metz</a></li>
<li><a href="https://github.com/igrigorik">Ilya Grigorik</a></li>
<li><a href="https://github.com/grmocg">Roberto Peon</a></li>
<li><a href="https://github.com/tatsuhiro-t">Tatsuhiro Tsujikawa</a></li>
<li><a href="https://github.com/jessecravens">Jesse Cravens</a></li>
</ul>
<h4 id="license">LICENSE</h4>
<p>This software is licensed under the MIT License.</p>
<p>Copyright Fedor Indutny, 2015.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</body>
</html>
