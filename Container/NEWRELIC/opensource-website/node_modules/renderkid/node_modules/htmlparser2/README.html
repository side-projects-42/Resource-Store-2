<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="htmlparser2">htmlparser2</h1>
<p><a href="https://npmjs.org/package/htmlparser2"><img src="http://img.shields.io/npm/v/htmlparser2.svg?style=flat" alt="NPM version" /></a> <a href="https://npmjs.org/package/htmlparser2"><img src="https://img.shields.io/npm/dm/htmlparser2.svg?style=flat" alt="Downloads" /></a> <a href="https://github.com/fb55/htmlparser2/actions?query=workflow%3A%22Node.js+Test%22"><embed src="https://img.shields.io/github/workflow/status/fb55/htmlparser2/Node.js%20Test?label=tests&amp;style=flat" /></a> <a href="https://coveralls.io/r/fb55/htmlparser2"><img src="http://img.shields.io/coveralls/fb55/htmlparser2.svg?style=flat" alt="Coverage" /></a></p>
<p>The fast &amp; forgiving HTML/XML parser.</p>
<h2 id="installation">Installation</h2>
<pre><code>npm install htmlparser2</code></pre>
<p>A live demo of <code>htmlparser2</code> is available <a href="https://astexplorer.net/#/2AmVrGuGVJ">here</a>.</p>
<h2 id="ecosystem">Ecosystem</h2>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://github.com/fb55/htmlparser2">htmlparser2</a></td>
<td>Fast &amp; forgiving HTML/XML parser</td>
</tr>
<tr class="even">
<td><a href="https://github.com/fb55/domhandler">domhandler</a></td>
<td>Handler for htmlparser2 that turns documents into a DOM</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/fb55/domutils">domutils</a></td>
<td>Utilities for working with domhandler’s DOM</td>
</tr>
<tr class="even">
<td><a href="https://github.com/fb55/css-select">css-select</a></td>
<td>CSS selector engine, compatible with domhandler’s DOM</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/cheeriojs/cheerio">cheerio</a></td>
<td>The jQuery API for domhandler’s DOM</td>
</tr>
<tr class="even">
<td><a href="https://github.com/cheeriojs/dom-serializer">dom-serializer</a></td>
<td>Serializer for domhandler’s DOM</td>
</tr>
</tbody>
</table>
<h2 id="usage">Usage</h2>
<p><code>htmlparser2</code> itself provides a callback interface that allows consumption of documents with minimal allocations. For a more ergonomic experience, read <a href="#getting-a-dom">Getting a DOM</a> below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> htmlparser2 <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;htmlparser2&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> parser <span class="op">=</span> <span class="kw">new</span> <span class="va">htmlparser2</span>.<span class="at">Parser</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="at">onopentag</span>(name<span class="op">,</span> attributes) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">        <span class="co">/*</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">         * This fires when a new tag is opened.</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">         *</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">         * If you don&#39;t need an aggregated `attributes` object,</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">         * have a look at the `onopentagname` and `onattribute` events.</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">         */</span></a>
<a class="sourceLine" id="cb2-10" title="10">        <span class="cf">if</span> (name <span class="op">===</span> <span class="st">&quot;script&quot;</span> <span class="op">&amp;&amp;</span> <span class="va">attributes</span>.<span class="at">type</span> <span class="op">===</span> <span class="st">&quot;text/javascript&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-11" title="11">            <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;JS! Hooray!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="at">ontext</span>(text) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-15" title="15">        <span class="co">/*</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">         * Fires whenever a section of text was processed.</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">         *</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">         * Note that this can fire at any point within text and you might</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">         * have to stich together multiple pieces.</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">         */</span></a>
<a class="sourceLine" id="cb2-21" title="21">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;--&gt;&quot;</span><span class="op">,</span> text)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="at">onclosetag</span>(tagname) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-24" title="24">        <span class="co">/*</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">         * Fires when a tag is closed.</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">         *</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">         * You can rely on this event only firing when you have received an</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">         * equivalent opening tag before. Closing tags without corresponding</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">         * opening tags will be ignored.</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">         */</span></a>
<a class="sourceLine" id="cb2-31" title="31">        <span class="cf">if</span> (tagname <span class="op">===</span> <span class="st">&quot;script&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-32" title="32">            <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;That&#39;s it?!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-33" title="33">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-34" title="34">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="va">parser</span>.<span class="at">write</span>(</a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="st">&quot;Xyz &lt;script type=&#39;text/javascript&#39;&gt;const foo = &#39;&lt;&lt;bar&gt;&gt;&#39;;&lt;/ script&gt;&quot;</span></a>
<a class="sourceLine" id="cb2-38" title="38">)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="va">parser</span>.<span class="at">end</span>()<span class="op">;</span></a></code></pre></div>
<p>Output (with multiple text events combined):</p>
<pre><code>--&gt; Xyz
JS! Hooray!
--&gt; const foo = &#39;&lt;&lt;bar&gt;&gt;&#39;;
That&#39;s it?!</code></pre>
<p>This example only shows three of the possible events. Read more about the parser, its events and options in the <a href="https://github.com/fb55/htmlparser2/wiki/Parser-options">wiki</a>.</p>
<h3 id="usage-with-streams">Usage with streams</h3>
<p>While the <code>Parser</code> interface closely resembles Node.js streams, it’s not a 100% match. Use the <code>WritableStream</code> interface to process a streaming input:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> <span class="op">{</span> WritableStream <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;htmlparser2/lib/WritableStream&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> parserStream <span class="op">=</span> <span class="kw">new</span> <span class="at">WritableStream</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="at">ontext</span>(text) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" title="4">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Streaming:&quot;</span><span class="op">,</span> text)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="op">},</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="kw">const</span> htmlStream <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&quot;./my-file.html&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="va">htmlStream</span>.<span class="at">pipe</span>(parserStream).<span class="at">on</span>(<span class="st">&quot;finish&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;done&quot;</span>))<span class="op">;</span></a></code></pre></div>
<h2 id="getting-a-dom">Getting a DOM</h2>
<p>The <code>DomHandler</code> produces a DOM (document object model) that can be manipulated using the <a href="https://github.com/fb55/DomUtils"><code>DomUtils</code></a> helper.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> htmlparser2 <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;htmlparser2&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">const</span> dom <span class="op">=</span> <span class="va">htmlparser2</span>.<span class="at">parseDocument</span>()<span class="op">;</span></a></code></pre></div>
<p>The <code>DomHandler</code>, while still bundled with this module, was moved to its <a href="https://github.com/fb55/domhandler">own module</a>. Have a look at that for further information.</p>
<h2 id="parsing-rssrdfatom-feeds">Parsing RSS/RDF/Atom Feeds</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> feed <span class="op">=</span> <span class="va">htmlparser2</span>.<span class="at">parseFeed</span>(content<span class="op">,</span> options)<span class="op">;</span></a></code></pre></div>
<p>Note: While the provided feed handler works for most feeds, you might want to use <a href="https://github.com/danmactough/node-feedparser">danmactough/node-feedparser</a>, which is much better tested and actively maintained.</p>
<h2 id="performance">Performance</h2>
<p>After having some artificial benchmarks for some time, <strong><span class="citation" data-cites="AndreasMadsen">@AndreasMadsen</span></strong> published his <a href="https://github.com/AndreasMadsen/htmlparser-benchmark"><code>htmlparser-benchmark</code></a>, which benchmarks HTML parses based on real-world websites.</p>
<p>At the time of writing, the latest versions of all supported parsers show the following performance characteristics on <a href="https://travis-ci.org/AndreasMadsen/htmlparser-benchmark/builds/10805007">Travis CI</a> (please note that Travis doesn’t guarantee equal conditions for all tests):</p>
<pre><code>gumbo-parser   : 34.9208 ms/file ± 21.4238
html-parser    : 24.8224 ms/file ± 15.8703
html5          : 419.597 ms/file ± 264.265
htmlparser     : 60.0722 ms/file ± 384.844
htmlparser2-dom: 12.0749 ms/file ± 6.49474
htmlparser2    : 7.49130 ms/file ± 5.74368
hubbub         : 30.4980 ms/file ± 16.4682
libxmljs       : 14.1338 ms/file ± 18.6541
parse5         : 22.0439 ms/file ± 15.3743
sax            : 49.6513 ms/file ± 26.6032</code></pre>
<h2 id="how-does-this-module-differ-from-node-htmlparser">How does this module differ from <a href="https://github.com/tautologistics/node-htmlparser">node-htmlparser</a>?</h2>
<p>This module started as a fork of the <code>htmlparser</code> module. The main difference is that <code>htmlparser2</code> is intended to be used only with node (it runs on other platforms using <a href="https://github.com/substack/node-browserify">browserify</a>). <code>htmlparser2</code> was rewritten multiple times and, while it maintains an API that’s compatible with <code>htmlparser</code> in most cases, the projects don’t share any code anymore.</p>
<p>The parser now provides a callback interface inspired by <a href="https://github.com/isaacs/sax-js">sax.js</a> (originally targeted at <a href="https://github.com/fb55/readabilitysax">readabilitySAX</a>). As a result, old handlers won’t work anymore.</p>
<p>The <code>DefaultHandler</code> and the <code>RssHandler</code> were renamed to clarify their purpose (to <code>DomHandler</code> and <code>FeedHandler</code>). The old names are still available when requiring <code>htmlparser2</code>, your code should work as expected.</p>
<h2 id="security-contact-information">Security contact information</h2>
<p>To report a security vulnerability, please use the <a href="https://tidelift.com/security">Tidelift security contact</a>. Tidelift will coordinate the fix and disclosure.</p>
<h2 id="htmlparser2-for-enterprise"><code>htmlparser2</code> for enterprise</h2>
<p>Available as part of the Tidelift Subscription</p>
<p>The maintainers of <code>htmlparser2</code> and thousands of other packages are working with Tidelift to deliver commercial support and maintenance for the open source dependencies you use to build your applications. Save time, reduce risk, and improve code health, while paying the maintainers of the exact dependencies you use. <a href="https://tidelift.com/subscription/pkg/npm-htmlparser2?utm_source=npm-htmlparser2&amp;utm_medium=referral&amp;utm_campaign=enterprise&amp;utm_term=repo">Learn more.</a></p>
</body>
</html>
