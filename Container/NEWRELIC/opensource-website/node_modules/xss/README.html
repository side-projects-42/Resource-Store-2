<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><a href="https://npmjs.org/package/xss"><img src="https://img.shields.io/npm/v/xss.svg?style=flat-square" alt="NPM version" /></a> <a href="https://github.com/leizongmin/js-xss/actions/workflows/nodejs.yml"><img src="https://github.com/leizongmin/js-xss/actions/workflows/nodejs.yml/badge.svg" alt="Node.js CI" /></a> <a href="https://coveralls.io/r/leizongmin/js-xss?branch=master"><img src="https://img.shields.io/coveralls/leizongmin/js-xss.svg?style=flat-square" alt="Test coverage" /></a> <a href="https://david-dm.org/leizongmin/js-xss"><img src="https://img.shields.io/david/leizongmin/js-xss.svg?style=flat-square" alt="David deps" /></a> <a href="http://nodejs.org/download/"><img src="https://img.shields.io/badge/node.js-%3E=_0.10-green.svg?style=flat-square" alt="node version" /></a> <a href="https://npmjs.org/package/xss"><img src="https://img.shields.io/npm/dm/xss.svg?style=flat-square" alt="npm download" /></a> <a href="https://npmjs.org/package/xss"><img src="https://img.shields.io/npm/l/xss.svg" alt="npm license" /></a></p>
<h1 id="sanitize-untrusted-html-to-prevent-xss-with-a-configuration-specified-by-a-whitelist.">Sanitize untrusted HTML (to prevent XSS) with a configuration specified by a Whitelist.</h1>
<p><a href="https://greenkeeper.io/"><img src="https://badges.greenkeeper.io/leizongmin/js-xss.svg" alt="Greenkeeper badge" /></a></p>
<figure>
<img src="https://nodei.co/npm/xss.png?downloads=true&amp;stars=true" alt="xss" /><figcaption>xss</figcaption>
</figure>
<hr />
<p><code>xss</code> is a module used to filter input from users to prevent XSS attacks. (<a href="http://en.wikipedia.org/wiki/Cross-site_scripting">What is XSS attack?</a>)</p>
<p><strong>Project Homepage:</strong> http://jsxss.com</p>
<p><strong>Try Online:</strong> http://jsxss.com/en/try.html</p>
<p><strong><a href="https://github.com/leizongmin/js-xss/blob/master/README.zh.md">中文版文档</a></strong></p>
<hr />
<h2 id="features">Features</h2>
<ul>
<li>Specifies HTML tags and their attributes allowed with whitelist</li>
<li>Handle any tags or attributes using custom function.</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet">XSS Filter Evasion Cheat Sheet</a></li>
<li><a href="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI scheme</a></li>
<li><a href="http://hi.baidu.com/badzzzz/item/bdbafe83144619c199255f7b">XSS with Data URI Scheme</a></li>
</ul>
<h2 id="benchmark-for-references-only">Benchmark (for references only)</h2>
<ul>
<li>the xss module: 22.53 MB/s</li>
<li><code>xss()</code> function from module <code>validator@0.3.7</code>: 6.9 MB/s</li>
</ul>
<p>For test code please refer to <code>benchmark</code> directory.</p>
<h2 id="they-are-using-xss-module">They are using xss module</h2>
<ul>
<li><strong>nodeclub</strong> - A Node.js bbs using MongoDB - https://github.com/cnodejs/nodeclub</li>
<li><strong>cnpmjs.org</strong> - Private npm registry and web for Enterprise - https://github.com/cnpm/cnpmjs.org</li>
</ul>
<h2 id="install">Install</h2>
<h3 id="npm">NPM</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> install xss</a></code></pre></div>
<h3 id="bower">Bower</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">bower</span> install xss</a></code></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">bower</span> install https://github.com/leizongmin/js-xss.git</a></code></pre></div>
<h2 id="usages">Usages</h2>
<h3 id="on-node.js">On Node.js</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> xss <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;xss&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="va">console</span>.<span class="at">log</span>(html)<span class="op">;</span></a></code></pre></div>
<h3 id="on-browser">On Browser</h3>
<p>Shim mode (reference file <code>test/test.html</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://rawgit.com/leizongmin/js-xss/master/dist/xss.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="co">// apply function filterXSS in the same way</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="kw">var</span> html <span class="op">=</span> <span class="at">filterXSS</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/scr&#39;</span> <span class="op">+</span> <span class="st">&quot;ipt&gt;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="at">alert</span>(html)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">&lt;/script&gt;</span></a></code></pre></div>
<p>AMD mode - shim:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="va">require</span>.<span class="at">config</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">baseUrl</span><span class="op">:</span> <span class="st">&quot;./&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">paths</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">      <span class="dt">xss</span><span class="op">:</span> <span class="st">&quot;https://rawgit.com/leizongmin/js-xss/master/dist/xss.js&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="op">},</span></a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="dt">shim</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">      <span class="dt">xss</span><span class="op">:</span> <span class="op">{</span> <span class="dt">exports</span><span class="op">:</span> <span class="st">&quot;filterXSS&quot;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="op">},</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="at">require</span>([<span class="st">&quot;xss&quot;</span>]<span class="op">,</span> <span class="kw">function</span> (xss) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/scr&#39;</span> <span class="op">+</span> <span class="st">&quot;ipt&gt;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="at">alert</span>(html)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="kw">&lt;/script&gt;</span></a></code></pre></div>
<p><strong>Notes: please don’t use the URL https://rawgit.com/leizongmin/js-xss/master/dist/xss.js in production environment.</strong></p>
<h2 id="command-line-tool">Command Line Tool</h2>
<h3 id="process-file">Process File</h3>
<p>You can use the xss command line tool to process a file. Usage:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="ex">xss</span> -i <span class="op">&lt;</span>input_file<span class="op">&gt;</span> -o <span class="op">&lt;</span>output_file<span class="op">&gt;</span></a></code></pre></div>
<p>Example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">xss</span> -i origin.html -o target.html</a></code></pre></div>
<h3 id="active-test">Active Test</h3>
<p>Run the following command, them you can type HTML code in the command-line, and check the filtered output:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">xss</span> -t</a></code></pre></div>
<p>For more details, please run <code>$ xss -h</code> to see it.</p>
<h2 id="custom-filter-rules">Custom filter rules</h2>
<p>When using the <code>xss()</code> function, the second parameter could be used to specify custom rules:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1">options <span class="op">=</span> <span class="op">{};</span> <span class="co">// Custom rules</span></a>
<a class="sourceLine" id="cb10-2" title="2">html <span class="op">=</span> <span class="at">xss</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;&#39;</span><span class="op">,</span> options)<span class="op">;</span></a></code></pre></div>
<p>To avoid passing <code>options</code> every time, you can also do it in a faster way by creating a <code>FilterXSS</code> instance:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1">options <span class="op">=</span> <span class="op">{};</span> <span class="co">// Custom rules</span></a>
<a class="sourceLine" id="cb11-2" title="2">myxss <span class="op">=</span> <span class="kw">new</span> <span class="va">xss</span>.<span class="at">FilterXSS</span>(options)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">// then apply myxss.process()</span></a>
<a class="sourceLine" id="cb11-4" title="4">html <span class="op">=</span> <span class="va">myxss</span>.<span class="at">process</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Details of parameters in <code>options</code> would be described below.</p>
<h3 id="whitelist">Whitelist</h3>
<p>By specifying a <code>whiteList</code>, e.g. <code>{ 'tagName': [ 'attr-1', 'attr-2' ] }</code>. Tags and attributes not in the whitelist would be filter out. For example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="co">// only tag a and its attributes href, title, target are allowed</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">var</span> options <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">whiteList</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="dt">a</span><span class="op">:</span> [<span class="st">&quot;href&quot;</span><span class="op">,</span> <span class="st">&quot;title&quot;</span><span class="op">,</span> <span class="st">&quot;target&quot;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">// With the configuration specified above, the following HTML:</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">// &lt;a href=&quot;#&quot; onclick=&quot;hello()&quot;&gt;&lt;i&gt;Hello&lt;/i&gt;&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">// would become:</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">// &lt;a href=&quot;#&quot;&gt;&amp;lt;i&amp;gt;Hello&amp;lt;/i&amp;gt;&lt;/a&gt;</span></a></code></pre></div>
<p>For the default whitelist, please refer <code>xss.whiteList</code>.</p>
<h3 id="customize-the-handler-function-for-matched-tags">Customize the handler function for matched tags</h3>
<p>By specifying the handler function with <code>onTag</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">function</span> <span class="at">onTag</span>(tag<span class="op">,</span> html<span class="op">,</span> options) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="co">// tag is the name of current tag, e.g. &#39;a&#39; for tag &lt;a&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="co">// html is the HTML of this tag, e.g. &#39;&lt;a&gt;&#39; for tag &lt;a&gt;</span></a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="co">// options is some addition informations:</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="co">//   isWhite    boolean, whether the tag is in whitelist</span></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="co">//   isClosing  boolean, whether the tag is a closing tag, e.g. true for &lt;/a&gt;</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="co">//   position        integer, the position of the tag in output result</span></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="co">//   sourcePosition  integer, the position of the tag in input HTML source</span></a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="co">// If a string is returned, the current tag would be replaced with the string</span></a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="co">// If return nothing, the default measure would be taken:</span></a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="co">//   If in whitelist: filter attributes using onTagAttr, as described below</span></a>
<a class="sourceLine" id="cb13-12" title="12">  <span class="co">//   If not in whitelist: handle by onIgnoreTag, as described below</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-the-handler-function-for-attributes-of-matched-tags">Customize the handler function for attributes of matched tags</h3>
<p>By specifying the handler function with <code>onTagAttr</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">function</span> <span class="at">onTagAttr</span>(tag<span class="op">,</span> name<span class="op">,</span> value<span class="op">,</span> isWhiteAttr) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="co">// tag is the name of current tag, e.g. &#39;a&#39; for tag &lt;a&gt;</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="co">// name is the name of current attribute, e.g. &#39;href&#39; for href=&quot;#&quot;</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="co">// isWhiteAttr whether the attribute is in whitelist</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="co">// If a string is returned, the attribute would be replaced with the string</span></a>
<a class="sourceLine" id="cb14-6" title="6">  <span class="co">// If return nothing, the default measure would be taken:</span></a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="co">//   If in whitelist: filter the value using safeAttrValue as described below</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="co">//   If not in whitelist: handle by onIgnoreTagAttr, as described below</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-the-handler-function-for-tags-not-in-the-whitelist">Customize the handler function for tags not in the whitelist</h3>
<p>By specifying the handler function with <code>onIgnoreTag</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">function</span> <span class="at">onIgnoreTag</span>(tag<span class="op">,</span> html<span class="op">,</span> options) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="co">// Parameters are the same with onTag</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="co">// If a string is returned, the tag would be replaced with the string</span></a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="co">// If return nothing, the default measure would be taken (specifies using</span></a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="co">// escape, as described below)</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-the-handler-function-for-attributes-not-in-the-whitelist">Customize the handler function for attributes not in the whitelist</h3>
<p>By specifying the handler function with <code>onIgnoreTagAttr</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">function</span> <span class="at">onIgnoreTagAttr</span>(tag<span class="op">,</span> name<span class="op">,</span> value<span class="op">,</span> isWhiteAttr) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="co">// Parameters are the same with onTagAttr</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="co">// If a string is returned, the value would be replaced with this string</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="co">// If return nothing, then keep default (remove the attribute)</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-escaping-function-for-html">Customize escaping function for HTML</h3>
<p>By specifying the handler function with <code>escapeHtml</code>. Following is the default function <strong>(Modification is not recommended)</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">function</span> <span class="at">escapeHtml</span>(html) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">  <span class="cf">return</span> <span class="va">html</span>.<span class="at">replace</span>(<span class="ss">/&lt;/g</span><span class="op">,</span> <span class="st">&quot;&amp;lt;&quot;</span>).<span class="at">replace</span>(/&gt;/g<span class="op">,</span> <span class="st">&quot;&amp;gt;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-escaping-function-for-value-of-attributes">Customize escaping function for value of attributes</h3>
<p>By specifying the handler function with <code>safeAttrValue</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">function</span> <span class="at">safeAttrValue</span>(tag<span class="op">,</span> name<span class="op">,</span> value) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="co">// Parameters are the same with onTagAttr (without options)</span></a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="co">// Return the value as a string</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="op">}</span></a></code></pre></div>
<h3 id="customize-css-filter">Customize CSS filter</h3>
<p>If you allow the attribute <code>style</code>, the value will be processed by <a href="https://github.com/leizongmin/js-css-filter">cssfilter</a> module. The cssfilter module includes a default css whitelist. You can specify the options for cssfilter module like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1">myxss <span class="op">=</span> <span class="kw">new</span> <span class="va">xss</span>.<span class="at">FilterXSS</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="dt">css</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb19-3" title="3">    <span class="dt">whiteList</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb19-4" title="4">      <span class="dt">position</span><span class="op">:</span> <span class="ss">/</span><span class="sc">^</span><span class="ss">fixed</span><span class="sc">|</span><span class="ss">relative</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-5" title="5">      <span class="dt">top</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-6" title="6">      <span class="dt">left</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-7" title="7">    <span class="op">},</span></a>
<a class="sourceLine" id="cb19-8" title="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-10" title="10">html <span class="op">=</span> <span class="va">myxss</span>.<span class="at">process</span>(<span class="st">&#39;&lt;script&gt;alert(&quot;xss&quot;);&lt;/script&gt;&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>If you don’t want to filter out the <code>style</code> content, just specify <code>false</code> to the <code>css</code> option:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1">myxss <span class="op">=</span> <span class="kw">new</span> <span class="va">xss</span>.<span class="at">FilterXSS</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="dt">css</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>For more help, please see https://github.com/leizongmin/js-css-filter</p>
<h3 id="quick-start">Quick Start</h3>
<h4 id="filter-out-tags-not-in-the-whitelist">Filter out tags not in the whitelist</h4>
<p>By using <code>stripIgnoreTag</code> parameter:</p>
<ul>
<li><code>true</code> filter out tags not in the whitelist</li>
<li><code>false</code>: by default: escape the tag using configured <code>escape</code> function</li>
</ul>
<p>Example:</p>
<p>If <code>stripIgnoreTag = true</code> is set, the following code:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb21-1" title="1">code:</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="at">alert</span>(<span class="ss">/xss/</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="kw">&lt;/script&gt;</span></a></code></pre></div>
<p>would output filtered:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb22-1" title="1">code:alert(/xss/);</a></code></pre></div>
<h4 id="filter-out-tags-and-tag-bodies-not-in-the-whitelist">Filter out tags and tag bodies not in the whitelist</h4>
<p>By using <code>stripIgnoreTagBody</code> parameter:</p>
<ul>
<li><code>false|null|undefined</code> by default: do nothing</li>
<li><code>'*'|true</code>: filter out all tags not in the whitelist</li>
<li><code>['tag1', 'tag2']</code>: filter out only specified tags not in the whitelist</li>
</ul>
<p>Example:</p>
<p>If <code>stripIgnoreTagBody = ['script']</code> is set, the following code:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb23-1" title="1">code:</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="at">alert</span>(<span class="ss">/xss/</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="kw">&lt;/script&gt;</span></a></code></pre></div>
<p>would output filtered:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb24-1" title="1">code:</a></code></pre></div>
<h4 id="filter-out-html-comments">Filter out HTML comments</h4>
<p>By using <code>allowCommentTag</code> parameter:</p>
<ul>
<li><code>true</code>: do nothing</li>
<li><code>false</code> by default: filter out HTML comments</li>
</ul>
<p>Example:</p>
<p>If <code>allowCommentTag = false</code> is set, the following code:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb25-1" title="1">code:<span class="co">&lt;!-- something --&gt;</span></a>
<a class="sourceLine" id="cb25-2" title="2">END</a></code></pre></div>
<p>would output filtered:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb26-1" title="1">code: END</a></code></pre></div>
<h2 id="examples">Examples</h2>
<h3 id="allow-attributes-of-whitelist-tags-start-with-data-">Allow attributes of whitelist tags start with <code>data-</code></h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">var</span> source <span class="op">=</span> <span class="st">&#39;&lt;div a=&quot;1&quot; b=&quot;2&quot; data-a=&quot;3&quot; data-b=&quot;4&quot;&gt;hello&lt;/div&gt;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(source<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb27-3" title="3">  <span class="dt">onIgnoreTagAttr</span><span class="op">:</span> <span class="kw">function</span> (tag<span class="op">,</span> name<span class="op">,</span> value<span class="op">,</span> isWhiteAttr) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-4" title="4">    <span class="cf">if</span> (<span class="va">name</span>.<span class="at">substr</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">5</span>) <span class="op">===</span> <span class="st">&quot;data-&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-5" title="5">      <span class="co">// escape its value using built-in escapeAttrValue function</span></a>
<a class="sourceLine" id="cb27-6" title="6">      <span class="cf">return</span> name <span class="op">+</span> <span class="st">&#39;=&quot;&#39;</span> <span class="op">+</span> <span class="va">xss</span>.<span class="at">escapeAttrValue</span>(value) <span class="op">+</span> <span class="st">&#39;&quot;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb27-8" title="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-10" title="10"></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;%s</span><span class="sc">\n</span><span class="st">convert to:</span><span class="sc">\n</span><span class="st">%s&quot;</span><span class="op">,</span> source<span class="op">,</span> html)<span class="op">;</span></a></code></pre></div>
<p>Result:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">&lt;div</span><span class="ot"> a=</span><span class="st">&quot;1&quot;</span><span class="ot"> b=</span><span class="st">&quot;2&quot;</span><span class="ot"> data-a=</span><span class="st">&quot;3&quot;</span><span class="ot"> data-b=</span><span class="st">&quot;4&quot;</span><span class="kw">&gt;</span>hello<span class="kw">&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb28-2" title="2">convert to:</a>
<a class="sourceLine" id="cb28-3" title="3"><span class="kw">&lt;div</span><span class="ot"> data-a=</span><span class="st">&quot;3&quot;</span><span class="ot"> data-b=</span><span class="st">&quot;4&quot;</span><span class="kw">&gt;</span>hello<span class="kw">&lt;/div&gt;</span></a></code></pre></div>
<h3 id="allow-tags-start-with-x-">Allow tags start with <code>x-</code></h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">var</span> source <span class="op">=</span> <span class="st">&quot;&lt;x&gt;&lt;x-1&gt;he&lt;x-2 checked&gt;&lt;/x-2&gt;wwww&lt;/x-1&gt;&lt;a&gt;&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(source<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-3" title="3">  <span class="dt">onIgnoreTag</span><span class="op">:</span> <span class="kw">function</span> (tag<span class="op">,</span> html<span class="op">,</span> options) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-4" title="4">    <span class="cf">if</span> (<span class="va">tag</span>.<span class="at">substr</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>) <span class="op">===</span> <span class="st">&quot;x-&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-5" title="5">      <span class="co">// do not filter its attributes</span></a>
<a class="sourceLine" id="cb29-6" title="6">      <span class="cf">return</span> html<span class="op">;</span></a>
<a class="sourceLine" id="cb29-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb29-8" title="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb29-9" title="9"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-10" title="10"></a>
<a class="sourceLine" id="cb29-11" title="11"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;%s</span><span class="sc">\n</span><span class="st">convert to:</span><span class="sc">\n</span><span class="st">%s&quot;</span><span class="op">,</span> source<span class="op">,</span> html)<span class="op">;</span></a></code></pre></div>
<p>Result:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">&lt;x</span></a>
<a class="sourceLine" id="cb30-2" title="2">  <span class="kw">&gt;&lt;x-1&gt;</span>he<span class="kw">&lt;x-2</span><span class="ot"> checked</span><span class="kw">&gt;&lt;/x-2&gt;</span>wwww<span class="kw">&lt;/x-1</span></a>
<a class="sourceLine" id="cb30-3" title="3">  <span class="kw">&gt;&lt;a&gt;</span></a>
<a class="sourceLine" id="cb30-4" title="4">    convert to: <span class="dv">&amp;lt;</span>x<span class="dv">&amp;gt;</span><span class="kw">&lt;x-1&gt;</span>he<span class="kw">&lt;x-2</span><span class="ot"> checked</span><span class="kw">&gt;&lt;/x-2&gt;</span>wwww<span class="kw">&lt;/x-1&gt;&lt;a&gt;&lt;/a&gt;&lt;/a</span></a>
<a class="sourceLine" id="cb30-5" title="5"><span class="kw">&gt;&lt;/x&gt;</span></a></code></pre></div>
<h3 id="parse-images-in-html">Parse images in HTML</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">var</span> source <span class="op">=</span></a>
<a class="sourceLine" id="cb31-2" title="2">  <span class="st">&#39;&lt;img src=&quot;img1&quot;&gt;a&lt;img src=&quot;img2&quot;&gt;b&lt;img src=&quot;img3&quot;&gt;c&lt;img src=&quot;img4&quot;&gt;d&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="kw">var</span> list <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(source<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb31-5" title="5">  <span class="dt">onTagAttr</span><span class="op">:</span> <span class="kw">function</span> (tag<span class="op">,</span> name<span class="op">,</span> value<span class="op">,</span> isWhiteAttr) <span class="op">{</span></a>
<a class="sourceLine" id="cb31-6" title="6">    <span class="cf">if</span> (tag <span class="op">===</span> <span class="st">&quot;img&quot;</span> <span class="op">&amp;&amp;</span> name <span class="op">===</span> <span class="st">&quot;src&quot;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb31-7" title="7">      <span class="co">// Use the built-in friendlyAttrValue function to escape attribute</span></a>
<a class="sourceLine" id="cb31-8" title="8">      <span class="co">// values. It supports converting entity tags such as &amp;lt; to printable</span></a>
<a class="sourceLine" id="cb31-9" title="9">      <span class="co">// characters such as &lt;</span></a>
<a class="sourceLine" id="cb31-10" title="10">      <span class="va">list</span>.<span class="at">push</span>(<span class="va">xss</span>.<span class="at">friendlyAttrValue</span>(value))<span class="op">;</span></a>
<a class="sourceLine" id="cb31-11" title="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb31-12" title="12">    <span class="co">// Return nothing, means keep the default handling measure</span></a>
<a class="sourceLine" id="cb31-13" title="13">  <span class="op">},</span></a>
<a class="sourceLine" id="cb31-14" title="14"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb31-15" title="15"></a>
<a class="sourceLine" id="cb31-16" title="16"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;image list:</span><span class="sc">\n</span><span class="st">%s&quot;</span><span class="op">,</span> <span class="va">list</span>.<span class="at">join</span>(<span class="st">&quot;, &quot;</span>))<span class="op">;</span></a></code></pre></div>
<p>Result:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb32-1" title="1">image list: img1, img2, img3, img4</a></code></pre></div>
<h3 id="filter-out-html-tags-keeps-only-plain-text">Filter out HTML tags (keeps only plain text)</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">var</span> source <span class="op">=</span> <span class="st">&quot;&lt;strong&gt;hello&lt;/strong&gt;&lt;script&gt;alert(/xss/);&lt;/script&gt;end&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">var</span> html <span class="op">=</span> <span class="at">xss</span>(source<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-3" title="3">  <span class="dt">whiteList</span><span class="op">:</span> <span class="op">{},</span> <span class="co">// empty, means filter out all tags</span></a>
<a class="sourceLine" id="cb33-4" title="4">  <span class="dt">stripIgnoreTag</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// filter out all HTML not in the whitelist</span></a>
<a class="sourceLine" id="cb33-5" title="5">  <span class="dt">stripIgnoreTagBody</span><span class="op">:</span> [<span class="st">&quot;script&quot;</span>]<span class="op">,</span> <span class="co">// the script tag is a special case, we need</span></a>
<a class="sourceLine" id="cb33-6" title="6">  <span class="co">// to filter out its content</span></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-8" title="8"></a>
<a class="sourceLine" id="cb33-9" title="9"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;text: %s&quot;</span><span class="op">,</span> html)<span class="op">;</span></a></code></pre></div>
<p>Result:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb34-1" title="1">text: helloend</a></code></pre></div>
<h2 id="license">License</h2>
<pre class="text"><code>Copyright (c) 2012-2018 Zongmin Lei(雷宗民) &lt;leizongmin@gmail.com&gt;
http://ucdok.com

The MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</code></pre>
</body>
</html>
