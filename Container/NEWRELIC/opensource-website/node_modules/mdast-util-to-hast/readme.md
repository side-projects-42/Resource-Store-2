mdast-util-to-hast
==================

[![Build](https://github.com/syntax-tree/mdast-util-to-hast/workflows/main/badge.svg)](https://github.com/syntax-tree/mdast-util-to-hast/actions) [![Coverage](https://img.shields.io/codecov/c/github/syntax-tree/mdast-util-to-hast.svg)](https://codecov.io/github/syntax-tree/mdast-util-to-hast) [![Downloads](https://img.shields.io/npm/dm/mdast-util-to-hast.svg)](https://www.npmjs.com/package/mdast-util-to-hast) [![Size](https://img.shields.io/bundlephobia/minzip/mdast-util-to-hast.svg)](https://bundlephobia.com/result?p=mdast-util-to-hast) [![Sponsors](https://opencollective.com/unified/sponsors/badge.svg)](https://opencollective.com/unified) [![Backers](https://opencollective.com/unified/backers/badge.svg)](https://opencollective.com/unified) [![Chat](https://img.shields.io/badge/chat-discussions-success.svg)](https://github.com/syntax-tree/unist/discussions)

[**mdast**](https://github.com/syntax-tree/mdast) utility to transform to [**hast**](https://github.com/syntax-tree/hast).

> **Note**: You probably want to use [`remark-rehype`](https://github.com/remarkjs/remark-rehype).

Install
-------

[npm](https://docs.npmjs.com/cli/install):

    npm install mdast-util-to-hast

Use
---

Say we have the following `example.md`:

    ## Hello **World**!

…and next to it, `example.js`:

    var inspect = require('unist-util-inspect')
    var unified = require('unified')
    var parse = require('remark-parse')
    var vfile = require('to-vfile')
    var toHast = require('mdast-util-to-hast')

    var tree = unified()
      .use(parse)
      .parse(vfile.readSync('example.md'))

    console.log(inspect(toHast(tree)))

Which when running with `node example` yields:

    root[1] (1:1-2:1, 0-20)
    └─ element[3] (1:1-1:20, 0-19) [tagName="h2"]
       ├─ text: "Hello " (1:4-1:10, 3-9)
       ├─ element[1] (1:10-1:19, 9-18) [tagName="strong"]
       │  └─ text: "World" (1:12-1:17, 11-16)
       └─ text: "!" (1:19-1:20, 18-19)

API
---

### `toHast(node[, options])`

Transform the given [mdast](https://github.com/syntax-tree/mdast) [tree](https://github.com/syntax-tree/unist#tree) to a [hast](https://github.com/syntax-tree/hast) [tree](https://github.com/syntax-tree/unist#tree).

##### Options

###### `options.allowDangerousHtml`

Whether to allow [`html`](https://github.com/syntax-tree/mdast#html) nodes and inject them as raw HTML (`boolean`, default: `false`). Only do this when using [`hast-util-to-html`](https://github.com/syntax-tree/hast-util-to-html) ([`rehype-stringify`](https://github.com/rehypejs/rehype/tree/HEAD/packages/rehype-stringify)) or [`hast-util-raw`](https://github.com/syntax-tree/hast-util-raw) ([`rehype-raw`](https://github.com/rehypejs/rehype-raw)) later: `raw` nodes are not a standard part of [hast](https://github.com/syntax-tree/hast).

###### `options.handlers`

Object mapping [mdast](https://github.com/syntax-tree/mdast) [nodes](https://github.com/syntax-tree/mdast#nodes) to functions handling them. Take a look at [`lib/handlers/`](lib/handlers) for examples.

###### `options.unknownHandler`

Handler for all unknown nodes.

Default behavior:

-   Unknown nodes with [`children`](https://github.com/syntax-tree/unist#child) are transformed to `div` elements
-   Unknown nodes with `value` are transformed to [`text`](https://github.com/syntax-tree/hast#text) nodes

##### Returns

[`HastNode`](https://github.com/syntax-tree/hast#nodes).

##### Notes

-   [`yaml`](https://github.com/syntax-tree/mdast#yaml) and `toml` nodes are ignored (created by [`remark-frontmatter`](https://github.com/remarkjs/remark-frontmatter))
-   [`html`](https://github.com/syntax-tree/mdast#html) nodes are ignored if `allowDangerousHtml` is `false`
-   [`position`](https://github.com/syntax-tree/unist#positional-information)s are properly patched
-   [`node.data.hName`](#hname) configures the hast element’s tag-name
-   [`node.data.hProperties`](#hproperties) is mixed into the hast element’s properties
-   [`node.data.hChildren`](#hchildren) configures the hast element’s children
-   GFM (and this project) uses the obsolete `align` attribute on `td` and `th` elements; combine this utility with [`@mapbox/hast-util-table-cell-style`](https://github.com/mapbox/hast-util-table-cell-style) to use `style` instead

##### Examples

###### `hName`

`node.data.hName` sets the tag-name of an element. The following [mdast](https://github.com/syntax-tree/mdast):

    {
      type: 'strong',
      data: {hName: 'b'},
      children: [{type: 'text', value: 'Alpha'}]
    }

Yields, in [hast](https://github.com/syntax-tree/hast):

    {
      type: 'element',
      tagName: 'b',
      properties: {},
      children: [{type: 'text', value: 'Alpha'}]
    }

###### `hProperties`

`node.data.hProperties` in sets the properties of an element. The following [mdast](https://github.com/syntax-tree/mdast):

    {
      type: 'image',
      src: 'circle.svg',
      alt: 'Big red circle on a black background',
      title: null
      data: {hProperties: {className: ['responsive']}}
    }

Yields, in [hast](https://github.com/syntax-tree/hast):

    {
      type: 'element',
      tagName: 'img',
      properties: {
        src: 'circle.svg',
        alt: 'Big red circle on a black background',
        className: ['responsive']
      },
      children: []
    }

###### `hChildren`

`node.data.hChildren` sets the children of an element. The following [mdast](https://github.com/syntax-tree/mdast):

    {
      type: 'code',
      lang: 'js',
      data: {
        hChildren: [
          {
            type: 'element',
            tagName: 'span',
            properties: {className: ['hljs-meta']},
            children: [{type: 'text', value: '"use strict"'}]
          },
          {type: 'text', value: ';'}
        ]
      },
      value: '"use strict";'
    }

Yields, in [hast](https://github.com/syntax-tree/hast) (**note**: the `pre` and `language-js` class are normal `mdast-util-to-hast` functionality):

    {
      type: 'element',
      tagName: 'pre',
      properties: {},
      children: [{
        type: 'element',
        tagName: 'code',
        properties: {className: ['language-js']},
        children: [
          {
            type: 'element',
            tagName: 'span',
            properties: {className: ['hljs-meta']},
            children: [{type: 'text', value: '"use strict"'}]
          },
          {type: 'text', value: ';'}
        ]
      }]
    }

Security
--------

Use of `mdast-util-to-hast` can open you up to a [cross-site scripting (XSS)](https://en.wikipedia.org/wiki/Cross-site_scripting) attack. Embedded hast properties (`hName`, `hProperties`, `hChildren`), custom handlers, and the `allowDangerousHtml` option all provide openings.

The following example shows how a script is injected where a benign code block is expected with embedded hast properties:

    var code = {type: 'code', value: 'alert(1)'}

    code.data = {hName: 'script'}

Yields:

    <script>alert(1)</script>

The following example shows how an image is changed to fail loading and therefore run code in a browser.

    var image = {type: 'image', url: 'existing.png'}

    image.data = {hProperties: {src: 'missing', onError: 'alert(2)'}}

Yields:

    <img src="missing" onerror="alert(2)">

The following example shows the default handling of embedded HTML:

    # Hello

    <script>alert(3)</script>

Yields:

    <h1>Hello</h1>

Passing `allowDangerousHtml: true` to `mdast-util-to-hast` is typically still not enough to run unsafe code:

    <h1>Hello</h1>
    &#x3C;script>alert(3)&#x3C;/script>

If `allowDangerousHtml: true` is also given to `hast-util-to-html` (or `rehype-stringify`), the unsafe code runs:

    <h1>Hello</h1>
    <script>alert(3)</script>

Use [`hast-util-sanitize`](https://github.com/syntax-tree/hast-util-sanitize) to make the hast tree safe.

Related
-------

-   [`mdast-util-to-nlcst`](https://github.com/syntax-tree/mdast-util-to-nlcst) — transform mdast to nlcst
-   [`hast-util-to-mdast`](https://github.com/syntax-tree/hast-util-to-mdast) — transform hast to mdast
-   [`hast-util-to-xast`](https://github.com/syntax-tree/hast-util-to-xast) — transform hast to xast
-   [`hast-util-sanitize`](https://github.com/syntax-tree/hast-util-sanitize) — sanitize hast nodes
-   [`remark-rehype`](https://github.com/remarkjs/remark-rehype) — rehype support for remark
-   [`rehype-remark`](https://github.com/rehypejs/rehype-remark) — remark support for rehype

Contribute
----------

See [`contributing.md` in `syntax-tree/.github`](https://github.com/syntax-tree/.github/blob/HEAD/contributing.md) for ways to get started. See [`support.md`](https://github.com/syntax-tree/.github/blob/HEAD/support.md) for ways to get help.

This project has a [code of conduct](https://github.com/syntax-tree/.github/blob/HEAD/code-of-conduct.md). By interacting with this repository, organization, or community you agree to abide by its terms.

License
-------

[MIT](license) © [Titus Wormer](https://wooorm.com)
