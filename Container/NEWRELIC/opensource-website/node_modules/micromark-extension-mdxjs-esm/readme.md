micromark-extension-mdxjs-esm
=============================

[![Build](https://github.com/micromark/micromark-extension-mdxjs-esm/workflows/main/badge.svg)](https://github.com/micromark/micromark-extension-mdxjs-esm/actions) [![Coverage](https://img.shields.io/codecov/c/github/micromark/micromark-extension-mdxjs-esm.svg)](https://codecov.io/github/micromark/micromark-extension-mdxjs-esm) [![Downloads](https://img.shields.io/npm/dm/micromark-extension-mdxjs-esm.svg)](https://www.npmjs.com/package/micromark-extension-mdxjs-esm) [![Size](https://img.shields.io/bundlephobia/minzip/micromark-extension-mdxjs-esm.svg)](https://bundlephobia.com/result?p=micromark-extension-mdxjs-esm) [![Sponsors](https://opencollective.com/unified/sponsors/badge.svg)](https://opencollective.com/unified) [![Backers](https://opencollective.com/unified/backers/badge.svg)](https://opencollective.com/unified) [![Chat](https://img.shields.io/badge/chat-discussions-success.svg)](https://github.com/micromark/micromark/discussions)

**[micromark](https://github.com/micromark/micromark)** extension to support MDX.js ESM import/exports.

This package provides the low-level modules for integrating with the micromark tokenizer but has no handling of compiling to HTML: go to a syntax tree instead.

You should probably use this with [`mdast-util-mdxjs-esm`](https://github.com/syntax-tree/mdast-util-mdxjs-esm) (**[mdast](https://github.com/syntax-tree/mdast)**). Or use [`micromark-extension-mdxjs`](https://github.com/micromark/micromark-extension-mdxjs) and [`mdast-util-mdx`](https://github.com/syntax-tree/mdast-util-mdx) instead, which includes both, to support all of MDX.js. Or, use those through [`remark-mdx`](https://github.com/mdx-js/mdx/tree/next/packages/remark-mdx) (**[remark](https://github.com/remarkjs/remark)**).

Install
-------

[npm](https://docs.npmjs.com/cli/install):

    npm install micromark-extension-mdxjs-esm

Use
---

See [`mdast-util-mdxjs-esm`](https://github.com/syntax-tree/mdast-util-mdxjs-esm) for an example.

API
---

### `syntax(options)`

Support ESM imports and exports of [MDX](https://github.com/mdx-js/mdx).

The export of `syntax` is a function that can be called with options and returns an extension for the micromark parser (to tokenize import/exports; can be passed in `extensions`).

##### `options`

###### `options.acorn`

Acorn parser to use ([`Acorn`](https://github.com/acornjs/acorn), required).

###### `options.acornOptions`

Options to pass to acorn (`Object`, default: `{ecmaVersion: 2020, locations: true, sourceType: 'module'}`). All fields except for `locations` can be set.

###### `options.addResult`

Whether to add an `estree` field to `mdxjsEsm` tokens with results from acorn (`boolean`, default: `false`).

Syntax
------

All valid imports and exports are supported, depending on what the given acorn instance and configuration supports.

When the lowercase strings `export` or `import` are found, followed by unicode whitespace (`\s`), we expect JavaScript. Otherwise, like normal in markdown, we exit and it’ll end up as a paragraph. We continue parsing until we find a line ending followed by a blank line. At that point, we parse with acorn: it if parses, we found our block. Otherwise, if parsing failed at the last character, we assume it’s a blank line in code: we continue on until the next blank line and try again. Otherwise, the acorn error is thrown.

    import a from "b"
    import * as a from "b"
    import {a} from "b"
    import {a as b} from "c"
    import a, {b as c} from "d"
    import a, * as b from "c"
    import "a"

    export var a = ""
    export const a = ""
    export let a = ""
    export var a, b
    export var a = "a", b = "b"
    export function a() {}
    export class a {}
    export var {a} = {}
    export var {a: b} = {}
    export var [a] = []
    export default a = 1
    export default function a() {}
    export default class a {}
    export * from "a"
    export * as a from "b"
    export {a} from "b"
    export {a as b} from "c"
    export {default} from "b"
    export {default as a, b} from "c"

    {/* Blank lines are supported in expressions: */}

    export function a() {

      return "b"

    }

    {/* A blank line must be used after import/exports: this is incorrect! */}

    import a from "b"
    ## Hello, world!

Errors
------

### Could not parse import/exports with acorn: $error

This error occurs if acorn crashes (source: `micromark-extension-mdxjs-esm`, rule id: `acorn`). For example:

    import 1/1

### Unexpected `$type` in code: only import/exports are supported

This error occurs when a non-ESM construct is found (source: `micromark-extension-mdxjs-esm`, rule id: `non-esm`). For example:

    export var a = 1
    var b

Tokens
------

An `mdxjsEsm` token is used to reflect the block of import/exports in markdown.

It includes:

-   `lineEnding` for the `\r`, `\n`, and `\r\n`
-   `lineEndingBlank` for the same characters but when after potential whitespace and another line ending
-   `whitespace` for markdown spaces and tabs in blank lines
-   `mdxjsEsmData` for any character in a line of `mdxjsEsm`

Related
-------

-   [`micromark/micromark`](https://github.com/micromark/micromark) — the smallest commonmark-compliant markdown parser that exists
-   [`micromark/micromark-extension-mdx`](https://github.com/micromark/micromark-extension-mdx) — support MDX
-   [`micromark/micromark-extension-mdxjs`](https://github.com/micromark/micromark-extension-mdxjs) — support MDX.js
-   [`micromark/micromark-extension-mdx-expression`](https://github.com/micromark/micromark-extension-mdx-expression) — support MDX (or MDX.js) expressions
-   [`micromark/micromark-extension-mdx-jsx`](https://github.com/micromark/micromark-extension-mdx-jsx) — support MDX (or MDX.js) JSX
-   [`micromark/micromark-extension-mdx-md`](https://github.com/micromark/micromark-extension-mdx-md) — support misc MDX changes
-   [`syntax-tree/mdast-util-mdx`](https://github.com/syntax-tree/mdast-util-mdx) — support MDX (or MDX.js) in mdast

Contribute
----------

See [`contributing.md` in `micromark/.github`](https://github.com/micromark/.github/blob/HEAD/contributing.md) for ways to get started. See [`support.md`](https://github.com/micromark/.github/blob/HEAD/support.md) for ways to get help.

This project has a [code of conduct](https://github.com/micromark/.github/blob/HEAD/code-of-conduct.md). By interacting with this repository, organization, or community you agree to abide by its terms.

License
-------

[MIT](license) © [Titus Wormer](https://wooorm.com)
