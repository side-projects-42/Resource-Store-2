<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>readme</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="p-event-build-status">p-event <a href="https://travis-ci.org/sindresorhus/p-event"><img src="https://travis-ci.org/sindresorhus/p-event.svg?branch=master" alt="Build Status" /></a></h1>
<blockquote>
<p>Promisify an event by waiting for it to be emitted</p>
</blockquote>
<p>Useful when you need only one event emission and want to use it with promises or await it in an async function.</p>
<p>If you want multiple individual events as they are emitted, this module is not for you, as a Promise is a single value. Instead, just continue using event callback or use <a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87">Observables</a>.</p>
<h2 id="install">Install</h2>
<pre><code>$ npm install --save p-event</code></pre>
<h2 id="usage">Usage</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> pEvent <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;p-event&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> emitter <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./some-event-emitter&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="at">pEvent</span>(emitter<span class="op">,</span> <span class="st">&#39;finish&#39;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="co">// Called when `emitter` emits a `finish` event</span></a>
<a class="sourceLine" id="cb2-6" title="6">    .<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-7" title="7">        <span class="va">console</span>.<span class="at">log</span>(result)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="co">// Called when `emitter` emits an `error` event</span></a>
<a class="sourceLine" id="cb2-10" title="10">    .<span class="at">catch</span>(error <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-11" title="11">        <span class="va">console</span>.<span class="at">error</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> pEvent <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;p-event&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="at">pEvent</span>(document<span class="op">,</span> <span class="st">&#39;DOMContentLoaded&#39;</span>).<span class="at">then</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;ðŸ˜Ž&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="api">API</h2>
<h3 id="peventemitter-event-options">pEvent(emitter, event, <a href="#options">options</a>)</h3>
<h3 id="peventemitter-event-filter">pEvent(emitter, event, filter)</h3>
<p>Returns a <code>Promise</code> that is fulfilled when <code>emitter</code> emits an event matching <code>event</code>, or rejects if <code>emitter</code> emits any of the events defined in the <code>rejectionEvents</code> option.</p>
<p>The returned promise has a <code>.cancel()</code> method, which when called, removes the event listeners and causes the promise to never be settled.</p>
<h4 id="emitter">emitter</h4>
<p>Type: <code>Object</code></p>
<p>Event emitter object.</p>
<p>Should have either a <code>.on()</code>/<code>.addListener()</code>/<code>.addEventListener()</code> and <code>.off()</code>/<code>.removeListener()</code>/<code>.removeEventListener()</code> method, like the <a href="https://nodejs.org/api/events.html">Node.js <code>EventEmitter</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Events">DOM events</a>.</p>
<h4 id="event">event</h4>
<p>Type: <code>string</code></p>
<p>Name of the event to listen to.</p>
<p>If the same event is defined both here and in <code>rejectionEvents</code>, this one takes priority.</p>
<h4 id="options">options</h4>
<p>Type: <code>Object</code></p>
<h5 id="rejectionevents">rejectionEvents</h5>
<p>Type: <code>Array</code><br> Default: <code>['error']</code></p>
<p>Events that will reject the promise.</p>
<h5 id="multiargs">multiArgs</h5>
<p>Type: <code>boolean</code><br> Default: <code>false</code></p>
<p>By default, the promisified function will only return the first argument from the event callback, which works fine for most APIs. This option can be useful for APIs that return multiple arguments in the callback. Turning this on will make it return an array of all arguments from the callback, instead of just the first argument. This also applies to rejections.</p>
<p>Example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> pEvent <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;p-event&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> emitter <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./some-event-emitter&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="at">pEvent</span>(emitter<span class="op">,</span> <span class="st">&#39;finish&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">multiArgs</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>).<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="kw">const</span> [id<span class="op">,</span> type] <span class="op">=</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h5 id="timeout">timeout</h5>
<p>Type: <code>Number</code><br> Default: <code>Infinity</code></p>
<p>Time in milliseconds before timing out.</p>
<h5 id="filter">filter</h5>
<p>Type: <code>Function</code></p>
<p>Filter function for accepting an event.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> pEvent <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;p-event&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">const</span> emitter <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./some-event-emitter&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="at">pEvent</span>(emitter<span class="op">,</span> <span class="st">&#39;ðŸ¦„&#39;</span><span class="op">,</span> value <span class="kw">=&gt;</span> value <span class="op">&gt;</span> <span class="dv">3</span>).<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="co">// Do something with first ðŸ¦„ event with a value greater than 3</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="before-and-after">Before and after</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">function</span> <span class="at">getOpenReadStream</span>(file<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="kw">const</span> stream <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(file)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="va">stream</span>.<span class="at">on</span>(<span class="st">&#39;open&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="at">callback</span>(<span class="kw">null</span><span class="op">,</span> stream)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="va">stream</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> error <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">        <span class="at">callback</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="op">}</span></a>
<a class="sourceLine" id="cb6-14" title="14"></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="at">getOpenReadStream</span>(<span class="st">&#39;unicorn.txt&#39;</span><span class="op">,</span> (error<span class="op">,</span> stream) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="cf">if</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-17" title="17">        <span class="va">console</span>.<span class="at">error</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-18" title="18">        <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-19" title="19">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-20" title="20"></a>
<a class="sourceLine" id="cb6-21" title="21">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;File descriptor:&#39;</span><span class="op">,</span> <span class="va">stream</span>.<span class="at">fd</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-22" title="22">    <span class="va">stream</span>.<span class="at">pipe</span>(<span class="va">process</span>.<span class="at">stdout</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> pEvent <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;p-event&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getOpenReadStream</span>(file) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="kw">const</span> stream <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(file)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="cf">await</span> <span class="at">pEvent</span>(stream<span class="op">,</span> <span class="st">&#39;open&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="cf">return</span> stream<span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="at">getOpenReadStream</span>(<span class="st">&#39;unicorn.txt&#39;</span>)</a>
<a class="sourceLine" id="cb7-11" title="11">    .<span class="at">then</span>(stream <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-12" title="12">        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;File descriptor:&#39;</span><span class="op">,</span> <span class="va">stream</span>.<span class="at">fd</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-13" title="13">        <span class="va">stream</span>.<span class="at">pipe</span>(<span class="va">process</span>.<span class="at">stdout</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-15" title="15">    .<span class="at">catch</span>(<span class="va">console</span>.<span class="at">error</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="related">Related</h2>
<ul>
<li><a href="https://github.com/sindresorhus/pify">pify</a> - Promisify a callback-style function</li>
<li><a href="https://github.com/sindresorhus/p-map">p-map</a> - Map over promises concurrently</li>
<li><a href="https://github.com/sindresorhus/promise-fun">Moreâ€¦</a></li>
</ul>
<h2 id="license">License</h2>
<p>MIT Â© <a href="https://sindresorhus.com">Sindre Sorhus</a></p>
</body>
</html>
