<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="http://badge.fury.io/js/harmony-reflect"><img src="https://badge.fury.io/js/harmony-reflect.svg" alt="NPM version" /></a> <a href="https://david-dm.org/tvcutsem/harmony-reflect"><img src="https://david-dm.org/tvcutsem/harmony-reflect.png" alt="Dependencies" /></a></p>
<p>This is a shim for the ECMAScript 6 <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-reflect-object">Reflect</a> and <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-objects">Proxy</a> objects.</p>
<p>This library does two things:</p>
<ul>
<li>It defines an ES6-compliant <code>Reflect</code> global object that exports the ECMAScript 6 reflection API.</li>
<li>If harmony-era (pre-ES6) <code>Proxy</code> support is available, it patches <code>Proxy</code> to be up-to-date with the <a href="http://www.ecma-international.org/ecma-262/6.0/">ES6 spec</a>.</li>
</ul>
<p><strong>July 2016 update</strong>: the most recent version of all major browsers and node.js now <a href="http://kangax.github.io/compat-table/es6/#test-Proxy">support fully ES6-compliant</a> <code>Reflect</code> and <code>Proxy</code> objects. This shim is primarily useful if you want ES6 <code>Reflect</code> support on older browsers or versions of node.js &lt; v6.0.0, or if you want ES6 <code>Proxy</code> support on versions of node.js &lt; v6.0.0.</p>
<p><strong>May 2016 update</strong>: the recently released <a href="http://v8project.blogspot.com.au/2016/01/v8-release-49.html">V8 v4.9</a> includes native support for ES2015 Proxies and Reflect, making this library obsolete for environments that embed V8 4.9 or newer (like Chrome 49 and Node v6.0). Node v5.10.x or lower still requires this polyfill for proper ES6 Proxy support.</p>
<p>Read <a href="https://github.com/tvcutsem/harmony-reflect/wiki">Why should I use this library?</a></p>
<h1 id="installation">Installation</h1>
<p>For node.js, install via <a href="http://npmjs.org">npm</a>:</p>
<pre><code>npm install harmony-reflect</code></pre>
<p>Then:</p>
<pre><code>node --harmony-proxies
&gt; var Reflect = require(&#39;harmony-reflect&#39;);</code></pre>
<p>See <a href="https://github.com/tvcutsem/harmony-reflect/blob/master/RELNOTES.md">release notes</a> for changes to the npm releases.</p>
<p>To use in a browser, just download the single reflect.js file. After loading</p>
<pre><code>&lt;script src=&quot;reflect.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>a global object <code>Reflect</code> is defined that contains reflection methods as defined in the <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-reflect-object">ES6 spec</a>.</p>
<p>This library also updates the “harmony-era” <code>Proxy</code> object in the V8 engine (also used in node.js) to follow the latest <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 2015</a> spec. To create such a proxy, call:</p>
<pre><code>var proxy = new Proxy(target, handler);</code></pre>
<p>See below for a list of spec incompatibilities and other gotcha’s.</p>
<h1 id="api-docs">API Docs</h1>
<p>This module exports an object named <code>Reflect</code> and updates the global <code>Proxy</code> object (if it exists) to be compatible with the latest ECMAScript 6 spec.</p>
<p>The ECMAScript 6 Proxy API allows one to intercept various operations on Javascript objects.</p>
<ul>
<li>Overview of all <a href="https://github.com/tvcutsem/harmony-reflect/tree/master/doc/traps.md">supported traps</a> on proxies</li>
<li>The <a href="https://github.com/tvcutsem/harmony-reflect/tree/master/doc/api.md">Reflect API</a></li>
<li>The Proxy <a href="https://github.com/tvcutsem/harmony-reflect/tree/master/doc/handler_api.md">Handler API</a></li>
</ul>
<h1 id="compatibility">Compatibility</h1>
<p>The <code>Reflect</code> API, with support for proxies, was tested on:</p>
<ul>
<li>Firefox (&gt;= v4.0)</li>
<li><code>node --harmony_proxies</code> (&gt;= v0.7.8)</li>
<li><code>iojs --harmony_proxies</code> (&gt;= 2.3.0)</li>
<li><code>v8 --harmony_proxies</code> (&gt;= v3.6)</li>
<li>Any recent <code>js</code> spidermonkey shell</li>
</ul>
<p>If you need only <code>Reflect</code> and not an up-to-date <code>Proxy</code> object, this library should work on any modern ES5 engine (including all browsers).</p>
<p>Compatibility notes:</p>
<ul>
<li>Chrome (&gt;= v19 &amp;&amp; &lt;= v37) used to support proxies behind a flag (<code>chrome://flags/#enable-javascript-harmony</code>) but Chrome v38 <a href="https://code.google.com/p/v8/issues/detail?id=1543#c44">removed</a> the <code>Proxy</code> constructor. As a result, this library cannot patch the harmony-era <code>Proxy</code> object on Chrome v38 or above. If you’re working with Chromium directly, it’s still possible to enable proxies using <code>chromium-browser --js-flags="--harmony_proxies"</code>.</li>
<li>In older versions of V8, the <code>Proxy</code> constructor was enabled by default when starting V8 with <code>--harmony</code>. For recent versions of V8, <code>Proxy</code> must be explicitly enabled with <code>--harmony_proxies</code>.</li>
</ul>
<h1 id="dependencies">Dependencies</h1>
<ul>
<li>ECMAScript 5/strict</li>
<li>To emulate direct proxies: * old Harmony <a href="http://wiki.ecmascript.org/doku.php?id=harmony:proxies">Proxies</a> * Harmony <a href="http://wiki.ecmascript.org/doku.php?id=harmony:weak_maps">WeakMaps</a></li>
</ul>
<p>After loading <code>reflect.js</code> into your page or other JS environment, be aware that the following globals are patched to be able to recognize emulated direct proxies:</p>
<pre><code>Object.getOwnPropertyDescriptor
Object.defineProperty
Object.defineProperties
Object.getOwnPropertyNames
Object.getOwnPropertySymbols
Object.keys
Object.{get,set}PrototypeOf
Object.assign
Object.{freeze,seal,preventExtensions}
Object.{isFrozen,isSealed,isExtensible}
Object.prototype.valueOf
Object.prototype.isPrototypeOf
Object.prototype.toString
Object.prototype.hasOwnProperty
Function.prototype.toString
Date.prototype.toString
Array.isArray
Array.prototype.concat
Proxy
Reflect</code></pre>
<p>:warning: In node.js, when you <code>require('harmony-reflect')</code>, only the current module’s globals are patched. If you pass an emulated direct proxy to an external module, and that module uses the unpatched globals, the module may not interact with the proxy according to the latest ES6 Proxy API, instead falling back on the old pre-ES6 Proxy API. This can cause bugs, e.g. the built-in <code>Array.isArray</code> will return <code>false</code> when passed a proxy-for-array, while the patched <code>Array.isArray</code> will return true. I know of no good fix to reliably patch the globals for all node modules. If you do, let me know.</p>
<h1 id="examples">Examples</h1>
<p>The <a href="https://github.com/tvcutsem/harmony-reflect/tree/master/examples">examples</a> directory contains a number of examples demonstrating the use of proxies:</p>
<ul>
<li>membranes: wrappers that transitively isolate two object-graphs.</li>
<li>observer: a self-hosted implementation of the ES7 <code>Object.observe</code> notification mechanism.</li>
<li>profiler: a simple profiler to collect usage statistics of an object.</li>
</ul>
<p>Other example uses of proxies (not done by me, but using this library):</p>
<ul>
<li>supporting <a href="https://github.com/sindresorhus/negative-array">negative array indices</a> a la Python</li>
<li><a href="https://github.com/mathiasbynens/tpyo">tpyo</a>: using proxies to correct typo’s in JS property names</li>
<li><a href="http://tagtree.tv/es6-proxies">persistent objects</a>: shows how one might go about using proxies to save updates to objects in a database incrementally</li>
<li><a href="https://github.com/greenify/defaultdict2">defaultdict</a>: default values for new keys in objects (as known from Python)</li>
</ul>
<p>For more examples of proxies, and a good overview of their design rationale, I recommend reading <a href="http://www.2ality.com/2014/12/es6-proxies.html">Axel Rauschmayer’s blog post on proxies</a>.</p>
<h1 id="proxy-handler-api">Proxy Handler API</h1>
<p>The sister project <a href="https://github.com/tvcutsem/proxy-handlers">proxy-handlers</a> defines a number of predefined Proxy handlers as “abstract classes” that your code can “subclass” The goal is to minimize the number of traps that your proxy handlers must implement.</p>
<h1 id="spec-incompatibilities-and-other-gotchas">Spec Incompatibilities and other gotcha’s</h1>
<p>This library differs from the <a href="http://www.ecma-international.org/ecma-262/7.0/index.html">ECMAScript 2016 spec</a> as follows:</p>
<ul>
<li>In ES7, the <code>enumerate()</code> trap, and the corresponding <code>Reflect.enumerate()</code> method, have been <a href="https://github.com/tc39/ecma262/issues/161">removed</a>. This shim still supports the trap.</li>
<li>The ES7 (and ES6) spec contains a <a href="https://github.com/tc39/ecma262/pull/666">bug</a> that leads to missing invariant checks in the getOwnPropertyDescriptor, defineProperty and deleteProperty traps. This library already contains the patch referred to in <a href="https://github.com/tc39/ecma262/pull/666">this issue</a>.</li>
</ul>
<p>This library differs from the <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 2015 spec</a> as follows:</p>
<ul>
<li><p>In ES6, <code>Proxy</code> is a constructor function that <em>requires</em> the use of <code>new</code>. That is, you must write <code>new Proxy(target, handler)</code>. This library exports <code>Proxy</code> as an ordinary function which may be called with or without using the <code>new</code> operator.</p></li>
<li><p>In ES6, <code>Function.prototype.toString</code> and <code>Date.prototype.toString</code> do not operate transparently on Proxies. This shim patches those functions so that stringifying a Proxy-for-a-function or a Proxy-for-a-date “unwraps” the proxy and instead stringifies the target of the Proxy. This behavior may change in the future to be more spec-compatible.</p></li>
<li><p>This library does not shim <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-symbol-objects">Symbol objects</a>. On modern V8 or io.js which supports Symbol objects natively, due to a bug in V8, Symbols and Proxies don’t play well together. <a href="https://github.com/tvcutsem/harmony-reflect/issues/57">Read more</a>.</p></li>
<li><p>Proxies-for-arrays are serialized as JSON objects rather than as JSON arrays. That is, <code>JSON.stringify(new Proxy([], {}))</code> returns “{}” rather than “[]”. <a href="https://github.com/tvcutsem/harmony-reflect/issues/13#issuecomment-17249465">Read more</a>.</p></li>
</ul>
</body>
</html>
