<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="gatsby-plugin-sharp">gatsby-plugin-sharp</h1>
<p>Exposes several image processing functions built on the <a href="https://github.com/lovell/sharp">Sharp image processing library</a>. This is a low-level helper plugin generally used by other Gatsby plugins. You generally shouldn’t be using this directly but might find it helpful if doing very custom image processing.</p>
<p>It aims to provide excellent out-of-the box settings for processing common web image formats.</p>
<p>For JPEGs it generates progressive images with a default quality level of 50.</p>
<p>For PNGs it uses <a href="https://github.com/pornel/pngquant">pngquant</a> to compress images. By default it uses a quality setting of [50-75]. The <code>pngCompressionSpeed</code> value is a speed/quality trade-off from 1 (brute-force) to 10 (fastest). Speed 10 has 5% lower quality, but is 8 times faster than the default (4). In most cases you should stick with the default, but if you have very large numbers of PNGs then it can significantly reduce build times.</p>
<h2 id="install">Install</h2>
<p><code>npm install gatsby-plugin-sharp</code></p>
<h2 id="how-to-use">How to use</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// In your gatsby-config.js</span></a>
<a class="sourceLine" id="cb1-2" title="2">plugins<span class="op">:</span> [</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="op">{</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="dt">resolve</span><span class="op">:</span> <span class="vs">`gatsby-plugin-sharp`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="dt">options</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-6" title="6">      <span class="co">// Defaults used for gatsbyImageData and StaticImage</span></a>
<a class="sourceLine" id="cb1-7" title="7">      <span class="dt">defaults</span><span class="op">:</span> <span class="op">{},</span></a>
<a class="sourceLine" id="cb1-8" title="8">      <span class="co">// Set to false to allow builds to continue on image errors</span></a>
<a class="sourceLine" id="cb1-9" title="9">      <span class="dt">failOnError</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-10" title="10">      <span class="co">// deprecated options and their defaults:</span></a>
<a class="sourceLine" id="cb1-11" title="11">      <span class="dt">base64Width</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-12" title="12">      <span class="dt">forceBase64Format</span><span class="op">:</span> <span class="vs">``</span><span class="op">,</span> <span class="co">// valid formats: png,jpg,webp</span></a>
<a class="sourceLine" id="cb1-13" title="13">      <span class="dt">useMozJpeg</span><span class="op">:</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">GATSBY_JPEG_ENCODER</span> <span class="op">===</span> <span class="vs">`MOZJPEG`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-14" title="14">      <span class="dt">stripMetadata</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-15" title="15">      <span class="dt">defaultQuality</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-16" title="16">    <span class="op">},</span></a>
<a class="sourceLine" id="cb1-17" title="17">  <span class="op">},</span></a>
<a class="sourceLine" id="cb1-18" title="18">]</a></code></pre></div>
<h2 id="options">Options</h2>
<ul>
<li><code>defaults</code>: default values used for <code>gatsbyImageData</code> and <code>StaticImage</code> from <a href="https://www.gatsbyjs.com/plugins/gatsby-plugin-image">gatsby-plugin-image</a>. Available options are: <code>formats</code>,<code>placeholder</code>,<code>quality</code>,<code>breakpoints</code>,<code>backgroundColor</code>,<code>tracedSVGOptions</code>,<code>blurredOptions</code>,<code>jpgOptions</code>,<code>pngOptions</code>,<code>webpOptions</code>,<code>avifOptions</code>. For details of these, see <a href="https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-plugin-image">the reference guide</a>.</li>
<li><code>failOnError</code>: default = <code>true</code>. By default builds will fail if there is a corrupted image. Set to false to continue the build on error. The image will return <code>undefined</code>.</li>
</ul>
<p>Other options are deprecated, and should only be used for the legacy <code>fixed</code> and <code>fluid</code> functions.</p>
<h2 id="methods">Methods</h2>
<h3 id="resize">resize</h3>
<h4 id="parameters">Parameters</h4>
<ul>
<li><code>width</code> (int, default: 400)</li>
<li><code>height</code> (int)</li>
<li><code>quality</code> (int, default: 50)</li>
<li><code>jpegQuality</code> (int)</li>
<li><code>pngQuality</code> (int)</li>
<li><code>webpQuality</code> (int)</li>
<li><code>jpegProgressive</code> (bool, default: true)</li>
<li><code>pngCompressionLevel</code> (int, default: 9)</li>
<li><code>base64</code>(bool, default: false)</li>
</ul>
<h4 id="returns">Returns</h4>
<ul>
<li><code>src</code> (string)</li>
<li><code>width</code> (int)</li>
<li><code>height</code> (int)</li>
<li><code>aspectRatio</code> (float)</li>
</ul>
<h3 id="fixed">fixed</h3>
<p>Automatically create sizes for different resolutions — we do 1x, 1.5x, and 2x.</p>
<h4 id="parameters-1">Parameters</h4>
<ul>
<li><code>width</code> (int, default: 400)</li>
<li><code>height</code> (int)</li>
<li><code>quality</code> (int, default: 50)</li>
<li><code>jpegQuality</code> (int)</li>
<li><code>pngQuality</code> (int)</li>
<li><code>webpQuality</code> (int)</li>
</ul>
<h4 id="returns-1">Returns</h4>
<ul>
<li><code>base64</code> (string)</li>
<li><code>aspectRatio</code> (float)</li>
<li><code>width</code> (float)</li>
<li><code>height</code> (float)</li>
<li><code>src</code> (string)</li>
<li><code>srcSet</code> (string)</li>
</ul>
<h3 id="fluid">fluid</h3>
<p>Create fluid sizes (in width) for the image. If the max width of the container for the rendered markdown file is 800px, the sizes would then be: 200px, 400px, 800px, 1200px, 1600px – enough to provide close to the optimal image size for every device size / screen resolution.</p>
<p>If you want more control over which sizes are output you can use the <code>srcSetBreakpoints</code> parameter. For example, if you want images that are 200, 340, 520, and 890 wide you can add <code>srcSetBreakpoints: [ 200, 340, 520, 890 ]</code> as a parameter. You will also get <code>maxWidth</code> as a breakpoint (which is 800 by default), so you will actually get <code>[ 200, 340, 520, 800, 890 ]</code> as breakpoints.</p>
<p>On top of that, <code>fluid</code> returns everything else (namely aspectRatio and a base64 image to use as a placeholder) you need to implement the “blur up” technique popularized by Medium and Facebook (and also available as a Gatsby plugin for Markdown content as gatsby-remark-images).</p>
<p>When both a <code>maxWidth</code> and <code>maxHeight</code> are provided, sharp will <a href="http://sharp.pixelplumbing.com/en/stable/api-resize/#crop">resize the image</a> using <code>COVER</code> as a fit strategy by default. You can choose between <code>COVER</code>, <code>CONTAIN</code>, <code>FILL</code>, <code>INSIDE</code>, and <code>OUTSIDE</code> as a fit strategy. See the <a href="#fit">fit parameter below</a> for more details.</p>
<h4 id="parameters-2">Parameters</h4>
<ul>
<li><code>maxWidth</code> (int, default: 800)</li>
<li><code>maxHeight</code> (int)</li>
<li><code>quality</code> (int, default: 50)</li>
<li><code>jpegQuality</code> (int)</li>
<li><code>pngQuality</code> (int)</li>
<li><code>webpQuality</code> (int)</li>
<li><code>srcSetBreakpoints</code> (array of int, default: [])</li>
<li><code>background</code> (string, default: ‘rgba(0,0,0,1)’)</li>
<li>[deprecated] <code>sizeByPixelDensity</code> (bool, default: false)
<ul>
<li>Pixel density is only used in vector images, which Gatsby’s implementation of Sharp doesn’t support. This option is currently a no-op and will be removed in the next major version of Gatsby.</li>
</ul></li>
</ul>
<h4 id="returns-2">Returns</h4>
<ul>
<li><code>base64</code> (string)</li>
<li><code>aspectRatio</code> (float)</li>
<li><code>src</code> (string)</li>
<li><code>srcSet</code> (string)</li>
<li><code>srcSetType</code> (string)</li>
<li><code>sizes</code> (string)</li>
<li><code>originalImg</code> (string)</li>
</ul>
<h3 id="shared-options">Shared Options</h3>
<p>In addition to their individual parameters, all methods above share the following:</p>
<ul>
<li><code>grayscale</code> (bool, default: false)</li>
<li><code>duotone</code> (bool|obj, default: false)</li>
<li><code>toFormat</code> (string, default: ’’)</li>
<li><code>toFormatBase64</code> (string, default: ’’)</li>
<li><code>base64Width</code> (int, default: 20)</li>
<li><code>cropFocus</code> (string, default: ‘ATTENTION’)</li>
<li><code>fit</code> (string, default: ‘COVER’)</li>
<li><code>pngCompressionSpeed</code> (int, default: 4)</li>
<li><code>rotate</code> (int, default: 0)</li>
</ul>
<h4 id="toformat">toFormat</h4>
<p>Convert the source image to one of the following available options: <code>NO_CHANGE</code>, <code>JPG</code>, <code>PNG</code>, <code>WEBP</code>.</p>
<h4 id="toformatbase64">toFormatBase64</h4>
<p>base64 image uses the image format from the source, or the value of <code>toFormat</code>. This setting allows a different image format instead, available options are: <code>JPG</code>, <code>PNG</code>, <code>WEBP</code>.</p>
<p><code>WEBP</code> allows for a smaller data size, allowing you to reduce your HTML size when transferring over the network, or to use a larger base64 placeholder width default for improved image placeholder quality.</p>
<p><a href="https://caniuse.com/#feat=webp">Not all browsers support <code>WEBP</code></a>. It would be wasteful to include a fallback image format in this case. Consider also adding a <code>backgroundColor</code> placeholder as a fallback instead.</p>
<p>The plugin config option <code>forceBase64Format</code> performs the equivalent functionality by default to all your base64 placeholders. <code>toFormatBase64</code> has a higher priority for base64 images that need to selectively use a different format.</p>
<h4 id="base64width">base64Width</h4>
<p>The width in pixels for your base64 placeholder to use. The height will also be adjusted based on the aspect ratio of the image. Use this to increase the image quality by allowing more pixels to be used at the expense of increasing the file size of the data to be transferred.</p>
<p>The default for Gatsby is <code>20</code>px. This keeps the data size low enough to embed into the HTML document for immediate display on DOM loaded and avoids an additional network request.</p>
<p><a href="https://engineering.fb.com/android/the-technology-behind-preview-photos/">Facebook</a> and <a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/">Medium</a> are both known to use <code>42</code>px width for their image placeholders. However Medium presently uses a solid background color placeholder to load the page as fast as possible, followed by an image placeholder requested over the network instead of embedding it with base64.</p>
<p>The plugin config has an equivalent option, allowing you to change the default for all base64 placeholders. This parameter option has a higher priority over the plugin config option.</p>
<h4 id="cropfocus">cropFocus</h4>
<p>Change the cropping focus. Available options: <code>CENTER</code>, <code>NORTH</code>, <code>NORTHEAST</code>, <code>EAST</code>, <code>SOUTHEAST</code>, <code>SOUTH</code>, <code>SOUTHWEST</code>, <code>WEST</code>, <code>NORTHWEST</code>, <code>ENTROPY</code>, <code>ATTENTION</code>. See Sharp’s <a href="http://sharp.pixelplumbing.com/en/stable/api-resize/#crop">resize</a>.</p>
<h4 id="fit">fit</h4>
<p>Select the fit strategy for sharp to use when resizing images. Available options are: <code>COVER</code>, <code>CONTAIN</code>, <code>FILL</code>, <code>INSIDE</code>, <code>OUTSIDE</code>. See Sharp’s <a href="http://sharp.pixelplumbing.com/en/stable/api-resize/#crop">resize</a>.</p>
<p><strong>Note:</strong> The fit strategies <code>CONTAIN</code> and <code>FILL</code> will not work when <code>cropFocus</code> is set to <code>ENTROPY</code> or <code>ATTENTION</code>.</p>
<p>The following image shows the effects of each fit option. You can see that the <code>INSIDE</code> option results in one dimension being smaller than requested, while the <code>OUTSIDE</code> option results in one dimension being larger than requested. <img src="./sharp-transform-fit-options.png" alt="Sharp transform fit options" /></p>
<h4 id="pngcompressionspeed">pngCompressionSpeed</h4>
<p>Change the speed/quality tradeoff for PNG compression from 1 (brute-force) to 10 (fastest). See pngquant’s <a href="https://pngquant.org/#options">options</a>.</p>
<h4 id="rotate">rotate</h4>
<p>Rotate the image (after cropping). See Sharp’s <a href="http://sharp.pixelplumbing.com/en/stable/api-operation/#rotate">rotate</a>.</p>
<h4 id="grayscale">grayscale</h4>
<p>Uses Sharp’s <a href="http://sharp.pixelplumbing.com/en/stable/api-colour/#greyscale">greyscale</a> to convert the source image to 8-bit greyscale, 256 shades of grey, e.g.</p>
<pre class="graphql"><code>allImageSharp {
  edges {
    node {
      ... on ImageSharp {
        resize(width: 150, height: 150, grayscale: true) {
          src
        }
      }
    }
  }
}</code></pre>
<h4 id="duotone">duotone</h4>
<p>Applys a “duotone” effect (see <a href="https://alistapart.com/article/finessing-fecolormatrix">I</a>, <a href="http://blog.72lions.com/blog/2015/7/7/duotone-in-js">II</a>, <a href="https://ines.io/blog/dynamic-duotone-svg-jade">III</a>) to the source image if given two hex colors <code>shadow</code> and <code>highlight</code> defining start and end color of the duotone gradient, e.g.</p>
<pre class="graphql"><code>fixed(
  width: 800,
  duotone: {
    highlight: &quot;#f00e2e&quot;,
    shadow: &quot;#192550&quot;
  }
) {
  src
  srcSet
  base64
}</code></pre>
<p>the source image colors will be converted to match a gradient color chosen based on each pixel’s <a href="https://en.wikipedia.org/wiki/Relative_luminance">relative luminance</a>.<br />
Logic is borrowed from <a href="https://github.com/nagelflorian/react-duotone">react-duotone</a>.</p>
<p>You can pass a third optional parameter, <code>opacity</code>:</p>
<pre class="graphql"><code>fluid(
  width: 800,
  duotone: {
    highlight: &quot;#f00e2e&quot;,
    shadow: &quot;#192550&quot;,
    opacity: 50
  }
) {
  src
  srcSet
  base64
}</code></pre>
<p>If set, a semi-transparent version of duotone’d image will be composited over the original image, allowing the original image and its colors to partially “shine through”. <em>Heads up</em>: If the original image contains an alpha channel it will be <a href="http://sharp.pixelplumbing.com/en/stable/api-operation/#flatten">flattened</a> before creating the composite.</p>
<p>This works by adding an alpha channel to the duotone’d image - then we let Sharp do its magic via <a href="http://sharp.pixelplumbing.com/en/stable/api-composite/#overlaywith"><code>overlayWith</code></a>; quoting the Sharp documentation:</p>
<blockquote>
<p>If the overlay image contains an alpha channel then composition with <a href="https://en.wikipedia.org/wiki/Alpha_compositing">premultiplication</a> will occur.</p>
</blockquote>
<h4 id="tracedsvg">tracedSVG</h4>
<p>Generates a traced SVG of the image (see <a href="https://github.com/gatsbyjs/gatsby/issues/2435">the original GitHub issue</a>) and returns the SVG as “<a href="https://codepen.io/tigt/post/optimizing-svgs-in-data-uris">optimized URL-encoded</a>” <code>data:</code> URI. It used in <a href="/plugins/gatsby-image/">gatsby-image</a> to provide an alternative to the default inline base64 placeholder image.</p>
<p>Uses <a href="https://github.com/tooolbox/node-potrace">node-potrace</a> and <a href="https://github.com/svg/svgo">SVGO</a> under the hood. Default settings for node-potrace:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">  <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="dt">color</span><span class="op">:</span> <span class="vs">`lightgray`</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="dt">optTolerance</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">turdSize</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">turnPolicy</span><span class="op">:</span> TURNPOLICY_MAJORITY<span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="op">}</span></a></code></pre></div>
<p>All <a href="https://github.com/tooolbox/node-potrace#parameters">node-potrace <code>Potrace</code> parameters</a> are exposed and can be set via the <code>traceSVG</code> argument:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="at">fixed</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  traceSVG<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">    <span class="dt">color</span><span class="op">:</span> <span class="st">&quot;#f00e2e&quot;</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">turnPolicy</span><span class="op">:</span> TURNPOLICY_MINORITY</a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="dt">blackOnWhite</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-7" title="7">) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">  src</a>
<a class="sourceLine" id="cb6-9" title="9">  srcSet</a>
<a class="sourceLine" id="cb6-10" title="10">  tracedSVG</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="op">}</span></a></code></pre></div>
<h3 id="setting-a-default-quality">Setting a default quality</h3>
<p>You can pass a default image quality to <code>sharp</code> by setting the <code>defaultQuality</code> option.</p>
<h3 id="using-mozjpeg">Using MozJPEG</h3>
<p>You can opt-in to use <a href="https://github.com/mozilla/mozjpeg">MozJPEG</a> for jpeg-encoding. MozJPEG provides even better image compression than the default encoder used in <code>gatsby-plugin-sharp</code>. However, when using MozJPEG the build time of your Gatsby project will increase significantly.</p>
<p>To enable MozJPEG, you can set the <code>useMozJpeg</code> plugin option to <code>true</code> in <code>gatsby-config.js</code>.</p>
<p>For backwards compatible reasons, if <code>useMozJpeg</code> is not defined in the plugin options, the <a href="/docs/environment-variables/#environment-variables">environment variable</a> <code>GATSBY_JPEG_ENCODER</code> acts as a fallback if set to <code>MOZJPEG</code>:</p>
<pre class="shell"><code>GATSBY_JPEG_ENCODER=MOZJPEG</code></pre>
<h3 id="allow-build-to-continue-on-image-processing-error">Allow build to continue on image processing error</h3>
<p>By default, the build will fail when it encounters an error while processing an image. You can change this so that it continues the build process by setting the plugin option <code>failOnError</code> to <code>false</code>. Sharp will still throw an error and display it in the console as a GraphQL error, but it will not exit the process. It is important to note that any images that would have otherwise failed will not be accessible via <code>childImageSharp</code> until the underlying issue with the image is addressed.</p>
<h3 id="exif-and-icc-metadata">EXIF and ICC metadata</h3>
<p>By default, <code>gatsby-plugin-sharp</code> strips all EXIF, ICC and other metadata present in your source file. This is the recommended default as it leads to smaller file sizes.</p>
<p>However, in situations where you wish to preserve EXIF metadata or ICC profiles (example: you are building a photography portfolio and wish to conserve the color profile or the copyright information of the photos you’ve exported from Adobe Lightroom or Phase One’s Capture One), you can set the <code>stripMetadata</code> plugin option to <code>false</code> in <code>gatsby-config.js</code>.</p>
<p>It is important to note that if <code>stripMetadata</code> is set to <code>false</code>, <strong>all</strong> metadata information will be preserved from the source image, including but not limited to the latitude/longitude information of where the picture was taken (if present). If you wish to strip this information from the source file, you can either leave <code>stripMetadata</code> to its default of <code>true</code>, or manually pre-process your images with a tool such as <a href="https://www.sno.phy.queensu.ca/~phil/exiftool/">ExifTool</a>.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="incompatible-library-version-sharp.node-requires-version-x-or-later-but-z-provides-version-y">Incompatible library version: sharp.node requires version X or later, but Z provides version Y</h3>
<p>This means that there are multiple incompatible versions of the <code>sharp</code> package installed in <code>node_modules</code>. The complete error typically looks like this:</p>
<pre class="text"><code>Something went wrong installing the &quot;sharp&quot; module

dlopen(/Users/misiek/dev/gatsby-starter-blog/node_modules/sharp/build/Release/sharp.node, 1): Library not loaded: @rpath/libglib-2.0.dylib
  Referenced from: /Users/misiek/dev/gatsby-starter-blog/node_modules/sharp/build/Release/sharp.node
  Reason: Incompatible library version: sharp.node requires version 6001.0.0 or later, but libglib-2.0.dylib provides version 5801.0.0</code></pre>
<p>To fix this, you’ll need to update all Gatsby plugins in the current project that depend on the <code>sharp</code> package. Here’s a list of official plugins that you might need to update in case your projects uses them:</p>
<ul>
<li><code>gatsby-plugin-sharp</code></li>
<li><code>gatsby-plugin-manifest</code></li>
<li><code>gatsby-remark-images-contentful</code></li>
<li><code>gatsby-source-contentful</code></li>
<li><code>gatsby-transformer-sharp</code></li>
<li><code>gatsby-transformer-sqip</code></li>
</ul>
<p>To update these packages, run:</p>
<pre class="shell"><code>npm install gatsby-plugin-sharp gatsby-plugin-manifest gatsby-remark-images-contentful gatsby-source-contentful gatsby-transformer-sharp gatsby-transformer-sqip</code></pre>
<p>If updating these doesn’t fix the issue, your project probably uses other plugins from the community that depend on a different version of <code>sharp</code>. Try running <code>npm list sharp</code> or <code>yarn why sharp</code> to see all packages in the current project that use <code>sharp</code> and try updating them as well.</p>
</body>
</html>
