<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="devcert---development-ssl-made-easy">devcert - Development SSL made easy</h1>
<p>So, running a local HTTPS server usually sucks. There’s a range of approaches, each with their own tradeoff. The common one, using self-signed certificates, means having to ignore scary browser warnings for each project.</p>
<p>devcert makes the process easy. Want a private key and certificate file to use with your server? Just ask:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">let</span> ssl <span class="op">=</span> <span class="cf">await</span> <span class="va">devcert</span>.<span class="at">certificateFor</span>(<span class="st">&#39;my-app.test&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">https</span>.<span class="at">createServer</span>(ssl<span class="op">,</span> app).<span class="at">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></a></code></pre></div>
<p>Now open https://my-app.test:3000 and voila - your page loads with no scary warnings or hoops to jump through.</p>
<blockquote>
<p>Certificates are cached by name, so two calls for <code>certificateFor('foo')</code> will return the same key and certificate.</p>
</blockquote>
<h2 id="options">Options</h2>
<p>When it installs or upgrades, devcert creates a self-signed certificate authority (CA) which it uses to sign all certificates it creates. It will try to register this CA with OS keychains in OSX, Linux, and Windows. However, some HTTP clients (such as Firefox and NodeJS itself) use their own trusted certificate list instead of the operating system’s keychain. The <code>getCaPath</code> and <code>getCaBuffer</code> options make the CA available in the <code>certificateFor()</code> return object itself, so that these programs can choose whether to trust it.</p>
<h3 id="getcapath">getCaPath</h3>
<p>Set this option to <code>true</code> and the returned object will inlude a <code>caPath</code> property, set to the file path of the certificate authority file. Use this path to add the certificate to local trust stores which accept paths as arguments, such as NodeJS’s builtin environment variable <code>NODE_EXTRA_CA_CERTS</code>..</p>
<h3 id="getcabuffer">getCaBuffer</h3>
<p>Set this option to <code>true</code> and the returned object will inlude a <code>ca</code> property, set to the UTF-8-encoded contents of the certificate authority file. Use this path to add the certificate to local trust stores which don’t use OS settings, lke the examples mentioned above.</p>
<h3 id="skiphostsfile">skipHostsFile</h3>
<p>If you supply a custom domain name (i.e. any domain other than <code>localhost</code>) when requesting a certificate from devcert, it will attempt to modify your system to redirect requests for that domain to your local machine (rather than to the real domain). It does this by modifying your <code>/etc/hosts</code> file.</p>
<p>If you pass in the <code>skipHostsFile</code> option, devcert will skip this step. This means that if you ask for certificates for <code>my-app.test</code> (for example), and don’t have some other DNS redirect method in place, that you won’t be able to access your app at <code>https://my-app.test</code> because your computer wouldn’t know that <code>my-app.test</code> should resolve your local machine.</p>
<p>Keep in mind that SSL certificates are issued for <em>domains</em>, so if you ask for a certificate for <code>my-app.test</code>, and don’t have any kind of DNS redirect in place (<code>/etc/hosts</code> or otherwise), trying to hit <code>localhost</code> won’t work, even if the app you intended to serve via <code>my-app.test</code> is running on your local machine (since the SSL certificate won’t say <code>localhost</code>).</p>
<h3 id="skipcertutil">skipCertutil</h3>
<p>This option will tell devcert to avoid installing <code>certutil</code> tooling.</p>
<p><code>certutil</code> is a tooling package used to automated the installation of SSL certificates in certain circumstances; specifically, Firefox (for every OS) and Chrome (on Linux only).</p>
<p>Normally, devcert will attempt to install <code>certutil</code> if it’s need and not already present on your system. If don’t want devcert to install this package, pass <code>skipCertutil: true</code>.</p>
<p>If you decide to <code>skipCertutil</code>, the initial setup process for devcert changes in these two scenarios:</p>
<ul>
<li><p><strong>Firefox on all platforms</strong>: Thankully, Firefox makes this easy. There’s a point-and-click wizard for importing and trusting a certificate, so if you specify <code>skipCertutil: true</code>, devcert will instead automatically open Firefox and kick off this wizard for you. Simply follow the prompts to trust the certificate. <strong>Reminder: you’ll only need to do this once per machine</strong></p></li>
<li><p><strong>Chrome on Linux</strong>: Unfortunately, it appears that the <strong>only</strong> way to get Chrome to trust an SSL certificate on Linux is via the <code>certutil</code> tooling - there is no manual process for it. Thus, if you are using Chrome on Linux, do <strong>not</strong> supply <code>skipCertuil: true</code>. If you do, devcert certificates will not be trusted by Chrome.</p></li>
</ul>
<p>The <code>certutil</code> tooling is installed in OS-specific ways:</p>
<ul>
<li>Mac: <code>brew install nss</code></li>
<li>Linux: <code>apt install libnss3-tools</code></li>
<li>Windows: N/A (there is no easy, hands-off way to install certutil on Windows, so devcert will simply fallback to the wizard approach for Firefox outlined above)</li>
</ul>
<h2 id="how-it-works">How it works</h2>
<p>When you ask for a development certificate, devcert will first check to see if it has run on this machine before. If not, it will create a root certificate authority and add it to your OS and various browser trust stores. You’ll likely see password prompts from your OS at this point to authorize the new root CA.</p>
<p>Since your machine now trusts this root CA, it will trust any certificates signed by it. So when you ask for a certificate for a new domain, devcert will use the root CA credentials to generate a certificate specific to the domain you requested, and returns the new certificate to you.</p>
<p>If you request a domain that has already had certificates generated for it, devcert will simply return the cached certificates.</p>
<p>This setup ensures that browsers won’t show scary warnings about untrusted certificates, since your OS and browsers will now trust devcert’s certificates.</p>
<h2 id="security-concerns">Security Concerns</h2>
<p>There’s a reason that your OS prompts you for your root password when devcert attempts to install it’s root certificate authority. By adding it to your machine’s trust stores, your browsers will automatically trust <em>any</em> certificate generated with it.</p>
<p>This exposes a potential attack vector on your local machine: if someone else could use the devcert certificate authority to generate certificates, and if they could intercept / manipulate your network traffic, they could theoretically impersonate some websites, and your browser would not show any warnings (because it trusts the devcert authority).</p>
<p>To prevent this, devcert takes steps to ensure that no one can access the devcert certificate authority credentials to generate malicious certificates without you knowing. The exact approach varies by platform:</p>
<ul>
<li><strong>macOS and Linux</strong>: the certificate authority’s credentials are written to files that are only readable by the root user (i.e. <code>chown 0 ca-cert.crt</code> and <code>chmod 600 ca-cert.crt</code>). When devcert itself needs these, it shells out to <code>sudo</code> invocations to read / write the credentials.</li>
<li><strong>Windows</strong>: because of my unfamiliarity with Windows file permissions, I wasn’t confident I would be able to correctly set permissions to mimic the setup on macOS and Linux. So instead, devcert will prompt you for a password, and then use that to encrypt the credentials with an AES256 cipher. The password is never written to disk.</li>
</ul>
<p>To further protect these credentials, any time they are written to disk, they are written to temporary files, and are immediately deleted after they are no longer needed.</p>
<p>Additionally, the root CA certificate is unique to your machine only: it’s generated on-the-fly when it is first installed. ensuring there are no central / shared keys to crack across machines.</p>
<h3 id="why-install-a-root-certificate-authority-at-all">Why install a root certificate authority at all?</h3>
<p>The root certificate authority makes it simpler to manage which domains are configured for SSL by devcert. The alternative is to generate and trust self-signed certificates for each domain. The problem is that while devcert is able to add a certificate to your machine’s trust stores, the tooling to remove a certificate doesn’t cover every case. So if you ever wanted to <em>untrust</em> devcert’s certificates, you’d have to manually remove each one from each trust store.</p>
<p>By trusting only a single root CA, devcert is able to guarantee that when you want to <em>disable</em> SSL for a domain, it can do so with no manual intervention - we just delete the domain-specific certificate files. Since these domain-specific files aren’t installed in your trust stores, once they are gone, they are gone.</p>
<h2 id="integration">Integration</h2>
<p>devcert has been designed from day one to work as low-level library that other tools can delegate to. The goal is to make HTTPS development easy for everyone, regardless of framework or library choice.</p>
<p>With that in mind, if you’d like to use devcert in your library/framework/CLI, devcert makes that easy.</p>
<p>In addition to the options above, devcert exposes a <code>ui</code> option. This option allows you to control all the points where devcert requries user interaction, substituting your own prompts and user interface. You can use this to brand the experience with your own tool’s name, localize the messages, or integrate devcert into a larger existing workflow.</p>
<p>The <code>ui</code> option should be an object with the following methods:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ts"><code class="sourceCode typescript"><a class="sourceLine" id="cb2-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">async</span> <span class="fu">getWindowsEncryptionPassword</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="co">// Invoked when devcert needs the password used to encrypt the root</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="co">// certificate authority credentials on Windows. May be invoked multiple</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="co">// times if the user&#39;s supplied password is incorrect</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="kw">async</span> <span class="fu">warnChromeOnLinuxWithoutCertutil</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="co">// Invoked when devcert is run on Linux, detects that Chrome is installed,</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="co">// and the `skipCertutil` option is `true`. Used to warn the user that</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="co">// Chrome will not work with `skipCertutil: true` on Linux.</span></a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="kw">async</span> <span class="fu">closeFirefoxBeforeContinuing</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="co">// Invoked when devcert detects that Firefox is running while it is trying</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="co">// to programmatically install it&#39;s certificate authority in the Firefox</span></a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="co">// trust store. Firefox appears to overwrite changes to the trust store on</span></a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="co">// exit, so Firefox must be closed before devcert can continue. devcert will</span></a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="co">// wait for Firefox to exit - this is just to prompt the user that they</span></a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="co">// need to close the application.</span></a>
<a class="sourceLine" id="cb2-19" title="19">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="kw">async</span> <span class="fu">startFirefoxWizard</span>(certificateHost<span class="op">:</span> <span class="dt">string</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="co">// Invoked when devcert detects a Firefox installation and `skipCertutil:</span></a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="co">// true` was specified. This is invoked right before devcert launches the</span></a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="co">// Firefox certificate import wizard GUI. Used to give the user a heads up</span></a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="co">// as to why they are about to see Firefox pop up.</span></a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="co">//</span></a>
<a class="sourceLine" id="cb2-26" title="26">    <span class="co">// The certificateHost provided is the URL for the temporary server that</span></a>
<a class="sourceLine" id="cb2-27" title="27">    <span class="co">// devcert has spun up in order to trigger the wizard(Firefox needs try to</span></a>
<a class="sourceLine" id="cb2-28" title="28">    <span class="co">// &quot;download&quot; the cert to trigger the wizard). This URL will load the page</span></a>
<a class="sourceLine" id="cb2-29" title="29">    <span class="co">// supplied in the `firefoxWizardPromptPage()` method below.</span></a>
<a class="sourceLine" id="cb2-30" title="30">    <span class="co">//</span></a>
<a class="sourceLine" id="cb2-31" title="31">    <span class="co">// Normally, devcert will automatically open this URL, but in case it fails</span></a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="co">// you may want to print it out to the console with an explanatory message</span></a>
<a class="sourceLine" id="cb2-33" title="33">    <span class="co">// so the user isn&#39;t left hanging wondering what&#39;s happening.</span></a>
<a class="sourceLine" id="cb2-34" title="34">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-35" title="35">  <span class="kw">async</span> <span class="fu">firefoxWizardPromptPage</span>(certificateURL<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-36" title="36">    <span class="co">// When devcert starts the Firefox certificate installation wizard GUI, it</span></a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="co">// first loads an HTML page in Firefox. The template used for that page is</span></a>
<a class="sourceLine" id="cb2-38" title="38">    <span class="co">// the return value of this method. The supplied certificateURL is the path</span></a>
<a class="sourceLine" id="cb2-39" title="39">    <span class="co">// to the actual certificate. The Firefox tab must attempt to load this URL</span></a>
<a class="sourceLine" id="cb2-40" title="40">    <span class="co">// to trigger the wizard.</span></a>
<a class="sourceLine" id="cb2-41" title="41">    <span class="co">//</span></a>
<a class="sourceLine" id="cb2-42" title="42">    <span class="co">// The default implemenation is a simple redirect to that URL. But you could</span></a>
<a class="sourceLine" id="cb2-43" title="43">    <span class="co">// supply your own branded template here, with a button that says &quot;Install</span></a>
<a class="sourceLine" id="cb2-44" title="44">    <span class="co">// certificate&quot; that is linked to the certificateURL, along with a more in</span></a>
<a class="sourceLine" id="cb2-45" title="45">    <span class="co">// depth explanation of what is happening for example.</span></a>
<a class="sourceLine" id="cb2-46" title="46">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-47" title="47">  <span class="kw">async</span> <span class="fu">waitForFirefoxWizard</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-48" title="48">    <span class="co">// Invoked _after_ the Firefox certificate import wizard is kicked off. This</span></a>
<a class="sourceLine" id="cb2-49" title="49">    <span class="co">// method should not resolve until the user indicates that the wizard is</span></a>
<a class="sourceLine" id="cb2-50" title="50">    <span class="co">// complete (unfortunately, we have no way of determining that</span></a>
<a class="sourceLine" id="cb2-51" title="51">    <span class="co">// programmatically)</span></a>
<a class="sourceLine" id="cb2-52" title="52">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="op">}</span></a></code></pre></div>
<p>You can supply any or all of these methods - ones you do not supply will fall back to the default implemenation.</p>
<h2 id="testing">Testing</h2>
<p>Testing a tool like devcert can be a pain. I haven’t found a good automated solution for cross platform GUI testing (the GUI part is necessary to test each browser’s handling of devcert certificates, as well as test the Firefox wizard flow).</p>
<p>To make things easier, devcert comes with a series of virtual machine images. Each one is a snapshot taken right before running a test - just launch the machine and hit <Enter>.</p>
<p>You can also use the snapshotted state of the VMs to roll them back to a pristine state for another round of testing.</p>
<blockquote>
<p><strong>Note</strong>: Be aware that the macOS license terms prohibit running it on non-Apple hardware, so you must own a Mac to test that platform. If you don’t own a Mac - that’s okay, just mention in the PR that you were unable to test on a Mac and we’re happy to test it for you.</p>
</blockquote>
<h3 id="virtual-machine-snapshots">Virtual Machine Snapshots</h3>
<ul>
<li><a href="https://s3-us-west-1.amazonaws.com/devcert-test-snapshots/macOS.pvm.zip">macOS</a></li>
<li><a href="https://s3-us-west-1.amazonaws.com/devcert-test-snapshots/MSEdge+-+Win10.zip">Windows</a></li>
<li><a href="https://s3-us-west-1.amazonaws.com/devcert-test-snapshots/Ubuntu+Linux.zip">Ubuntu</a></li>
</ul>
<h2 id="license">License</h2>
<p>MIT © <a href="http://davewasmer.com">Dave Wasmer</a></p>
</body>
</html>
