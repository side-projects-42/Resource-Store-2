extract-files
=============

[![npm version](https://badgen.net/npm/v/extract-files)](https://npm.im/extract-files) [![CI status](https://github.com/jaydenseric/extract-files/workflows/CI/badge.svg)](https://github.com/jaydenseric/extract-files/actions)

Clones a value, recursively extracting [`File`](https://developer.mozilla.org/docs/web/api/file), [`Blob`](https://developer.mozilla.org/docs/web/api/blob) and [`ReactNativeFile`](#class-reactnativefile) instances with their [object paths](#type-objectpath), replacing them with `null`. [`FileList`](https://developer.mozilla.org/docs/web/api/filelist) instances are treated as [`File`](https://developer.mozilla.org/docs/web/api/file) instance arrays.

Used by [GraphQL multipart request spec client implementations](https://github.com/jaydenseric/graphql-multipart-request-spec#implementations) such as [`graphql-react`](https://npm.im/graphql-react) and [`apollo-upload-client`](https://npm.im/apollo-upload-client).

Setup
-----

Install with [npm](https://npmjs.com/get-npm):

    npm install extract-files

See the [`extractFiles`](#function-extractfiles) documentation to get started.

Support
-------

-   Node.js `^10.17.0 || ^12.0.0 || >= 13.7.0`
-   Browsers [`> 0.5%, not OperaMini all, not dead`](https://browserl.ist/?q=%3E+0.5%25%2C+not+OperaMini+all%2C+not+dead)
-   React Native

API
---

### Table of contents

-   [class ReactNativeFile](#class-reactnativefile)
-   [function extractFiles](#function-extractfiles)
-   [function isExtractableFile](#function-isextractablefile)
-   [type ExtractableFile](#type-extractablefile)
-   [type ExtractableFileMatcher](#type-extractablefilematcher)
-   [type ExtractFilesResult](#type-extractfilesresult)
-   [type ObjectPath](#type-objectpath)
-   [type ReactNativeFileSubstitute](#type-reactnativefilesubstitute)

### class ReactNativeFile

Used to mark a [React Native `File` substitute](#type-reactnativefilesubstitute) in an object tree for [`extractFiles`](#function-extractfiles). It’s too risky to assume all objects with `uri`, `type` and `name` properties are files to extract.

<table><thead><tr class="header"><th style="text-align: left;">Parameter</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>file</code></td><td style="text-align: left;"><a href="#type-reactnativefilesubstitute">ReactNativeFileSubstitute</a></td><td style="text-align: left;">A React Native <a href="https://developer.mozilla.org/docs/web/api/file"><code>File</code></a> substitute.</td></tr></tbody></table>

#### Examples

*Ways to `import`.*

>     import { ReactNativeFile } from 'extract-files';
>
>     import ReactNativeFile from 'extract-files/public/ReactNativeFile.js';

*Ways to `require`.*

>     const { ReactNativeFile } = require('extract-files');
>
>     const ReactNativeFile = require('extract-files/public/ReactNativeFile');

*An extractable file in React Native.*

>     import { ReactNativeFile } from 'extract-files';
>
>     const file = new ReactNativeFile({
>       uri: uriFromCameraRoll,
>       name: 'a.jpg',
>       type: 'image/jpeg',
>     });

------------------------------------------------------------------------

### function extractFiles

Clones a value, recursively extracting [`File`](https://developer.mozilla.org/docs/web/api/file), [`Blob`](https://developer.mozilla.org/docs/web/api/blob) and [`ReactNativeFile`](#class-reactnativefile) instances with their [object paths](#type-objectpath), replacing them with `null`. [`FileList`](https://developer.mozilla.org/docs/web/api/filelist) instances are treated as [`File`](https://developer.mozilla.org/docs/web/api/file) instance arrays.

<table style="width:99%;"><colgroup><col style="width: 33%" /><col style="width: 33%" /><col style="width: 33%" /></colgroup><thead><tr class="header"><th style="text-align: left;">Parameter</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>value</code></td><td style="text-align: left;">*</td><td style="text-align: left;">Value (typically an object tree) to extract files from.</td></tr><tr class="even"><td style="text-align: left;"><code>path</code></td><td style="text-align: left;"><a href="#type-objectpath">ObjectPath</a>? = <code>''</code></td><td style="text-align: left;">Prefix for object paths for extracted files.</td></tr><tr class="odd"><td style="text-align: left;"><code>isExtractableFile</code></td><td style="text-align: left;"><a href="#type-extractablefilematcher">ExtractableFileMatcher</a>? = <a href="#function-isextractablefile">isExtractableFile</a></td><td style="text-align: left;">The function used to identify extractable files.</td></tr></tbody></table>

**Returns:** [ExtractFilesResult](#type-extractfilesresult) — Result.

#### Examples

*Ways to `import`.*

>     import { extractFiles } from 'extract-files';
>
>     import extractFiles from 'extract-files/public/extractFiles.js';

*Ways to `require`.*

>     const { extractFiles } = require('extract-files');
>
>     const extractFiles = require('extract-files/public/extractFiles');

*Extract files from an object.*

> For the following:
>
>     import { extractFiles } from 'extract-files';
>
>     const file1 = new File(['1'], '1.txt', { type: 'text/plain' });
>     const file2 = new File(['2'], '2.txt', { type: 'text/plain' });
>     const value = {
>       a: file1,
>       b: [file1, file2],
>     };
>
>     const { clone, files } = extractFiles(value, 'prefix');
>
> `value` remains the same.
>
> `clone` is:
>
>     {
>       "a": null,
>       "b": [null, null]
>     }
>
> `files` is a [`Map`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map) instance containing:
>
> <table><thead><tr class="header"><th style="text-align: left;">Key</th><th style="text-align: left;">Value</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>file1</code></td><td style="text-align: left;"><code>['prefix.a', 'prefix.b.0']</code></td></tr><tr class="even"><td style="text-align: left;"><code>file2</code></td><td style="text-align: left;"><code>['prefix.b.1']</code></td></tr></tbody></table>
>
------------------------------------------------------------------------

### function isExtractableFile

Checks if a value is an [extractable file](#type-extractablefile).

**Type:** [ExtractableFileMatcher](#type-extractablefilematcher)

<table><thead><tr class="header"><th style="text-align: left;">Parameter</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>value</code></td><td style="text-align: left;">*</td><td style="text-align: left;">Value to check.</td></tr></tbody></table>

**Returns:** boolean — Is the value an [extractable file](#type-extractablefile).

#### Examples

*Ways to `import`.*

>     import { isExtractableFile } from 'extract-files';
>
>     import isExtractableFile from 'extract-files/public/isExtractableFile.js';

*Ways to `require`.*

>     const { isExtractableFile } = require('extract-files');
>
>     const isExtractableFile = require('extract-files/public/isExtractableFile');

------------------------------------------------------------------------

### type ExtractableFile

An extractable file.

**Type:** File | Blob | [ReactNativeFile](#class-reactnativefile)

------------------------------------------------------------------------

### type ExtractableFileMatcher

A function that checks if a value is an [extractable file](#type-extractablefile).

**Type:** Function

<table><thead><tr class="header"><th style="text-align: left;">Parameter</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>value</code></td><td style="text-align: left;">*</td><td style="text-align: left;">Value to check.</td></tr></tbody></table>

**Returns:** boolean — Is the value an [extractable file](#type-extractablefile).

#### See

-   [`isExtractableFile`](#function-isextractablefile) is the default extractable file matcher.

#### Examples

*How to check for the default exactable files, as well as a custom type of file.*

>     import { isExtractableFile } from 'extract-files';
>
>     const isExtractableFileEnhanced = (value) =>
>       isExtractableFile(value) ||
>       (typeof CustomFile !== 'undefined' && value instanceof CustomFile);

------------------------------------------------------------------------

### type ExtractFilesResult

What [`extractFiles`](#function-extractfiles) returns.

**Type:** object

<table style="width:99%;"><colgroup><col style="width: 33%" /><col style="width: 33%" /><col style="width: 33%" /></colgroup><thead><tr class="header"><th style="text-align: left;">Property</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>clone</code></td><td style="text-align: left;">*</td><td style="text-align: left;">Clone of the original input value with files recursively replaced with <code>null</code>.</td></tr><tr class="even"><td style="text-align: left;"><code>files</code></td><td style="text-align: left;">Map&lt;<a href="#type-extractablefile">ExtractableFile</a>, Array&lt;<a href="#type-objectpath">ObjectPath</a>&gt;&gt;</td><td style="text-align: left;">Extracted files and their locations within the original value.</td></tr></tbody></table>

------------------------------------------------------------------------

### type ObjectPath

String notation for the path to a node in an object tree.

**Type:** string

#### See

-   [`object-path` on npm](https://npm.im/object-path).

#### Examples

*Object path is property `a`, array index `0`, object property `b`.*

>     a.0.b

------------------------------------------------------------------------

### type ReactNativeFileSubstitute

A React Native [`File`](https://developer.mozilla.org/docs/web/api/file) substitute for when using [`FormData`](https://developer.mozilla.org/docs/web/api/formdata).

**Type:** object

<table><thead><tr class="header"><th style="text-align: left;">Property</th><th style="text-align: left;">Type</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><code>uri</code></td><td style="text-align: left;">string</td><td style="text-align: left;">Filesystem path.</td></tr><tr class="even"><td style="text-align: left;"><code>name</code></td><td style="text-align: left;">string?</td><td style="text-align: left;">File name.</td></tr><tr class="odd"><td style="text-align: left;"><code>type</code></td><td style="text-align: left;">string?</td><td style="text-align: left;">File content type.</td></tr></tbody></table>

#### See

-   [React Native `FormData` polyfill source](https://github.com/facebook/react-native/blob/v0.45.1/Libraries/Network/FormData.js#L34).

#### Examples

*A camera roll file.*

>     const fileSubstitute = {
>       uri: uriFromCameraRoll,
>       name: 'a.jpg',
>       type: 'image/jpeg',
>     };
