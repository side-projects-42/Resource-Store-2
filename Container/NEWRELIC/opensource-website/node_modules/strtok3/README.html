<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><img src="https://github.com/Borewit/strtok3/workflows/Node.js%20CI/badge.svg" alt="Node.js CI" /> <a href="https://npmjs.org/package/strtok3"><img src="https://badge.fury.io/js/strtok3.svg" alt="NPM version" /></a> <a href="https://npmcharts.com/compare/strtok3,token-types?start=1200&amp;interval=30"><img src="http://img.shields.io/npm/dm/strtok3.svg" alt="npm downloads" /></a> <a href="https://dependabot.com"><img src="https://api.dependabot.com/badges/status?host=github&amp;repo=Borewit/music-metadata" alt="Dependabot Status" /></a><a href="https://coveralls.io/github/Borewit/strtok3?branch=master"><img src="https://coveralls.io/repos/github/Borewit/strtok3/badge.svg?branch=master" alt="Coverage status" /></a> <a href="https://deepscan.io/dashboard#view=project&amp;tid=5165&amp;pid=8526&amp;bid=103329"><img src="https://deepscan.io/api/teams/5165/projects/8526/branches/103329/badge/grade.svg" alt="DeepScan grade" /></a> <a href="https://snyk.io/test/github/Borewit/strtok3?targetFile=package.json"><img src="https://snyk.io/test/github/Borewit/strtok3/badge.svg?targetFile=package.json" alt="Known Vulnerabilities" /></a> <a href="https://lgtm.com/projects/g/Borewit/strtok3/alerts/"><img src="https://img.shields.io/lgtm/alerts/g/Borewit/strtok3.svg?logo=lgtm&amp;logoWidth=18" alt="Total alerts" /></a> <a href="https://www.codacy.com/app/Borewit/strtok3?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=Borewit/strtok3&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/59dd6795e61949fb97066ca52e6097ef" alt="Codacy Badge" /></a> <a href="https://lgtm.com/projects/g/Borewit/strtok3/context:javascript"><img src="https://img.shields.io/lgtm/grade/javascript/g/Borewit/strtok3.svg?logo=lgtm&amp;logoWidth=18" alt="Language grade: JavaScript" /></a> # strtok3</p>
<p>A promise based streaming <a href="#tokenizer"><em>tokenizer</em></a> for <a href="http://nodejs.org">Node.js</a> and browsers. This node module is a successor of <a href="https://github.com/Borewit/strtok2">strtok2</a>.</p>
<p>The <code>strtok3</code> contains a few methods to turn different input into a <a href="#tokenizer"><em>tokenizer</em></a>. Designed to * Support a streaming environment * Decoding of binary data, strings and numbers in mind * Read <a href="https://github.com/Borewit/token-types">predefined</a> or custom tokens. * Optimized <a href="#tokenizer"><em>tokenizers</em></a> for reading from <a href="#method-strtok3fromfile">file</a>, <a href="#method-strtok3fromstream">stream</a> or <a href="#method-strtok3frombuffer">buffer</a>.</p>
<p>It can read from: * A file (taking a file path as an input) * A Node.js <a href="https://nodejs.org/api/stream.html">stream</a>. * A <a href="https://nodejs.org/api/buffer.html">Buffer</a> * HTTP chunked transfer provided by <span class="citation" data-cites="tokenizer/http">[@tokenizer/http]</span>(https://github.com/Borewit/tokenizer-http). * Chunked <a href="https://aws.amazon.com/s3">Amazon S3</a> access provided by <span class="citation" data-cites="tokenizer/s3">[@tokenizer/s3]</span>(https://github.com/Borewit/tokenizer-s3).</p>
<h2 id="installation">Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npm</span> install strtok3</a></code></pre></div>
<h2 id="api">API</h2>
<p>Use one of the methods to instantiate an <a href="#tokenizer"><em>abstract tokenizer</em></a>: * <a href="#method-strtok3fromfile">strtok3.fromFile</a> * <a href="#method-strtok3fromstream">strtok3.fromStream</a> * <a href="#method-strtok3frombuffer">strtok3.fromBuffer</a></p>
<h3 id="strtok3-methods">strtok3 methods</h3>
<p>All of the strtok3 methods return a <a href="#tokenizer"><em>tokenizer</em></a>, either directly or via a promise.</p>
<h4 id="method-strtok3.fromfile">Method <code>strtok3.fromFile()</code></h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>path</td>
<td>Path to file (string)</td>
<td>Path to file to read from</td>
</tr>
</tbody>
</table>
<p>Note that <a href="#file-information">file-information</a> is automatically added.</p>
<p>Returns, via a promise, a <a href="#tokenizer"><em>tokenizer</em></a> which can be used to parse a file.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> strtok3 <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;strtok3&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> Token <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;token-types&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3">    </a>
<a class="sourceLine" id="cb2-4" title="4">(<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="kw">const</span> tokenizer <span class="op">=</span> <span class="cf">await</span> <span class="va">strtok3</span>.<span class="at">fromFile</span>(<span class="st">&quot;somefile.bin&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">         <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="kw">const</span> myNumber <span class="op">=</span> <span class="cf">await</span> <span class="va">tokenizer</span>.<span class="at">readToken</span>(<span class="va">Token</span>.<span class="at">UINT8</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`My number: </span><span class="sc">${</span>myNumber<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="op">}</span> <span class="cf">finally</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="va">tokenizer</span>.<span class="at">close</span>()<span class="op">;</span> <span class="co">// Close the file</span></a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="op">}</span> </a>
<a class="sourceLine" id="cb2-13" title="13"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<h4 id="method-strtok3.fromstream">Method <code>strtok3.fromStream()</code></h4>
<p>Create <a href="#tokenizer"><em>tokenizer</em></a> from a node.js <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">readable stream</a>.</p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Optional</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>stream</td>
<td>no</td>
<td><a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">Readable</a></td>
<td>Stream to read from</td>
</tr>
<tr class="even">
<td>fileInfo</td>
<td>yes</td>
<td><a href="#IFileInfo">IFileInfo</a></td>
<td>Provide file information</td>
</tr>
</tbody>
</table>
<p>Returns a <a href="#tokenizer"><em>tokenizer</em></a>, via a Promise, which can be used to parse a buffer.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> strtok3 <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;strtok3&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> Token <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;token-types&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">strtok3</span>.<span class="at">fromStream</span>(stream).<span class="at">then</span>(tokenizer <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="cf">return</span> <span class="va">tokenizer</span>.<span class="at">readToken</span>(<span class="va">Token</span>.<span class="at">UINT8</span>).<span class="at">then</span>(myUint8Number <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`My number: </span><span class="sc">${</span>myUint8Number<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h4 id="method-strtok3.frombuffer">Method <code>strtok3.fromBuffer()</code></h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Optional</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>buffer</td>
<td>no</td>
<td><a href="https://nodejs.org/api/buffer.html">Buffer</a></td>
<td>Buffer to read from</td>
</tr>
<tr class="even">
<td>fileInfo</td>
<td>yes</td>
<td><a href="#IFileInfo">IFileInfo</a></td>
<td>Provide file information</td>
</tr>
</tbody>
</table>
<p>Returns a <a href="#tokenizer"><em>tokenizer</em></a> which can be used to parse the provided buffer.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> strtok3 <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;strtok3&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2">    </a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">const</span> tokenizer <span class="op">=</span> <span class="va">strtok3</span>.<span class="at">fromBuffer</span>(buffer)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">tokenizer</span>.<span class="at">readToken</span>(<span class="va">Token</span>.<span class="at">UINT8</span>).<span class="at">then</span>(myUint8Number <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="va">console</span>.<span class="at">log</span>(<span class="vs">`My number: </span><span class="sc">${</span>myUint8Number<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="tokenizer">Tokenizer</h2>
<p>The tokenizer allows us to <em>read</em> or <em>peek</em> from the <em>tokenizer-stream</em>. The <em>tokenizer-stream</em> is an abstraction of a <a href="https://nodejs.org/api/stream.html">stream</a>, file or <a href="https://nodejs.org/api/buffer.html">Buffer</a>. It can also be translated in chunked reads, as done in <span class="citation" data-cites="tokenizer/http">[@tokenizer/http]</span>(https://github.com/Borewit/tokenizer-http);</p>
<p>What is the difference with Nodejs.js stream? * The <em>tokenizer-stream</em> supports jumping / seeking in a the <em>tokenizer-stream</em> using <a href="#method-tokenizerignore"><code>tokenizer.ignore()</code></a> * In addition to <em>read</em> methods, it has <em>peek</em> methods, to read a ahead and check what is coming.</p>
<p>The <a href="#attribute-tokenizerposition">tokenizer.position</a> keeps tracks of the read position.</p>
<h3 id="strtok3-attributes">strtok3 attributes</h3>
<h4 id="attribute-tokenizer.fileinfo">Attribute <code>tokenizer.fileInfo</code></h4>
<p>Optional attribute describing the file information, see <a href="#IFileInfo">IFileInfo</a></p>
<h4 id="attribute-tokenizer.position">Attribute <code>tokenizer.position</code></h4>
<p>Pointer to the current position in the <a href="#tokenizer"><em>tokenizer</em></a> stream. If a <em>position</em> is provided to a <em>read</em> or <em>peek</em> method, is should be, at least, equal or greater than this value.</p>
<h3 id="tokenizer-methods">Tokenizer methods</h3>
<p>There are to groups of methods</p>
<ul>
<li><em>read</em> methods: used to read a <em>token</em> of <a href="https://nodejs.org/api/buffer.html">Buffer</a> from the <a href="#tokenizer"><em>tokenizer</em></a>. The position of the <em>tokenizer-stream</em> will advance with the size of the token.</li>
<li><em>peek</em> methods: same as the read, but it will <em>not</em> advance the pointer. It allows to read (peek) ahead.</li>
</ul>
<h4 id="method-tokenizer.readbuffer">Method <code>tokenizer.readBuffer()</code></h4>
<p>Read buffer from stream. <code>readBuffer(buffer, options?)</code></p>
<table>
<colgroup>
<col style="width: 3%" />
<col style="width: 20%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>buffer</td>
<td><a href="https://nodejs.org/api/buffer.html">Buffer</a> | Uint8Array</td>
<td>Target buffer to write the data read to</td>
</tr>
<tr class="even">
<td>options</td>
<td><a href="#ireadchunkoptions">IReadChunkOptions</a></td>
<td>An integer specifying the number of bytes to read</td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;number&gt;</code> Promise with number of bytes read. The number of bytes read maybe if less, <em>mayBeLess</em> flag was set.</p>
<h4 id="method-tokenizer.peekbuffer">Method <code>tokenizer.peekBuffer()</code></h4>
<p>Peek (read ahead) buffer from <a href="#tokenizer"><em>tokenizer</em></a> <code>peekBuffer(buffer,  options?)</code></p>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 38%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>buffer</td>
<td>Buffer | Uint8Array</td>
<td>Target buffer to write the data read (peeked) to.</td>
</tr>
<tr class="even">
<td>options</td>
<td><a href="#ireadchunkoptions">IReadChunkOptions</a></td>
<td>An integer specifying the number of bytes to read.</td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;number&gt;</code> Promise with number of bytes read. The number of bytes read maybe if less, <em>mayBeLess</em> flag was set.</p>
<h4 id="method-tokenizer.readtoken">Method <code>tokenizer.readToken()</code></h4>
<p>Read a <em>token</em> from the tokenizer-stream. <code>readToken(token, position?)</code></p>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 16%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>token</td>
<td><a href="#IGetToken">IGetToken</a></td>
<td>Token to read from the tokenizer-stream.</td>
</tr>
<tr class="even">
<td>position?</td>
<td>number</td>
<td>Offset where to begin reading within the file. If position is null, data will be read from the current file position.</td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;number&gt;</code>. Promise with number of bytes read. The number of bytes read maybe if less, <em>mayBeLess</em> flag was set.</p>
<h4 id="method-tokenizer.peektoken">Method <code>tokenizer.peekToken()</code></h4>
<p>Peek a <em>token</em> from the <a href="#tokenizer"><em>tokenizer</em></a>. <code>peekToken(token, position?)</code></p>
<table>
<colgroup>
<col style="width: 7%" />
<col style="width: 17%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>token</td>
<td><a href="#IGetToken">IGetToken<T></a></td>
<td>Token to read from the tokenizer-stream.</td>
</tr>
<tr class="even">
<td>position?</td>
<td>number</td>
<td>Offset where to begin reading within the file. If position is null, data will be read from the current file position.</td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;T&gt;</code> Promise with token value peeked from the <a href="#tokenizer"><em>tokenizer</em></a>.</p>
<h4 id="method-tokenizer.readnumber">Method <code>tokenizer.readNumber()</code></h4>
<p>Peek a numeric <a href="#token"><em>token</em></a> from the <a href="#tokenizer"><em>tokenizer</em></a>. <code>readNumber(token)</code></p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>token</td>
<td><a href="#IGetToken">IGetToken<number></a></td>
<td>Numeric token to read from the tokenizer-stream.</td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;number&gt;</code> Promise with number peeked from the <em>tokenizer-stream</em>.</p>
<h4 id="method-tokenizer.ignore">Method <code>tokenizer.ignore()</code></h4>
<p>Peek a numeric <a href="#token"><em>token</em></a> from the tokenizer-stream. <code>ignore(length)</code></p>
<table>
<colgroup>
<col style="width: 13%" />
<col style="width: 8%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ignore</td>
<td>number</td>
<td>Numeric of bytes to ignore. Will advance the <code>tokenizer.position</code></td>
</tr>
</tbody>
</table>
<p>Return value <code>Promise&lt;number&gt;</code> Promise with number peeked from the <em>tokenizer-stream</em>.</p>
<h4 id="method-tokenizer.close">Method <code>tokenizer.close()</code></h4>
<p>Clean up resources, such as closing a file pointer if applicable.</p>
<h3 id="ireadchunkoptions">IReadChunkOptions</h3>
<p>Each attribute is optional:</p>
<table>
<colgroup>
<col style="width: 4%" />
<col style="width: 3%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="header">
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>offset</td>
<td>number</td>
<td>The offset in the buffer to start writing at; if not provided, start at 0</td>
</tr>
<tr class="even">
<td>length</td>
<td>number</td>
<td>Requested number of bytes to read.</td>
</tr>
<tr class="odd">
<td>position</td>
<td>number</td>
<td>Position where to peek from the file. If position is null, data will be read from the <a href="#attribute-tokenizerposition">current file position</a>. Position may not be less then <a href="#attribute-tokenizerposition">tokenizer.position</a></td>
</tr>
<tr class="even">
<td>mayBeLess</td>
<td>boolean</td>
<td>If and only if set, will not throw an EOF error if less then the requested <em>mayBeLess</em> could be read.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">  <span class="va">tokenizer</span>.<span class="at">peekBuffer</span>(buffer<span class="op">,</span> <span class="op">{</span><span class="dt">mayBeLess</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="ifileinfo">IFileInfo</h2>
<p>File information interface which describes the underlying file, each attribute is optional.</p>
<table>
<thead>
<tr class="header">
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>size</td>
<td>number</td>
<td>File size in bytes</td>
</tr>
<tr class="even">
<td>mimeType</td>
<td>number</td>
<td><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME-type</a> of file.</td>
</tr>
<tr class="odd">
<td>path</td>
<td>number</td>
<td>File path</td>
</tr>
<tr class="even">
<td>url</td>
<td>boolean</td>
<td>File URL</td>
</tr>
</tbody>
</table>
<h2 id="token">Token</h2>
<p>The <em>token</em> is basically a description what to read form the <a href="#tokenizer"><em>tokenizer-stream</em></a>. A basic set of <em>token types</em> can be found here: <a href="https://github.com/Borewit/token-types"><em>token-types</em></a>.</p>
<p>A token is something which implements the following interface:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode ts"><code class="sourceCode typescript"><a class="sourceLine" id="cb6-1" title="1"><span class="im">export</span> <span class="kw">interface</span> IGetToken<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">   * Length in bytes of encoded value</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-6" title="6">  len<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">   * Decode value from buffer at offset</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="cv">buf</span><span class="co"> Buffer to read the decoded value from</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="cv">off</span><span class="co"> Decode offset</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-13" title="13">  <span class="kw">get</span>(buf<span class="op">:</span> <span class="bu">Buffer</span><span class="op">,</span> off<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> T<span class="op">;</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="op">}</span></a></code></pre></div>
<p>The <em>tokenizer</em> reads <code>token.len</code> bytes from the <em>tokenizer-stream</em> into a Buffer. The <code>token.get</code> will be called with the Buffer. <code>token.get</code> is responsible for conversion from the buffer to the desired output type.</p>
<h2 id="browser-compatibility">Browser compatibility</h2>
<p>To exclude fs based dependencies, you can use a submodule-import from ‘strtok3/lib/core’.</p>
<table>
<thead>
<tr class="header">
<th>function</th>
<th>‘strtok3’</th>
<th>‘strtok3/lib/core’</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>parseBuffer</code></td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="even">
<td><code>parseStream</code></td>
<td>✓</td>
<td>✓</td>
</tr>
<tr class="odd">
<td><code>fromFile</code></td>
<td>✓</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="working-with-web-api-readable-stream">Working with Web-API readable stream</h3>
<p>To convert a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamDefaultReader">Web-API readable stream</a> into a <a href="(https://nodejs.org/api/stream.html#stream_readable_streams)">Node.js readable stream</a>, you can use <a href="https://github.com/Borewit/readable-web-to-node-stream">readable-web-to-node-stream</a> to convert one in another.</p>
<p>Example submodule-import:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> strtok3core <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;strtok3/lib/core&#39;</span>)<span class="op">;</span> <span class="co">// Submodule-import to prevent Node.js specific dependencies</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> <span class="op">{</span>ReadableWebToNodeStream<span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;readable-web-to-node-stream&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">(<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(url)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="kw">const</span> readableWebStream <span class="op">=</span> <span class="va">response</span>.<span class="at">body</span><span class="op">;</span> <span class="co">// Web-API readable stream</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="kw">const</span> nodeStream <span class="op">=</span> <span class="kw">new</span> <span class="at">ReadableWebToNodeStream</span>(readableWebStream)<span class="op">;</span> <span class="co">// convert to Node.js readable stream</span></a>
<a class="sourceLine" id="cb7-9" title="9">  </a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="kw">const</span> tokenizer <span class="op">=</span> <span class="va">strtok3core</span>.<span class="at">fromStream</span>(nodeStream)<span class="op">;</span> <span class="co">// And we now have tokenizer in a web environment</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<h2 id="licence">Licence</h2>
<p>(The MIT License)</p>
<p>Copyright (c) 2020 Borewit</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the ‘Software’), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED ‘AS IS’, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</body>
</html>
