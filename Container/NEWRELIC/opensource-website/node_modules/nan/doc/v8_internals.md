V8 internals
------------

The hooks to access V8 internals—including GC and statistics—are different across the supported versions of V8, therefore NAN provides its own hooks that call the appropriate V8 methods.

-   [**`NAN_GC_CALLBACK()`**](#api_nan_gc_callback)
-   [**`Nan::AddGCEpilogueCallback()`**](#api_nan_add_gc_epilogue_callback)
-   [**`Nan::RemoveGCEpilogueCallback()`**](#api_nan_remove_gc_epilogue_callback)
-   [**`Nan::AddGCPrologueCallback()`**](#api_nan_add_gc_prologue_callback)
-   [**`Nan::RemoveGCPrologueCallback()`**](#api_nan_remove_gc_prologue_callback)
-   [**`Nan::GetHeapStatistics()`**](#api_nan_get_heap_statistics)
-   [**`Nan::SetCounterFunction()`**](#api_nan_set_counter_function)
-   [**`Nan::SetCreateHistogramFunction()`**](#api_nan_set_create_histogram_function)
-   [**`Nan::SetAddHistogramSampleFunction()`**](#api_nan_set_add_histogram_sample_function)
-   [**`Nan::IdleNotification()`**](#api_nan_idle_notification)
-   [**`Nan::LowMemoryNotification()`**](#api_nan_low_memory_notification)
-   [**`Nan::ContextDisposedNotification()`**](#api_nan_context_disposed_notification)
-   [**`Nan::GetInternalFieldPointer()`**](#api_nan_get_internal_field_pointer)
-   [**`Nan::SetInternalFieldPointer()`**](#api_nan_set_internal_field_pointer)
-   [**`Nan::AdjustExternalMemory()`**](#api_nan_adjust_external_memory)

<span id="api_nan_gc_callback"></span> \#\#\# NAN\_GC\_CALLBACK(callbackname)

Use `NAN_GC_CALLBACK` to declare your callbacks for `Nan::AddGCPrologueCallback()` and `Nan::AddGCEpilogueCallback()`. Your new method receives the arguments `v8::GCType type` and `v8::GCCallbackFlags flags`.

    static Nan::Persistent<Function> callback;

    NAN_GC_CALLBACK(gcPrologueCallback) {
      v8::Local<Value> argv[] = { Nan::New("prologue").ToLocalChecked() };
      Nan::MakeCallback(Nan::GetCurrentContext()->Global(), Nan::New(callback), 1, argv);
    }

    NAN_METHOD(Hook) {
      callback.Reset(To<Function>(args[0]).ToLocalChecked());
      Nan::AddGCPrologueCallback(gcPrologueCallback);
      info.GetReturnValue().Set(info.Holder());
    }

<span id="api_nan_add_gc_epilogue_callback"></span> \#\#\# Nan::AddGCEpilogueCallback()

Signature:

    void Nan::AddGCEpilogueCallback(v8::Isolate::GCEpilogueCallback callback, v8::GCType gc_type_filter = v8::kGCTypeAll)

Calls V8’s [`AddGCEpilogueCallback()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a580f976e4290cead62c2fc4dd396be3e).

<span id="api_nan_remove_gc_epilogue_callback"></span> \#\#\# Nan::RemoveGCEpilogueCallback()

Signature:

    void Nan::RemoveGCEpilogueCallback(v8::Isolate::GCEpilogueCallback callback)

Calls V8’s [`RemoveGCEpilogueCallback()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#adca9294555a3908e9f23c7bb0f0f284c).

<span id="api_nan_add_gc_prologue_callback"></span> \#\#\# Nan::AddGCPrologueCallback()

Signature:

    void Nan::AddGCPrologueCallback(v8::Isolate::GCPrologueCallback, v8::GCType gc_type_filter callback)

Calls V8’s [`AddGCPrologueCallback()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a6dbef303603ebdb03da6998794ea05b8).

<span id="api_nan_remove_gc_prologue_callback"></span> \#\#\# Nan::RemoveGCPrologueCallback()

Signature:

    void Nan::RemoveGCPrologueCallback(v8::Isolate::GCPrologueCallback callback)

Calls V8’s [`RemoveGCPrologueCallback()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a5f72c7cda21415ce062bbe5c58abe09e).

<span id="api_nan_get_heap_statistics"></span> \#\#\# Nan::GetHeapStatistics()

Signature:

    void Nan::GetHeapStatistics(v8::HeapStatistics *heap_statistics)

Calls V8’s [`GetHeapStatistics()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a5593ac74687b713095c38987e5950b34).

<span id="api_nan_set_counter_function"></span> \#\#\# Nan::SetCounterFunction()

Signature:

    void Nan::SetCounterFunction(v8::CounterLookupCallback cb)

Calls V8’s [`SetCounterFunction()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a045d7754e62fa0ec72ae6c259b29af94).

<span id="api_nan_set_create_histogram_function"></span> \#\#\# Nan::SetCreateHistogramFunction()

Signature:

    void Nan::SetCreateHistogramFunction(v8::CreateHistogramCallback cb) 

Calls V8’s [`SetCreateHistogramFunction()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a542d67e85089cb3f92aadf032f99e732).

<span id="api_nan_set_add_histogram_sample_function"></span> \#\#\# Nan::SetAddHistogramSampleFunction()

Signature:

    void Nan::SetAddHistogramSampleFunction(v8::AddHistogramSampleCallback cb) 

Calls V8’s [`SetAddHistogramSampleFunction()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#aeb420b690bc2c216882d6fdd00ddd3ea).

<span id="api_nan_idle_notification"></span> \#\#\# Nan::IdleNotification()

Signature:

    bool Nan::IdleNotification(int idle_time_in_ms)

Calls V8’s [`IdleNotification()` or `IdleNotificationDeadline()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#ad6a2a02657f5425ad460060652a5a118) depending on V8 version.

<span id="api_nan_low_memory_notification"></span> \#\#\# Nan::LowMemoryNotification()

Signature:

    void Nan::LowMemoryNotification() 

Calls V8’s [`LowMemoryNotification()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#a24647f61d6b41f69668094bdcd6ea91f).

<span id="api_nan_context_disposed_notification"></span> \#\#\# Nan::ContextDisposedNotification()

Signature:

    void Nan::ContextDisposedNotification()

Calls V8’s [`ContextDisposedNotification()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#ad7f5dc559866343fe6cd8db1f134d48b).

<span id="api_nan_get_internal_field_pointer"></span> \#\#\# Nan::GetInternalFieldPointer()

Gets a pointer to the internal field with at `index` from a V8 `Object` handle.

Signature:

    void* Nan::GetInternalFieldPointer(v8::Local<v8::Object> object, int index) 

Calls the Object’s [`GetAlignedPointerFromInternalField()` or `GetPointerFromInternalField()`](https://v8docs.nodesource.com/node-8.16/db/d85/classv8_1_1_object.html#a580ea84afb26c005d6762eeb9e3c308f) depending on the version of V8.

<span id="api_nan_set_internal_field_pointer"></span> \#\#\# Nan::SetInternalFieldPointer()

Sets the value of the internal field at `index` on a V8 `Object` handle.

Signature:

    void Nan::SetInternalFieldPointer(v8::Local<v8::Object> object, int index, void* value)

Calls the Object’s [`SetAlignedPointerInInternalField()` or `SetPointerInInternalField()`](https://v8docs.nodesource.com/node-8.16/db/d85/classv8_1_1_object.html#ab3c57184263cf29963ef0017bec82281) depending on the version of V8.

<span id="api_nan_adjust_external_memory"></span> \#\#\# Nan::AdjustExternalMemory()

Signature:

    int Nan::AdjustExternalMemory(int bytesChange)

Calls V8’s [`AdjustAmountOfExternalAllocatedMemory()`](https://v8docs.nodesource.com/node-8.16/d5/dda/classv8_1_1_isolate.html#ae1a59cac60409d3922582c4af675473e).
