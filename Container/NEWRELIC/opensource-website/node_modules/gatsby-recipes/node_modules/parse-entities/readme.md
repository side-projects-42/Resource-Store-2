parse-entities
==============

[![Build](https://img.shields.io/travis/wooorm/parse-entities.svg)](https://travis-ci.org/wooorm/parse-entities) [![Coverage](https://img.shields.io/codecov/c/github/wooorm/parse-entities.svg)](https://codecov.io/github/wooorm/parse-entities) [![Downloads](https://img.shields.io/npm/dm/parse-entities.svg)](https://www.npmjs.com/package/parse-entities) [![Size](https://img.shields.io/bundlephobia/minzip/parse-entities.svg)](https://bundlephobia.com/result?p=parse-entities)

Parse HTML character references: fast, spec-compliant, positional information.

Installation
------------

[npm](https://docs.npmjs.com/cli/install):

    npm install parse-entities

Usage
-----

    var decode = require('parse-entities')

    decode('alpha &amp bravo')
    // => alpha & bravo

    decode('charlie &copycat; delta')
    // => charlie ¬©cat; delta

    decode('echo &copy; foxtrot &#8800; golf &#x1D306; hotel')
    // => echo ¬© foxtrot ‚â† golf ùåÜ hotel

API
---

`parseEntities(value[, options])`
---------------------------------

##### `options`

###### `options.additional`

Additional character to accept (`string?`, default: `''`). This allows other characters, without error, when following an ampersand.

###### `options.attribute`

Whether to parse `value` as an attribute value (`boolean?`, default: `false`).

###### `options.nonTerminated`

Whether to allow non-terminated entities (`boolean`, default: `true`). For example, `&copycat` for `¬©cat`. This behaviour is spec-compliant but can lead to unexpected results.

###### `options.warning`

Error handler ([`Function?`](#function-warningreason-position-code)).

###### `options.text`

Text handler ([`Function?`](#function-textvalue-location)).

###### `options.reference`

Reference handler ([`Function?`](#function-referencevalue-location-source)).

###### `options.warningContext`

Context used when invoking `warning` (`'*'`, optional).

###### `options.textContext`

Context used when invoking `text` (`'*'`, optional).

###### `options.referenceContext`

Context used when invoking `reference` (`'*'`, optional)

###### `options.position`

Starting `position` of `value` (`Location` or `Position`, optional). Useful when dealing with values nested in some sort of syntax tree. The default is:

    {
      start: {line: 1, column: 1, offset: 0},
      indent: []
    }

##### Returns

`string` ‚Äî Decoded `value`.

### `function warning(reason, position, code)`

Error handler.

##### Context

`this` refers to `warningContext` when given to `parseEntities`.

##### Parameters

###### `reason`

Human-readable reason for triggering a parse error (`string`).

###### `position`

Place at which the parse error occurred (`Position`).

###### `code`

Identifier of reason for triggering a parse error (`number`).

The following codes are used:

<table><thead><tr class="header"><th>Code</th><th>Example</th><th>Note</th></tr></thead><tbody><tr class="odd"><td><code>1</code></td><td><code>foo &amp;amp bar</code></td><td>Missing semicolon (named)</td></tr><tr class="even"><td><code>2</code></td><td><code>foo &amp;#123 bar</code></td><td>Missing semicolon (numeric)</td></tr><tr class="odd"><td><code>3</code></td><td><code>Foo &amp;bar baz</code></td><td>Ampersand did not start a reference</td></tr><tr class="even"><td><code>4</code></td><td><code>Foo &amp;#</code></td><td>Empty reference</td></tr><tr class="odd"><td><code>5</code></td><td><code>Foo &amp;bar; baz</code></td><td>Unknown entity</td></tr><tr class="even"><td><code>6</code></td><td><code>Foo &amp;#128; baz</code></td><td><a href="https://github.com/wooorm/character-reference-invalid">Disallowed reference</a></td></tr><tr class="odd"><td><code>7</code></td><td><code>Foo &amp;#xD800; baz</code></td><td>Prohibited: outside permissible unicode range</td></tr></tbody></table>

### `function text(value, location)`

Text handler.

##### Context

`this` refers to `textContext` when given to `parseEntities`.

##### Parameters

###### `value`

String of content (`string`).

###### `location`

Location at which `value` starts and ends (`Location`).

### `function reference(value, location, source)`

Character reference handler.

##### Context

`this` refers to `referenceContext` when given to `parseEntities`.

##### Parameters

###### `value`

Encoded character reference (`string`).

###### `location`

Location at which `value` starts and ends (`Location`).

###### `source`

Source of character reference (`Location`).

Related
-------

-   [`stringify-entities`](https://github.com/wooorm/stringify-entities) ‚Äî Encode HTML character references
-   [`character-entities`](https://github.com/wooorm/character-entities) ‚Äî Info on character entities
-   [`character-entities-html4`](https://github.com/wooorm/character-entities-html4) ‚Äî Info on HTML4 character entities
-   [`character-entities-legacy`](https://github.com/wooorm/character-entities-legacy) ‚Äî Info on legacy character entities
-   [`character-reference-invalid`](https://github.com/wooorm/character-reference-invalid) ‚Äî Info on invalid numeric character references

License
-------

[MIT](license) ¬© [Titus Wormer](https://wooorm.com)
