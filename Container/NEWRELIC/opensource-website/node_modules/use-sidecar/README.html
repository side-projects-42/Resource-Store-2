<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<div data-align="center">
<h1>
üèé side car
</h1>
<p><br/> Alternative way to code splitting <br/></p>
<p><a href="https://www.npmjs.com/package/use-sidecar"> <img src="https://img.shields.io/npm/v/use-sidecar.svg?style=flat-square" /> </a></p>
<p><a href="https://travis-ci.org/theKashey/use-sidecar"> <img src="https://img.shields.io/travis/theKashey/use-sidecar.svg?style=flat-square" alt="Build status"> </a></p>
<p><a href="https://www.npmjs.com/package/use-sidecar"> <img src="https://img.shields.io/npm/dm/use-sidecar.svg" alt="npm downloads"> </a></p>
<p><a href="https://bundlephobia.com/result?p=use-sidecar"> <img src="https://img.shields.io/bundlephobia/minzip/use-sidecar.svg" alt="bundle size"> </a><br />
<br/></p>
</div>
<p>UI/Effects code splitting pattern - <a href="https://dev.to/thekashey/sidecar-for-a-code-splitting-1o8g">read the original article</a> to understand concepts behind. - <a href="https://medium.com/@cramforce/designing-very-large-javascript-applications-6e013a3291a3">read how Google</a> split view and logic. - <a href="https://developers.facebook.com/videos/2019/building-the-new-facebookcom-with-react-graphql-and-relay/">watch how Facebook</a> defers ‚Äúinteractivity‚Äù effects.</p>
<h2 id="terminology">Terminology:</h2>
<ul>
<li><code>sidecar</code> - non UI component, which may carry effects for a paired UI component.</li>
<li><code>UI</code> - UI component, which interactivity is moved to a <code>sidecar</code>.</li>
</ul>
<p><code>UI</code> is a <em>view</em>, <code>sidecar</code> is the <em>logic</em> for it. Like Batman(UI) and his sidekick Robin(effects).</p>
<h2 id="concept">Concept</h2>
<ul>
<li>a <code>package</code> exposes <strong>3 entry points</strong> using a <a href="https://github.com/theKashey/multiple-entry-points-example">nested <code>package.json</code> format</a>:
<ul>
<li>default aka <code>combination</code>, and lets hope tree shaking will save you</li>
<li><code>UI</code>, with only UI part</li>
<li><code>sidecar</code>, with all the logic</li>
<li><blockquote>
<p><code>UI</code> + <code>sidecar</code> === <code>combination</code>. The size of <code>UI+sidecar</code> might a bit bigger than size of their <code>combination</code>. Use <a href="https://github.com/ai/size-limit">size-limit</a> to control their size independently.</p>
</blockquote></li>
</ul></li>
<li><p>package uses a <code>medium</code> to talk with own sidecar, breaking explicit dependency.</p></li>
<li>if package depends on another <em>sidecar</em> package:
<ul>
<li>it shall export dependency side car among own sidecar.</li>
<li>package imports own sidecar via <code>medium</code>, thus able to export multiple sidecars via one export.</li>
</ul></li>
<li><p>final consumer uses <code>sidecar</code> or <code>useSidecar</code> to combine pieces together.</p></li>
</ul>
<h2 id="rules">Rules</h2>
<ul>
<li><code>UI</code> components might use/import any other <code>UI</code> components</li>
<li><code>sidecar</code> could use/import any other <code>sidecar</code></li>
</ul>
<p>That would form two different code branches, you may load separately - UI first, and effect sidecar later. That also leads to a obvious consequence - <strong>one sidecar may export all sidecars</strong>. - to decouple <code>sidecars</code> from module exports, and be able to pick ‚Äúthe right‚Äù one at any point you have to use <code>exportSidecar(medium, component)</code> to export it, and use the same <code>medium</code> to import it back. - this limitation is for <strong>libraries only</strong>, as long as in the usercode you might dynamically import whatever and whenever you want.</p>
<ul>
<li><code>useMedium</code> is always async - action would be executed in a next tick, or on the logic load.</li>
<li><code>sidecar</code> is always async - is does not matter have you loaded logic or not - component would be rendered at least in the next tick.</li>
</ul>
<blockquote>
<p>except <code>medium.read</code>, which synchronously read the data from a medium, and <code>medium.assingSyncMedium</code> which changes <code>useMedium</code> to be sync.</p>
</blockquote>
<h2 id="ssr-and-usage-tracking">SSR and usage tracking</h2>
<p>Sidecar pattern is clear: - you dont need to use/render any <code>sidecars</code> on server. - you dont have to load <code>sidecars</code> prior main render.</p>
<p>Thus - no usage tracking, and literally no SSR. It‚Äôs just skipped.</p>
<h1 id="api">API</h1>
<h2 id="createmedium">createMedium()</h2>
<ul>
<li>Type: Util. Creates shared effect medium for algebraic effect.</li>
<li>Goal: To decouple modules from each other.</li>
<li>Usage: <code>use</code> in UI side, and <code>assign</code> from side-car. All effects would be executed.</li>
<li>Analog: WeakMap, React.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> medium <span class="op">=</span> <span class="at">createMedium</span>(defaultValue)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> cancelCb <span class="op">=</span> <span class="va">medium</span>.<span class="at">useMedium</span>(someData)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">// like</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="va">medium</span>.<span class="at">useMedium</span>(someData)<span class="op">,</span> [])<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">medium</span>.<span class="at">assignMedium</span>(someDataProcessor)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">// createSidecarMedium is a helper for createMedium to create a &quot;sidecar&quot; symbol</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">const</span> effectCar <span class="op">=</span> <span class="at">createSidecarMedium</span>()<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>! For consistence <code>useMedium</code> is async - sidecar load status should not affect function behavior, thus effect would be always executed at least in the ‚Äúnext tick‚Äù. You may alter this behavior by using <code>medium.assingSyncMedium</code>.</p>
</blockquote>
<h2 id="exportsidecarmedium-component">exportSidecar(medium, component)</h2>
<ul>
<li>Type: HOC</li>
<li>Goal: store <code>component</code> inside <code>medium</code> and return external wrapper</li>
<li>Solving: decoupling module exports to support exporting multiple sidecars via a single entry point.</li>
<li>Usage: use to export a <code>sidecar</code></li>
<li>Analog: WeakMap</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="im">import</span> <span class="op">{</span>effectCar<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./medium&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="im">import</span> <span class="op">{</span>EffectComponent<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./Effect&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">// !!! - to prevent Effect from being imported</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">// `effectCar` medium __have__ to be defined in another file</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">// const effectCar = createSidecarMedium();</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="im">export</span> <span class="im">default</span> <span class="at">exportSidecar</span>(effectCar<span class="op">,</span> EffectComponent)<span class="op">;</span></a></code></pre></div>
<h2 id="sidecarimporter">sidecar(importer)</h2>
<ul>
<li>Type: HOC</li>
<li>Goal: React.lazy analog for code splitting, but does not require <code>Suspense</code>, might provide error failback.</li>
<li>Usage: like React.lazy to load a side-car component.</li>
<li>Analog: React.Lazy</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> <span class="op">{</span>sidecar<span class="op">}</span> <span class="im">from</span> <span class="st">&quot;use-sidecar&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> Sidecar <span class="op">=</span>  <span class="at">sidecar</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;./sidecar&#39;</span>)<span class="op">,</span> <span class="op">&lt;</span>span<span class="op">&gt;</span>on fail&lt;/span<span class="op">&gt;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5"> <span class="op">&lt;</span>Sidecar /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"> <span class="op">&lt;</span>UI /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7">&lt;/<span class="op">&gt;</span> </a></code></pre></div>
<h3 id="importing-exportedsidecar">Importing <code>exportedSidecar</code></h3>
<p>Would require additional prop to be set - <code>&lt;Sidecar sideCar={effectCar} /&gt;</code></p>
<h2 id="usesidecarimporter">useSidecar(importer)</h2>
<ul>
<li>Type: hook, loads a <code>sideCar</code> using provided <code>importer</code> which shall follow React.lazy API</li>
<li>Goal: to load a side car without displaying any ‚Äúspinners‚Äù.</li>
<li>Usage: load side car for a component</li>
<li>Analog: none</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="im">import</span> <span class="op">{</span>useSidecar<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;use-sidecar&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">const</span> [Car<span class="op">,</span> error] <span class="op">=</span> <span class="at">useSidecar</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;./sideCar&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="cf">return</span> (</a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="op">{</span>Car <span class="op">?</span> <span class="op">&lt;</span>Car <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> /&gt; : <span class="kw">null</span><span class="op">}</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="op">&lt;</span>UIComponent <span class="op">{</span>...<span class="at">props</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb4-8" title="8">  &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9">)<span class="op">;</span> </a></code></pre></div>
<h3 id="importing-exportedsidecar-1">Importing <code>exportedSideCar</code></h3>
<p>You have to specify <strong>effect medium</strong> to read data from, as long as <strong>export itself is empty</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="im">import</span> <span class="op">{</span>useSidecar<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;use-sidecar&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">/* medium.js: */</span> <span class="im">export</span> <span class="kw">const</span> effectCar <span class="op">=</span> <span class="at">useMedium</span>(<span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">/* sideCar.js: */</span><span class="im">export</span> <span class="im">default</span> <span class="at">exportSidecar</span>(effectCar<span class="op">,</span> EffectComponent)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">const</span> [Car<span class="op">,</span> error] <span class="op">=</span> <span class="at">useSidecar</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;./sideCar&#39;</span>)<span class="op">,</span> effectCar)<span class="op">;</span> </a>
<a class="sourceLine" id="cb5-7" title="7"><span class="cf">return</span> (</a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="op">{</span>Car <span class="op">?</span> <span class="op">&lt;</span>Car <span class="op">{</span>...<span class="at">props</span><span class="op">}</span> /&gt; : <span class="kw">null</span><span class="op">}</span></a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="op">&lt;</span>UIComponent <span class="op">{</span>...<span class="at">props</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb5-12" title="12">)<span class="op">;</span></a></code></pre></div>
<h2 id="rendercarcomponent">renderCar(Component)</h2>
<ul>
<li>Type: HOC, moves renderProp component to a side channel</li>
<li>Goal: Provide render prop support, ie defer component loading keeping tree untouched.</li>
<li>Usage: Provide <code>defaults</code> and use them until sidecar is loaded letting you code split (non visual) render-prop component</li>
<li>Analog: - Analog: code split library like <a href="https://github.com/theKashey/react-imported-library">react-imported-library</a> or <span class="citation" data-cites="loadable/lib">[@loadable/lib]</span>(https://www.smooth-code.com/open-source/loadable-components/docs/library-splitting/).</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="im">import</span> <span class="op">{</span>renderCar<span class="op">,</span> sidecar<span class="op">}</span> <span class="im">from</span> <span class="st">&quot;use-sidecar&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">const</span> RenderCar <span class="op">=</span> <span class="at">renderCar</span>(</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co">// will move side car to a side channel</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="at">sidecar</span>(() <span class="kw">=&gt;</span> <span class="im">import</span>(<span class="st">&#39;react-powerplug&#39;</span>).<span class="at">then</span>(imports <span class="kw">=&gt;</span> <span class="va">imports</span>.<span class="at">Value</span>))<span class="op">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="co">// default render props</span></a>
<a class="sourceLine" id="cb6-6" title="6">  [<span class="op">{</span><span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">}</span>]  </a>
<a class="sourceLine" id="cb6-7" title="7">)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="op">&lt;</span>RenderCar<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">{</span>(<span class="op">{</span>value<span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">&lt;</span>span<span class="op">&gt;{</span>value<span class="op">}</span>&lt;/span<span class="op">&gt;}</span></a>
<a class="sourceLine" id="cb6-11" title="11">&lt;/RenderCar<span class="op">&gt;</span></a></code></pre></div>
<h2 id="setconfigconfig">setConfig(config)</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">setConfig</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  onError<span class="op">,</span> <span class="co">// sets default error handler</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h1 id="examples">Examples</h1>
<h2 id="deferred-effect">Deferred effect</h2>
<p>Let‚Äôs imagine - on element focus you have to do ‚Äúsomething‚Äù, for example focus anther element</p>
<h4 id="original-code">Original code</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1">onFocus <span class="op">=</span> event <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="cf">if</span> (<span class="va">event</span>.<span class="at">currentTarget</span> <span class="op">===</span> <span class="va">event</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="va">document</span>.<span class="at">querySelectorAll</span>(<span class="st">&#39;button&#39;</span><span class="op">,</span> <span class="va">event</span>.<span class="at">currentTarget</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="op">}</span></a></code></pre></div>
<h4 id="sidecar-code">Sidecar code</h4>
<ol start="3" type="1">
<li>Use medium (yes, .3)</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">// we are calling medium with an original event as an argument</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">const</span> onFocus <span class="op">=</span> event <span class="kw">=&gt;</span> <span class="va">focusMedium</span>.<span class="at">useMedium</span>(event)<span class="op">;</span></a></code></pre></div>
<ol start="2" type="1">
<li>Define reaction</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// in a sidecar</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">// we are setting handler for the effect medium</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">// effect is complicated - we are skipping event &quot;bubbling&quot;, </span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">// and focusing some button inside a parent</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="va">focusMedium</span>.<span class="at">assignMedium</span>(event <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="cf">if</span> (<span class="va">event</span>.<span class="at">currentTarget</span> <span class="op">===</span> <span class="va">event</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="va">document</span>.<span class="at">querySelectorAll</span>(<span class="st">&#39;button&#39;</span><span class="op">,</span> <span class="va">event</span>.<span class="at">currentTarget</span>)</a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<ol type="1">
<li>Create medium Having these constrains - we have to clone <code>event</code>, as long as React would eventually reuse SyntheticEvent, thus not preserve <code>target</code> and <code>currentTarget</code>.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="co">// </span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">const</span> focusMedium <span class="op">=</span> <span class="at">createMedium</span>(<span class="kw">null</span><span class="op">,</span> event <span class="kw">=&gt;</span> (<span class="op">{</span>...<span class="at">event</span><span class="op">}</span>))<span class="op">;</span></a></code></pre></div>
<p>Now medium side effect is ok to be async</p>
<p><strong>Example</strong>: <a href="https://github.com/theKashey/react-focus-lock/blob/8c69c644ecfeed2ec9dc0dc4b5b30e896a366738/src/Lock.js#L48">Effect for react-focus-lock</a> - 1kb UI, 4kb sidecar</p>
<h3 id="medium-callback">Medium callback</h3>
<p>Like a library level code splitting</p>
<h4 id="original-code-1">Original code</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="im">import</span> <span class="op">{</span>x<span class="op">,</span> y<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./utils&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="cf">if</span> (<span class="at">x</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-5" title="5">    <span class="at">y</span>()</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="op">},</span> [])<span class="op">;</span></a></code></pre></div>
<h4 id="sidecar-code-1">Sidecar code</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// medium</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">const</span> utilMedium <span class="op">=</span> <span class="at">createMedium</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">// utils</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="kw">const</span> x <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span> <span class="co">/* ... */</span><span class="op">};</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw">const</span> y <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span> <span class="co">/* ... */</span><span class="op">};</span></a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">// medium will callback with exports exposed</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="va">utilMedium</span>.<span class="at">assignMedium</span>(cb <span class="kw">=&gt;</span> <span class="at">cb</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb13-10" title="10"> x<span class="op">,</span> y</a>
<a class="sourceLine" id="cb13-11" title="11"><span class="op">}</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13"></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">// UI</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">// not importing x and y from the module system, but would be given via callback</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-17" title="17">  <span class="va">utilMedium</span>.<span class="at">useMedium</span>((<span class="op">{</span>x<span class="op">,</span>y<span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-18" title="18">      <span class="cf">if</span> (<span class="at">x</span>()) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-19" title="19">        <span class="at">y</span>()</a>
<a class="sourceLine" id="cb13-20" title="20">      <span class="op">}</span></a>
<a class="sourceLine" id="cb13-21" title="21">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb13-22" title="22"><span class="op">},</span> [])<span class="op">;</span></a></code></pre></div>
<ul>
<li>Hint: there is a easy way to type it</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> utilMedium <span class="op">=</span> createMedium<span class="op">&lt;</span>(cb<span class="op">:</span> <span class="kw">typeof</span> <span class="im">import</span>(<span class="st">&#39;./utils&#39;</span>)) <span class="kw">=&gt;</span> <span class="kw">void</span><span class="op">&gt;</span>()<span class="op">;</span></a></code></pre></div>
<p><strong>Example</strong>: <a href="https://github.com/theKashey/react-focus-lock/blob/8c69c644ecfeed2ec9dc0dc4b5b30e896a366738/src/MoveFocusInside.js#L12">Callback API for react-focus-lock</a></p>
<h3 id="split-effects">Split effects</h3>
<p>Lets take an example from a Google - Calendar app, with view and logic separated. To be honest - it‚Äôs not easy to extract logic from application like calendar - usually it‚Äôs tight coupled.</p>
<h4 id="original-code-2">Original code</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">const</span> CalendarUI <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span> </a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="kw">const</span> [date<span class="op">,</span> setDate] <span class="op">=</span> <span class="at">useState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="kw">const</span> onButtonClick <span class="op">=</span> <span class="at">useCallback</span>(() <span class="kw">=&gt;</span> <span class="at">setDate</span>(<span class="va">Date</span>.<span class="at">now</span>)<span class="op">,</span> [])<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4">  </a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb15-6" title="6">    <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb15-7" title="7">     <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;date&quot;</span> onChange<span class="op">={</span>setDate<span class="op">}</span> value<span class="op">={</span>date<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb15-8" title="8">     <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> onClick<span class="op">={</span>onButtonClick<span class="op">}&gt;</span>Set Today&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb15-9" title="9">    &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb15-10" title="10">  )</a>
<a class="sourceLine" id="cb15-11" title="11"><span class="op">}</span></a></code></pre></div>
<h4 id="sidecar-code-2">Sidecar code</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> CalendarUI <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="kw">const</span> [events<span class="op">,</span> setEvents] <span class="op">=</span> <span class="at">useState</span>(<span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="kw">const</span> [date<span class="op">,</span> setDate] <span class="op">=</span> <span class="at">useState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-4" title="4">  </a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb16-6" title="6">    <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb16-7" title="7">     <span class="op">&lt;</span>Sidecar setDate<span class="op">={</span>setDate<span class="op">}</span> setEvents<span class="op">={</span>setEvents<span class="op">}</span>/&gt;</a>
<a class="sourceLine" id="cb16-8" title="8">     <span class="op">&lt;</span>UILayout <span class="op">{</span>...<span class="at">events</span><span class="op">}</span> date<span class="op">={</span>date<span class="op">}</span>/&gt;</a>
<a class="sourceLine" id="cb16-9" title="9">    &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb16-10" title="10">  )</a>
<a class="sourceLine" id="cb16-11" title="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb16-12" title="12"></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="kw">const</span> UILayout <span class="op">=</span> (<span class="op">{</span>onDateChange<span class="op">,</span> onButtonClick<span class="op">,</span> date<span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb16-14" title="14">  <span class="op">&lt;&gt;</span></a>
<a class="sourceLine" id="cb16-15" title="15">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;date&quot;</span> onChange<span class="op">={</span>onDateChange<span class="op">}</span> value<span class="op">={</span>date<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb16-16" title="16">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> onClick<span class="op">={</span>onButtonClick<span class="op">}&gt;</span>Set Today&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb16-17" title="17">  &lt;/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb16-18" title="18">)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-19" title="19"></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="co">// in a sidecar</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="co">// we are providing callbacks back to UI</span></a>
<a class="sourceLine" id="cb16-22" title="22"><span class="kw">const</span> Sidecar <span class="op">=</span> (<span class="op">{</span>setDate<span class="op">,</span> setEvents<span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-23" title="23">  <span class="at">useEffect</span>(() <span class="kw">=&gt;</span> <span class="at">setEvents</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb16-24" title="24">      <span class="dt">onDateChange</span><span class="op">:</span>setDate<span class="op">,</span></a>
<a class="sourceLine" id="cb16-25" title="25">      <span class="dt">onButtonClick</span><span class="op">:</span> () <span class="kw">=&gt;</span> <span class="at">setDate</span>(<span class="va">Date</span>.<span class="at">now</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb16-26" title="26">  <span class="op">}</span>)<span class="op">,</span> [])<span class="op">;</span></a>
<a class="sourceLine" id="cb16-27" title="27">  </a>
<a class="sourceLine" id="cb16-28" title="28">  <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-29" title="29"><span class="op">}</span></a></code></pre></div>
<p>While in this example this looks a bit, you know, strange - there are 3 times more code that in the original example - that would make a sense for a real Calendar, especially if some helper library, like <code>moment</code>, has been used.</p>
<p><strong>Example</strong>: <a href="https://github.com/theKashey/react-remove-scroll/blob/666472d5c77fb6c4e5beffdde87c53ae63ef42c5/src/SideEffect.tsx#L166">Effect for react-remove-scroll</a> - 300b UI, 2kb sidecar</p>
<h1 id="licence">Licence</h1>
<p>MIT</p>
</body>
</html>
