fast-copy
=========

![](https://img.shields.io/badge/build-passing-brightgreen.svg) ![](https://img.shields.io/badge/coverage-100%25-brightgreen.svg) ![](https://img.shields.io/badge/license-MIT-blue.svg)

A [blazing fast](#benchmarks) deep object copier

Table of contents
-----------------

-   [fast-copy](#fast-copy)
    -   [Table of contents](#table-of-contents)
    -   [Usage](#usage)
    -   [Options](#options)
        -   [isStrict](#isstrict)
        -   [realm](#realm)
    -   [Types supported](#types-supported)
    -   [Benchmarks](#benchmarks)
        -   [Simple objects](#simple-objects)
        -   [Complex objects](#complex-objects)
        -   [Big data](#big-data)
        -   [Circular objects](#circular-objects)
        -   [Special objects](#special-objects)
    -   [Development](#development)

Usage
-----

    import copy from "fast-copy";
    import { deepEqual } from "fast-equals";

    const object = {
      array: [123, { deep: "value" }],
      map: new Map([["foo", {}], [{ bar: "baz" }, "quz"]])
    };

    const copiedObject = copy(object);

    console.log(copiedObject === object); // false
    console.log(deepEqual(copiedObject, object)); // true

Options
-------

#### isStrict

Starting in `2.0.0`, you can use the `isStrict` option to copy the object based on strict standards, meaning:

-   Properties retain their original property descriptor
-   Non-enumerable properties are copied
-   Non-standard properties (e.g., keys on an `Array` object) are copied

This is significantly slower, so you should only use this if you believe it necessary.

    console.log(copy(object, { isStrict: true }));

**NOTE**: This option is also aliased as `copy.strict`.

    console.log(copy.strict(object));

#### realm

Under the hood, `fast-copy` uses `instanceof` to determine object types, which can cause false negatives when used in combination with `iframe`-based objects. To handle this edge case, you can pass the `realm` in options, which identifies which realm the object comes from and will use that realm to drive both comparisons and constructors for the copies.

    <iframe srcdoc="<script>var arr = ['foo', 'bar'];</script>"></iframe>

    const iframe = document.querySelector("iframe");
    const arr = iframe.contentWindow.arr;

    console.log(copy(arr, { realm: iframe.contentWindow })); // ['foo', 'bar']

Types supported
---------------

The following object types are deeply cloned when they are either properties on the object passed, or the object itself:

-   `Array`
-   `ArrayBuffer`
-   `Blob`
-   `Buffer`
-   `DataView`
-   `Date`
-   `Float32Array`
-   `Float64Array`
-   `Int8Array`
-   `Int16Array`
-   `Int32Array`
-   `Map`
-   `Object`
-   `RegExp`
-   `Set`
-   `Uint8Array`
-   `Uint8ClampedArray`
-   `Uint16Array`
-   `Uint32Array`
-   `React` components
-   Custom constructors

The following object types are copied directly, as they are either primitives, cannot be cloned, or the common use-case implementation does not expect cloning:

-   `AsyncFunction`
-   `Boolean`
-   `Error`
-   `Function`
-   `GeneratorFunction`
-   `Number`
-   `Null`
-   `Promise`
-   `String`
-   `Symbol`
-   `Undefined`
-   `WeakMap`
-   `WeakSet`

Circular objects are supported out of the box as well. By default a cache based on `WeakSet` is used, but if `WeakSet` is not available then a standard `Object` fallback is used. The benchmarks quoted below are based on use of `WeakSet`.

Benchmarks
----------

#### Simple objects

*Small number of properties, all values are primitives*

<table><thead><tr class="header"><th></th><th>Operations / second</th></tr></thead><tbody><tr class="odd"><td><strong>fast-copy</strong></td><td><strong>2,692,822</strong></td></tr><tr class="even"><td>clone</td><td>1,420,277</td></tr><tr class="odd"><td>lodash.cloneDeep</td><td>1,277,213</td></tr><tr class="even"><td>fast-deepclone</td><td>768,982</td></tr><tr class="odd"><td>ramda</td><td>719,948</td></tr><tr class="even"><td>fast-clone</td><td>567,342</td></tr><tr class="odd"><td>deepclone</td><td>509,547</td></tr><tr class="even"><td>fast-copy (strict)</td><td>420,804</td></tr></tbody></table>

#### Complex objects

*Large number of properties, values are a combination of primitives and complex objects*

<table><thead><tr class="header"><th></th><th>Operations / second</th></tr></thead><tbody><tr class="odd"><td><strong>fast-copy</strong></td><td><strong>109,352</strong></td></tr><tr class="even"><td>fast-deepclone</td><td>101,808</td></tr><tr class="odd"><td>ramda</td><td>93,103</td></tr><tr class="even"><td>deepclone</td><td>74,270</td></tr><tr class="odd"><td>fast-clone</td><td>49,911</td></tr><tr class="even"><td>clone</td><td>46,355</td></tr><tr class="odd"><td>lodash.cloneDeep</td><td>43,900</td></tr><tr class="even"><td>fast-copy (strict)</td><td>33,440</td></tr></tbody></table>

#### Big data

*Very large number of properties with high amount of nesting, mainly objects and arrays*

<table><thead><tr class="header"><th></th><th>Operations / second</th></tr></thead><tbody><tr class="odd"><td><strong>fast-copy</strong></td><td>123</td></tr><tr class="even"><td>fast-deepclone</td><td>101</td></tr><tr class="odd"><td>fast-clone</td><td>93</td></tr><tr class="even"><td>lodash.cloneDeep</td><td>92</td></tr><tr class="odd"><td>deepclone</td><td>66</td></tr><tr class="even"><td>clone</td><td>50</td></tr><tr class="odd"><td>fast-copy (strict)</td><td>42</td></tr><tr class="even"><td>ramda</td><td>5</td></tr></tbody></table>

#### Circular objects

*Objects that deeply reference themselves*

<table><thead><tr class="header"><th></th><th>Operations / second</th></tr></thead><tbody><tr class="odd"><td><strong>fast-copy</strong></td><td><strong>1,143,074</strong></td></tr><tr class="even"><td>ramda</td><td>750,430</td></tr><tr class="odd"><td>clone</td><td>722,632</td></tr><tr class="even"><td>lodash.cloneDeep</td><td>580,005</td></tr><tr class="odd"><td>deepclone</td><td>490,824</td></tr><tr class="even"><td>fast-deepclone</td><td>446,585</td></tr><tr class="odd"><td>fast-copy (strict)</td><td>321,678</td></tr><tr class="even"><td>fast-clone (not supported)</td><td>0</td></tr></tbody></table>

#### Special objects

*Custom constructors, React components, etc*

<table><thead><tr class="header"><th></th><th>Operations / second</th></tr></thead><tbody><tr class="odd"><td><strong>fast-copy</strong></td><td><strong>78,422</strong></td></tr><tr class="even"><td>clone</td><td>52,165</td></tr><tr class="odd"><td>lodash.cloneDeep</td><td>39,648</td></tr><tr class="even"><td>ramda</td><td>32,372</td></tr><tr class="odd"><td>fast-deepclone</td><td>27,518</td></tr><tr class="even"><td>fast-clone</td><td>27,495</td></tr><tr class="odd"><td>deepclone</td><td>16,552</td></tr><tr class="even"><td>fast-copy (strict)</td><td>12,509</td></tr></tbody></table>

Development
-----------

Standard practice, clone the repo and `yarn` (or `npm i`) to get the dependencies. The following npm scripts are available:

-   benchmark =&gt; run benchmark tests against other equality libraries
-   build =&gt; build dist files with `rollup`
-   clean =&gt; run `rimraf` on the `dist` folder
-   dev =&gt; start webpack playground App
-   dist =&gt; run `build` and `build:minified` scripts
-   lint =&gt; run ESLint on all files in `src` folder (also runs on `dev` script)
-   lint:fix =&gt; run `lint` script, but with auto-fixer
-   prepublishOnly =&gt; run `lint`, `test:coverage`, and `dist` scripts
-   release =&gt; run `prepublishOnly` and release with new version
-   release:beta =&gt; run `prepublishOnly` and release with new beta version
-   release:dry =&gt; run `prepublishOnly` and simulate a new release
-   start =&gt; run `dev`
-   test =&gt; run AVA with NODE\_ENV=test on all files in `test` folder
-   test:coverage =&gt; run same script as `test` with code coverage calculation via `nyc`
-   test:watch =&gt; run same script as `test` but keep persistent watcher
