<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="sudo-prompt">sudo-prompt</h1>
<p>Run a non-graphical terminal command using <code>sudo</code>, prompting the user with a graphical OS dialog if necessary. Useful for background Node.js applications or native Electron apps that need <code>sudo</code>.</p>
<h2 id="cross-platform">Cross-Platform</h2>
<p><code>sudo-prompt</code> provides a native OS dialog prompt on <strong>macOS</strong>, <strong>Linux</strong> and <strong>Windows</strong>.</p>
<figure>
<img src="./macos.png" alt="macOS" /><figcaption>macOS</figcaption>
</figure>
<figure>
<img src="./linux.png" alt="Linux" /><figcaption>Linux</figcaption>
</figure>
<figure>
<img src="./windows.png" alt="Windows" /><figcaption>Windows</figcaption>
</figure>
<h2 id="installation">Installation</h2>
<p><code>sudo-prompt</code> has no external dependencies and does not require any native bindings.</p>
<pre><code>npm install sudo-prompt</code></pre>
<h2 id="usage">Usage</h2>
<p>Note: Your command should not start with the <code>sudo</code> prefix.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> sudo <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;sudo-prompt&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">var</span> options <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Electron&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">icns</span><span class="op">:</span> <span class="st">&#39;/Applications/Electron.app/Contents/Resources/Electron.icns&#39;</span><span class="op">,</span> <span class="co">// (optional)</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="va">sudo</span>.<span class="at">exec</span>(<span class="st">&#39;echo hello&#39;</span><span class="op">,</span> options<span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="kw">function</span>(error<span class="op">,</span> stdout<span class="op">,</span> stderr) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="cf">if</span> (error) <span class="cf">throw</span> error<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;stdout: &#39;</span> <span class="op">+</span> stdout)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-11" title="11">)<span class="op">;</span></a></code></pre></div>
<p><code>sudo-prompt</code> will use <code>process.title</code> as <code>options.name</code> if <code>options.name</code> is not provided. <code>options.name</code> must be alphanumeric only (spaces are supported) and at most 70 characters.</p>
<p>Your command should not depend on any current working directory or environment variables in order to execute correctly, and you should take care to use absolute paths and not relative paths.</p>
<p><strong><code>sudo-prompt.exec()</code> is different to <code>child-process.exec()</code> in that no child process is returned (due to platform and permissions constraints).</strong></p>
<h2 id="behavior">Behavior</h2>
<p>On macOS, <code>sudo-prompt</code> should behave just like the <code>sudo</code> command in the shell. If your command does not work with the <code>sudo</code> command in the shell (perhaps because it uses <code>&gt;</code> redirection to a restricted file), then it may not work with <code>sudo-prompt</code>. However, it is still possible to use sudo-prompt to get a privileged shell, <a href="https://github.com/jorangreef/sudo-prompt/issues/1">see this closed issue for more information</a>.</p>
<p>On Linux, <code>sudo-prompt</code> will use either <code>pkexec</code> or <code>kdesudo</code> to show the password prompt and run your command. Where possible, <code>sudo-prompt</code> will try and get these to mimic <code>sudo</code>. Depending on which binary is used, and due to the limitations of some binaries, the name of your program or the command itself may be displayed to your user. <code>sudo-prompt</code> will not use <code>gksudo</code> since <code>gksudo</code> does not support concurrent prompts. Passing <code>options.icns</code> is currently not supported by <code>sudo-prompt</code> on Linux. Patches are welcome to add support for icons based on <code>polkit</code>.</p>
<p>On Windows, <code>sudo-prompt</code> will elevate your command using User Account Control (UAC). Passing <code>options.name</code> or <code>options.icns</code> is currently not supported by <code>sudo-prompt</code> on Windows.</p>
<h2 id="non-graphical-terminal-commands-only">Non-graphical terminal commands only</h2>
<p>Just as you should never use <code>sudo</code> to launch any graphical applications, you should never use <code>sudo-prompt</code> to launch any graphical applications. Doing so could cause files in your home directory to become owned by root. <code>sudo-prompt</code> is explicitly designed to launch non-graphical terminal commands. For more information, <a href="http://www.psychocats.net/ubuntu/graphicalsudo">read this post</a>.</p>
<h2 id="concurrency">Concurrency</h2>
<p>On systems where the user has opted to have <code>tty-tickets</code> enabled (most systems), each call to <code>exec()</code> will result in a separate password prompt. Where <code>tty-tickets</code> are disabled, subsequent calls to <code>exec()</code> will still require a password prompt, even where the user’s <code>sudo</code> timestamp file remains valid, due to edge cases with <code>sudo</code> itself, <a href="https://github.com/jorangreef/sudo-prompt/pull/76">see this discussion for more information</a>.</p>
<p>You should never rely on <code>sudo-prompt</code> to execute your calls in order. If you need to enforce ordering of calls, then you should explicitly order your calls in your application. Where your commands are short-lived, you should always queue your calls to <code>exec()</code> to make sure your user is not overloaded with password prompts.</p>
<h2 id="invalidating-the-timestamp">Invalidating the timestamp</h2>
<p>On macOS and Linux, you can invalidate the user’s <code>sudo</code> timestamp file to force the prompt to appear by running the following command in your terminal:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1">$ <span class="fu">sudo</span> -k</a></code></pre></div>
</body>
</html>
