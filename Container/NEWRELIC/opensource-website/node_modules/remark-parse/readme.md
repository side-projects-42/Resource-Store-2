remark-parse
============

[![Build](https://img.shields.io/travis/remarkjs/remark.svg)](https://travis-ci.org/remarkjs/remark) [![Coverage](https://img.shields.io/codecov/c/github/remarkjs/remark.svg)](https://codecov.io/github/remarkjs/remark) [![Downloads](https://img.shields.io/npm/dm/remark-parse.svg)](https://www.npmjs.com/package/remark-parse) [![Size](https://img.shields.io/bundlephobia/minzip/remark-parse.svg)](https://bundlephobia.com/result?p=remark-parse) [![Sponsors](https://opencollective.com/unified/sponsors/badge.svg)](https://opencollective.com/unified) [![Backers](https://opencollective.com/unified/backers/badge.svg)](https://opencollective.com/unified) [![Chat](https://img.shields.io/badge/chat-spectrum-7b16ff.svg)](https://spectrum.chat/unified/remark)

[Parser](https://github.com/unifiedjs/unified#processorparser) for [**unified**](https://github.com/unifiedjs/unified). Parses Markdown to [**mdast**](https://github.com/syntax-tree/mdast) syntax trees. Used in the [**remark** processor](https://github.com/remarkjs/remark/tree/main/packages/remark) but can be used on its own as well. Can be [extended](#extending-the-parser) to change how Markdown is parsed.

Sponsors
--------

[Gatsby](https://www.gatsbyjs.org)  
ü•á  
  
[![](https://avatars1.githubusercontent.com/u/12551863?s=900&v=4)](https://www.gatsbyjs.org)

[Vercel](https://vercel.com)  
ü•á  
  
[![](https://images.opencollective.com/vercel/d8a5bee/logo/512.png)](https://vercel.com)

[Netlify](https://www.netlify.com)  
  
  
[![](https://images.opencollective.com/netlify/4087de2/logo/512.png)](https://www.netlify.com)

[Holloway](https://www.holloway.com)  
  
  
[![](https://avatars1.githubusercontent.com/u/35904294?s=300&v=4)](https://www.holloway.com)

[ThemeIsle](https://themeisle.com)  
ü•â  
  
[![](https://twitter-avatar.now.sh/themeisle)](https://themeisle.com)

[BoostIO](https://boostio.co)  
ü•â  
  
[![](https://avatars1.githubusercontent.com/u/13612118?s=300&v=4)](https://boostio.co)

[Expo](https://expo.io)  
ü•â  
  
[![](https://avatars1.githubusercontent.com/u/12504344?s=300&v=4)](https://expo.io)

  
  
  
  
[**You?**](https://opencollective.com/unified)

Install
-------

[npm](https://docs.npmjs.com/cli/install):

    npm install remark-parse

Use
---

    var unified = require('unified')
    var createStream = require('unified-stream')
    var markdown = require('remark-parse')
    var remark2rehype = require('remark-rehype')
    var html = require('rehype-stringify')

    var processor = unified()
      .use(markdown, {commonmark: true})
      .use(remark2rehype)
      .use(html)

    process.stdin.pipe(createStream(processor)).pipe(process.stdout)

[See **unified** for more examples ¬ª](https://github.com/unifiedjs/unified)

Contents
--------

-   [API](#api)
    -   [`processor().use(parse[, options])`](#processoruseparse-options)
    -   [`parse.Parser`](#parseparser)
-   [Extending the `Parser`](#extending-the-parser)
    -   [`Parser#blockTokenizers`](#parserblocktokenizers)
    -   [`Parser#blockMethods`](#parserblockmethods)
    -   [`Parser#inlineTokenizers`](#parserinlinetokenizers)
    -   [`Parser#inlineMethods`](#parserinlinemethods)
    -   [`function tokenizer(eat, value, silent)`](#function-tokenizereat-value-silent)
    -   [`tokenizer.locator(value, fromIndex)`](#tokenizerlocatorvalue-fromindex)
    -   [`eat(subvalue)`](#eatsubvalue)
    -   [`add(node[, parent])`](#addnode-parent)
    -   [`add.test()`](#addtest)
    -   [`add.reset(node[, parent])`](#addresetnode-parent)
    -   [Turning off a tokenizer](#turning-off-a-tokenizer)
-   [Security](#security)
-   [Contribute](#contribute)
-   [License](#license)

API
---

[See **unified** for API docs ¬ª](https://github.com/unifiedjs/unified)

### `processor().use(parse[, options])`

Configure the `processor` to read Markdown as input and process [**mdast**](https://github.com/syntax-tree/mdast) syntax trees.

##### `options`

Options can be passed directly, or passed later through [`processor.data()`](https://github.com/unifiedjs/unified#processordatakey-value).

###### `options.gfm`

GFM mode (`boolean`, default: `true`).

    hello ~~hi~~ world

Turns on:

-   [Fenced code blocks](https://help.github.com/articles/creating-and-highlighting-code-blocks#fenced-code-blocks)
-   [Autolinking of URLs](https://help.github.com/articles/autolinked-references-and-urls)
-   [Deletions (strikethrough)](https://help.github.com/articles/basic-writing-and-formatting-syntax#styling-text)
-   [Task lists](https://help.github.com/articles/basic-writing-and-formatting-syntax#task-lists)
-   [Tables](https://help.github.com/articles/organizing-information-with-tables)

###### `options.commonmark`

CommonMark mode (`boolean`, default: `false`).

    This is a paragraph
        and this is also part of the preceding paragraph.

Allows:

-   Empty lines to split block quotes
-   Parentheses (`(` and `)`) around link and image titles
-   Any escaped [ASCII punctuation](https://spec.commonmark.org/0.29/#backslash-escapes) character
-   Closing parenthesis (`)`) as an ordered list marker
-   URL definitions in block quotes

Disallows:

-   Indented code blocks directly following a paragraph
-   ATX headings (`# Hash headings`) without spacing after opening hashes or and before closing hashes
-   Setext headings (`Underline headings\n---`) when following a paragraph
-   Newlines in link and image titles
-   White space in link and image URLs in auto-links (links in brackets, `<` and `>`)
-   Lazy block quote continuation, lines not preceded by a greater than character (`>`), for lists, code, and thematic breaks

###### `options.pedantic`

‚ö†Ô∏è Pedantic was previously used to mimic old-style Markdown mode: no tables, no fenced code, and with many bugs. It‚Äôs currently still ‚Äúworking‚Äù, but please do not use it, it‚Äôll be removed in the future.

###### `options.blocks`

Blocks (`Array.<string>`, default: list of [block HTML elements](https://github.com/remarkjs/remark/blob/main/packages/remark-parse/lib/block-elements.js)).

    <block>foo
    </block>

Defines which HTML elements are seen as block level.

### `parse.Parser`

Access to the [parser](https://github.com/unifiedjs/unified#processorparser), if you need it.

Extending the `Parser`
----------------------

Typically, using [*transformers*](https://github.com/unifiedjs/unified#function-transformernode-file-next) to manipulate a syntax tree produces the desired output. Sometimes, such as when introducing new syntactic entities with a certain precedence, interfacing with the parser is necessary.

If the `remark-parse` plugin is used, it adds a [`Parser`](https://github.com/unifiedjs/unified#processorparser) constructor function to the `processor`. Other plugins can add tokenizers to its prototype to change how Markdown is parsed.

The below plugin adds a [tokenizer](#function-tokenizereat-value-silent) for at-mentions.

    module.exports = mentions

    function mentions() {
      var Parser = this.Parser
      var tokenizers = Parser.prototype.inlineTokenizers
      var methods = Parser.prototype.inlineMethods

      // Add an inline tokenizer (defined in the following example).
      tokenizers.mention = tokenizeMention

      // Run it just before `text`.
      methods.splice(methods.indexOf('text'), 0, 'mention')
    }

### `Parser#blockTokenizers`

Map of names to [tokenizer](#function-tokenizereat-value-silent)s (`Object.<Function>`). These tokenizers (such as `fencedCode`, `table`, and `paragraph`) eat from the start of a value to a line ending.

See `#blockMethods` below for a list of methods that are included by default.

### `Parser#blockMethods`

List of `blockTokenizers` names (`Array.<string>`). Specifies the order in which tokenizers run.

Precedence of default block methods is as follows:

-   `blankLine`
-   `indentedCode`
-   `fencedCode`
-   `blockquote`
-   `atxHeading`
-   `thematicBreak`
-   `list`
-   `setextHeading`
-   `html`
-   `definition`
-   `table`
-   `paragraph`

### `Parser#inlineTokenizers`

Map of names to [tokenizer](#function-tokenizereat-value-silent)s (`Object.<Function>`). These tokenizers (such as `url`, `reference`, and `emphasis`) eat from the start of a value. To increase performance, they depend on [locator](#tokenizerlocatorvalue-fromindex)s.

See `#inlineMethods` below for a list of methods that are included by default.

### `Parser#inlineMethods`

List of `inlineTokenizers` names (`Array.<string>`). Specifies the order in which tokenizers run.

Precedence of default inline methods is as follows:

-   `escape`
-   `autoLink`
-   `url`
-   `email`
-   `html`
-   `link`
-   `reference`
-   `strong`
-   `emphasis`
-   `deletion`
-   `code`
-   `break`
-   `text`

### `function tokenizer(eat, value, silent)`

There are two types of tokenizers: block level and inline level. Both are functions, and work the same, but inline tokenizers must have a [locator](#tokenizerlocatorvalue-fromindex).

The following example shows an inline tokenizer that is added by the mentions plugin above.

    tokenizeMention.notInLink = true
    tokenizeMention.locator = locateMention

    function tokenizeMention(eat, value, silent) {
      var match = /^@(\w+)/.exec(value)

      if (match) {
        if (silent) {
          return true
        }

        return eat(match[0])({
          type: 'link',
          url: 'https://social-network/' + match[1],
          children: [{type: 'text', value: match[0]}]
        })
      }
    }

Tokenizers *test* whether a document starts with a certain syntactic entity. In *silent* mode, they return whether that test passes. In *normal* mode, they consume that token, a process which is called ‚Äúeating‚Äù.

Locators enable inline tokenizers to function faster by providing where the next entity may occur.

###### Signatures

-   `Node? = tokenizer(eat, value)`
-   `boolean? = tokenizer(eat, value, silent)`

###### Parameters

-   `eat` ([`Function`](#eatsubvalue)) ‚Äî Eat, when applicable, an entity
-   `value` (`string`) ‚Äî Value which may start an entity
-   `silent` (`boolean`, optional) ‚Äî Whether to detect or consume

###### Properties

-   `locator` ([`Function`](#tokenizerlocatorvalue-fromindex)) ‚Äî Required for inline tokenizers
-   `onlyAtStart` (`boolean`) ‚Äî Whether nodes can only be found at the beginning of the document
-   `notInBlock` (`boolean`) ‚Äî Whether nodes cannot be in block quotes or lists
-   `notInList` (`boolean`) ‚Äî Whether nodes cannot be in lists
-   `notInLink` (`boolean`) ‚Äî Whether nodes cannot be in links

###### Returns

-   `boolean?`, in *silent* mode ‚Äî whether a node can be found at the start of `value`
-   [`Node?`](https://github.com/syntax-tree/unist#node), In *normal* mode ‚Äî If it can be found at the start of `value`

### `tokenizer.locator(value, fromIndex)`

Locators are required for inline tokenizers. Their role is to keep parsing performant.

The following example shows a locator that is added by the mentions tokenizer above.

    function locateMention(value, fromIndex) {
      return value.indexOf('@', fromIndex)
    }

Locators enable inline tokenizers to function faster by providing information on where the next entity *may* occur. Locators may be wrong, it‚Äôs OK if there actually isn‚Äôt a node to be found at the index they return.

###### Parameters

-   `value` (`string`) ‚Äî Value which may contain an entity
-   `fromIndex` (`number`) ‚Äî Position to start searching at

###### Returns

`number` ‚Äî Index at which an entity may start, and `-1` otherwise.

### `eat(subvalue)`

    var add = eat('foo')

Eat `subvalue`, which is a string at the start of the [tokenized](#function-tokenizereat-value-silent) `value`.

###### Parameters

-   `subvalue` (`string`) - Value to eat

###### Returns

[`add`](#addnode-parent).

### `add(node[, parent])`

    var add = eat('foo')

    add({type: 'text', value: 'foo'})

Add [positional information](https://github.com/syntax-tree/unist#position) to `node` and add `node` to `parent`.

###### Parameters

-   `node` ([`Node`](https://github.com/syntax-tree/unist#node)) - Node to patch position on and to add
-   `parent` ([`Parent`](https://github.com/syntax-tree/unist#parent), optional) - Place to add `node` to in the syntax tree. Defaults to the currently processed node

###### Returns

[`Node`](https://github.com/syntax-tree/unist#node) ‚Äî The given `node`.

### `add.test()`

Get the [positional information](https://github.com/syntax-tree/unist#position) that would be patched on `node` by `add`.

###### Returns

[`Position`](https://github.com/syntax-tree/unist#position).

### `add.reset(node[, parent])`

`add`, but resets the internal position. Useful for example in lists, where the same content is first eaten for a list, and later for list items.

###### Parameters

-   `node` ([`Node`](https://github.com/syntax-tree/unist#node)) - Node to patch position on and insert
-   `parent` ([`Node`](https://github.com/syntax-tree/unist#node), optional) - Place to add `node` to in the syntax tree. Defaults to the currently processed node

###### Returns

[`Node`](https://github.com/syntax-tree/unist#node) ‚Äî The given node.

### Turning off a tokenizer

In some situations, you may want to turn off a tokenizer to avoid parsing that syntactic feature.

Preferably, use the [`remark-disable-tokenizers`](https://github.com/zestedesavoir/zmarkdown/tree/HEAD/packages/remark-disable-tokenizers) plugin to turn off tokenizers.

Alternatively, this can be done by replacing the tokenizer from `blockTokenizers` (or `blockMethods`) or `inlineTokenizers` (or `inlineMethods`).

The following example turns off indented code blocks:

    remarkParse.Parser.prototype.blockTokenizers.indentedCode = indentedCode

    function indentedCode() {
      return true
    }

Security
--------

As Markdown is sometimes used for HTML, and improper use of HTML can open you up to a [cross-site scripting (XSS)](https://en.wikipedia.org/wiki/Cross-site_scripting) attack, use of remark can also be unsafe. When going to HTML, use remark in combination with the [**rehype**](https://github.com/rehypejs/rehype) ecosystem, and use [`rehype-sanitize`](https://github.com/rehypejs/rehype-sanitize) to make the tree safe.

Use of remark plugins could also open you up to other attacks. Carefully assess each plugin and the risks involved in using them.

Contribute
----------

See [`contributing.md`](https://github.com/remarkjs/.github/blob/HEAD/contributing.md) in [`remarkjs/.github`](https://github.com/remarkjs/.github) for ways to get started. See [`support.md`](https://github.com/remarkjs/.github/blob/HEAD/support.md) for ways to get help. Ideas for new plugins and tools can be posted in [`remarkjs/ideas`](https://github.com/remarkjs/ideas).

A curated list of awesome remark resources can be found in [**awesome remark**](https://github.com/remarkjs/awesome-remark).

This project has a [code of conduct](https://github.com/remarkjs/.github/blob/HEAD/code-of-conduct.md). By interacting with this repository, organization, or community you agree to abide by its terms.

License
-------

[MIT](https://github.com/remarkjs/remark/blob/main/license) ¬© [Titus Wormer](https://wooorm.com)
