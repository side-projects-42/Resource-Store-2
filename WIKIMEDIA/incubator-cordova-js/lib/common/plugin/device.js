var channel = require("cordova/channel"),
  utils = require("cordova/utils"),
  exec = require("cordova/exec");

// Tell cordova channel to wait on the CordovaInfoReady event
channel.waitForInitialization("onCordovaInfoReady");

/**
 * This represents the mobile device, and provides properties for inspecting the model, version, UUID of the
 * phone, etc.
 * @constructor
 */
function Device() {
  this.available = false;
  this.platform = null;
  this.version = null;
  this.name = null;
  this.uuid = null;
  this.cordova = null;

  var me = this;

  channel.onCordovaReady.subscribeOnce(function () {
    me.getInfo(
      function (info) {
        me.available = true;
        me.platform = info.platform;
        me.version = info.version;
        me.name = info.name;
        me.uuid = info.uuid;
        me.cordova = info.cordova;
        channel.onCordovaInfoReady.fire();
      },
      function (e) {
        me.available = false;
        utils.alert("[ERROR] Error initializing Cordova: " + e);
      }
    );
  });
}

/**
 * Get device info
 *
 * @param {Function} successCallback The function to call when the heading data is available
 * @param {Function} errorCallback The function to call when there is an error getting the heading data. (OPTIONAL)
 */
Device.prototype.getInfo = function (successCallback, errorCallback) {
  // successCallback required
  if (typeof successCallback !== "function") {
    console.log("Device Error: successCallback is not a function");
    return;
  }

  // errorCallback optional
  if (errorCallback && typeof errorCallback !== "function") {
    console.log("Device Error: errorCallback is not a function");
    return;
  }

  // Get info
  exec(successCallback, errorCallback, "Device", "getDeviceInfo", []);
};

module.exports = new Device();
