<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>atomic_design</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<p><a href="http://llvm.org/">LLVM Home</a></p>
<p>libc++ Info <a href="/index.html">About</a></p>
<p>Quick Links <a href="http://lists.cs.uiuc.edu/mailman/listinfo/cfe-dev">cfe-dev</a> <a href="http://lists.cs.uiuc.edu/mailman/listinfo/cfe-commits">cfe-commits</a> <a href="http://llvm.org/bugs/">Bug Reports</a> <a href="http://llvm.org/svn/llvm-project/libcxx/trunk/">Browse SVN</a> <a href="http://llvm.org/viewvc/llvm-project/libcxx/trunk/">Browse ViewVC</a></p>
<h1 id="atomic-design">&lt;atomic&gt; design</h1>
<p>There are currently 3 designs under consideration. They differ in where most of the implmentation work is done. The functionality exposed to the customer should be identical (and conforming) for all three designs.</p>
<ol type="1">
<li><a href="atomic_design_a.html">Minimal work for the library</a></li>
<li><a href="atomic_design_b.html">Something in between</a></li>
<li><a href="atomic_design_c.html">Minimal work for the front end</a></li>
</ol>
<p>With any design, the (back end) compiler writer should note:</p>
<blockquote>
<p>The decision to implement lock-free operations on any given type (or not) is an ABI-binding decision. One can not change from treating a type as not lock free, to lock free (or vice-versa) without breaking your ABI.</p>
<p>Example:</p>
<blockquote>
<pre><code>TU1.cc
-----------
extern atomic&lt;long long&gt; A;
int foo() { return A.compare_exchange_strong(w, x); }

TU2.cc
-----------
extern atomic&lt;long long&gt; A;
void bar() { return A.compare_exchange_strong(y, z); }</code></pre>
</blockquote>
</blockquote>
<p>If only <em>one</em> of these calls to <code>compare_exchange_strong</code> is implemented with mutex-locked code, then that mutex-locked code will not be executed mutually exclusively of the one implemented in a lock-free manner.</p>
</body>
</html>
